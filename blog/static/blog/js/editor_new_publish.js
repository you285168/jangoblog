if(typeof Sina=="undefined"){Sina={}}Sina.pkg=function(ns){if(!ns||!ns.length){return null}var levels=ns.split(".");var nsobj=Sina;for(var i=levels[0]=="Sina"?1:0;i<levels.length;++i){nsobj[levels[i]]=nsobj[levels[i]]||{};nsobj=nsobj[levels[i]]}return nsobj};function $E(oID){var node=typeof oID=="string"?document.getElementById(oID):oID;if(node!=null){return node}return null}function $C(tagName){return document.createElement(tagName)}function $N(name){return document.getElementsByName(name)}function $T(obj,tagName){return obj.getElementsByTagName(tagName)}try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}!function(){var bind=function(fFunction,object){var __method=fFunction;return function(){return __method.apply(object,arguments)}};var debug_namespace="Debug";if(window[debug_namespace]==null||typeof window[debug_namespace].log=="undefined"){window[debug_namespace]={cacheData:[],base_url:"http://sjs.sinajs.cn/bind2/",product:scope.$PRODUCT_NAME,baseColor:{1:{color:"#FFF",bgcolor:"#E00"},2:{color:"#F00"},3:{color:"#FFF000"},4:{color:"#0F0"},5:{color:"#FFF"}},fatal:function(sInfo){this.addData(sInfo,1)},error:function(sInfo){this.addData(sInfo,2)},warning:function(sInfo){this.addData(sInfo,3)},info:function(sInfo){this.addData(sInfo,4)},log:function(sInfo){this.addData(sInfo,5)},dir:function(oInfo){this.addData(oInfo,5)},addData:function(sInfo,nType,sColor,sBgColor){if(sInfo==null){return}if(typeof sInfo!="object"){sInfo=sInfo.toString()}var oOption={type:nType||"5",color:sColor||this.baseColor[nType].color,bgcolor:sBgColor||this.baseColor[nType].bgcolor};this.cacheData.push([sInfo,oOption]);if(this.initFinished==true){this.showCurrentData([sInfo,oOption])}}};window.trace=bind(window[debug_namespace].log,window[debug_namespace]);window.traceError=bind(window[debug_namespace].error,window[debug_namespace])}}();Sina.pkg("Core");if(typeof Core=="undefined"){Core=Sina.Core}Sina.pkg("Core.Array");Core.Array.foreach=function(ar,insp){if(ar==null&&ar.constructor!=Array){return[]}var i=0,len=ar.length,r=[];while(i<len){var x=insp(ar[i],i);if(x!==null){r[r.length]=x}i++}return r};Sina.pkg("Core.Events");!function(_s){var _ua=navigator.userAgent.toLowerCase();var system={$winXP:/windows nt 5.1/.test(_ua),$winVista:/windows nt 6.0/.test(_ua),$win7:/windows nt 6.1/.test(_ua),$macOS:/mac/.test(_ua)};var browser={$OPERA:false,$IE6:false,$IE7:false,$IE8:false,$IE9:false,$SAFARI:false,$FF2:false,$FF3:false,$FF4:false,$FF:false,$CHROME:false,$TT:false,$360:false,$SOGO:false,$Maxthon:false};var engine={$IE:0,$MOZ:false,$WEBKIT:false,$KHTML:false};if(/opera/.test(_ua)||_s.opera){browser.$OPERA=true}else if(/chrome\/(\S+)/.test(_ua)){browser.$CHROME=true}else if(/safari\/(\S+)/.test(_ua)){browser.$SAFARI=true}else if(/msie/.test(_ua)){engine.$IE=true;if(/360se/.test(_ua)){browser.$360=true}else if(/tencenttraveler/.test(_ua)){browser.$TT=true}else if(/se\s\S+\smetasr\s\d+\.\d+/.test(_ua)){browser.$SOGO=true}var uaVersionArray=_ua.match(/msie (\d+)/);var version=parseInt(uaVersionArray[1]);engine.$IE=version;if(version===8){browser.$IE8=true}else if(version===6){browser.$IE6=true}else if(version===9){browser.$IE9=true}else if(version===7){browser.$IE7=true}else if(version===10){browser.$IE10=true}}else if(/firefox/.test(_ua)){var uaVersionArray=_ua.match(/firefox\/(\d+)/);browser.$FF=parseInt(uaVersionArray[1]);if(/firefox\/3/.test(_ua)){browser.$FF3=true}else if(/firefox\/4/.test(_ua)){browser.$FF4=true}else if(/firefox\/2/.test(_ua)){browser.$FF2=true}}else if(/trident\/7.0/.test(_ua)&&/rv:11.0/.test(_ua)){engine.$IE=11;browser.$IE11=true}try{var t=window.external;browser.$Maxthon=t.max_version?true:false}catch(e){}if(/applewebkit\/(\S+)/.test(_ua)){engine.$WEBKIT=true}else if(/khtml\/(\S+)/.test(_ua)){engine.$KHTML=true}else if(/rv:([^\)]+)\) gecko\/\d{8}/.test(_ua)){engine.$MOZ=true}browser.$MOBILE=/mobile/i.test(_ua);if(!browser.$MOBILE){browser.$MOBILE=/HTC/.test(_ua)}function apply(thisObj,cfg){var p;for(p in cfg){thisObj[p]=cfg[p]}}apply(_s,browser);apply(_s,engine);apply(_s,system)}(window);Core.Events.addEvent=function(elm,func,evType,useCapture){var _el=typeof elm=="string"?$E(elm):elm;if(_el==null){trace("addEvent 找不到对象："+elm);return}if(typeof useCapture=="undefined"){useCapture=false}if(typeof evType=="undefined"){evType="click"}if(_el.addEventListener){if(evType=="mousewheel"&&$FF){evType="DOMMouseScroll"}_el.addEventListener(evType,func,useCapture);return true}else if(_el.attachEvent){var r=_el.attachEvent("on"+evType,func);return true}else{_el["on"+evType]=func}};Core.Events.removeEvent=function(oElement,fHandler,sName){var _el=$E(oElement);if(_el==null){trace("removeEvent 找不到对象："+oElement);return}if(typeof fHandler!="function"){return}if(typeof sName=="undefined"){sName="click"}if(_el.addEventListener){_el.removeEventListener(sName,fHandler,false)}else if(_el.attachEvent){_el.detachEvent("on"+sName,fHandler)}fHandler[sName]=null};Sina.pkg("Core.Function");Core.Function.bind3=function(fFunc,object,args){args=args==null?[]:args;var __method=fFunc;return function(){return __method.apply(object,args)}};Core.Array.findit=function(arr,v){var k=-1;Core.Array.foreach(arr,function(value,index){if(v==value){k=index}});return k};window.onerror=function(err,file,line){trace("Error occured:"+err+"<br/>file:"+file+"<br/>line:"+line+"<br/>");return true};function Jobs(oOption){this.option=oOption||{};this._jobTable=[[],[],[],[]]}Jobs.prototype={_registedJobTable:{},errorMsg:[],_registJob:function(jobName,rel){this._registedJobTable[jobName]=rel},error:function(sMsg){Debug.error(sMsg);this.errorMsg.push(sMsg)},add:function(jobName,type){type=type||1;if(Core.Array.findit(this._jobTable[type],jobName)==-1){this._jobTable[type].push(jobName)}else{this.error("Error: Job <b>"+jobName+"</b> is existed now.")}},start:function(){if(this.option.onStart!=null){this.option.onStart()}var regJobs=this._registedJobTable;var jobs=this._jobTable[1].concat(this._jobTable[2]);var _this=this;this.fe=Core.Function.bind3(_this.focus,_this,[]);var addFocus=function(){if(_this._jobTable[3].length==0){if(_this.option.onEnd!=null){_this.option.onEnd()}return}Core.Events.addEvent(document.body,_this.fe,"focus");Core.Events.addEvent(window,_this.fe,"scroll");Core.Events.addEvent(document.body,_this.fe,"mousemove");Core.Events.addEvent(document.body,_this.fe,"mouseover")};this.queue(jobs,addFocus)},focus:function(){var _this=this;if(this.focusdown){Core.Events.removeEvent(document.body,_this.fe,"focus");Core.Events.removeEvent(window,_this.fe,"scroll");Core.Events.removeEvent(document.body,_this.fe,"mousemove");Core.Events.removeEvent(document.body,_this.fe,"mouseover");_this.fe=null;return}this.focusdown=true;var jobs=this._jobTable[3];this.queue(jobs,this.option.onEnd)},queue:function(jobs,callback){var _this=this;var getTime=function(){return(new Date).valueOf()};var regJobs=this._registedJobTable;var joblen=jobs.length;var i=0;var interNum=window.setInterval(function(){if(i>=joblen){clearInterval(interNum);interNum=null;if(callback!=null){callback()}return}var jobName=jobs[i];var job=regJobs[jobName];i++;if(typeof job=="undefined"){_this.error("<b>Job["+jobName+"] is undefiend!!!</b>");return}var _try=true;var _start=getTime();try{job.call()}catch(e){_this.error("<b>Job["+jobName+"] failed!!!</b>"+e.message+"");if(callback!=null){callback()}_try=false;throw e}finally{if(_try){var _end=getTime();Debug.info("<b>Job["+jobName+"] done in "+(_end-_start)+"ms.</b>")}}},10)},call:function(jobName,args){if(typeof this._registedJobTable[jobName]!="undefined"){this._registedJobTable[jobName].apply(this,args)}else{trace("<b>Job["+jobName+"] is undefined!!!</b>",{color:"#900",bgColor:"#FFF;"})}}};$registJob=function(name,rel){Jobs.prototype._registJob(name,rel)};$callJob=function(name){var args=[];if(arguments.length>1){Core.Array.foreach(arguments,function(v,i){args[i]=v});args.shift()}Jobs.prototype.call(name,args)};Sina.pkg("Utils");if(typeof Utils=="undefined"){Utils=Sina.Utils}Sina.pkg("Utils.Io");Sina.pkg("Core.System");!function(){var parseParam=function(oSource,oParams){var key;try{if(typeof oParams!="undefined"){for(key in oSource){if(oParams[key]!=null){oSource[key]=oParams[key]}}}}finally{key=null;return oSource}};Core.System.parseParam=parseParam}();Sina.pkg("Core.String");Utils.Url=function(url){url=url||"";this.url=url;this.query={};this.parse()};Utils.Url.prototype={parse:function(url){if(url){this.url=url}this.parseAnchor();this.parseParam()},parseAnchor:function(){var anchor=this.url.match(/\#(.*)/);anchor=anchor?anchor[1]:null;this._anchor=anchor;if(anchor!=null){this.anchor=this.getNameValuePair(anchor);this.url=this.url.replace(/\#.*/,"")}},parseParam:function(){var query=this.url.match(/\?([^\?]*)/);query=query?query[1]:null;if(query!=null){this.url=this.url.replace(/\?([^\?]*)/,"");this.query=this.getNameValuePair(query)}},getNameValuePair:function(str){var o={};str.replace(/([^&=]*)(?:\=([^&]*))?/gim,function(w,n,v){if(n==""){return}o[n]=v||""});return o},getParam:function(sPara){return this.query[sPara]||""},clearParam:function(){this.query={}},setParam:function(name,value){if(name==null||name==""||typeof name!="string"){throw new Error("no param name set")}this.query=this.query||{};this.query[name]=value},setParams:function(o){this.query=o},serialize:function(o){var ar=[];for(var i in o){if(o[i]==null||o[i]==""){ar.push(i+"=")}else{ar.push(i+"="+o[i])}}return ar.join("&")},toString:function(){var queryStr=this.serialize(this.query);return this.url+(queryStr.length>0?"?"+queryStr:"")+(this.anchor?"#"+this.serialize(this.anchor):"")},getHashStr:function(forceSharp){return this.anchor?"#"+this.serialize(this.anchor):forceSharp?"#":""}};Core.String.encodeDoubleByte=function(str){if(typeof str!="string"){return str}return encodeURIComponent(str)};Utils.Io.JsLoad={};!function(){function createScripts(oOpts,oCFG){processUrl(oOpts,oCFG);var urls=oOpts.urls;var i,len=urls.length;for(i=0;i<len;i++){var js=$C("script");js.src=urls[i].url;js.charset=urls[i].charset;js.onload=js.onerror=js.onreadystatechange=function(){if(js&&js.readyState&&js.readyState!="loaded"&&js.readyState!="complete"){return}oCFG.script_loaded_num++;js.onload=js.onreadystatechange=js.onerror=null;if(!1!==oOpts.isRemove){js.src="";js.parentNode.removeChild(js)}js=null};document.getElementsByTagName("head")[0].appendChild(js)}}function processUrl(oOpts,oCFG){var urls=oOpts.urls;var get_hash=oOpts.GET;var i,len=urls.length;var key,url_cls,varname,rnd;for(i=0;i<len;i++){rnd=window.parseInt(Math.random()*1e8);url_cls=new Utils.Url(urls[i].url);for(key in get_hash){if(oOpts.noencode==true){url_cls.setParam(key,get_hash[key])}else{url_cls.setParam(key,Core.String.encodeDoubleByte(get_hash[key]))}}varname=url_cls.getParam("varname")||"requestId_"+rnd;if(oOpts.noreturn!=true){url_cls.setParam("varname",varname)}if(oOpts.returnType=="jsonp"){var name=url_cls.getParam("callback")||"callback_"+rnd;var callback="script_callbackes."+name;url_cls.setParam("callback",callback);if(!window.script_callbackes){window.script_callbackes=[]}window.script_callbackes[name]=function(res){oCFG.is_loadcomplete=true;delete window.script_callbackes[name];if(oCFG.timeout_flag!=null){clearTimeout(oCFG.timeout_flag)}if(oCFG.is_timeout){return}if(oOpts.onComplete!=null){oOpts.onComplete(res)}}}oCFG.script_var_arr.push(varname);urls[i].url=url_cls.toString();urls[i].charset=urls[i].charset||oOpts.charset}}function ancestor(aUrls,oOpts){var _opts={isRemove:!0,urls:[],charset:"utf-8",noreturn:false,noencode:false,returnType:"",timeout:-1,POST:{},GET:{},onComplete:null,onException:null};var _cfg={script_loaded_num:0,is_timeout:false,is_loadcomplete:false,script_var_arr:[],timeout_flag:null};_opts.urls=typeof aUrls=="string"?[{url:aUrls}]:aUrls;Core.System.parseParam(_opts,oOpts);createScripts(_opts,_cfg);if(_opts.returnType!="jsonp"){!function(){if(_opts.noreturn==true&&_opts.onComplete==null){return}var i,data=[];if(_cfg.script_loaded_num==_opts.urls.length){_cfg.is_loadcomplete=true;if(_opts.onComplete!=null){for(i=0;i<_cfg.script_var_arr.length;i++){data.push(window[_cfg.script_var_arr[i]])}if(_cfg.script_var_arr.length<2){_opts.onComplete(data[0])}else{_opts.onComplete(data)}}return}if(_cfg.is_timeout==true){return}setTimeout(arguments.callee,50)}()}if(_opts.timeout>0){_cfg.timeout_flag=setTimeout(function(){if(_cfg.is_loadcomplete!=true){if(_opts.onException!=null){_opts.onException()}_cfg.is_timeout=true}},_opts.timeout)}}Utils.Io.JsLoad.request=function(aUrls,oOpts){new ancestor(aUrls,oOpts)}}();if(typeof Lib=="undefined"){Lib={}}Lib.pkg=function(ns){if(!ns||!ns.length){return null}var levels=ns.split(".");var nsobj=Lib;for(var i=levels[0]=="Lib"?1:0;i<levels.length;++i){nsobj[levels[i]]=nsobj[levels[i]]||{};nsobj=nsobj[levels[i]]}return nsobj};Sina.pkg("Utils.Cookie");Utils.Cookie.getCookie=function(name){name=name.replace(/([\.\[\]\$])/g,"\\$1");var rep=new RegExp(name+"=([^;]*)?;","i");var co=document.cookie+";";var res=co.match(rep);if(res){return res[1]||""}else{return""}};Core.System.keyValue=function(string,key){var arr=string.match(new RegExp("(\\?|&)"+key+"=([^&]*)(&|$)"));if(arr!=null)return arr[2];return null};var __reqCheckLogin__=function(){var isReqEnd=false;var isReq=false;var funQueue=[];return function(func){funQueue.push(func);if(isReq){return}else if(isReqEnd){if(func){func()}}else{var times=(new Date).getTime();isReq=true;window["__check_login_status__"+times]=function(data){isReq=false;var user=data.user;$nick=user.nick||null;$UID=user.uid||null;$isLogin=!!$UID;if(typeof scope.$uid=="undefined"){$isAdmin=false}else{$isAdmin=scope.$uid==$UID}try{delete window["__check_login_status__"+times];document.head.removeChild(document.getElementById("jsonp_script"+times))}catch(e){}isReqEnd=true;for(var i=0;i<funQueue.length;i++){try{funQueue[i].call(null)}catch(e){console.log(e.stack)}}};var script=document.createElement("script");script.id="jsonp_script"+times;script.src="http://control.blog.sina.com.cn/riaapi/check_login.php?callback="+"__check_login_status__"+times;document.getElementsByTagName("head")[0].appendChild(script)}}}();Lib.checkAuthor=function(func,fileName){var AuthorInfo=Utils.Cookie.getCookie("SUBP");var _self=this;if(AuthorInfo&&AuthorInfo!=""){var arrSubp=sinaSSOEncoder.getSUBPCookie.decode(AuthorInfo);if(typeof arrSubp.nick!=="undefined"){$nick=decodeURIComponent(arrSubp.nick.replace(/(^\s*)|(\s*$)/g,""))}else{$nick="null"}if(typeof arrSubp.uid==="undefined"){$isLogin=false;$UID=null}else{$isLogin=true}if(typeof scope.$uid=="undefined"){$isAdmin=false}else{if(typeof arrSubp.uid!=="undefined"){$UID=arrSubp.uid.replace(/(^\s*)|(\s*$)/g,"");$isAdmin=scope.$uid==$UID}else{$isAdmin=false}}if(func&&fileName){func()}}else{__reqCheckLogin__(func)}};function v6SendLog(type,label){}function v7sendLog(type,pageid,msg){if(!type){return false}if(type.split("_").length==3){Lib.checkAuthor(function(){if($isLogin){type+="_"+$UID}},"v7SendLog"+(new Date).getTime())}if(typeof scope=="undefined"){window.scope={};scope.$pageid=""}pageid=pageid||scope.$pageid;msg=msg||"";Utils.Io.JsLoad.request("http://hits.sinajs.cn/A2/b.html?type="+type+"&pageid="+pageid+"&msg="+msg,{onComplete:function(){}})}Utils.Io.loadCss=function(oCss,oTarget){if(oCss==null){return false}oTarget=oTarget||window;var _target=oTarget.document;oCss.id=oCss.id||"";var _css;if(oCss.url){_css=_target.createElement("link");_css.setAttribute("rel","stylesheet");_css.setAttribute("type","text/css");_css.setAttribute("href",oCss.url)}else if(oCss.text){_css=_target.createElement("style");_css.setAttribute("type","text/css");if($IE){_css.styleSheet.cssText=oCss.text}else{_css.innerHTML=oCss.text}}_css.setAttribute("id",oCss.id);_target.getElementsByTagName("head")[0].appendChild(_css)};Lib.register=function(name,fn){var ns=name.split(".");var obj={},tmp,nsobj=Lib;while(tmp=ns.shift()){if(ns.length){if(nsobj[tmp]===undefined){nsobj[tmp]={}}nsobj=nsobj[tmp]}else{if(nsobj[tmp]===undefined){nsobj[tmp]=fn(Lib)}}}};Lib.register("util.loadScript",function(){var TRUE=!0,FALSE=!1,cache={};var loadScript=function(url,item){Utils.Io.JsLoad.request(url,{isRemove:FALSE,noreturn:TRUE,onComplete:function(data){cache[url].isLoading=FALSE;var cb=cache[url].cb;for(var i=0,len=cb.length;i<len;i++){cb[i](data)}cache[url].cb=null}})};return function(url,fun){var item=cache[url];var cb=item&&item["cb"];if(!item){cb=[fun];item={isLoading:TRUE,cb:cb};cache[url]=item;loadScript(url,item)}else if(item.isLoading){cb.push(fun)}else{fun()}}});Lib.register("sendSuda",function(lib){var url="http://www.sinaimg.cn/unipro/pub/suda_s_v851c.js";return function(fun){lib.util.loadScript(url,fun)}});Core.Array.uniq=function(ar){var result=[],x;for(var i=0;i<ar.length;i++){x=ar[i];if(Core.Array.findit(result,x)==-1){result.push(x)}}return result};Core.String.trimHead=function(str){return str.replace(/^(\u3000|\s|\t)*/gi,"")};Core.String.trimTail=function(str){return str.replace(/(\u3000|\s|\t)*$/gi,"")};Core.String.trim=function(str){return Core.String.trimHead(Core.String.trimTail(str))};Lib.Uic={_interfaceMultiquery:"http://uic.sso.sina.com.cn/uic/Mutiquery.php",cacheNickName:{},getNickName:function(arrUidLists,fCallBack,requestNo){var _self=this;Lib.checkAuthor(function(){arrUidLists=Core.Array.uniq(arrUidLists)||[];requestNo=requestNo||10;var _trim=Core.String.trim;var _cache=_self.cacheNickName,_uidWithNoCache=[],nickType=[];var _data={};for(var i=0,len=arrUidLists.length;i<len;i++){if(typeof _cache[arrUidLists[i]]=="undefined"&&_cache[arrUidLists[i]]==null){var nickEl=$E("ownernick");var pageid=_trim(scope.$pageid);if(arrUidLists[i]==$UID&&scope.nickname!=null){_data[arrUidLists[i]]=_trim(scope.nickname);continue}_uidWithNoCache.push(arrUidLists[i])}else{_data[arrUidLists[i]]=_cache[arrUidLists[i]]||arrUidLists[i]}}if(_uidWithNoCache.length==0){fCallBack(_data);_data=null}else{var urls=[];for(var i=0;i<_uidWithNoCache.length;i++){nickType[i]=1}if(_uidWithNoCache.length>0){if(nickType.length>0){nickType="["+nickType.toString().replace(/,$/g,"")+"]"}_uidWithNoCache="["+_uidWithNoCache.toString().replace(/,$/g,"")+"]";urls.push({url:_self._interfaceMultiquery+"?UID=0&Check=null&UIDS="+_uidWithNoCache+"&UserInfoTypes="+nickType+"&ProductType=2"})}var jsRequest=function(aUrl){Utils.Io.JsLoad.request(aUrl[0].url,{onComplete:function(data){if(data){var uids=data.UserInfos;for(var i=0;i<uids.length;i++){_data[uids[i][0]]=uids[i][2][1];Lib.Uic.cacheNickName[uids[i][0]]=uids[i][2][1]}fCallBack(_data)}}});if(urls.length>0){setTimeout(function(){jsRequest(urls.splice(0,1))},10)}};if(urls.length>0){setTimeout(function(){jsRequest(urls.splice(0,1))},10)}}},"UIC"+(new Date).getTime())}};Core.String.byteLength=function(str){if(typeof str=="undefined"){return 0}var aMatch=str.match(/[^\x00-\x80]/g);return str.length+(!aMatch?0:aMatch.length)};Core.String.leftB=function(str,len){var s=str.replace(/\*/g," ").replace(/[^\x00-\xff]/g,"**");str=str.slice(0,s.slice(0,len).replace(/\*\*/g," ").replace(/\*/g,"").length);if(Core.String.byteLength(str)>len)str=str.slice(0,str.length-1);return str};$registJob("suda",function(){var pageId=scope&&scope.$pageid;var wlh=window.location.href;var isTj=wlh.indexOf("tj=1")>-1;var suda_flag=pageId&&(pageId==="articletj"||pageId==="index"||pageId==="indexM"||pageId==="editor"||isTj);function addSudaPage(pageId,parm1,parm2,parm3,parm4){if(isTj){v7sendLog(parm4)}switch(pageId){case"index":case"indexM":v7sendLog(parm1);break;case"editor":v7sendLog(parm2);break;case"articletj":v7sendLog(parm3);break}}if(suda_flag){var url=encodeURIComponent(wlh);var refer=encodeURIComponent(document.referrer)}if(typeof _S_pSt=="function"){if(suda_flag){v7sendLog("42_01_03_"+(new Date).getTime()+"_"+url+"_"+refer)}return}Lib.checkAuthor(function(){if(suda_flag){if(!$isLogin){var tj="42_01_01_"+(new Date).getTime()+"_"+url+"_"+refer}else{var tj="42_01_01_"+$UID+"_"+(new Date).getTime()+"_"+url+"_"+refer}addSudaPage(pageId,"42_01_08","42_01_14",tj,"42_01_05")}Lib.sendSuda(function(){try{_S_pSt("")}catch(e){}if(suda_flag){if(!$isLogin){var succTj="42_01_02_"+(new Date).getTime()+"_"+url+"_"+refer}else{var succTj="42_01_02_"+$UID+"_"+(new Date).getTime()+"_"+url+"_"+refer}addSudaPage(pageId,"42_01_09","42_01_15",succTj,"42_01_06")}});var ele=$E("blognamespan");if(!ele){return}Lib.Uic.getNickName([scope.$uid],function(oResult){var nickName=oResult[scope.$uid];nickName=nickName.replace(/\u7684\u535a\u5ba2$/,"");nickName=Core.String.leftB(nickName,30);nickName=nickName+"的博客";ele.innerHTML=nickName})},"suda_blognamespan"+(new Date).getTime());!function(d,s,id){var n=d.getElementsByTagName(s)[0];if(d.getElementById(id))return;s=d.createElement(s);s.id=id;s.setAttribute("charset","utf-8");s.src="//d"+Math.floor(0+Math.random()*(8-0+1))+".sina.com.cn/litong/zhitou/sinaads/src/spec/sinaads_ck.js";n.parentNode.insertBefore(s,n)}(document,"script","sinaads-ck-script")});Core.String.j2o=function(str){if(!str||str==""){return null}try{var o=window.eval("("+str+")");return o}catch(e){trace("j2o : 数据分析出错");traceError(e);return null}};Core.Function.bind2=function(fFunc,object){var __method=fFunc;return function(){return __method.apply(object,arguments)}};Function.prototype.bind2=function(object){var __method=this;return function(){return __method.apply(object,arguments)}};Sina.pkg("Core.Dom");Core.Dom.getElementsByClass=function(el,tg,clz){el=el||document;var rs=[];clz=" "+clz+" ";var cldr=el.getElementsByTagName(tg),len=cldr.length;for(var i=0;i<len;++i){var o=cldr[i];if(o.nodeType==1){var ecl=" "+o.className+" ";if(ecl.indexOf(clz)!=-1){rs[rs.length]=o}}}return rs};Core.Dom.byClz=Core.Dom.getElementsByClass;Utils.Io.Ijax={arrTaskLists:[],createLoadingIframe:function(){if(this.loadFrames!=null){return false}var rndId1="loadingIframe_thread"+Math.ceil(Math.random()*1e4);var rndId2="loadingIframe_thread"+Math.ceil((Math.random()+1)*1e4);this.loadFrames=[rndId1,rndId2];var html='<iframe id="'+rndId1+'" name="'+rndId1+'" class="invisible"	              scrolling="no" src=""	              allowTransparency="true" style="display:none;" frameborder="0"	              ></iframe>				  <iframe id="'+rndId2+'" name="'+rndId2+'" class="invisible"	              scrolling="no" src=""	              allowTransparency="true" style="display:none;" frameborder="0"	              ></iframe>';var oIjaxIframeCnt=$C("div");oIjaxIframeCnt.id="ijax_iframes";oIjaxIframeCnt.innerHTML=html;trace("创建 Ijax 需要的 iframe");document.body.appendChild(oIjaxIframeCnt);var loadTimer=setInterval(Core.Function.bind2(function(){if($E(this.loadFrames[0])!=null&&$E(this.loadFrames[1])!=null){clearInterval(loadTimer);loadTimer=null;this.loadingIframe={thread1:{container:$E(this.loadFrames[0]),isBusy:false},thread2:{container:$E(this.loadFrames[1]),isBusy:false}};this.loadByList()}},this),10)},isIjaxReady:function(){if(typeof this.loadingIframe=="undefined"){return false}for(var oLoadCnt in this.loadingIframe){if(this.loadingIframe[oLoadCnt].isBusy==false){this.loadingIframe[oLoadCnt].isBusy=true;return this.loadingIframe[oLoadCnt]}}return false},request:function(url,option){var oTask={};oTask.url=url;oTask.option=option||{};this.arrTaskLists.push(oTask);if(this.loadFrames==null){this.createLoadingIframe()}else{this.loadByList()}},loadByList:function(){if(this.arrTaskLists.length==0){return false}var loadStatus=this.isIjaxReady();if(loadStatus==false){return false}var newData=this.arrTaskLists[0];this.loadData(newData.url,newData.option,loadStatus);this.arrTaskLists.shift()},loadData:function(url,option,loader){var _url=new Utils.Url(url);if(option.GET){for(var key in option.GET){_url.setParam(key,Core.String.encodeDoubleByte(option.GET[key]))}}if(!/\bdomain\b/.test(url)){_url.setParam("domain","1")}_url=_url.toString();var ifm=loader.container;ifm.listener=Core.Function.bind2(function(){try{var iframeObject=ifm.contentWindow.document,sResult;var tArea=Core.Dom.byClz(iframeObject,"textarea","")[0];if(typeof tArea!="undefined"){sResult=tArea.value}else{sResult=iframeObject.body.innerHTML}if(option.onComplete){option.onComplete(sResult)}else{option.onException()}}catch(e){traceError(e);if(option.onException){option.onException(e.message,_url.toString())}}loader.isBusy=false;Core.Events.removeEvent(ifm,ifm.listener,"load");this.loadByList()},this);Core.Events.addEvent(ifm,ifm.listener,"load");if(option.POST){var oIjaxForm=$C("form");oIjaxForm.id="IjaxForm";oIjaxForm.action=_url;oIjaxForm.method="post";oIjaxForm.target=ifm.id;for(var oItem in option.POST){var value;if(option.noEncode){value=Core.String.encodeDoubleByte(option.POST[oItem])}else{value=option.POST[oItem]}var oInput=$C("input");oInput.type="hidden";oInput.name=oItem;oInput.value=value;oIjaxForm.appendChild(oInput)}document.body.appendChild(oIjaxForm);oIjaxForm.submit()}else{try{window.frames(ifm.id).location.href=_url}catch(e){ifm.src=_url}}}};Utils.Io.Ajax={createRequest:function(){var request=null;try{request=new XMLHttpRequest}catch(trymicrosoft){try{request=new ActiveXObject("Msxml2.XMLHTTP")}catch(othermicrosoft){try{request=ActiveXObject("Microsoft.XMLHTTP")}catch(failed){}}}if(request==null){}else{return request}},request:function(url,option){option=option||{};option.onComplete=option.onComplete||function(){};option.onException=option.onException||function(){};option.returnType=option.returnType||"txt";option.method=option.method||"get";option.data=option.data||{};if(typeof option.GET!="undefined"&&typeof option.GET.url_random!="undefined"&&option.GET.url_random==0){this.rand=false;option.GET.url_random=null}return this.loadData(url,option)},loadData:function(url,option){var request=this.createRequest(),tmpArr=[];var _url=new Utils.Url(url);if(option.POST){for(var postkey in option.POST){var postvalue=option.POST[postkey];if(postvalue!=null){tmpArr.push(postkey+"="+Core.String.encodeDoubleByte(postvalue))}}}var sParameter=tmpArr.join("&")||"";if(option.GET){for(var key in option.GET){if(key!="url_random"){_url.setParam(key,Core.String.encodeDoubleByte(option.GET[key]))}}}if(this.rand!=false){}request.onreadystatechange=function(){if(request.readyState==4){var response,type=option.returnType;try{switch(type){case"txt":response=request.responseText;break;case"xml":if($IE){response=request.responseXML}else{var Dparser=new DOMParser;response=Dparser.parseFromString(request.responseText,"text/xml")}break;case"json":response=eval("("+request.responseText+")");break}option.onComplete(response)}catch(e){option.onException(e.message,_url);return false}}};try{if(option.POST){request.open("POST",_url,true);request.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");request.withCredentials=true;request.send(sParameter)}else{request.open("GET",_url,true);request.send(null)}}catch(e){option.onException(e.message,_url);return false}return request}};Sina.pkg("Core.Class");Core.Class.AsPrototype={};Core.Class.create=function(){return function(t){if(t!=Core.Class.AsPrototype){this.initialize.apply(this,arguments)}}};if($IE6&&typeof Utils.Io.Ijax!="undefined"){Utils.Io.Ijax.loadData=function(url,option,loader){var _url=new Utils.Url(url);if(option.GET){for(var key in option.GET){_url.setParam(key,Core.String.encodeDoubleByte(option.GET[key]))}}if(!/\bdomain\b/.test(url)){_url.setParam("domain","1")}_url=_url.toString();var ifm=loader.container;ifm.listener=Core.Function.bind2(function(){try{var iframeObject=ifm.contentWindow.document,sResult;var tArea=Core.Dom.byClz(iframeObject,"textarea","")[0];if(typeof tArea!="undefined"){sResult=tArea.value}else{sResult=iframeObject.body.innerHTML}if(option.onComplete){option.onComplete(sResult)}else{option.onException()}}catch(e){traceError(e);if(option.onException){option.onException(e.message,_url.toString())}}loader.isBusy=false;Core.Events.removeEvent(ifm,ifm.listener,"load");this.loadByList()},this);Core.Events.addEvent(ifm,ifm.listener,"load");if(option.POST){var oIjaxForm=$C("form");oIjaxForm.id="IjaxForm";oIjaxForm.action=_url;oIjaxForm.method="post";oIjaxForm.target=ifm.id;for(var oItem in option.POST){var value;if(option.noEncode){value=Core.String.encodeDoubleByte(option.POST[oItem])}else{value=option.POST[oItem]}var oInput=$C("input");oInput.type="hidden";oInput.name=oItem;oInput.value=value;oIjaxForm.appendChild(oInput)}document.body.appendChild(oIjaxForm);var timenum=100;function innerfun(){if(timenum>0){try{oIjaxForm.submit()}catch(e){setTimeout(innerfun,10)}}timenum--}innerfun()}else{try{window.frames(ifm.id).location.href=_url}catch(e){ifm.src=_url}}}}var Interface=function(url,type){this.url=new Utils.Url(url);this.type=type.toLowerCase()};Interface.prototype={url:null,type:"",request:function(option){var err=option.onError;var suc=option.onSuccess;option.onComplete=option.onSuccess=function(result){try{if(typeof result=="string"){result=result.replace(/;$/,"")}result=typeof result=="string"&&/\s*{/.test(result)?Core.String.j2o(result):result;if(result!=null&&typeof result.code=="undefined"){trace("接口数据异常："+this.url,"#F00");return}if(result!=null){if(result.code=="A00006"){suc(result.data)}else{err(result)}}else{err(result)}}catch(e){traceError(e)}}.bind2(this);option.onException=option.onError=option.onFail||function(){trace("接口失败："+this.url,"#F00");if(arguments.length>0){for(var i=0,len=arguments.length;i<len;i++){if(arguments[i]&&typeof arguments[i]!="undefined"){trace("错误信息："+arguments[i].toString())}}}}.bind2(this);var requestURL=this.url.toString();switch(this.type){case"ijax":Utils.Io.Ijax.request(requestURL,option);break;case"ajax":Utils.Io.Ajax.request(requestURL,option);break;case"script":case"jsload":Utils.Io.JsLoad.request(requestURL,option);break;default:throw new Error("未指定有效的数据传输类型")}}};!function(){function object(o){function F(){}F.prototype=o;return new F}Function.prototype.$define=function(def){var k;for(k in def){this.prototype[k]=def[k]}if(this.__interface__){for(k in this.prototype){if(this.prototype[k]==="NI"){throw new Error("类定义错误，接口方法["+k+"]未实现")}}}this.prototype.constructor=this;this.$extends=this.$define=this.$implements=function(){throw new Error("$define语句定义后面不能再作其它定义")};return this};Function.prototype.$extends=function(){var me=this,i=arguments.length,sup,fn;if(i===0){throw new Error("$extends语句错误：未指定父类")}sup=arguments[0];fn=function(){sup.apply(this,arguments);me.apply(this,arguments)};fn.prototype=object(sup.prototype);fn.prototype.constructor=fn;fn.$super=sup.prototype;return fn};Function.prototype.$implements=function(){var arg=Array.prototype.slice.call(arguments,0),fn,i=arg.length,k;while(i--){if(typeof arg[i]!=="object"){throw new Error("$implements语句错误：参数必须为object类型")}for(k in arg[i]){typeof this.prototype[k]==="undefined"&&(this.prototype[k]="NI")}}this.__interface__=true;this.$extends=function(){throw new Error("$extends语句错误:$extends语句不能出现在$implements定义之后")};return this}}();Core.Events.getEvent=function(){return window.event};if(!$IE||$IE>8){Core.Events.getEvent=function(){if(!$IE&&window.event){return window.event}var o=arguments.callee.caller;var e;var n=0;while(o!=null&&n<40){e=o.arguments[0];if(e&&(e.constructor==Event||e.constructor==MouseEvent)){return e}n++;o=o.caller}return e}}Core.Events.stopEvent=function(el){var ev=el?el:Core.Events.getEvent();if(ev!=null){ev.cancelBubble=true;ev.returnValue=false}};if(!$IE||$IE>8){Core.Events.stopEvent=function(el){var ev=el?el:Core.Events.getEvent();if(ev!=null){ev.preventDefault();ev.stopPropagation()}}}Sina.pkg("Ui");if(typeof Ui=="undefined"){Ui=Sina.Ui}Ui.Template=function(tmpl){this.tmpl=tmpl;this.pattern=/(#\{(.*?)\})/g};Ui.Template.prototype={evaluate:function(data){return this.tmpl.replace(this.pattern,function(){return data[arguments[2]]||""})},evaluateMulti:function(data,reverse){var _buffer=[];Core.Array.foreach(data,Core.Function.bind2(function(v,i){i=reverse?data.length-i:i;_buffer[i]=this.evaluate(v)},this));return _buffer.join("")}};Core.Dom.setStyle=function(el,property,val){switch(property){case"opacity":el.style.filter="alpha(opacity="+val*100+")";if(!el.currentStyle||!el.currentStyle.hasLayout){el.style.zoom=1
}break;case"float":property="styleFloat";default:el.style[property]=val}};if(!$IE||!($IE<9)){Core.Dom.setStyle=function(el,property,val){if(property=="float"){property="cssFloat"}el.style[property]=val}}!function(){Core.Function.defineGetter=function(obj,p,fn){if(p instanceof Array&&fn instanceof Array){var i=Math.min(p.length,fn.length);while(i--){if(typeof p[i]==="string"&&__checkFunction(fn[i])){obj[p[i]]={valueOf:function(j){return function(){return __getValue(obj,fn[j])}}(i),toString:this.valueOf}}}}else if(typeof p==="string"&&__checkFunction(fn)){obj[p]={valueOf:function(){return __getValue(obj,fn)},toString:this.valueOf}}};function __checkFunction(fn){return typeof fn!=="string"&&String.prototype.slice.call(fn,0,8)=="function"}function __getValue(obj,fn){var ret=fn.call(obj);return typeof ret==="string"||typeof ret==="number"?ret:null}}();Ui.IE6FixedController=function(){var me=this;this.node=null;this.iframeNode=null;this.__orgX=0;this.__orgY=0;this.__isBindScroll=false;this.__fixedHandle=function(){if(me.node){me.node.style.left=document.documentElement.scrollLeft+me.__orgX+"px";me.node.style.top=document.documentElement.scrollTop+me.__orgY+"px"}if(me.iframeNode){me.iframeNode.style.left=me.node.style.left;me.iframeNode.style.top=me.node.style.top}}}.$define({setFixed:function(node,state){this.updateOrgPosition();if(state&&!this.__isBindScroll){Core.Events.addEvent(window,this.__fixedHandle,"scroll");this.__isBindScroll=true}if(!state&&this.__isBindScroll){Core.Events.removeEvent(window,this.__fixedHandle,"scroll");this.__isBindScroll=false}},setPosition:function(node,fixedState,p){if(typeof p.x!=="undefined"){if(fixedState){node.style.left=p.x+document.documentElement.scrollLeft+"px";this.__orgX=parseInt(this.node.style.left)-document.documentElement.scrollLeft}else{node.style.left=p.x+"px"}}if(typeof p.y!=="undefined"){if(fixedState){node.style.top=p.y+document.documentElement.scrollTop+"px";this.__orgY=parseInt(this.node.style.top)-document.documentElement.scrollTop}else{node.style.top=p.y+"px"}}typeof p.z!=="undefined"&&(node.style.zIndex=p.z)},getX:function(node,fixedState){if(fixedState){return parseInt(node.style.left)-document.documentElement.scrollLeft}else{return parseInt(node.style.left)}},getY:function(node,fixedState){if(fixedState){return parseInt(node.style.top)-document.documentElement.scrollTop}else{return parseInt(node.style.top)}},updateIframe:function(isFixed){this.setFixed(this.iframeNode,isFixed);isFixed&&this.__fixedHandle()},updateOrgPosition:function(){if(!this.node){return}this.__orgX=parseInt(this.node.style.left)-document.documentElement.scrollLeft;this.__orgY=parseInt(this.node.style.top)-document.documentElement.scrollTop},destroy:function(){Core.Events.removeEvent(window,this.__fixedHandle,"scroll");this.__isBindScroll=false;this.node=null;this.iframeNode=null}});Core.Events.EventDispatcher=function(target){this.__target=target;this.__events={}}.$define({addEventListener:function(type,handle){if(!this.__checkFunction(handle)){return}var evts=this.__events;type=type.toLowerCase();!evts[type]&&(evts[type]=[]);evts[type].push(handle)},removeEventListener:function(type,handle){var evts=this.__events[type];type=type.toLowerCase();if(!this.__checkFunction(handle)||!evts||!evts.length){return}for(var i=evts.length-1;i>=0;i--){evts[i]==handle&&evts.splice(i,1)}},dispatchEvent:function(type){type=type.toLowerCase();var evts=this.__events[type];if(!evts||!evts.length){return}var args=Array.prototype.slice.call(arguments,0);args.shift();for(var i=0,l=evts.length;i<l;i++){evts[i].apply(this.__target,args)}},__checkFunction:function(func){return typeof func!=="string"&&String.prototype.slice.call(func,0,8)=="function"}});Ui.IRenderer={setCanShow:function(state){},setCanHidden:function(state){},show:function(node){},hidden:function(node){},addEventListener:function(type,handle){},removeEventListener:function(type,handle){}};Ui.SimpleRenderer=function(){this.__canShow=true;this.__canHidden=true;this.__eventDispatcher=new Core.Events.EventDispatcher(this)}.$implements(Ui.IRenderer).$define({setCanShow:function(state){this.__canShow=!!state},setCanHidden:function(state){this.__canHidden=!!state},show:function(node){this.__eventDispatcher.dispatchEvent("beforeShow");if(this.__canShow){node.style.display="";this.__eventDispatcher.dispatchEvent("show")}return this},hidden:function(node){this.__eventDispatcher.dispatchEvent("beforeHidden");if(this.__canHidden){node.style.display="none";this.__eventDispatcher.dispatchEvent("hidden")}return this},addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this}});Ui.DisplayObject=function(parent,node){Core.Function.defineGetter(this,["x","y","z","width","height"],[this.__getX,this.__getY,this.__getZ,this.__getWidth,this.__getHeight]);this.__renderer=null;this.__entity=node;this.__isInited=false;this.__parent=parent||document.body;this.__eventDispatcher=new Core.Events.EventDispatcher(this);var ed=this.__eventDispatcher;this.__onBeforeShow=function(){ed.dispatchEvent("beforeShow")};this.__onShow=function(){ed.dispatchEvent("show")};this.__onBeforeHidden=function(){ed.dispatchEvent("beforeHidden")};this.__onHidden=function(){ed.dispatchEvent("hidden")};this.__updateRenderer(Ui.SimpleRenderer)}.$define({isShow:!1,isHidden:!0,setPosition:function(p){!this.__isInited&&this.__initEntity();typeof p.x!=="undefined"&&(this.__entity.style.left=p.x+"px");typeof p.y!=="undefined"&&(this.__entity.style.top=p.y+"px");typeof p.z!=="undefined"&&(this.__entity.style.zIndex=p.z);return this},setSize:function(p){!this.__isInited&&this.__initEntity();typeof p.width!=="undefined"&&(this.__entity.style.width=p.width+"px");typeof p.height!=="undefined"&&(this.__entity.style.height=p.height+"px");return this},setRenderer:function(rendererConstructor){!this.__isInited&&this.__initEntity();this.__updateRenderer(rendererConstructor);return this},show:function(rendererConstructor){this.isHidden=!1;this.isShow=!0;!this.__isInited&&this.__initEntity();this.__updateRenderer(rendererConstructor);this.__renderer.show(this.__entity);return this},hidden:function(rendererConstructor){return this.hide(rendererConstructor)},hide:function(rendererConstructor){this.isHidden=!0;this.isShow=!1;!this.__isInited&&this.__initEntity();this.__updateRenderer(rendererConstructor);this.__renderer.hidden(this.__entity);return this},setCanShow:function(state){this.__renderer.setCanShow(state);return this},setCanHidden:function(state){this.__renderer.setCanHidden(state);return this},addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this},destroy:function(){if(!this.__entity){return}!this.__isInited&&this.__initEntity();this.__entity.parentNode&&this.__entity.parentNode.removeChild(this.__entity);this.__entity=null},__initEntity:function(){var st;!this.__entity&&(this.__entity=$C("div"));st=this.__entity.style;st.position="absolute";st.left=0;st.top=0;!this.__entity.parentNode&&this.__parent.appendChild(this.__entity);this.__isInited=true},__updateRenderer:function(rendererConstructor){if(!rendererConstructor){return}var addEvent=function(){this.__renderer.addEventListener("beforeShow",this.__onBeforeShow).addEventListener("show",this.__onShow).addEventListener("beforeHidden",this.__onBeforeHidden).addEventListener("hidden",this.__onHidden)};if(!this.__renderer){this.__renderer=new rendererConstructor;addEvent.call(this)}else if(this.__renderer.constructor!==rendererConstructor){this.__renderer.removeEventListener("beforeShow",this.__onBeforeShow).removeEventListener("show",this.__onShow).removeEventListener("beforeHidden",this.__onBeforeHidden).removeEventListener("hidden",this.__onHidden);this.__renderer=new rendererConstructor;addEvent.call(this)}},__getX:function(){!this.__isInited&&this.__initEntity();return parseInt(this.__entity.style.left)},__getY:function(){!this.__isInited&&this.__initEntity();return parseInt(this.__entity.style.top)},__getZ:function(){!this.__isInited&&this.__initEntity();return parseInt(this.__entity.style.zIndex)},__getWidth:function(){!this.__isInited&&this.__initEntity();return this.__getSize(this.__entity,"offsetWidth")},__getHeight:function(){!this.__isInited&&this.__initEntity();return this.__getSize(this.__entity,"offsetHeight")},__getSize:function(node,p){var et=node,v,ov=et.style.visibility;if(et.style.display=="none"){et.style.visibility="hidden";et.style.display="";v=et[p];et.style.display="none";et.style.visibility=ov}else{v=et[p]}return v}});Ui.Panel=function(parent,node){this.nodes={};this.uniqueID=this.__getUniqueID();this.entity=null;this.__iframe=null;this.__isSetAdamant=false;this.__templateNodesIDs=[];this.__isFixed=false;$IE6&&(this.__ie6FixedController=new Ui.IE6FixedController)}.$extends(Ui.DisplayObject).$define({setTemplate:function(tpl){var nd=$C("div");nd.innerHTML=new Ui.Template(tpl).evaluate(this.__getNodes(tpl,"i"));nd.style.display="none";this.__parent.appendChild(nd);this.__updateTemplate(nd);this.nodes=this.__getNodes(tpl);this.entity=this.__entity;this.nodes.panel=this.entity;return this},setFixed:function(state){!this.__isInited&&this.__initEntity();var x=parseInt(this.__entity.style.left),y=parseInt(this.__entity.style.top);if($IE6){this.__ie6FixedController.setFixed(this.__entity,state);this.__isSetAdamant&&this.__ie6FixedController.setFixed(this.__iframe,state)}else{if(state&&!this.__isFixed){this.setPosition({x:x-Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),y:y-Math.max(document.documentElement.scrollTop,document.body.scrollTop)});this.__entity.style.position="fixed"}if(!state&&this.__isFixed){this.setPosition({x:x+Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),y:y+Math.max(document.documentElement.scrollTop,document.body.scrollTop)});this.__entity.style.position="absolute"}}this.__isFixed=!!state;this.__updateIframe();return this},setAdamant:function(state){this.__isSetAdamant=!!state;this.__isSetAdamant&&!this.__iframe&&this.__createIframe();this.__updateIframe();return this},destroy:function(){if(!this.__entity){return}Ui.Panel.$super.destroy.call(this);this.__ie6FixedController&&this.__ie6FixedController.destroy();this.__iframe&&this.__iframe.parentNode.removeChild(this.__iframe)},setPosition:function(p){!this.__isInited&&this.__initEntity();if($IE6){this.__ie6FixedController.setPosition(this.__entity,this.__isFixed,p)}else{Ui.Panel.$super.setPosition.call(this,p)}this.__updateIframe();return this},setSize:function(p){Ui.Panel.$super.setSize.call(this,p).__updateIframe();return this},show:function(renderer){Ui.Panel.$super.show.call(this,renderer).__updateIframe();return this},hidden:function(renderer){Ui.Panel.$super.hidden.call(this,renderer).__updateIframe();return this},__getX:function(){!this.__isInited&&this.__initEntity();if($IE6){return this.__ie6FixedController.getX(this.__entity,this.__isFixed)}else{return parseInt(this.__entity.style.left)}},__getY:function(){!this.__isInited&&this.__initEntity();if($IE6){return this.__ie6FixedController.getY(this.__entity,this.__isFixed)}else{return parseInt(this.__entity.style.top)}},__createIframe:function(){this.__iframe=$C("iframe");this.__iframe.frameBorder="none";this.__parent.insertBefore(this.__iframe,this.__entity);Core.Dom.setStyle(this.__iframe,"opacity",0);this.__ie6FixedController&&(this.__ie6FixedController.iframeNode=this.__iframe);this.__updateIframe()},__updateIframe:function(){if(this.__iframe){var st=this.__iframe.style;st.backgroundColor="#ffffff";st.left=this.x+"px";st.top=this.y+"px";st.width=this.width+"px";st.height=this.height+"px";st.position=this.__entity.style.position;st.display=this.__entity.style.display;st.zIndex=this.__entity.style.zIndex;$IE6&&this.__ie6FixedController.updateIframe(this.__isFixed)}},__updateIE6FCOrgPosition:function(){this.__ie6FixedController&&this.__ie6FixedController.updateOrgPosition()},__updateTemplate:function(nd){var l,t,z,p,d,et=this.__entity;if(et){et.parentNode&&et.parentNode.removeChild(et);l=et.style.left;t=et.style.top;z=et.style.zIndex;p=et.style.position;d=et.style.display}else{d="none"}et=this.__entity=$E("_"+this.uniqueID+"_panel");if(!et){et=this.__entity=$E("_"+this.uniqueID+"_entity")}if(!et){throw new Error("[Panel Error]there missing identifier #{panel} in panel template")}et.style.left=l||0;et.style.top=t||0;et.style.zIndex=z||0;et.style.position=p||"absolute";et.style.display=d;this.__parent.replaceChild(et,nd);this.__ie6FixedController&&(this.__ie6FixedController.node=this.__entity)},__getNodes:function(template,mode){var m=mode||"o",p=/\{[^\}]+(?=\})/g,i,nodes={},rets,r;this.__templateNodesIDs=template.match(p);rets=this.__templateNodesIDs;if(rets){i=rets.length;while(i--){r=rets[i].replace("{","");switch(m){case"o":nodes[r]=$E("_"+this.uniqueID+"_"+r);break;case"i":nodes[r]="_"+this.uniqueID+"_"+r;break}}}return nodes},__getUniqueID:function(){return parseInt(Math.random()*1e3).toString()+(new Date).getTime().toString()},setContent:function(str){this.nodes.content&&(this.nodes.content.innerHTML=str)},getNodes:function(){return this.nodes}});Ui.Drag=function(captureNode,attachNodes,isDragCapureNode){var me=this;this.canDrag=true;this.isLock=false;this.lockArea={left:0,right:0,top:0,bottom:0};this.__captureNode=captureNode;this.__dragNodes=[];this.__deltaX=[];this.__deltaY=[];this.__eventDispatcher=new Core.Events.EventDispatcher(this);this.__isDraging=false;this.__canDragX=true;this.__canDragY=true;this.__dragHandle=function(){me.__drag()};this.__mouseDownHandle=function(){me.__isDraging=true;me.__eventDispatcher.dispatchEvent("beforeDrag");me.__setCapture(true)};this.__mouseUpHandle=function(){me.__isDraging&&me.__eventDispatcher.dispatchEvent("afterDrag");me.__isDraging=false;me.__setCapture(false)};this.__initNodes(captureNode,attachNodes,isDragCapureNode);this.__initCaputerNode()}.$define({addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this},destroy:function(){Core.Events.removeEvent(this.__captureNode,this.__mouseDownHandle,"mousedown");Core.Events.removeEvent(document,this.__mouseUpHandle,"mouseup");this.__captureNode=null;this.__dragNodes=null},__initNodes:function(captureNode,attachNodes,isDragCapureNode){if(attachNodes){attachNodes instanceof Array?this.__dragNodes=attachNodes:this.__dragNodes.push(attachNodes);(typeof isDragCapureNode==="undefined"||isDragCapureNode)&&this.__dragNodes.push(this.__captureNode)}else{this.__dragNodes.push(this.__captureNode)}var dns=this.__dragNodes,i=dns.length;while(i--){!dns[i].style.position&&(dns[i].style.position="absolute");!dns[i].style.left&&(dns[i].style.left=0);!dns[i].style.top&&(dns[i].style.top=0)}},__initCaputerNode:function(){var cn=this.__captureNode,me=this;Core.Events.addEvent(cn,this.__mouseDownHandle,"mousedown");Core.Events.addEvent(document,this.__mouseUpHandle,"mouseup")},__setCapture:function(isCapture){var cn=this.__captureNode,dns=this.__dragNodes,evt=Core.Events.getEvent(),i=dns.length;while(i--){this.__deltaX[i]=evt.clientX-parseInt(dns[i].style.left);this.__deltaY[i]=evt.clientY-parseInt(dns[i].style.top)}if(isCapture){if($IE){cn.setCapture();Core.Events.addEvent(cn,this.__dragHandle,"mousemove")}else{Core.Events.addEvent(document,this.__dragHandle,"mousemove")}}else{if($IE){cn.releaseCapture();Core.Events.removeEvent(cn,this.__dragHandle,"mousemove")}else{Core.Events.removeEvent(document,this.__dragHandle,"mousemove")}}},__drag:function(){if(!this.canDrag){return}var dns=this.__dragNodes,evt=Core.Events.getEvent(),i=dns.length,la=this.lockArea,dX=0,dY=0;this.__eventDispatcher.dispatchEvent("drag");while(i--){dX=evt.clientX-this.__deltaX[i];dY=evt.clientY-this.__deltaY[i];if(this.isLock){dX=Math.min(Math.max(dX,la.left),la.right);dY=Math.min(Math.max(dY,la.top),la.bottom)}dns[i].style.left=dX+"px";dns[i].style.top=dY+"px"}}});Ui.IDragger={addEventListener:function(type,handle){},removeEventListener:function(type,handle){},setDrag:function(node,attachNodes,isDragCapureNode){},setLock:function(state){},setArea:function(area){},destroy:function(){}};Ui.SimpleDragger=function(){this.__drag=null;this.__eventDispatcher=new Core.Events.EventDispatcher(this)}.$implements(Ui.IDragger).$define({addEventListener:function(type,handle){if(type.toLowerCase()==="afterdrag"){this.__eventDispatcher.addEventListener(type,handle)}else{this.__drag.addEventListener(type,handle)}return this},removeEventListener:function(type,handle){if(type.toLowerCase()==="afterdrag"){this.__eventDispatcher.removeEventListener(type,handle)}else{this.__drag.removeEventListener(type,handle)}return this},setDrag:function(node,attachNode,isDragCapureNode){var me=this;this.__drag=new Ui.Drag(node,attachNode,isDragCapureNode);this.__drag.addEventListener("afterDrag",function(){me.__eventDispatcher.dispatchEvent("afterDrag")});return this},setLock:function(state){this.__drag.isLock=!!state;return this},setArea:function(area){this.__drag.lockArea=area;return this},destroy:function(){this.__drag.destroy()}});Ui.Dialog=function(parent,node){var me=this;this.__dragger=null;this.__isBindUpadateAreaEvent=false;this.__isBindUpdateIE6AreaEvent=false;this.__beforeDragHandle=function(){me.__updateDraggerArea();me.__eventDispatcher.dispatchEvent("beforedrag")};this.__dragHandle=function(){me.__isSetAdamant&&me.__updateIframe();me.__eventDispatcher.dispatchEvent("drag")};this.__afterDragHandle=function(){me.__isFixed&&$IE6&&me.__updateIE6FCOrgPosition();me.__eventDispatcher.dispatchEvent("afterdrag")};this.__updateDraggerAreaHandle=function(){setTimeout(function(){me.__updateDraggerArea()},1)};this.__setMiddleHandle=function(){me.setMiddle()}}.$extends(Ui.Panel).$define({setTemplate:function(tpl){Ui.Dialog.$super.setTemplate.call(this,tpl);this.__initTitleBar();this.setDragger(Ui.SimpleDragger);return this},setContent:function(content){if(!this.nodes.content){return this}this.nodes.content.innerHTML=new Ui.Template(content).evaluate(this.__getNodes(content,"i"));this.__addContentNodes(this.__getNodes(content));return this},setFixed:function(state){Ui.Dialog.$super.setFixed.call(this,state);if(state){Core.Events.addEvent(window,this.__setMiddleHandle,"resize")}else{Core.Events.removeEvent(window,this.__setMiddleHandle,"resize")}this.__updateDraggerArea();return this},setMiddle:function(){var areaHeight=this.__getDocumentSize().height-this.height,goldenSection=(Math.sqrt(5)-1)/2,totalSection=1,goldenSectionY=areaHeight*goldenSection/(goldenSection+totalSection),middleX=this.__getDocumentSize().width/2-this.width/2;if(!this.__isFixed){goldenSectionY+=Math.max(document.documentElement.scrollTop,document.body.scrollTop);middleX+=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft)}this.setPosition({x:Math.max(middleX,0),y:Math.max(goldenSectionY,0)});return this},setAreaLocked:function(state){if(!this.__dragger){return this}this.__dragger.setLock(state);return this},setSize:function(p){!this.__isInited&&this.__initEntity();if(this.nodes.content){typeof p.width!=="undefined"&&(this.nodes.content.style.width=p.width+"px");typeof p.height!=="undefined"&&(this.nodes.content.style.height=p.height+"px")}else{typeof p.width!=="undefined"&&(this.__entity.style.width=p.width+"px");typeof p.height!=="undefined"&&(this.__entity.style.height=p.height+"px")}return this},setDragger:function(draggerConstructor){if(!this.nodes.titleBar||!draggerConstructor){return this}if(!this.__dragger){this.__dragger=new draggerConstructor}else if(this.__dragger.constructor===draggerConstructor){return this}this.__updateDragger(draggerConstructor);return this},destroy:function(){if(!this.__entity){return}Ui.Dialog.$super.destroy.call(this);Core.Events.removeEvent(window,this.__updateDraggerAreaHandle,"resize");Core.Events.removeEvent(window,this.__setMiddleHandle,"resize")},__addContentNodes:function(nodes){var nds=this.nodes,k;for(k in nodes){nds[k]=nodes[k]}},__updateDragger:function(draggerConstructor){if(this.__dragger.constructor!==draggerConstructor){this.__dragger.removeEventListener("beforedrag",this.__beforeDragHandle).removeEventListener("drag",this.__dragHandle).removeEventListener("afterdrag",this.__afterDragHandle);this.__dragger.destroy();this.__dragger=new draggerConstructor}this.__dragger.setDrag(this.nodes.titleBar,this.__entity,false);this.__dragger.addEventListener("beforedrag",this.__beforeDragHandle).addEventListener("drag",this.__dragHandle).addEventListener("afterdrag",this.__afterDragHandle)},__updateDraggerArea:function(){var l,t,r,b;if(this.__isFixed){l=$IE6?document.documentElement.scrollLeft:0;t=$IE6?document.documentElement.scrollTop:0;r=$IE6?document.documentElement.scrollLeft+this.__getDocumentSize().width-this.width:this.__getDocumentSize().width-this.width;b=$IE6?document.documentElement.scrollTop+this.__getDocumentSize().height-this.height:this.__getDocumentSize().height-this.height}else{l=0;t=0;r=document.documentElement.scrollWidth-this.width;b=document.documentElement.scrollHeight-this.height}this.__dragger.setArea({left:l,top:t,right:r,bottom:b})},__initTitleBar:function(){if(!this.nodes.titleBar){return}var tb=this.nodes.titleBar;tb.style.cursor="move";if($IE){Core.Events.addEvent(tb,function(){return false},"selectstart")}else{tb.style.MozUserSelect="none"}},__getDocumentSize:function(){var w=document.documentElement.clientWidth||document.body.clientWidth,h=document.documentElement.clientHeight||document.body.clientHeight;return{width:w,height:h}}});Ui.ModuleDialog=function(tplConfig,iconSet,cfg){this.__bgShadow=null;this.__dialog=null;this.__isInitBgShadow=false;this.__tplConfig=tplConfig;this.__iconSet=iconSet;this.__dialogQueue=[];this.__zIndex=cfg&&cfg.zIndex||5e3;this.__cfg=cfg||{};this.__initDialogEvent()}.$define({alert:function(text,cfg){cfg=cfg||{};var dlg=this.__createMessageDialog(cfg.tplConfig||this.__tplConfig.alert,cfg);dlg.nodes.text&&(dlg.nodes.text.innerHTML=text||"");dlg.show(cfg.renderer||this.__cfg.renderer).addEventListener("hidden",function(){this.destroy()});dlg.nodes.linkOk&&dlg.nodes.linkOk.style.display!=="none"&&dlg.nodes.linkOk.focus();return dlg},newAlert:function(text,cfg,name){cfg.tplConfig=this.__tplConfig.newAlert;this.alert(text,cfg,name)},confirm:function(text,cfg){cfg=cfg||{};var dlg=this.__createMessageDialog(cfg.tplConfig||this.__tplConfig.confirm,cfg),me=this;dlg.nodes.text&&(dlg.nodes.text.innerHTML=text||"");if(dlg.nodes.btnCancel){dlg.nodes.btnCancel.innerHTML=cfg.textCancel||"取消";Core.Events.addEvent(dlg.nodes.btnCancel,function(){cfg.funcCancel&&cfg.funcCancel.call(dlg);dlg.hidden(cfg.renderer||me.__cfg.renderer);Core.Events.stopEvent()},"click");dlg.nodes.linkCancel&&Core.Events.addEvent(dlg.nodes.linkCancel,function(){var e=Core.Events.getEvent();if(e.keyCode=="13"){cfg.funcCancel&&cfg.funcCancel.call(dlg);dlg.hidden(cfg.renderer||me.__cfg.renderer)}},"keydown")}dlg.show(cfg.renderer||me.__cfg.renderer).addEventListener("hidden",function(){this.destroy()});if(cfg.defaultButton==0){dlg.nodes.linkCancel&&dlg.nodes.linkCancel.style.display!=="none"&&dlg.nodes.linkCancel.focus()}else{dlg.nodes.linkOk&&dlg.nodes.linkOk.style.display!=="none"&&dlg.nodes.linkOk.focus()}return dlg},newConfirm:function(text,cfg,name){cfg.tplConfig=this.__tplConfig.newConfirm;this.confirm(text,cfg,name)},create:function(cfg){var me=this;cfg=cfg||{};var dlg=new Ui.Dialog;dlg.setTemplate(cfg.tpl||this.__tplConfig.customs);cfg.content&&dlg.setContent(cfg.content);cfg.width&&!isNaN(cfg.width)&&dlg.setSize({width:cfg.width});cfg.height&&!isNaN(cfg.height)&&dlg.setSize({height:cfg.height});return this.__initDialog(dlg,cfg)},__initDialogEvent:function(){var queue=this.__dialogQueue;Core.Events.addEvent(document,function(){var e=Core.Events.getEvent();if(queue.length&&e.keyCode=="27"){queue[queue.length-1].hidden()}},"keydown")},__createMessageDialog:function(tpl,cfg){var dlg=new Ui.Dialog,me=this,i;dlg.setTemplate(tpl);cfg.width&&!isNaN(cfg.width)&&dlg.setSize({width:cfg.width});cfg.height&&!isNaN(cfg.height)&&dlg.setSize({height:cfg.height});dlg.nodes.subText&&(dlg.nodes.subText.innerHTML=cfg.subText||"");if(dlg.nodes.icon){dlg.nodes.icon.className=this.__iconSet[cfg.icon||"01"]["class"];dlg.nodes.icon.alt=this.__iconSet[cfg.icon||"01"]["alt"]}if(dlg.nodes.btnOk){dlg.nodes.btnOk.innerHTML=cfg.textOk||"确定";Core.Events.addEvent(dlg.nodes.btnOk,function(){dlg.hidden(cfg.renderer||me.__cfg.renderer);cfg.funcOk&&cfg.funcOk.call(dlg);Core.Events.stopEvent()},"click")}dlg.nodes.linkOk&&Core.Events.addEvent(dlg.nodes.linkOk,function(){var e=Core.Events.getEvent();if(e.keyCode=="13"){dlg.hidden(cfg.renderer||me.__cfg.renderer);cfg.funcOk&&cfg.funcOk.call(dlg)}},"keydown");dlg.setDragger(cfg.dragger||me.__cfg.dragger).setFixed(true).setAreaLocked(true);return this.__initDialog(dlg,cfg)},__initDialog:function(dlg,cfg){var me=this;cfg.zIndex&&(me.__zIndex=cfg.zIndex);dlg.nodes.titleName&&(dlg.nodes.titleName.innerHTML=cfg.title||"提示");if(dlg.nodes.btnClose){Core.Events.addEvent(dlg.nodes.btnClose,function(){var isCanHidden=true;cfg.funcBeforeClose&&(isCanHidden=cfg.funcBeforeClose.call(dlg)!==false);cfg.funcClose&&cfg.funcClose.call(dlg);isCanHidden&&dlg.hidden()},"click");Core.Events.addEvent(dlg.nodes.btnClose,function(){Core.Events.stopEvent()},"mousedown")}dlg.setPosition({z:cfg.zIndex||me.__zIndex});dlg.setRenderer(cfg.renderer||this.__cfg.renderer);dlg.setDragger(cfg.dragger||this.__cfg.dragger);dlg.setMiddle();dlg.addEventListener("beforeHidden",function(){me.__updateDialogQueue(this,"remove")});dlg.addEventListener("beforeShow",function(){this.nodes.panel.parentNode.appendChild(this.nodes.panel);var that=this;if(!me.__isInitBgShadow){me.__initBGShadow(this,cfg.isAdamant||me.__cfg.isAdamant)}me.__setBGShadowOpacity(cfg.bgShadowOpacity!==0?cfg.bgShadowOpacity||.4:cfg.bgShadowOpacity);window.setTimeout(function(){me.__bgShadow.show();me.__updateDialogQueue(that,"add")},1)});dlg.setTitle=function(title){this.nodes.titleName&&(this.nodes.titleName.innerHTML=title)};dlg.setHelp=function(url){this.nodes.btnHelp&&(this.nodes.btnHelp.href=url)};dlg.close=function(){this.hidden()};dlg.getNodes=function(){return this.nodes};dlg.getX=function(){return this.x};dlg.getY=function(){return this.y};dlg.getWidth=function(){return this.width};dlg.getHeight=function(){return this.height};return dlg},__initBGShadow:function(dlg,isAdamant){var w=this.__getDocumentSize().width,h=this.__getDocumentSize().height,me=this;this.__bgShadow=new Ui.Panel;this.__bgShadow.setTemplate('<div id="#{panel}" style="background-color:black"></div>').setSize({width:w,height:h}).setAdamant(isAdamant).setFixed(true).setPosition({x:0,y:0,z:me.__zIndex});Core.Events.addEvent(window,function(){me.__bgShadow.setPosition({x:0,y:0}).setSize({width:me.__getDocumentSize().width,height:me.__getDocumentSize().height})},"resize");this.__isInitBgShadow=true},__updateDialogQueue:function(dialog,op){var i,dlg;if(op==="add"){this.__dialogQueue.push(dialog)}else if(op==="remove"){i=this.__dialogQueue.length;while(i--){this.__dialogQueue[i]===dialog&&this.__dialogQueue.splice(i,1)}}if(this.__dialogQueue.length===0){this.__bgShadow.hidden()}else{dlg=this.__dialogQueue[this.__dialogQueue.length-1];this.__bgShadow.nodes.panel.parentNode.insertBefore(this.__bgShadow.nodes.panel,dlg.nodes.panel);this.__bgShadow.__iframe&&this.__bgShadow.__iframe.parentNode.insertBefore(this.__bgShadow.__iframe,this.__bgShadow.nodes.panel);dlg.nodes.linkOk&&dlg.nodes.linkOk.style.display!=="none"&&dlg.nodes.linkOk.focus()}},__setBGShadowOpacity:function(v){v=isNaN(v)?0:Math.max(Math.min(v,1),0);Core.Dom.setStyle(this.__bgShadow.nodes.panel,"opacity",v)},__getDocumentSize:function(){var w=document.documentElement.clientWidth||document.body.clientWidth,h=document.documentElement.clientHeight||document.body.clientHeight;return{width:w,height:h}}});Ui.Transition={simple:function(t,b,c,d){return c*t/d+b},backEaseIn:function(t,b,c,d){var s=1.70158;return c*(t/=d)*t*((s+1)*t-s)+b},backEaseOut:function(t,b,c,d){var s=1.70158;return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b},backEaseInOut:function(t,b,c,d){var s=1.70158;if((t/=d/2)<1){return c/2*t*t*(((s*=1.525)+1)*t-s)+b}return c/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+b},bounceEaseOut:function(t,b,c,d){if((t/=d)<1/2.75){return c*7.5625*t*t+b}else if(t<2/2.75){return c*(7.5625*(t-=1.5/2.75)*t+.75)+b}else if(t<2.5/2.75){return c*(7.5625*(t-=2.25/2.75)*t+.9375)+b}else{return c*(7.5625*(t-=2.625/2.75)*t+.984375)+b}},bounceEaseIn:function(t,b,c,d){return c-Transition.bounceEaseOut(d-t,0,c,d)+b},bounceEaseInOut:function(t,b,c,d){if(t<d/2){return Transition.bounceEaseIn(t*2,0,c,d)*.5+b}else{return Transition.bounceEaseOut(t*2-d,0,c,d)*.5+c*.5+b}},regularEaseIn:function(t,b,c,d){return c*(t/=d)*t+b},regularEaseOut:function(t,b,c,d){return-c*(t/=d)*(t-2)+b},regularEaseInOut:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t+b}return-c/2*(--t*(t-2)-1)+b},strongEaseIn:function(t,b,c,d){return c*(t/=d)*t*t*t*t+b},strongEaseOut:function(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b},strongEaseInOut:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t*t*t+b}return c/2*((t-=2)*t*t*t*t+2)+b},elasticEaseIn:function(t,b,c,d){var a,p;if(t==0){return b}if((t/=d)==1){return b+c}p=d*.3;if(!a||a<Math.abs(c)){a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*2*Math.PI/p))+b},elasticEaseOut:function(t,b,c,d){var a,p;if(t==0){return b}if((t/=d)==1){return b+c}if(!p){p=d*.3}if(!a||a<Math.abs(c)){a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*2*Math.PI/p)+c+b},elasticEaseInOut:function(t,b,c,d){var a,p;if(t==0){return b}if((t/=d/2)==2){return b+c}if(!p){var p=d*.3*1.5}if(!a||a<Math.abs(c)){var a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}if(t<1){return-.5*a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*2*Math.PI/p)+b}return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*2*Math.PI/p)*.5+c+b}};Ui.TweenStrategy=function(startValue,endValue,duration,motion){this.startValue=startValue||0;this.endValue=endValue||0;this.duration=duration||0;this.motion=motion||Ui.Transition.simple;this.__eventDispatcher=new Core.Events.EventDispatcher(this)}.$define({motion:null,duration:0,startValue:0,endValue:0,_itvID:0,_isTweenning:false,addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this},start:function(){if(this._isTweenning){return}this._isTweenning=true;var me=this,t,sv=this.startValue,ev=this.endValue,d=this.duration,value,startTime=(new Date).getTime();this._itvID=window.setInterval(function(){t=((new Date).getTime()-startTime)/1e3;t>me.duration&&(t=me.duration);value=me.motion(t,sv,ev-sv,d);me.onTween&&me.onTween(value);me.__eventDispatcher.dispatchEvent("tween",value);t==me.duration&&me.stop()},25);return this},stop:function(){window.clearInterval(this._itvID);this._isTweenning=false;this.onEnd&&this.onEnd();this.__eventDispatcher.dispatchEvent("end");return this},onTween:function(value){},onEnd:function(){}});Ui.OpacityRenderer=function(){this.__canShow=true;this.__canHidden=true;this.__node=null;this.__tween=new Ui.TweenStrategy(0,0,.6,Ui.Transition.strongEaseOut);this.__state="";this.__lastState="";this.__value=0;this.__node=null;this.__eventDispatcher=new Core.Events.EventDispatcher(this);this.__initTweenEvent()}.$implements(Ui.IRenderer).$define({setCanShow:function(state){this.__canShow=!!state},setCanHidden:function(state){this.__canHidden=!!state},show:function(node){var tn=this.__tween;tn.stop();Core.Dom.setStyle(node,"opacity",this.__value);node.style.display="";
this.__node=node;this.__state="show";this.__eventDispatcher.dispatchEvent("beforeShow");if(this.__canShow){tn.startValue=this.__value;tn.endValue=1;tn.start()}return this},hidden:function(node){var tn=this.__tween;tn.stop();this.__node=node;this.__state="hidden";this.__eventDispatcher.dispatchEvent("beforeHidden");if(this.__canHidden){tn.startValue=this.__value;tn.endValue=0;tn.start()}return this},addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this},__initTweenEvent:function(){var me=this;this.__tween.addEventListener("tween",function(v){me.__value=v;Core.Dom.setStyle(me.__node,"opacity",v)});this.__tween.addEventListener("end",function(){me.__node&&me.__node.style.filter&&(me.__node.style.filter="");if(me.__state!==""&&me.__state!==me.__lastState){me.__lastState=me.__state;me.__eventDispatcher.dispatchEvent(me.__state)}me.__state==="hidden"&&(me.__node.style.display="none")})}});Ui.BorderDragger=function(){this.__drag=null;this.__isBindEvent=false;this.__border=null;this.__dragNode=null;this.__isCreated=false;this.__tweenX=new Ui.TweenStrategy(0,0,.5,Ui.Transition.strongEaseOut);this.__tweenY=new Ui.TweenStrategy(0,0,.5,Ui.Transition.strongEaseOut);this.__eventDispatcher=new Core.Events.EventDispatcher(this)}.$implements(Ui.IDragger).$define({addEventListener:function(type,handle){if(type.toLowerCase()==="afterdrag"){this.__eventDispatcher.addEventListener(type,handle)}else{this.__drag.addEventListener(type,handle)}return this},removeEventListener:function(type,handle){if(type.toLowerCase()==="afterdrag"){this.__eventDispatcher.removeEventListener(type,handle)}else{this.__drag.removeEventListener(type,handle)}return this},setDrag:function(node,attachNode,isDragCapureNode){if(!this.__isCreated){this.__createBorder(attachNode);this.__initTweenEvent(attachNode)}this.__drag=new Ui.Drag(node,this.__border,isDragCapureNode);this.__dragNode=attachNode;this.__initDragEvent();return this},setLock:function(state){this.__drag.isLock=!!state;return this},setArea:function(area){this.__drag.lockArea=area;return this},destroy:function(){this.__drag.destroy()},__createBorder:function(node){this.__border=$C("div");var st=this.__border.style;st.border="2px dashed #BCC4D0";st.position="absolute";st.display="none";st.backgroundColor="transparent";st.MozUserSelect="none";document.body.appendChild(this.__border);this.__isCreated=true},__initDragEvent:function(){if(this.__isBindEvent){return}var me=this,bst=this.__border.style,nst=this.__dragNode.style,twX=this.__tweenX,twY=this.__tweenY;this.__drag.addEventListener("beforeDrag",function(){bst.zIndex=nst.zIndex+1;bst.position=nst.position;bst.width=me.__dragNode.offsetWidth-4+"px";bst.height=me.__dragNode.offsetHeight-4+"px";bst.left=parseInt(nst.left)+"px";bst.top=parseInt(nst.top)+"px";bst.display=""});this.__drag.addEventListener("afterDrag",function(){if($IE6){nst.left=parseInt(bst.left)+"px";nst.top=parseInt(bst.top)+"px";bst.display="none";me.__eventDispatcher.dispatchEvent("afterDrag")}else{twX.startValue=parseInt(nst.left);twX.endValue=parseInt(bst.left);twY.startValue=parseInt(nst.top);twY.endValue=parseInt(bst.top);twX.start();twY.start()}});this.__isBindEvent=true},__initTweenEvent:function(node){var nst=node.style,bst=this.__border.style,me=this;this.__tweenX.addEventListener("tween",function(v){nst.left=v+"px"});this.__tweenY.addEventListener("tween",function(v){nst.top=v+"px"});this.__tweenX.addEventListener("end",function(){bst.display="none";me.__eventDispatcher.dispatchEvent("afterDrag")})}});var winDialog={};var DialogTemplate={};!function(){var dialogTemplates={alert:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">提示标题</strong><cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div id="#{content}" class="CP_layercon1">','<div class="CP_prompt">','<img id="#{icon}" class="SG_icon SG_icon201" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="50" height="50" align="absmiddle"/>','<table class="CP_w_ttl"><tr><td id="#{text}"></td></tr></table>','<div id="#{subText}" class="CP_w_cnt SG_txtb"></div>','<p class="CP_w_btns_Mid"><a id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="#{btnOk}"> </cite></a></p>',"</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),newAlert:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">提示</strong><cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div class="CP_layercon2 pop_v">','<div class="v_prompt">','<img id="#{icon}" class="SG_icon SG_icon148" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="20" height="20" align="absmiddle" />','<div id="#{text}" class="v_cnt SG_txtb"></div>','<div id="#{subText}"></div>','<p class="v_btns">','<a id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#"><cite id="#{btnOk}">确定</cite></a>',"</p>","</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),confirm:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">提示标题</strong><cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div id="#{content}" class="CP_layercon1">','<div class="CP_prompt">','<img id="#{icon}" class="SG_icon SG_icon201" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="50" height="50" align="absmiddle"/>','<table class="CP_w_ttl"><tr><td id="#{text}"></td></tr></table>','<div id="#{subText}" class="CP_w_cnt SG_txtb"></div>','<p class="CP_w_btns">','<a  id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="#{btnOk}"></cite></a>','<a style="margin-left:5px;" id="#{linkCancel}" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="#{btnCancel}"> <span id="#{cancel}"></span> </cite></a></p>',"</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),newConfirm:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">提示</strong><cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div class="CP_layercon2 pop_v">','<div class="v_prompt">','<img id="#{icon}" class="SG_icon SG_icon148" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="20" height="20" align="absmiddle" />','<div id="#{text}" class="v_cnt SG_txtb"></div>','<div id="#{subText}"></div>','<p class="v_btns">','<a id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#"><cite id="#{btnOk}">确定</cite></a>&nbsp;&nbsp;','<a id="#{linkCancel}" class="SG_aBtn SG_aBtnB SG_aBtn_g" href="#"><cite id="#{btnCancel}">取消</cite></a>',"</p>","</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),customs:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid">','<div class="bLyTop">','<strong id="#{titleName}">提示标题</strong>','<cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite>',"</div>","</th>",'<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid" id="#{content}">',"</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join("")};var iconSet={"01":{"class":"SG_icon SG_icon201",alt:"警告"},"02":{"class":"SG_icon SG_icon202",alt:"失败"},"03":{"class":"SG_icon SG_icon203",alt:"成功"},"04":{"class":"SG_icon SG_icon204",alt:"询问"},"05":{"class":"SG_icon SG_bigLoading",alt:"正在加载"},"06":{"class":"SG_icon SG_icon148",alt:"警告"}};var dialogs={};var moduleDialog=new Ui.ModuleDialog(dialogTemplates,iconSet,{renderer:Ui.OpacityRenderer,dragger:Ui.BorderDragger,isAdamant:$IE6});winDialog.create=winDialog.createCustomsDialog=function(args,name){if(name&&typeof name==="string"){dialogs[name]=moduleDialog.create(args);return dialogs[name]}else{return moduleDialog.create(args)}};winDialog.alert=function(text,cfg,name){if(name&&typeof name==="string"){dialogs[name]=moduleDialog.alert(text,cfg);return dialogs[name]}else{return moduleDialog.alert(text,cfg)}};winDialog.newAlert=function(text,cfg,name){if(name&&typeof name==="string"){dialogs[name]=moduleDialog.newAlert(text,cfg);return dialogs[name]}else{return moduleDialog.newAlert(text,cfg)}};winDialog.confirm=function(text,cfg,name){if(name&&typeof name==="string"){dialogs[name]=moduleDialog.confirm(text,cfg);return dialogs[name]}else{return moduleDialog.confirm(text,cfg)}};winDialog.newConfirm=function(text,cfg,name){if(name&&typeof name==="string"){dialogs[name]=moduleDialog.newConfirm(text,cfg);return dialogs[name]}else{return moduleDialog.newConfirm(text,cfg)}};winDialog.getDialog=function(name){if(name&&typeof name==="string"){return dialogs[name]}};DialogTemplate=dialogTemplates}();$registJob("checkImgBlogger",function(){var itf={check:new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/points/check_vip.php","ajax"),redeem:new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/points/points_redeem.php","ajax")};checkImgBlogger();function checkImgBlogger(cb){var cb=cb||function(){};itf.check.request({POST:{type:3},onSuccess:function(data){scope.$is_photo_vip=1},onError:function(result){if(result&&result.code=="A00001"){scope.$redeemImgBloggerDialog=redeemImgBlogger}},onFail:function(){}})}function redeemImgBlogger(cb){var sucdlg=winDialog.alert("抱歉，图片超过5m！",{funcOk:function(){itf.redeem.request({POST:{user:scope.$uid||$UID,type:3},onSuccess:function(data){scope.$is_photo_vip=1;cb(data)},onError:function(result){if(result&&result.code=="A00001"){winDialog.alert(result.data)}},onFail:function(){}})},textOk:"马上兑换",subText:"150积分开通10m大图上传"},"redeemImgBloggerDialog")}});Utils.Cookie.setCookie=function(name,value,expire,path,domain,secure){var cstr=[];cstr.push(name+"="+escape(value));if(expire){var dd=new Date;var expires=dd.getTime()+expire*36e5;dd.setTime(expires);cstr.push("expires="+dd.toGMTString())}if(path){cstr.push("path="+path)}if(domain){cstr.push("domain="+domain)}if(secure){cstr.push(secure)}document.cookie=cstr.join(";")};String.prototype.format=function(){var r=!arguments[0]||typeof arguments[0]=="undefined"?"":arguments[0].toString();var re=/(.*?)({(\d+)(:([0-9a-z]+))?})/gi;var t=this.match(re);if(t){for(var i=0,l=t.length;i<l;i++){t[i]=t[i].replace(re,function(){return RegExp.$1});t[i]=RegExp.$1;switch(typeof arguments[parseInt(RegExp.$3)]){case"undefined":t[i]+=RegExp.$2;break;case"number":t[i]+=isNaN(RegExp.$5)||RegExp.$5==""?arguments[parseInt(RegExp.$3)]:arguments[parseInt(RegExp.$3)].toString(Math.max(Math.min(Math.round(RegExp.$5),36),2));break;default:t[i]+=arguments[parseInt(RegExp.$3)]}}t.push(this.replace(re,""));return t.join("")}return this};Sina.pkg("Core.Math");Core.Math.getUniqueId=function(_start,_end){return parseInt(Math.random()*1e4).toString()+(new Date).getTime().toString()};Lib.pkg("Login");Lib.Login.info=function(){var info;if(window["sinaSSOController"]&&(info=sinaSSOController.getLoginInfo())){return info}else{return{}}};Lib.Login.LoginPost=Core.Class.create();Lib.Login.LoginPost.prototype={url:"https://i.sso.sina.com.cn/js/ssologin.js",callback:null,state:{isRequesting:false},initialize:function(callback,clearDomain,from){var _self=this;window.sinaSSOConfig=new function(){if(from){this.from=from}this.pageCharset="utf-8";this.noActiveTime=14400;this.setDomain=true;this.entry="boke";this.customInit=function(){};this.customLoginCallBack=function(){callback.apply(null,arguments);_self.state.isRequesting=false};this.customLogoutCallBack=function(result){};this.useIframe=true}},login:function(username,password,time){var _this=this;if(this.state.isRequesting){return}else{this.state.isRequesting=true}if(typeof sinaSSOController=="undefined"||!sinaSSOController){trace("no sso");Utils.Io.JsLoad.request(this.url,{onComplete:function(){__login()},onException:function(){},timeout:3e4,isRemove:false})}else{trace("has sso");sinaSSOController.init();if(typeof sinaSSOController.setLoginType=="function"){sinaSSOController.setLoginType(2)}if(typeof sinaSSOController.getServerTime=="function"){}trace("init ok");__login()}function __login(){if(typeof time=="undefined"){sinaSSOController.login(username,password)}else{sinaSSOController.login(username,password,time)}}},parse:function(loginStatus){this.callback.call(loginStatus)}};Core.System.getScrollPos=function(oDocument){oDocument=oDocument||document;var dd=oDocument.documentElement;var db=oDocument.body;return[Math.max(dd.scrollTop,db.scrollTop),Math.max(dd.scrollLeft,db.scrollLeft),Math.max(dd.scrollWidth,db.scrollWidth),Math.max(dd.scrollHeight,db.scrollHeight)]};Core.Dom.getStyle=function(el,property){switch(property){case"opacity":var val=100;try{val=el.filters["DXImageTransform.Microsoft.Alpha"].opacity}catch(e){try{val=el.filters("alpha").opacity}catch(e){}}return val/100;case"float":property="styleFloat";default:var value=el.currentStyle?el.currentStyle[property]:null;return el.style[property]||value}};if(!$IE||$IE>8){Core.Dom.getStyle=function(el,property){if(property=="float"){property="cssFloat"}try{var computed=document.defaultView.getComputedStyle(el,"")}catch(e){traceError(e)}return el.style[property]||computed?computed[property]:null}}Core.Dom.getXY=function(el){if((el.parentNode==null||el.offsetParent==null||Core.Dom.getStyle(el,"display")=="none")&&el!=document.body){return false}var parentNode=null;var pos=[];var box;var doc=el.ownerDocument;box=el.getBoundingClientRect();var scrollPos=Core.System.getScrollPos(el.ownerDocument);return[box.left+scrollPos[1],box.top+scrollPos[0]];parentNode=el.parentNode;while(parentNode.tagName&&!/^body|html$/i.test(parentNode.tagName)){if(Core.Dom.getStyle(parentNode,"display").search(/^inline|table-row.*$/i)){pos[0]-=parentNode.scrollLeft;pos[1]-=parentNode.scrollTop}parentNode=parentNode.parentNode}return pos};if(!$IE){Core.Dom.getXY=function(el){if((el.parentNode==null||el.offsetParent==null||Core.Dom.getStyle(el,"display")=="none")&&el!=document.body){return false}var parentNode=null;var pos=[];var box;var doc=el.ownerDocument;pos=[el.offsetLeft,el.offsetTop];parentNode=el.offsetParent;var hasAbs=Core.Dom.getStyle(el,"position")=="absolute";if(parentNode!=el){while(parentNode){pos[0]+=parentNode.offsetLeft;pos[1]+=parentNode.offsetTop;if($SAFARI&&!hasAbs&&Core.Dom.getStyle(parentNode,"position")=="absolute"){hasAbs=true}parentNode=parentNode.offsetParent}}if($SAFARI&&hasAbs){pos[0]-=el.ownerDocument.body.offsetLeft;pos[1]-=el.ownerDocument.body.offsetTop}parentNode=el.parentNode;while(parentNode.tagName&&!/^body|html$/i.test(parentNode.tagName)){if(Core.Dom.getStyle(parentNode,"display").search(/^inline|table-row.*$/i)){pos[0]-=parentNode.scrollLeft;pos[1]-=parentNode.scrollTop}parentNode=parentNode.parentNode}return pos}}!function(){var _inputNode;var _rndID=parseInt(Math.random()*100);var _showMenuItems=[];var _selectMenuIndex=-1;var _selectMenuText="";var _css="#userPosition {padding: 0;margin: 0;border: 0;position: absolute;z-index: 999;}				#sinaNote {position: absolute;z-index: 999999;width: auto;overflow: hidden;padding: 0;margin: 0;				border: 1px solid #CCCCCC;background: #ffffff;text-align:left;}				#sinaNote li {font-size: 12px;list-style: none;margin: 0 1px;height: 20px;padding: 0 5px;clear: both;				line-height: 20px;cursor: pointer;color: #999999;}				#sinaNote li.note {text-align: left;color: #999999;}";var _viewWindow=window;var passcardOBJ={overfcolor:"#999",overbgcolor:"#e8f4fc",outfcolor:"#000000",outbgcolor:"",menuStatus:{"sina.com":true,"sina.cn":true,"vip.sina.com":true,"qq.com":true,"163.com":true,"126.com":true,"hotmail.com":true,"yahoo.com.cn":true,"gmail.com":true}};passcardOBJ.createNode=function(){var d=_viewWindow.document;var div=d.createElement("div");div.innerHTML='<ul id="sinaNote" style="display:none;"></ul>';var obj=d.createElement("style");obj.setAttribute("type","text/css");try{if($IE){obj.styleSheet.cssText=_css}else{obj.innerHTML=_css}}catch(e){trace(e.message)}var total=d.createElement("div");total.appendChild(div);total.appendChild(obj);d.body.appendChild(total)};passcardOBJ.arrowKey=function(keyCodeNum){if(keyCodeNum==38){if(_selectMenuIndex<=0){_selectMenuIndex=_showMenuItems.length}_selectMenuIndex--;passcardOBJ.selectLi(_selectMenuIndex)}if(keyCodeNum==40){if(_selectMenuIndex>=_showMenuItems.length-1){_selectMenuIndex=-1}_selectMenuIndex++;passcardOBJ.selectLi(_selectMenuIndex)}};passcardOBJ.showList=function(e){_selectMenuText="";var keyCodeNum=Core.Events.getEvent().keyCode;if(keyCodeNum==38||keyCodeNum==40){passcardOBJ.arrowKey(keyCodeNum);return false}if(!$E("sinaNote")){passcardOBJ.createNode()}var username=$E(e).value;var menuList={};var atIndex=username.indexOf("@");var InputCase="";var InputStr="";if(atIndex>-1){InputCase=username.substr(atIndex+1);InputStr=username.substr(0,atIndex)}_showMenuItems=[];_selectMenuIndex=0;_showMenuItems[_showMenuItems.length]="sinaNote_MenuItem_Title_"+_rndID;for(var key in this.menuStatus){this.menuStatus[key]=true;if(InputCase!=""&&InputCase!=key.substr(0,InputCase.length)){this.menuStatus[key]=false}else{_showMenuItems[_showMenuItems.length]="sinaNote_MenuItem_"+key+"_"+_rndID}}var listcontent='<li class="note">请选择登录类型</li>';listcontent+='<li id="sinaNote_MenuItem_Title_'+_rndID+'">'+username+"</li>";var itemLabel;for(var mykey in this.menuStatus){if(this.menuStatus[mykey]==true){if(InputStr==""){itemLabel=username+"@"+mykey}else{itemLabel=InputStr+"@"+mykey}listcontent+='<li id="sinaNote_MenuItem_'+mykey+"_"+_rndID+'" title="'+itemLabel+'">'+itemLabel+"</li>"}}$E("sinaNote").innerHTML=listcontent;for(var i=0;i<username.length;i++){if(username.charCodeAt(i)<160){$E("sinaNote").style.display="";this.selectList(e)}else{this.hideList()}}var el=$E(e);var note=$E("sinaNote");var frameLeft=0;var frameTop=0;var framePos;if(_viewWindow!=window){framePos=Core.Dom.getXY(window.frameElement);frameLeft=framePos[0];frameTop=framePos[1]}var inputWidth=el.offsetWidth;if(inputWidth<200){inputWidth=200}note.style.width=inputWidth-2+"px";var inputXY=Core.Dom.getXY(el);note.style.left=inputXY[0]-($IE?2:-1)+frameLeft+"px";note.style.top=inputXY[1]+el.offsetHeight-($IE?2:-1)+frameTop+"px"};passcardOBJ.selectList=function(e){var unames=$E("sinaNote").getElementsByTagName("li");for(var i=1;i<unames.length;i++){unames[1].style.backgroundColor=passcardOBJ.overbgcolor;unames[1].style.color=passcardOBJ.outfcolor;unames[i].onmousedown=function(){var temp=this.innerHTML;if(temp.indexOf("非新浪邮箱")>-1){var pos=temp.split("@");$E(e).value=pos[0]}else{$E(e).value=this.innerHTML}if(Core.Events.getEvent()!=null){Core.Events.stopEvent()}};unames[i].onmouseover=function(){if(i!=1){unames[1].style.backgroundColor=passcardOBJ.outbgcolor;unames[1].style.color=passcardOBJ.overfcolor}this.style.backgroundColor=passcardOBJ.overbgcolor;this.style.color=passcardOBJ.outfcolor};unames[i].onmouseout=function(){this.style.backgroundColor=passcardOBJ.outbgcolor;this.style.color=passcardOBJ.overfcolor;unames[1].style.backgroundColor=passcardOBJ.overbgcolor;unames[1].style.color=passcardOBJ.outfcolor}}};passcardOBJ.selectLi=function(nIndex){var menuNode;$E("sinaNote_MenuItem_Title_"+_rndID).style.backgroundColor=passcardOBJ.outbgcolor;$E("sinaNote_MenuItem_Title_"+_rndID).style.color=passcardOBJ.overfcolor;for(var i=0;i<_showMenuItems.length;i++){menuNode=$E(_showMenuItems[i]);menuNode.style.backgroundColor=passcardOBJ.outbgcolor;menuNode.style.color=passcardOBJ.overfcolor}$E(_showMenuItems[nIndex]).style.backgroundColor=passcardOBJ.overbgcolor;$E(_showMenuItems[nIndex]).style.color=passcardOBJ.outfcolor;_selectMenuText=$E(_showMenuItems[nIndex]).innerHTML};passcardOBJ.hideList=function(){if(!$E("sinaNote")){passcardOBJ.createNode()}$E("sinaNote").style.display="none"};passcardOBJ.init=function(oNode,oColors,oFocusNode,oWindowTarget){oWindowTarget=oWindowTarget||window;if(oWindowTarget.document.body==null){setTimeout(Core.Function.bind3(function(){this.init(oNode,oColors,oFocusNode,oWindowTarget)},this),100)}for(var key in oColors){this[key]=oColors[key]}Core.Events.addEvent(document,passcardOBJ.hideList,"click");Core.Events.addEvent(oNode,passcardOBJ.hideList,"blur");Core.Events.addEvent(oNode,Core.Function.bind3(passcardOBJ.showList,this,[oNode]),"keyup");Core.Events.addEvent(oNode,function(e){var keyCodeNum=Core.Events.getEvent().keyCode;var isSinaMail;if(keyCodeNum==13||keyCodeNum==9){if(_selectMenuText!=""){var temp=_selectMenuText;if(temp.indexOf("非新浪邮箱")>-1){var pos=temp.split("@");oNode.value=pos[0]+"@";isSinaMail=false}else{oNode.value=_selectMenuText;isSinaMail=true}}if(isSinaMail){if(oFocusNode!=null){setTimeout(function(){oFocusNode.focus()},0)}}else{if(oNode){oNode.focus()}}}},"keydown");if(oWindowTarget){_viewWindow=oWindowTarget}};Lib.passcardOBJ=passcardOBJ}();Lib.Login.Ui=Core.Class.create();var msnRefreshTimer=0;function msnrefreshWindow(){var setCookie=Utils.Cookie.setCookie;var getCookie=Utils.Cookie.getCookie;clearTimeout(msnRefreshTimer);var reg_token=getCookie("reg_token");if(reg_token){trace("token find out...");setCookie("reg_token","","","/",".blog.sina.com.cn")}else{trace("no token...");msnRefreshTimer=setTimeout(msnrefreshWindow,1e3);return}var cookieArr;var cid;var code;var c_cid=getCookie("c_uid");var CBcookie=getCookie("msnLinkCB");var altReg=getCookie("AlT");setCookie("msnLoginComeFrom",window.location.href,1,"/",".blog.sina.com.cn");if(CBcookie){cookieArr=CBcookie.split("_");cid=cookieArr[0];code=cookieArr[1]}if(c_cid!=cid)return;switch(code){case"noCid":break;case"loginError":break;case"unlink":deleteCookie("msnLinkCB");funcNoAccount(reg_token);break;case"done":deleteCookie("msnLinkCB");setCookie("loginFromMsn","msn",24,"/",".blog.sina.com.cn");funcSuccess(altReg,reg_token);break;case"pass":break}function funcSuccess(arg,reg_tk){trace("has Account");if(arg){trace("alt:"+arg);var iframe=$C("iframe");iframe.setAttribute("height",0);iframe.setAttribute("width",0);document.body.appendChild(iframe);iframe.src="https://login.sina.com.cn/sso/login.php?entry=blogmsn&service=blogmsn&alt="+encodeURIComponent(arg)+"&savestate=7&returntype=TEXT";!function(){var me=arguments.callee;if(!me.count)me.count=0;if(me.count++>10){trace("放弃获取SUBP");iframe.parentNode.removeChild(iframe);return}trace("尝试获取SUBP, count:"+me.count);if(getCookie("SUBP")){trace("获取到 SUBP"+getCookie("SUBP"));window.location.reload();return}setTimeout(me,1e3)}()}else{window.location.reload()}}function funcNoAccount(){trace("noAccount");window.location.href="http://blog.sina.com.cn/blog_rebuild/msn/interface/connect_user_confirm.php"}function deleteCookie(name){var Then=new Date;Then.setTime(Then.getTime()-1);document.cookie=name+"=_pass;path=/;domain=.blog.sina.com.cn;expires="+Then.toGMTString()}function jsonDecode(str){if(!str||str==""){return null}try{return window.eval("("+str+")")}catch(e){return null}}}Lib.Login.Ui.prototype={dialog:null,isInit:false,request:null,callback:null,initialize:function(){},login:function(callback,clearDomain,from){this.callback=callback||null;this.clearDomain=clearDomain||false;this.from=from||null;this.initDom();this.initEvent();this.dialog.show();this.dialog.setAreaLocked(true);this.reloadName();this.onShow();this.focus();if(scope.$pageid==="blogMove"){$E("login_move_tip").style.display=""}if($IE6){this.initAD()}Lib.passcardOBJ.init($E("login_name_d"),{overfcolor:"#999",overbgcolor:"#e8f4fc",outfcolor:"#000000",outbgcolor:""},$E("login_pass_d"))},reloadName:function(){var userInfo=Lib.Login.info();var defaultName=userInfo.ln;if(defaultName){$E("login_name_d").value=defaultName}var alf=Utils.Cookie.getCookie("ALF");if(alf!=""&&$E("login_save")){$E("login_save").checked=true;$E("login_save_tips").style.display="none"}alf=Utils.Cookie.getCookie("LiRe");if(alf!=""&&$E("login_save")){$E("login_save").checked=true;$E("login_save_tips").style.display="none"}},initDom:function(){var me=this;this.dialog=winDialog.createCustomsDialog({tpl:me.tpl});this.dialog.addEventListener("hidden",function(){this.destroy()});this.dialog.setContent(this.struc);this.dialog.setTitle("登录新浪博客");this.dialog.setMiddle()},initEvent:function(){var callback=this.parse.bind2(this);this.request=new Lib.Login.LoginPost(callback,this.clearDomain,this.from);Core.Events.addEvent("login_button",this.doLogin.bind2(this));Core.Events.addEvent("login_name_d",function(e){var code=e.keyCode;if(code==13){this.doLogin()}}.bind2(this),"keydown");Core.Events.addEvent("login_pass_d",function(e){var code=e.keyCode;if(code==13){this.doLogin()}}.bind2(this),"keydown");var cancelStatus=1;Core.Events.addEvent("login_save",function(){if($E("login_save").checked){$E("login_save_tips").style.display=""}else{$E("login_save_tips").style.display="none"}if(cancelStatus){var url="http://control.blog.sina.com.cn/blog_rebuild/riaapi/padblog/padInfo.php?ck_login=A00001&rnd="+Math.random();Utils.Io.JsLoad.request(url,{onComplete:function(){},onException:function(){}});cancelStatus=null}})},doLogin:function(){Core.Events.stopEvent();var username=$E("login_name_d").value;var password=$E("login_pass_d").value;username=Core.String.trim(username);password=password;if(username==""){this.error("请输入登录名");return false}if(password==""){this.error("请输入密码");return false}if(typeof sinaSSOController!="undefined"&&typeof sinaSSOController.loginExtraQuery!="undefined"){if(typeof sinaSSOController.loginExtraQuery.door!="undefined"){var vcode=$E("login_vcode").value;sinaSSOController.loginExtraQuery.door=vcode||1}}if($E("login_save").checked){v7sendLog("48_01_38_1");this.request.login(username,password,60)}else{v7sendLog("48_01_38_0");this.request.login(username,password)}return false},parse:function(loginStatus){if(loginStatus.result){Lib.checkAuthor();if($E("login_save").checked){Utils.Cookie.setCookie("LiRe",true,2400,"/",".blog.sina.com.cn")}else{Utils.Cookie.setCookie("LiRe","",2400,"/",".blog.sina.com.cn")}var date=new Date,y=date.getFullYear(),m=date.getMonth(),d=date.getDate();var time=new Date(y,m,d,24).getTime();Utils.Cookie.setCookie("onceloggedonblog",time,720,"/",".blog.sina.com.cn");var me=this;function cbreload(){if(this.callback){try{$tray.renderLogin()}catch(e){}this.callback.call()}else{window.location=window.location.toString().replace(/#.*/,"")}}var cbed=false;Utils.Io.JsLoad.request("https://login.sina.com.cn/bindmail/checkmailuser.php?entry=blog&name="+encodeURIComponent($E("login_name_d").value)+"&utf82gbk=1&callback=scope.$bindEmailAlert",{noreturn:true,timeout:5e3,onException:function(){if(!cbed){cbreload.call(me)}}});scope.$bindEmailAlert=function(data){cbed=true;if(data.ret!="y"&&data.errcode!="not_verify"||Utils.Cookie.getCookie("sbr_noTBE")==1){cbreload.call(me)}else{var dialog=winDialog.createCustomsDialog({content:['<div id="#{entityID} style="width:358px;height:144px" class="CP_layercon2 unilayer">','<div id="#{contentID}" class="CP_prompt">','<img height="50" align="absmiddle" width="50" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon201">','<table class="CP_w_ttl"><tbody><tr><td>经检测您的帐号存在一定的安全隐患！<br>建议绑定邮箱</td></tr></tbody></table>','<p class="CP_w_btns_Mid"><a href="javascript:;" class="SG_aBtn SG_aBtnB" id="#{bindit}" target="_blank"><cite> 绑定 </cite></a>&nbsp;&nbsp;<a href="javascript:;" class="SG_aBtn SG_aBtnB" id="#{nobind}"><cite> 暂不绑定 </cite></a></p>',"</div>",'<div class="unilayerB SG_j_linedot1">','<p class="SG_txtb"><input type="checkbox" id="#{noalertbind}"><label for="#{noalertbind}">一周内不提醒</label></p>',"</div>","</div>"].join(""),shadow:1},"bindEmail");dialog.setMiddle();dialog.show();dialog.nodes["btnClose"].onclick=function(){cbreload.call(me);dialog.hidden()};dialog.nodes["nobind"].onclick=function(){setTimeout(function(){cbreload.call(me);dialog.hidden()},100)};dialog.nodes["bindit"].href="https://login.sina.com.cn/bindmail/bindmail.php?entry=blog";dialog.nodes["bindit"].onclick=function(){cbreload.call(me)};dialog.nodes["noalertbind"].onclick=function(){if(this.checked){Utils.Cookie.setCookie("sbr_noTBE","1",24*7,"/",".blog.sina.com.cn")}else{Utils.Cookie.setCookie("sbr_noTBE","",0,"/",".blog.sina.com.cn")}}}};this.dialog.hidden()}else{if(loginStatus.errno==="4049"){sinaSSOController.loginExtraQuery={door:0};$E("login_ckimg").style.display="";$E("login_vcode").value="";$E("checkImg").src="https://login.sina.com.cn/cgi/pin.php?r="+Core.Math.getUniqueId()+"&s=0";Core.Events.addEvent($E("reloadCode"),function(){$E("checkImg").src="https://login.sina.com.cn/cgi/pin.php?r="+Core.Math.getUniqueId()+"&s=0";$E("login_vcode").value="";$E("login_div_error").innerHTML=""});this.error("");return}if(loginStatus.errno==="2070"){Core.Events.fireEvent($E("reloadCode"),"click");this.error(loginStatus.reason);return}if(loginStatus.errno=="4047"){this.error(loginStatus.reason);return}else if(loginStatus.errno=="4057"){this.error(loginStatus.reason);return}else if(loginStatus.errno=="4040"){this.error(loginStatus.reason);return}else if(loginStatus.errno=="50113038"){this.error(loginStatus.reason);return}this.error("登录名或密码错误");$E("checkImg").src="https://login.sina.com.cn/cgi/pin.php?r="+Core.Math.getUniqueId()+"&s=0";$E("login_vcode").value=""}},friendlyTip:function(reason){var ret=reason;var node=$E("login_name_d");var name=node.value;var me=this;if(!/[\u0391-\uFFE5]+/.test(name)&&!/^\d+$/.test(name)&&!/^@/.test(name)){var str="你的登录名可能是 ";var linkTpl='<a href="#" class="underline" onclick="$_RENAME(/@.*/, \'{1}\');return false">{0}{1}</a>';var linkArr=["@sina.com","@sina.cn"];var finalLink="";if(/@sina\.cn$/.test(name)){finalLink=linkTpl.format("{0}",linkArr[0])}else if(/@sina\.com$/.test(name)){finalLink=linkTpl.format("{0}",linkArr[1])}else{finalLink=linkTpl.format("{0}",linkArr[0])+" 或 "+linkTpl.format("{0}",linkArr[1])}ret=(str+finalLink).format(name.replace(/@.*/,""))}return ret},rename:function(){window.$_RENAME=function(reg,suf){var node=$E("login_name_d");node.value=node.value.replace(reg,"")+suf;$E("login_pass_d").focus();
$E("login_div_error").innerHTML=""};return window.$_RENAME}(),focus:function(){var nameEl=$E("login_name_d");if(nameEl.value==""){nameEl.focus()}else{$E("login_pass_d").focus()}},initAD:function(){},onShow:function(){},error:function(msg){$E("login_div_error").innerHTML=msg;$E("login_pass_d").value="";this.focus()},tpl:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid">','<div class="bLyTop">','<strong id="#{titleName}">提示标题</strong>','<cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite>',"</div>","</th>",'<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid" id="#{content}">',"</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),struc:'		<div class="CP_layercon2 passLoginItem">			<div>				<div id="login_move_tip" style="display:none;margin-bottom:12px">可以使用新浪微博、邮箱、通行证的帐号进行登录</div>				<div class="boxA">登录名：					<input tabIndex="201" type="text" class="fm1" style="width:215px;" name="login_name" id="login_name_d" tabIndex=1/>  <a style="font-size: 12px;" href="https://login.sina.com.cn/signup/signupmail.php?entry=blog&srcuid='+scope.$uid+'&src=blogicp" target="_blank">立即注册</a>				</div>				<div class="boxA">密　码：					<input tabIndex="202" type="password" class="fm1" style="width:215px;" name="login_pass" maxlength="16" id="login_pass_d" tabIndex=2/>  <a style="font-size: 12px;" href="https://login.sina.com.cn/getpass.html" target="_blank">找回密码</a>				</div>				<div id="login_ckimg" class="boxA" style="display:none"> <p class="p_img">验证码：                  	<input type="text" id="login_vcode" name="login_vcode" class="fm1" size="10" maxlength="5" />                  	<img width="100" align="absmiddle" id="checkImg" src="https://login.sina.com.cn/cgi/pin.php?r='+Core.Math.getUniqueId()+'&s=0" /> <a href="javascript:;" onclick="return false;" style="font-size: 12px;"><span id="reloadCode">换一换</span></a></p> 			    </div>				<div class="ErrTips" id="login_div_error"></div>				<div class="boxB"><p><input tabIndex="203" type="checkbox" value="" id="login_save" checked="checked" /><label for="login_save"> 记住登录状态</label></p><p id="login_save_tips" style="color:#999;display:none;">建议在网吧/公用电脑上取消该选项</p><p style="margin-top: 8px;"><a id="login_button" class="SG_aBtn SG_aBtnB SG_aBtn_sub" href="javascript:;" tabIndex=204><cite>登录<input type="text"/></cite></a> </p></div>			</div>			<div class="connect_msn" id="connect_msn" style="position:relative;display:none;">				<span>使用 MSN 帐号登录博客</span>				<a href="#" onclick="Lib.checkAuthor();v7sendLog(\'48_01_36\'); window.open(\'https://login.live.com/oauth20_authorize.srf?client_id=0000000040046F08&redirect_uri=http%3A%2F%2Fcontrol.blog.sina.com.cn%2Fblog_rebuild%2Fmsn%2FmsnLoginCallBack.php&response_type=code&scope=wl.basic%20wl.signin%20wl.offline_access%20wl.share%20wl.emails\',\'neww\',\'left='+(screen.width-440)/2+",top="+(screen.height-400)/2+',height=400,width=440\');msnrefreshWindow();" style="background:transparent url(http://simg.sinajs.cn/blog7style/images/msn_login01.gif) no-repeat left top; width:70px; height:22px; line-height:22px; display:inline-block; text-align:left; text-indent:2em; text-decoration:none; color:white; font-weight:bold; font-size:14px;">登录</a>			</div>			<a href="http://blog.sina.com.cn/s/blog_4b0f52990100miil.html" target="_blank"style="left:308px;position:relative;top:-24px;display:none;">如何登录？</a>			<div class="CP_lg_ad SG_j_linedot1">			</div>		</div>'};!function(){DialogTemplate.alert=DialogTemplate.newAlert='<div id="#{panel}" class="e_layer_prompt" style="width:458px;">                            <div id="#{titleBar}" class="e_prompt_header">                              <div class="e_prompt_tit" id="#{titleName}"></div>                              <a href="javascript:void(0)" class="e_prompt_close" id="#{btnClose}">&times;</a>                             </div>                            <div id="#{content}" class="e_prompt_cont e_pro_align">                              <p id="#{text}" class="e_prompt_word"></p>                              <p id="#{subText}" style="margin-bottom:20px;"></p>                              <a id="#{btnOk}" class="e_prompt_btn" href="#" onclick="return false;">确定</a>                            </div>                          </div>';DialogTemplate.confirm=DialogTemplate.newConfirm='<div id="#{panel}" class="e_layer_prompt" style="width:458px;">                            <div id="#{titleBar}" class="e_prompt_header">                              <div class="e_prompt_tit" id="#{titleName}"></div>                              <a href="javascript:void(0)" class="e_prompt_close" id="#{btnClose}">&times;</a>                             </div>                            <div id="#{content}" class="e_prompt_cont e_pro_align">                              <p id="#{text}" class="e_prompt_word"></p>                              <p id="#{subText}" style="margin-bottom:20px;"></p>                            </div>                            <div class="prompt_btn">                              <a id="#{btnOk}" class="btn_style" href="#" onclick="return false;">确定</a>                              <a id="#{btnCancel}" class="btn_style" href="#" onclick="return false;">取消</a>                            </div>                          </div>';DialogTemplate.customs='<div id="#{panel}" class="BNE_e_layer">                              <div class="e_layer_header" id="#{titleBar}">                                  <div class="e_layer_tit" id="#{titleName}"></div>                                  <a href="javascript:void(0)" class="e_layer_close" id="#{btnClose}">&times;</a>                              </div>                              <div id="#{content}"></div>                          </div>';if($IE6||$IE7){Ui.Dialog.prototype.setSize=function(p){!this.__isInited&&this.__initEntity();if(this.nodes.panel){typeof p.width!=="undefined"&&(this.nodes.panel.style.width=p.width+"px");typeof p.height!=="undefined"&&(this.nodes.panel.style.height=p.height+"px")}else{typeof p.width!=="undefined"&&(this.__entity.panel.width=p.width+"px");typeof p.height!=="undefined"&&(this.__entity.panel.height=p.height+"px")}return this}}Lib.Login.Ui.prototype.tpl=DialogTemplate.custom;Lib.Login.Ui.prototype.struc='<div class="e_layer_cont3">                                    <div class="login_input">                                      <label class="login_icon icon_a"></label>                                        <input disableautocomplete class="tag_input" autocomplete="off" type="text" tabIndex="201" name="login_name" id="login_name_d" tabIndex="1"/>                                    </div>                                    <div class="login_input input_top">                                      <label class="login_icon icon_b"></label>                                        <input class="tag_input" type="password" name="login_pass" maxlength="16" id="login_pass_d" tabIndex="202"/>                                    </div>                                    <div class="login_code" id="login_ckimg" style="display:none;">                                        <input type="text" id="login_vcode" name="login_vcode" class="code_input" size="10" maxlength="5" />                                        <img width="100" class="img_code" align="absmiddle" id="checkImg" src="https://login.sina.com.cn/cgi/pin.php?r='+Core.Math.getUniqueId()+'&s=0" />                                        <a href="javascript:;" class="replace_a" onclick="return false;"><span id="reloadCode">换一换</span></a>                                    </div>                                    <div class="lp"><p class="l"><input value="" type="checkbox" id="login_save" checked="checked" tabIndex="203" class="l_box"/>记住登录状态</p><p id="login_save_tips" class="r"><a href="" title="">立即注册</a><a href="" title="">找回密码</a></p></div>                                    <div style="color:red;margin-top:5px;" id="login_div_error"></div>                                    <a href="javascript:;" id="login_button" class="login_btn btn_style">登录</a>                                    <div class="lp"><p class="msn">使用MSN账号登录博客</p>                                        <a href="http://blog.sina.com.cn/s/blog_4b0f52990100miil.html" target="_blank" class="how">如何登录？</a>                                        <a href="#" class="msn_btn" onclick="Lib.checkAuthor();v7sendLog(\'48_01_36\'); window.open(\'https://login.live.com/oauth20_authorize.srf?client_id=0000000040046F08&redirect_uri=http%3A%2F%2Fcontrol.blog.sina.com.cn%2Fblog_rebuild%2Fmsn%2FmsnLoginCallBack.php&response_type=code&scope=wl.basic%20wl.signin%20wl.offline_access%20wl.share%20wl.emails\',\'neww\',\'left='+(screen.width-440)/2+",top="+(screen.height-400)/2+',height=400,width=440\');msnrefreshWindow();">登录</a>                                    </div>                                  </div>                                  <div class="login_footer">                                  </div>';if(scope.blogOpener){function checkBlogName(inputEle,errEle,icon){var val=inputEle.value;if(/^(?:\s|[　])+|(?:\s|[　])+$/.test(val)){inputEle.value=Core.String.trim(val);val=inputEle.value}if(val){var nameLen=Core.String.byteLength(val);if(nameLen>24){showError(errEle,"博客名称超长",icon)}else{hiddenError(errEle,icon)}}else{showError(errEle,"博客名称不能为空",icon)}}function showError(ele,str,icon){ele.innerHTML=str;ele.style.display="block";if(ele.id.indexOf("ErrTips")>=0){ele.style.visibility="visible"}if(icon){icon.className="SG_icon SG_icon48 tips"}}function hiddenError(ele,icon){ele.innerHTML="";ele.style.display="none";if(icon){icon.className="SG_icon SG_icon49 tips"}}function getKeyName(){var SUBPCookie=Utils.Cookie.getCookie("SUBP");var arrSubp=sinaSSOEncoder.getSUBPCookie.decode(SUBPCookie);var key=arrSubp.ln;return key}scope.blogOpener._initDialog=function(){var _this=this;Lib.checkAuthor(function(){_this.key=getKeyName();_this._dialog=winDialog.createCustomsDialog({content:_this.getCon(),width:458},"openblog");_this.bindEvent();scope.openBlogNameEvent($E("blogNameInput_t"),$E("blogNameError_t"),[],$E("blogNameIcon_t"))},"dialogNewTemplate"+(new Date).getTime())};scope.blogOpener.getCon=function(){return['<div class="e_layer_cont3">','<p class="open_tit">您的博客尚未开通,仅一步操作就能开通您的个人博客</p>','<dl class="e_layer_open">','<dt class="md">博客名称：</dt>','<dd><div class="open_input"><input id="blogNameInput_t" class="tag_input" type="text"></div></dd>','<img style="display:none" id="blogNameIcon_t" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" class="SG_icon SG_icon49 tips">','<dd id="blogNameError_t" style="color:red;margin:10px 0 0 80px;">博客名称不能为空</dd>',"</dl>",'<dl class="e_layer_open">',"<dt>隐私设置：</dt>","<dd>",'<input type="radio" class="open_box" checked="checked" id="openAll1_t" name="isPrivate_t">','<span class="open_word">对所有人开放</span>','<input type="radio" class=""open_box name="isPrivate_t" id="openMe1_t">','<span class="open_word">仅对自己开放，私密博客</span>',"</dd>",'<dd id="ErrTips_t"  style="color:red;margin-top:10px;">系统繁忙，请稍后再试</dd>',"</dl>",'<div class="open_btn">','<a href="javascript:void(0)" class="btn_style" id="openBlogOkBtn_t">完成开通</a>','<a href="javascript:void(0)" class="btn_style" id="openBlogCancel">取消</a>',"</div>","</div>"].join(" ")};scope.openBlogNameEvent=function(inputEle,errEle,optArr,icon){inputEle.onblur=function(){checkBlogName(inputEle,errEle,icon)};inputEle.onkeyup=function(){checkBlogName(inputEle,errEle,icon)}}}Lib.Login.Ui.prototype.initDom=function(){var me=this;this.dialog=winDialog.createCustomsDialog({width:458,tpl:me.tpl});this.dialog.addEventListener("hidden",function(){this.destroy()});this.dialog.setContent(this.struc);this.dialog.setTitle("登录新浪博客");this.dialog.setMiddle()};var oldAlert=Ui.ModuleDialog.prototype.alert;Ui.ModuleDialog.prototype.alert=function(text,cfg){if(cfg)delete cfg.width;if(!cfg)cfg={};cfg.zIndex=1e3;oldAlert.call(this,text,cfg)};var oldConfirm=Ui.ModuleDialog.prototype.confirm;Ui.ModuleDialog.prototype.confirm=function(text,cfg){if(cfg)delete cfg.width;if(!cfg)cfg={};cfg.zIndex=1e3;oldConfirm.call(this,text,cfg)};if(typeof scope.xssSafeCodeDiag=="undefined"){Core.Events.addEvent(window,function(){var safeimgsrc="http://interface.blog.sina.com.cn/riaapi/checkwd_image.php";var tpl='<div id="#{panel}" class="e_layer_prompt" style="width:458px;">'+'<div id="#{titleBar}" class="e_prompt_header">'+'<div class="e_prompt_tit" id="#{titleName}">提示</div>'+'<a href="javascript:void(0);" class="e_prompt_close" id="#{btnClose}">×</a>'+"</div>"+'<div id="#{content}">'+"</div>"+"</div>";var content='<div class="e_prompt_cont">'+'<div class="prompt_input">'+'<label class="txt">请输入验证码</label>'+'<input class="code_input" type="text" name="checkword" id="xssSafeCodeDiag_checkword">'+'<a href="javascript:scope.xssSafeCodeDiag.changeSafeCode();void(0);"><img id="xssSafeCodeDiag_safeimg" src="http://simg.sinajs.cn/blog7style/images/common/yzm1.gif" class="img_code" alt="" width="58" height="20" align="absmiddle"></a>'+'<a class="replace_a" href="javascript:scope.xssSafeCodeDiag.changeSafeCode();void(0);">换一个</a>'+"</div>"+'<div class="prompt_btn">'+'<a id="xssSafeCodeDiag_okbtn" href="javascript:scope.xssSafeCodeDiag.ok();void(0);" class="btn_style">确定</a>'+'<a id="xssSafeCodeDiag_cancelbtn" href="javascript:scope.xssSafeCodeDiag.cancel();void(0);" class="btn_style">取消</a></div>'+"</div>";scope.xssSafeCodeDiag=winDialog.createCustomsDialog({tpl:tpl,title:"提示",content:content,funcDisplayFinished:function(){}},"note");scope.xssSafeCodeDiag.changeSafeCode=function(){$E("xssSafeCodeDiag_checkword").value="";$E("xssSafeCodeDiag_safeimg").src=safeimgsrc+"?r="+Math.random()};scope.xssSafeCodeDiag.ok=function(){var v=$E("xssSafeCodeDiag_checkword").value;if(v===""){scope.xssSafeCodeDiag.hidden();winDialog.alert("请输入验证码。",{textOk:"确定",icon:"01",funcOk:function(){scope.xssSafeCodeDiag.showDiag()}});return}if(typeof $E("editorForm").checkword=="undefined"||$E("editorForm").checkword==null){var input;if($IE&&$IE<9){input=document.createElement('<input value="'+v+'" type="hidden" name="checkword" />')}else{input=document.createElement("input")}$E("editorForm").appendChild(input);input.name="checkword";input.type="hidden";input.value=v}$E("editorForm").submit();scope.xssSafeCodeDiag.hidden();$E("editorForm").removeChild($E("editorForm").checkword);$E("editorForm").checkword=null};scope.xssSafeCodeDiag.cancel=function(){scope.xssSafeCodeDiag.hidden()};scope.xssSafeCodeDiag.showDiag=function(){scope.xssSafeCodeDiag.show();scope.xssSafeCodeDiag.setMiddle();scope.xssSafeCodeDiag.changeSafeCode()};Core.Events.addEvent($E("xssSafeCodeDiag_checkword"),function(){if(typeof scope.xssSafeCodeDiag.keydownFn=="undefined"){scope.xssSafeCodeDiag.keydownFn=function(e){e=e||window.event;var kc=e.keyCode||e.charCode;if(kc=="13"){scope.xssSafeCodeDiag.ok()}};Core.Events.addEvent($E("xssSafeCodeDiag_checkword"),scope.xssSafeCodeDiag.keydownFn,"keydown")}},"focus");Core.Events.addEvent($E("xssSafeCodeDiag_checkword"),function(){if(typeof scope.xssSafeCodeDiag.keydownFn!="undefined"){Core.Events.removeEvent($E("xssSafeCodeDiag_checkword"),scope.xssSafeCodeDiag.keydownFn,"keydown");scope.xssSafeCodeDiag.keydownFn=null}},"blur")},"load")}}();!function(){var expands=Lib.pkg("Lib.Expands");!function(global,factory){if(typeof module==="object"&&typeof module.exports==="object"){module.exports=global.document?factory(global,true):function(w){if(!w.document){throw new Error("jQuery requires a window with a document")}return factory(w)}}else{factory(global)}}(window,function(window,noGlobal){var deletedIds=[];var slice=deletedIds.slice;var concat=deletedIds.concat;var push=deletedIds.push;var indexOf=deletedIds.indexOf;var class2type={};var toString=class2type.toString;var hasOwn=class2type.hasOwnProperty;var support={};var version="1.11.1",jQuery=function(selector,context){return new jQuery.fn.init(selector,context)},rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return letter.toUpperCase()};jQuery.fn=jQuery.prototype={jquery:version,constructor:jQuery,selector:"",length:0,toArray:function(){return slice.call(this)},get:function(num){return num!=null?num<0?this[num+this.length]:this[num]:slice.call(this)},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);ret.prevObject=this;ret.context=this.context;return ret},each:function(callback,args){return jQuery.each(this,callback,args)},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},slice:function(){return this.pushStack(slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(i){var len=this.length,j=+i+(i<0?len:0);return this.pushStack(j>=0&&j<len?[this[j]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:push,sort:deletedIds.sort,splice:deletedIds.splice};jQuery.extend=jQuery.fn.extend=function(){var src,copyIsArray,copy,name,options,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[i]||{};i++}if(typeof target!=="object"&&!jQuery.isFunction(target)){target={}}if(i===length){target=this;i--}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&jQuery.isArray(src)?src:[]}else{clone=src&&jQuery.isPlainObject(src)?src:{}}target[name]=jQuery.extend(deep,clone,copy)}else if(copy!==undefined){target[name]=copy}}}}return target};jQuery.extend({expando:"jQuery"+(version+Math.random()).replace(/\D/g,""),isReady:true,error:function(msg){throw new Error(msg)},noop:function(){},isFunction:function(obj){return jQuery.type(obj)==="function"},isArray:Array.isArray||function(obj){return jQuery.type(obj)==="array"},isWindow:function(obj){return obj!=null&&obj==obj.window},isNumeric:function(obj){return!jQuery.isArray(obj)&&obj-parseFloat(obj)>=0},isEmptyObject:function(obj){var name;for(name in obj){return false}return true},isPlainObject:function(obj){var key;if(!obj||jQuery.type(obj)!=="object"||obj.nodeType||jQuery.isWindow(obj)){return false}try{if(obj.constructor&&!hasOwn.call(obj,"constructor")&&!hasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false}}catch(e){return false}if(support.ownLast){for(key in obj){return hasOwn.call(obj,key)}}for(key in obj){}return key===undefined||hasOwn.call(obj,key)},type:function(obj){if(obj==null){return obj+""}return typeof obj==="object"||typeof obj==="function"?class2type[toString.call(obj)]||"object":typeof obj},globalEval:function(data){if(data&&jQuery.trim(data)){(window.execScript||function(data){window["eval"].call(window,data)})(data)}},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()},each:function(obj,callback,args){var value,i=0,length=obj.length,isArray=isArraylike(obj);if(args){if(isArray){for(;i<length;i++){value=callback.apply(obj[i],args);if(value===false){break}}}else{for(i in obj){value=callback.apply(obj[i],args);if(value===false){break}}}}else{if(isArray){for(;i<length;i++){value=callback.call(obj[i],i,obj[i]);if(value===false){break}}}else{for(i in obj){value=callback.call(obj[i],i,obj[i]);if(value===false){break}}}}return obj},trim:function(text){return text==null?"":(text+"").replace(rtrim,"")},makeArray:function(arr,results){var ret=results||[];if(arr!=null){if(isArraylike(Object(arr))){jQuery.merge(ret,typeof arr==="string"?[arr]:arr)}else{push.call(ret,arr)}}return ret},inArray:function(elem,arr,i){var len;if(arr){if(indexOf){return indexOf.call(arr,elem,i)}len=arr.length;i=i?i<0?Math.max(0,len+i):i:0;for(;i<len;i++){if(i in arr&&arr[i]===elem){return i}}}return-1},merge:function(first,second){var len=+second.length,j=0,i=first.length;while(j<len){first[i++]=second[j++]}if(len!==len){while(second[j]!==undefined){first[i++]=second[j++]}}first.length=i;return first},grep:function(elems,callback,invert){var callbackInverse,matches=[],i=0,length=elems.length,callbackExpect=!invert;for(;i<length;i++){callbackInverse=!callback(elems[i],i);if(callbackInverse!==callbackExpect){matches.push(elems[i])}}return matches},map:function(elems,callback,arg){var value,i=0,length=elems.length,isArray=isArraylike(elems),ret=[];if(isArray){for(;i<length;i++){value=callback(elems[i],i,arg);if(value!=null){ret.push(value)}}}else{for(i in elems){value=callback(elems[i],i,arg);if(value!=null){ret.push(value)}}}return concat.apply([],ret)},guid:1,proxy:function(fn,context){var args,proxy,tmp;if(typeof context==="string"){tmp=fn[context];context=fn;fn=tmp}if(!jQuery.isFunction(fn)){return undefined}args=slice.call(arguments,2);proxy=function(){return fn.apply(context||this,args.concat(slice.call(arguments)))};proxy.guid=fn.guid=fn.guid||jQuery.guid++;return proxy},now:function(){return+new Date},support:support});jQuery.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()});function isArraylike(obj){var length=obj.length,type=jQuery.type(obj);if(type==="function"||jQuery.isWindow(obj)){return false}if(obj.nodeType===1&&length){return true}return type==="array"||length===0||typeof length==="number"&&length>0&&length-1 in obj}var Sizzle=function(window){var i,support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+-new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){if(a===b){hasDuplicate=true}return 0},strundefined=typeof undefined,MAX_NEGATIVE=1<<31,hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=arr.indexOf||function(elem){var i=0,len=this.length;for(;i<len;i++){if(this[i]===elem){return i}}return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",characterEncoding="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",identifier=characterEncoding.replace("w","w#"),attributes="\\["+whitespace+"*("+characterEncoding+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+characterEncoding+")(?:\\(("+"('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|"+"((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|"+".*"+")\\)|)",rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*?)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+characterEncoding+")"),CLASS:new RegExp("^\\.("+characterEncoding+")"),TAG:new RegExp("^("+characterEncoding.replace("w","w*")+")"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!==high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,high&1023|56320)};try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes);arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){var j=target.length,i=0;while(target[j++]=els[i++]){}target.length=j-1}}}function Sizzle(selector,context,results,seed){var match,elem,m,nodeType,i,groups,old,nid,newContext,newSelector;if((context?context.ownerDocument||context:preferredDoc)!==document){setDocument(context)}context=context||document;results=results||[];if(!selector||typeof selector!=="string"){return results}if((nodeType=context.nodeType)!==1&&nodeType!==9){return[]}if(documentIsHTML&&!seed){if(match=rquickExpr.exec(selector)){if(m=match[1]){if(nodeType===9){elem=context.getElementById(m);if(elem&&elem.parentNode){if(elem.id===m){results.push(elem);return results}}else{return results}}else{if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m){results.push(elem);return results}}}else if(match[2]){push.apply(results,context.getElementsByTagName(selector));return results}else if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName){push.apply(results,context.getElementsByClassName(m));return results}}if(support.qsa&&(!rbuggyQSA||!rbuggyQSA.test(selector))){nid=old=expando;newContext=context;newSelector=nodeType===9&&selector;if(nodeType===1&&context.nodeName.toLowerCase()!=="object"){groups=tokenize(selector);if(old=context.getAttribute("id")){nid=old.replace(rescape,"\\$&")}else{context.setAttribute("id",nid)}nid="[id='"+nid+"'] ";i=groups.length;while(i--){groups[i]=nid+toSelector(groups[i])}newContext=rsibling.test(selector)&&testContext(context.parentNode)||context;newSelector=groups.join(",")}if(newSelector){try{push.apply(results,newContext.querySelectorAll(newSelector));return results}catch(qsaError){}finally{if(!old){context.removeAttribute("id")}}}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){var keys=[];function cache(key,value){if(keys.push(key+" ")>Expr.cacheLength){delete cache[keys.shift()]}return cache[key+" "]=value}return cache}function markFunction(fn){fn[expando]=true;return fn}function assert(fn){var div=document.createElement("div");try{return!!fn(div)}catch(e){return false}finally{if(div.parentNode){div.parentNode.removeChild(div)}div=null}}function addHandle(attrs,handler){var arr=attrs.split("|"),i=attrs.length;while(i--){Expr.attrHandle[arr[i]]=handler}}function siblingCheck(a,b){var cur=b&&a,diff=cur&&a.nodeType===1&&b.nodeType===1&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff){return diff}if(cur){while(cur=cur.nextSibling){if(cur===b){return-1}}}return a?1:-1}function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&elem.type===type}}function createPositionalPseudo(fn){return markFunction(function(argument){argument=+argument;return markFunction(function(seed,matches){var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;while(i--){if(seed[j=matchIndexes[i]]){seed[j]=!(matches[j]=seed[j])}}})})}function testContext(context){return context&&typeof context.getElementsByTagName!==strundefined&&context}support=Sizzle.support={};isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?documentElement.nodeName!=="HTML":false};setDocument=Sizzle.setDocument=function(node){var hasCompare,doc=node?node.ownerDocument||node:preferredDoc,parent=doc.defaultView;if(doc===document||doc.nodeType!==9||!doc.documentElement){return document}document=doc;docElem=doc.documentElement;documentIsHTML=!isXML(doc);if(parent&&parent!==parent.top){if(parent.addEventListener){parent.addEventListener("unload",function(){setDocument()},false)}else if(parent.attachEvent){parent.attachEvent("onunload",function(){setDocument()})}}support.attributes=assert(function(div){div.className="i";return!div.getAttribute("className")});support.getElementsByTagName=assert(function(div){div.appendChild(doc.createComment(""));return!div.getElementsByTagName("*").length});support.getElementsByClassName=rnative.test(doc.getElementsByClassName)&&assert(function(div){div.innerHTML="<div class='a'></div><div class='a i'></div>";div.firstChild.className="i";return div.getElementsByClassName("i").length===2});support.getById=assert(function(div){docElem.appendChild(div).id=expando;return!doc.getElementsByName||!doc.getElementsByName(expando).length});if(support.getById){Expr.find["ID"]=function(id,context){if(typeof context.getElementById!==strundefined&&documentIsHTML){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}};Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}}}else{delete Expr.find["ID"];Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=typeof elem.getAttributeNode!==strundefined&&elem.getAttributeNode("id");return node&&node.value===attrId}}}Expr.find["TAG"]=support.getElementsByTagName?function(tag,context){if(typeof context.getElementsByTagName!==strundefined){return context.getElementsByTagName(tag)}}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if(tag==="*"){while(elem=results[i++]){if(elem.nodeType===1){tmp.push(elem)}}return tmp}return results};Expr.find["CLASS"]=support.getElementsByClassName&&function(className,context){if(typeof context.getElementsByClassName!==strundefined&&documentIsHTML){return context.getElementsByClassName(className)}};rbuggyMatches=[];rbuggyQSA=[];if(support.qsa=rnative.test(doc.querySelectorAll)){assert(function(div){div.innerHTML="<select msallowclip=''><option selected=''></option></select>";if(div.querySelectorAll("[msallowclip^='']").length){rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")")}if(!div.querySelectorAll("[selected]").length){rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")")}if(!div.querySelectorAll(":checked").length){rbuggyQSA.push(":checked")}});assert(function(div){var input=doc.createElement("input");input.setAttribute("type","hidden");div.appendChild(input).setAttribute("name","D");if(div.querySelectorAll("[name=d]").length){rbuggyQSA.push("name"+whitespace+"*[*^$|!~]?=")}if(!div.querySelectorAll(":enabled").length){rbuggyQSA.push(":enabled",":disabled")}div.querySelectorAll("*,:x");rbuggyQSA.push(",.*:")})}if(support.matchesSelector=rnative.test(matches=docElem.matches||docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector)){assert(function(div){support.disconnectedMatch=matches.call(div,"div");matches.call(div,"[s!='']:x");rbuggyMatches.push("!=",pseudos)})}rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|"));rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|"));hasCompare=rnative.test(docElem.compareDocumentPosition);contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;
return a===bup||!!(bup&&bup.nodeType===1&&(adown.contains?adown.contains(bup):a.compareDocumentPosition&&a.compareDocumentPosition(bup)&16))}:function(a,b){if(b){while(b=b.parentNode){if(b===a){return true}}}return false};sortOrder=hasCompare?function(a,b){if(a===b){hasDuplicate=true;return 0}var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;if(compare){return compare}compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1;if(compare&1||!support.sortDetached&&b.compareDocumentPosition(a)===compare){if(a===doc||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)){return-1}if(b===doc||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)){return 1}return sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0}return compare&4?-1:1}:function(a,b){if(a===b){hasDuplicate=true;return 0}var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup){return a===doc?-1:b===doc?1:aup?-1:bup?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0}else if(aup===bup){return siblingCheck(a,b)}cur=a;while(cur=cur.parentNode){ap.unshift(cur)}cur=b;while(cur=cur.parentNode){bp.unshift(cur)}while(ap[i]===bp[i]){i++}return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0};return doc};Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)};Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document){setDocument(elem)}expr=expr.replace(rattributeQuotes,"='$1']");if(support.matchesSelector&&documentIsHTML&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr))){try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&elem.document.nodeType!==11){return ret}}catch(e){}}return Sizzle(expr,document,null,[elem]).length>0};Sizzle.contains=function(context,elem){if((context.ownerDocument||context)!==document){setDocument(context)}return contains(context,elem)};Sizzle.attr=function(elem,name){if((elem.ownerDocument||elem)!==document){setDocument(elem)}var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):undefined;return val!==undefined?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)};Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;hasDuplicate=!support.detectDuplicates;sortInput=!support.sortStable&&results.slice(0);results.sort(sortOrder);if(hasDuplicate){while(elem=results[i++]){if(elem===results[i]){j=duplicates.push(i)}}while(j--){results.splice(duplicates[j],1)}}sortInput=null;return results};getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(!nodeType){while(node=elem[i++]){ret+=getText(node)}}else if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==="string"){return elem.textContent}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem)}}}else if(nodeType===3||nodeType===4){return elem.nodeValue}return ret};Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){match[1]=match[1].replace(runescape,funescape);match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape);if(match[2]==="~="){match[3]=" "+match[3]+" "}return match.slice(0,4)},CHILD:function(match){match[1]=match[1].toLowerCase();if(match[1].slice(0,3)==="nth"){if(!match[3]){Sizzle.error(match[0])}match[4]=+(match[4]?match[5]+(match[6]||1):2*(match[3]==="even"||match[3]==="odd"));match[5]=+(match[7]+match[8]||match[3]==="odd")}else if(match[3]){Sizzle.error(match[0])}return match},PSEUDO:function(match){var excess,unquoted=!match[6]&&match[2];if(matchExpr["CHILD"].test(match[0])){return null}if(match[3]){match[2]=match[4]||match[5]||""}else if(unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,true))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)){match[0]=match[0].slice(0,excess);match[2]=unquoted.slice(0,excess)}return match.slice(0,3)}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return nodeNameSelector==="*"?function(){return true}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test(typeof elem.className==="string"&&elem.className||typeof elem.getAttribute!==strundefined&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);if(result==null){return operator==="!="}if(!operator){return true}result+="";return operator==="="?result===check:operator==="!="?result!==check:operator==="^="?check&&result.indexOf(check)===0:operator==="*="?check&&result.indexOf(check)>-1:operator==="$="?check&&result.slice(-check.length)===check:operator==="~="?(" "+result+" ").indexOf(check)>-1:operator==="|="?result===check||result.slice(0,check.length+1)===check+"-":false}},CHILD:function(type,what,argument,first,last){var simple=type.slice(0,3)!=="nth",forward=type.slice(-4)!=="last",ofType=what==="of-type";return first===1&&last===0?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType;if(parent){if(simple){while(dir){node=elem;while(node=node[dir]){if(ofType?node.nodeName.toLowerCase()===name:node.nodeType===1){return false}}start=dir=type==="only"&&!start&&"nextSibling"}return true}start=[forward?parent.firstChild:parent.lastChild];if(forward&&useCache){outerCache=parent[expando]||(parent[expando]={});cache=outerCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=cache[0]===dirruns&&cache[2];node=nodeIndex&&parent.childNodes[nodeIndex];while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop()){if(node.nodeType===1&&++diff&&node===elem){outerCache[type]=[dirruns,nodeIndex,diff];break}}}else if(useCache&&(cache=(elem[expando]||(elem[expando]={}))[type])&&cache[0]===dirruns){diff=cache[1]}else{while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop()){if((ofType?node.nodeName.toLowerCase()===name:node.nodeType===1)&&++diff){if(useCache){(node[expando]||(node[expando]={}))[type]=[dirruns,diff]}if(node===elem){break}}}}diff-=last;return diff===first||diff%first===0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);if(fn[expando]){return fn(argument)}if(fn.length>1){args=[pseudo,pseudo,"",argument];return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){var idx,matched=fn(seed,argument),i=matched.length;while(i--){idx=indexOf.call(seed,matched[i]);seed[idx]=!(matches[idx]=matched[i])}}):function(elem){return fn(elem,0,args)}}return fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;while(i--){if(elem=unmatched[i]){seed[i]=!(matches[i]=elem)}}}):function(elem,context,xml){input[0]=elem;matcher(input,null,xml,results);return!results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),lang:markFunction(function(lang){if(!ridentifier.test(lang||"")){Sizzle.error("unsupported lang: "+lang)}lang=lang.replace(runescape,funescape).toLowerCase();return function(elem){var elemLang;do{if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang")){elemLang=elemLang.toLowerCase();return elemLang===lang||elemLang.indexOf(lang+"-")===0}}while((elem=elem.parentNode)&&elem.nodeType===1);return false}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return elem.disabled===false},disabled:function(elem){return elem.disabled===true},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return nodeName==="input"&&!!elem.checked||nodeName==="option"&&!!elem.selected},selected:function(elem){if(elem.parentNode){elem.parentNode.selectedIndex}return elem.selected===true},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling){if(elem.nodeType<6){return false}}return true},parent:function(elem){return!Expr.pseudos["empty"](elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type==="button"||name==="button"},text:function(elem){var attr;return elem.nodeName.toLowerCase()==="input"&&elem.type==="text"&&((attr=elem.getAttribute("type"))==null||attr.toLowerCase()==="text")},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){var i=0;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){var i=1;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;--i>=0;){matchIndexes.push(i)}return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;++i<length;){matchIndexes.push(i)}return matchIndexes})}};Expr.pseudos["nth"]=Expr.pseudos["eq"];for(i in{radio:true,checkbox:true,file:true,password:true,image:true}){Expr.pseudos[i]=createInputPseudo(i)}for(i in{submit:true,reset:true}){Expr.pseudos[i]=createButtonPseudo(i)}function setFilters(){}setFilters.prototype=Expr.filters=Expr.pseudos;Expr.setFilters=new setFilters;tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached){return parseOnly?0:cached.slice(0)}soFar=selector;groups=[];preFilters=Expr.preFilter;while(soFar){if(!matched||(match=rcomma.exec(soFar))){if(match){soFar=soFar.slice(match[0].length)||soFar}groups.push(tokens=[])}matched=false;if(match=rcombinators.exec(soFar)){matched=match.shift();tokens.push({value:matched,type:match[0].replace(rtrim," ")});soFar=soFar.slice(matched.length)}for(type in Expr.filter){if((match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match)))){matched=match.shift();tokens.push({value:matched,type:type,matches:match});soFar=soFar.slice(matched.length)}}if(!matched){break}}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)};function toSelector(tokens){var i=0,len=tokens.length,selector="";for(;i<len;i++){selector+=tokens[i].value}return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&dir==="parentNode",doneName=done++;return combinator.first?function(elem,context,xml){while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){return matcher(elem,context,xml)}}}:function(elem,context,xml){var oldCache,outerCache,newCache=[dirruns,doneName];if(xml){while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){if(matcher(elem,context,xml)){return true}}}}else{while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){outerCache=elem[expando]||(elem[expando]={});if((oldCache=outerCache[dir])&&oldCache[0]===dirruns&&oldCache[1]===doneName){return newCache[2]=oldCache[2]}else{outerCache[dir]=newCache;if(newCache[2]=matcher(elem,context,xml)){return true}}}}}}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){var i=matchers.length;while(i--){if(!matchers[i](elem,context,xml)){return false}}return true}:matchers[0]}function multipleContexts(selector,contexts,results){var i=0,len=contexts.length;for(;i<len;i++){Sizzle(selector,contexts[i],results)}return results}function condense(unmatched,map,filter,context,xml){var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=map!=null;for(;i<len;i++){if(elem=unmatched[i]){if(!filter||filter(elem,context,xml)){newUnmatched.push(elem);if(mapped){map.push(i)}}}}return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){if(postFilter&&!postFilter[expando]){postFilter=setMatcher(postFilter)}if(postFinder&&!postFinder[expando]){postFinder=setMatcher(postFinder,postSelector)}return markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=preFilter&&(seed||!selector)?condense(elems,preMap,preFilter,context,xml):elems,matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher){matcher(matcherIn,matcherOut,context,xml)}if(postFilter){temp=condense(matcherOut,postMap);postFilter(temp,[],context,xml);i=temp.length;while(i--){if(elem=temp[i]){matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem)}}}if(seed){if(postFinder||preFilter){if(postFinder){temp=[];i=matcherOut.length;while(i--){if(elem=matcherOut[i]){temp.push(matcherIn[i]=elem)}}postFinder(null,matcherOut=[],temp,xml)}i=matcherOut.length;while(i--){if((elem=matcherOut[i])&&(temp=postFinder?indexOf.call(seed,elem):preMap[i])>-1){seed[temp]=!(results[temp]=elem)}}}}else{matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut);if(postFinder){postFinder(null,results,matcherOut,xml)}else{push.apply(results,matcherOut)}}})}function matcherFromTokens(tokens){var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,true),matchAnyContext=addCombinator(function(elem){return indexOf.call(checkContext,elem)>-1},implicitRelative,true),matchers=[function(elem,context,xml){return!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml))}];for(;i<len;i++){if(matcher=Expr.relative[tokens[i].type]){matchers=[addCombinator(elementMatcher(matchers),matcher)]}else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;j<len;j++){if(Expr.relative[tokens[j].type]){break}}return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:tokens[i-2].type===" "?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find["TAG"]("*",outermost),dirrunsUnique=dirruns+=contextBackup==null?1:Math.random()||.1,len=elems.length;if(outermost){outermostContext=context!==document&&context}for(;i!==len&&(elem=elems[i])!=null;i++){if(byElement&&elem){j=0;while(matcher=elementMatchers[j++]){if(matcher(elem,context,xml)){results.push(elem);break}}if(outermost){dirruns=dirrunsUnique}}if(bySet){if(elem=!matcher&&elem){matchedCount--}if(seed){unmatched.push(elem)}}}matchedCount+=i;if(bySet&&i!==matchedCount){j=0;while(matcher=setMatchers[j++]){matcher(unmatched,setMatched,context,xml)}if(seed){if(matchedCount>0){while(i--){if(!(unmatched[i]||setMatched[i])){setMatched[i]=pop.call(results)}}}setMatched=condense(setMatched)}push.apply(results,setMatched);if(outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1){Sizzle.uniqueSort(results)}}if(outermost){dirruns=dirrunsUnique;outermostContext=contextBackup}return unmatched};return bySet?markFunction(superMatcher):superMatcher}compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){if(!match){match=tokenize(selector)}i=match.length;while(i--){cached=matcherFromTokens(match[i]);if(cached[expando]){setMatchers.push(cached)}else{elementMatchers.push(cached)}}cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers));cached.selector=selector}return cached};select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled=typeof selector==="function"&&selector,match=!seed&&tokenize(selector=compiled.selector||selector);results=results||[];if(match.length===1){tokens=match[0]=match[0].slice(0);if(tokens.length>2&&(token=tokens[0]).type==="ID"&&support.getById&&context.nodeType===9&&documentIsHTML&&Expr.relative[tokens[1].type]){context=(Expr.find["ID"](token.matches[0].replace(runescape,funescape),context)||[])[0];if(!context){return results}else if(compiled){context=context.parentNode}selector=selector.slice(tokens.shift().value.length)}i=matchExpr["needsContext"].test(selector)?0:tokens.length;while(i--){token=tokens[i];if(Expr.relative[type=token.type]){break}if(find=Expr.find[type]){if(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context)){tokens.splice(i,1);selector=seed.length&&toSelector(tokens);if(!selector){push.apply(results,seed);return results}break}}}}(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,rsibling.test(selector)&&testContext(context.parentNode)||context);return results};support.sortStable=expando.split("").sort(sortOrder).join("")===expando;support.detectDuplicates=!!hasDuplicate;setDocument();support.sortDetached=assert(function(div1){return div1.compareDocumentPosition(document.createElement("div"))&1});if(!assert(function(div){div.innerHTML="<a href='#'></a>";return div.firstChild.getAttribute("href")==="#"})){addHandle("type|href|height|width",function(elem,name,isXML){if(!isXML){return elem.getAttribute(name,name.toLowerCase()==="type"?1:2)}})}if(!support.attributes||!assert(function(div){div.innerHTML="<input/>";div.firstChild.setAttribute("value","");return div.firstChild.getAttribute("value")===""})){addHandle("value",function(elem,name,isXML){if(!isXML&&elem.nodeName.toLowerCase()==="input"){return elem.defaultValue}})}if(!assert(function(div){return div.getAttribute("disabled")==null})){addHandle(booleans,function(elem,name,isXML){var val;if(!isXML){return elem[name]===true?name.toLowerCase():(val=elem.getAttributeNode(name))&&val.specified?val.value:null}})}return Sizzle}(window);jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.pseudos;jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;jQuery.contains=Sizzle.contains;var rneedsContext=jQuery.expr.match.needsContext;var rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/;var risSimple=/^.[^:#\[\.,]*$/;function winnow(elements,qualifier,not){if(jQuery.isFunction(qualifier)){return jQuery.grep(elements,function(elem,i){return!!qualifier.call(elem,i,elem)!==not})}if(qualifier.nodeType){return jQuery.grep(elements,function(elem){return elem===qualifier!==not})}if(typeof qualifier==="string"){if(risSimple.test(qualifier)){return jQuery.filter(qualifier,elements,not)}qualifier=jQuery.filter(qualifier,elements)}return jQuery.grep(elements,function(elem){return jQuery.inArray(elem,qualifier)>=0!==not})}jQuery.filter=function(expr,elems,not){var elem=elems[0];if(not){expr=":not("+expr+")"}return elems.length===1&&elem.nodeType===1?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return elem.nodeType===1}))};jQuery.fn.extend({find:function(selector){var i,ret=[],self=this,len=self.length;if(typeof selector!=="string"){return this.pushStack(jQuery(selector).filter(function(){for(i=0;i<len;i++){if(jQuery.contains(self[i],this)){return true}}}))}for(i=0;i<len;i++){jQuery.find(selector,self[i],ret)}ret=this.pushStack(len>1?jQuery.unique(ret):ret);ret.selector=this.selector?this.selector+" "+selector:selector;return ret},filter:function(selector){return this.pushStack(winnow(this,selector||[],false))},not:function(selector){return this.pushStack(winnow(this,selector||[],true))},is:function(selector){return!!winnow(this,typeof selector==="string"&&rneedsContext.test(selector)?jQuery(selector):selector||[],false).length}});var rootjQuery,document=window.document,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,init=jQuery.fn.init=function(selector,context){var match,elem;if(!selector){return this}if(typeof selector==="string"){if(selector.charAt(0)==="<"&&selector.charAt(selector.length-1)===">"&&selector.length>=3){match=[null,selector,null]}else{match=rquickExpr.exec(selector)}if(match&&(match[1]||!context)){if(match[1]){context=context instanceof jQuery?context[0]:context;jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,true));if(rsingleTag.test(match[1])&&jQuery.isPlainObject(context)){for(match in context){if(jQuery.isFunction(this[match])){this[match](context[match])}else{this.attr(match,context[match])}}}return this}else{elem=document.getElementById(match[2]);if(elem&&elem.parentNode){if(elem.id!==match[2]){return rootjQuery.find(selector)}this.length=1;this[0]=elem}this.context=document;this.selector=selector;return this}}else if(!context||context.jquery){return(context||rootjQuery).find(selector)}else{return this.constructor(context).find(selector)}}else if(selector.nodeType){this.context=this[0]=selector;this.length=1;return this}else if(jQuery.isFunction(selector)){return typeof rootjQuery.ready!=="undefined"?rootjQuery.ready(selector):selector(jQuery)}if(selector.selector!==undefined){this.selector=selector.selector;this.context=selector.context}return jQuery.makeArray(selector,this)};init.prototype=jQuery.fn;rootjQuery=jQuery(document);var rparentsprev=/^(?:parents|prev(?:Until|All))/,guaranteedUnique={children:true,contents:true,next:true,prev:true};jQuery.extend({dir:function(elem,dir,until){var matched=[],cur=elem[dir];while(cur&&cur.nodeType!==9&&(until===undefined||cur.nodeType!==1||!jQuery(cur).is(until))){if(cur.nodeType===1){matched.push(cur)}cur=cur[dir]}return matched},sibling:function(n,elem){var r=[];for(;n;n=n.nextSibling){if(n.nodeType===1&&n!==elem){r.push(n)}}return r}});jQuery.fn.extend({has:function(target){var i,targets=jQuery(target,this),len=targets.length;return this.filter(function(){for(i=0;i<len;i++){if(jQuery.contains(this,targets[i])){return true}}})},closest:function(selectors,context){var cur,i=0,l=this.length,matched=[],pos=rneedsContext.test(selectors)||typeof selectors!=="string"?jQuery(selectors,context||this.context):0;for(;i<l;i++){for(cur=this[i];cur&&cur!==context;cur=cur.parentNode){if(cur.nodeType<11&&(pos?pos.index(cur)>-1:cur.nodeType===1&&jQuery.find.matchesSelector(cur,selectors))){matched.push(cur);break}}}return this.pushStack(matched.length>1?jQuery.unique(matched):matched)},index:function(elem){if(!elem){return this[0]&&this[0].parentNode?this.first().prevAll().length:-1}if(typeof elem==="string"){return jQuery.inArray(this[0],jQuery(elem))}return jQuery.inArray(elem.jquery?elem[0]:elem,this)},add:function(selector,context){return this.pushStack(jQuery.unique(jQuery.merge(this.get(),jQuery(selector,context))))},addBack:function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector))}});function sibling(cur,dir){do{cur=cur[dir]}while(cur&&cur.nodeType!==1);return cur}jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null},parents:function(elem){return jQuery.dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return jQuery.dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return jQuery.dir(elem,"nextSibling")},prevAll:function(elem){return jQuery.dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return jQuery.dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return jQuery.dir(elem,"previousSibling",until)},siblings:function(elem){return jQuery.sibling((elem.parentNode||{}).firstChild,elem)},children:function(elem){return jQuery.sibling(elem.firstChild)},contents:function(elem){return jQuery.nodeName(elem,"iframe")?elem.contentDocument||elem.contentWindow.document:jQuery.merge([],elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var ret=jQuery.map(this,fn,until);if(name.slice(-5)!=="Until"){selector=until}if(selector&&typeof selector==="string"){ret=jQuery.filter(selector,ret)}if(this.length>1){if(!guaranteedUnique[name]){ret=jQuery.unique(ret)}if(rparentsprev.test(name)){ret=ret.reverse()}}return this.pushStack(ret)}});var rnotwhite=/\S+/g;var optionsCache={};function createOptions(options){var object=optionsCache[options]={};jQuery.each(options.match(rnotwhite)||[],function(_,flag){object[flag]=true});return object}jQuery.Callbacks=function(options){options=typeof options==="string"?optionsCache[options]||createOptions(options):jQuery.extend({},options);var firing,memory,fired,firingLength,firingIndex,firingStart,list=[],stack=!options.once&&[],fire=function(data){memory=options.memory&&data;fired=true;firingIndex=firingStart||0;firingStart=0;firingLength=list.length;firing=true;for(;list&&firingIndex<firingLength;firingIndex++){if(list[firingIndex].apply(data[0],data[1])===false&&options.stopOnFalse){memory=false;break}}firing=false;if(list){if(stack){if(stack.length){fire(stack.shift())}}else if(memory){list=[]}else{self.disable()}}},self={add:function(){if(list){var start=list.length;!function add(args){jQuery.each(args,function(_,arg){var type=jQuery.type(arg);if(type==="function"){if(!options.unique||!self.has(arg)){list.push(arg)}}else if(arg&&arg.length&&type!=="string"){add(arg)}})}(arguments);if(firing){firingLength=list.length}else if(memory){firingStart=start;fire(memory)}}return this},remove:function(){if(list){jQuery.each(arguments,function(_,arg){var index;while((index=jQuery.inArray(arg,list,index))>-1){list.splice(index,1);if(firing){if(index<=firingLength){firingLength--}if(index<=firingIndex){firingIndex--}}}})}return this},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:!!(list&&list.length)},empty:function(){list=[];firingLength=0;return this},disable:function(){list=stack=memory=undefined;return this},disabled:function(){return!list},lock:function(){stack=undefined;if(!memory){self.disable()}return this},locked:function(){return!stack},fireWith:function(context,args){if(list&&(!fired||stack)){args=args||[];args=[context,args.slice?args.slice():args];if(firing){stack.push(args)}else{fire(args)}}return this},fire:function(){self.fireWith(this,arguments);return this},fired:function(){return!!fired}};return self};jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state},always:function(){deferred.done(arguments).fail(arguments);return this},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var fn=jQuery.isFunction(fns[i])&&fns[i];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);if(returned&&jQuery.isFunction(returned.promise)){returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify)}else{newDefer[tuple[0]+"With"](this===promise?newDefer.promise():this,fn?[returned]:arguments)}})});fns=null}).promise()},promise:function(obj){return obj!=null?jQuery.extend(obj,promise):promise}},deferred={};promise.pipe=promise.then;jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add;if(stateString){list.add(function(){state=stateString},tuples[i^1][2].disable,tuples[2][2].lock)}deferred[tuple[0]]=function(){deferred[tuple[0]+"With"](this===deferred?promise:this,arguments);return this};deferred[tuple[0]+"With"]=list.fireWith});promise.promise(deferred);if(func){func.call(deferred,deferred)}return deferred},when:function(subordinate){var i=0,resolveValues=slice.call(arguments),length=resolveValues.length,remaining=length!==1||subordinate&&jQuery.isFunction(subordinate.promise)?length:0,deferred=remaining===1?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this;values[i]=arguments.length>1?slice.call(arguments):value;if(values===progressValues){deferred.notifyWith(contexts,values)}else if(!--remaining){deferred.resolveWith(contexts,values)}}},progressValues,progressContexts,resolveContexts;if(length>1){progressValues=new Array(length);progressContexts=new Array(length);resolveContexts=new Array(length);for(;i<length;i++){if(resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)){resolveValues[i].promise().done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject).progress(updateFunc(i,progressContexts,progressValues))}else{--remaining}}}if(!remaining){deferred.resolveWith(resolveContexts,resolveValues)}return deferred.promise()}});var readyList;jQuery.fn.ready=function(fn){jQuery.ready.promise().done(fn);return this};jQuery.extend({isReady:false,readyWait:1,holdReady:function(hold){if(hold){jQuery.readyWait++}else{jQuery.ready(true)}},ready:function(wait){if(wait===true?--jQuery.readyWait:jQuery.isReady){return}if(!document.body){return setTimeout(jQuery.ready)}jQuery.isReady=true;if(wait!==true&&--jQuery.readyWait>0){return}readyList.resolveWith(document,[jQuery]);if(jQuery.fn.triggerHandler){jQuery(document).triggerHandler("ready");jQuery(document).off("ready")}}});function detach(){if(document.addEventListener){document.removeEventListener("DOMContentLoaded",completed,false);window.removeEventListener("load",completed,false)}else{document.detachEvent("onreadystatechange",completed);window.detachEvent("onload",completed)}}function completed(){if(document.addEventListener||event.type==="load"||document.readyState==="complete"){detach();jQuery.ready()}}jQuery.ready.promise=function(obj){if(!readyList){readyList=jQuery.Deferred();if(document.readyState==="complete"){setTimeout(jQuery.ready)}else if(document.addEventListener){document.addEventListener("DOMContentLoaded",completed,false);window.addEventListener("load",completed,false)}else{document.attachEvent("onreadystatechange",completed);window.attachEvent("onload",completed);var top=false;try{top=window.frameElement==null&&document.documentElement
}catch(e){}if(top&&top.doScroll){!function doScrollCheck(){if(!jQuery.isReady){try{top.doScroll("left")}catch(e){return setTimeout(doScrollCheck,50)}detach();jQuery.ready()}}()}}}return readyList.promise(obj)};var strundefined=typeof undefined;var i;for(i in jQuery(support)){break}support.ownLast=i!=="0";support.inlineBlockNeedsLayout=false;jQuery(function(){var val,div,body,container;body=document.getElementsByTagName("body")[0];if(!body||!body.style){return}div=document.createElement("div");container=document.createElement("div");container.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px";body.appendChild(container).appendChild(div);if(typeof div.style.zoom!==strundefined){div.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1";support.inlineBlockNeedsLayout=val=div.offsetWidth===3;if(val){body.style.zoom=1}}body.removeChild(container)});!function(){var div=document.createElement("div");if(support.deleteExpando==null){support.deleteExpando=true;try{delete div.test}catch(e){support.deleteExpando=false}}div=null}();jQuery.acceptData=function(elem){var noData=jQuery.noData[(elem.nodeName+" ").toLowerCase()],nodeType=+elem.nodeType||1;return nodeType!==1&&nodeType!==9?false:!noData||noData!==true&&elem.getAttribute("classid")===noData};var rbrace=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,rmultiDash=/([A-Z])/g;function dataAttr(elem,key,data){if(data===undefined&&elem.nodeType===1){var name="data-"+key.replace(rmultiDash,"-$1").toLowerCase();data=elem.getAttribute(name);if(typeof data==="string"){try{data=data==="true"?true:data==="false"?false:data==="null"?null:+data+""===data?+data:rbrace.test(data)?jQuery.parseJSON(data):data}catch(e){}jQuery.data(elem,key,data)}else{data=undefined}}return data}function isEmptyDataObject(obj){var name;for(name in obj){if(name==="data"&&jQuery.isEmptyObject(obj[name])){continue}if(name!=="toJSON"){return false}}return true}function internalData(elem,name,data,pvt){if(!jQuery.acceptData(elem)){return}var ret,thisCache,internalKey=jQuery.expando,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[internalKey]:elem[internalKey]&&internalKey;if((!id||!cache[id]||!pvt&&!cache[id].data)&&data===undefined&&typeof name==="string"){return}if(!id){if(isNode){id=elem[internalKey]=deletedIds.pop()||jQuery.guid++}else{id=internalKey}}if(!cache[id]){cache[id]=isNode?{}:{toJSON:jQuery.noop}}if(typeof name==="object"||typeof name==="function"){if(pvt){cache[id]=jQuery.extend(cache[id],name)}else{cache[id].data=jQuery.extend(cache[id].data,name)}}thisCache=cache[id];if(!pvt){if(!thisCache.data){thisCache.data={}}thisCache=thisCache.data}if(data!==undefined){thisCache[jQuery.camelCase(name)]=data}if(typeof name==="string"){ret=thisCache[name];if(ret==null){ret=thisCache[jQuery.camelCase(name)]}}else{ret=thisCache}return ret}function internalRemoveData(elem,name,pvt){if(!jQuery.acceptData(elem)){return}var thisCache,i,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[jQuery.expando]:jQuery.expando;if(!cache[id]){return}if(name){thisCache=pvt?cache[id]:cache[id].data;if(thisCache){if(!jQuery.isArray(name)){if(name in thisCache){name=[name]}else{name=jQuery.camelCase(name);if(name in thisCache){name=[name]}else{name=name.split(" ")}}}else{name=name.concat(jQuery.map(name,jQuery.camelCase))}i=name.length;while(i--){delete thisCache[name[i]]}if(pvt?!isEmptyDataObject(thisCache):!jQuery.isEmptyObject(thisCache)){return}}}if(!pvt){delete cache[id].data;if(!isEmptyDataObject(cache[id])){return}}if(isNode){jQuery.cleanData([elem],true)}else if(support.deleteExpando||cache!=cache.window){delete cache[id]}else{cache[id]=null}}jQuery.extend({cache:{},noData:{"applet ":true,"embed ":true,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(elem){elem=elem.nodeType?jQuery.cache[elem[jQuery.expando]]:elem[jQuery.expando];return!!elem&&!isEmptyDataObject(elem)},data:function(elem,name,data){return internalData(elem,name,data)},removeData:function(elem,name){return internalRemoveData(elem,name)},_data:function(elem,name,data){return internalData(elem,name,data,true)},_removeData:function(elem,name){return internalRemoveData(elem,name,true)}});jQuery.fn.extend({data:function(key,value){var i,name,data,elem=this[0],attrs=elem&&elem.attributes;if(key===undefined){if(this.length){data=jQuery.data(elem);if(elem.nodeType===1&&!jQuery._data(elem,"parsedAttrs")){i=attrs.length;while(i--){if(attrs[i]){name=attrs[i].name;if(name.indexOf("data-")===0){name=jQuery.camelCase(name.slice(5));dataAttr(elem,name,data[name])}}}jQuery._data(elem,"parsedAttrs",true)}}return data}if(typeof key==="object"){return this.each(function(){jQuery.data(this,key)})}return arguments.length>1?this.each(function(){jQuery.data(this,key,value)}):elem?dataAttr(elem,key,jQuery.data(elem,key)):undefined},removeData:function(key){return this.each(function(){jQuery.removeData(this,key)})}});jQuery.extend({queue:function(elem,type,data){var queue;if(elem){type=(type||"fx")+"queue";queue=jQuery._data(elem,type);if(data){if(!queue||jQuery.isArray(data)){queue=jQuery._data(elem,type,jQuery.makeArray(data))}else{queue.push(data)}}return queue||[]}},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type)};if(fn==="inprogress"){fn=queue.shift();startLength--}if(fn){if(type==="fx"){queue.unshift("inprogress")}delete hooks.stop;fn.call(elem,next,hooks)}if(!startLength&&hooks){hooks.empty.fire()}},_queueHooks:function(elem,type){var key=type+"queueHooks";return jQuery._data(elem,key)||jQuery._data(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){jQuery._removeData(elem,type+"queue");jQuery._removeData(elem,key)})})}});jQuery.fn.extend({queue:function(type,data){var setter=2;if(typeof type!=="string"){data=type;type="fx";setter--}if(arguments.length<setter){return jQuery.queue(this[0],type)}return data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type);if(type==="fx"&&queue[0]!=="inprogress"){jQuery.dequeue(this,type)}})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){if(!--count){defer.resolveWith(elements,[elements])}};if(typeof type!=="string"){obj=type;type=undefined}type=type||"fx";while(i--){tmp=jQuery._data(elements[i],type+"queueHooks");if(tmp&&tmp.empty){count++;tmp.empty.add(resolve)}}resolve();return defer.promise(obj)}});var pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source;var cssExpand=["Top","Right","Bottom","Left"];var isHidden=function(elem,el){elem=el||elem;return jQuery.css(elem,"display")==="none"||!jQuery.contains(elem.ownerDocument,elem)};var access=jQuery.access=function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,length=elems.length,bulk=key==null;if(jQuery.type(key)==="object"){chainable=true;for(i in key){jQuery.access(elems,fn,i,key[i],true,emptyGet,raw)}}else if(value!==undefined){chainable=true;if(!jQuery.isFunction(value)){raw=true}if(bulk){if(raw){fn.call(elems,value);fn=null}else{bulk=fn;fn=function(elem,key,value){return bulk.call(jQuery(elem),value)}}}if(fn){for(;i<length;i++){fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)))}}}return chainable?elems:bulk?fn.call(elems):length?fn(elems[0],key):emptyGet};var rcheckableType=/^(?:checkbox|radio)$/i;!function(){var input=document.createElement("input"),div=document.createElement("div"),fragment=document.createDocumentFragment();div.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";support.leadingWhitespace=div.firstChild.nodeType===3;support.tbody=!div.getElementsByTagName("tbody").length;support.htmlSerialize=!!div.getElementsByTagName("link").length;support.html5Clone=document.createElement("nav").cloneNode(true).outerHTML!=="<:nav></:nav>";input.type="checkbox";input.checked=true;fragment.appendChild(input);support.appendChecked=input.checked;div.innerHTML="<textarea>x</textarea>";support.noCloneChecked=!!div.cloneNode(true).lastChild.defaultValue;fragment.appendChild(div);div.innerHTML="<input type='radio' checked='checked' name='t'/>";support.checkClone=div.cloneNode(true).cloneNode(true).lastChild.checked;support.noCloneEvent=true;if(div.attachEvent){div.attachEvent("onclick",function(){support.noCloneEvent=false});div.cloneNode(true).click()}if(support.deleteExpando==null){support.deleteExpando=true;try{delete div.test}catch(e){support.deleteExpando=false}}}();!function(){var i,eventName,div=document.createElement("div");for(i in{submit:true,change:true,focusin:true}){eventName="on"+i;if(!(support[i+"Bubbles"]=eventName in window)){div.setAttribute(eventName,"t");support[i+"Bubbles"]=div.attributes[eventName].expando===false}}div=null}();var rformElems=/^(?:input|select|textarea)$/i,rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|pointer|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\.(.+)|)$/;function returnTrue(){return true}function returnFalse(){return false}function safeActiveElement(){try{return document.activeElement}catch(err){}}jQuery.event={global:{},add:function(elem,types,handler,data,selector){var tmp,events,t,handleObjIn,special,eventHandle,handleObj,handlers,type,namespaces,origType,elemData=jQuery._data(elem);if(!elemData){return}if(handler.handler){handleObjIn=handler;handler=handleObjIn.handler;selector=handleObjIn.selector}if(!handler.guid){handler.guid=jQuery.guid++}if(!(events=elemData.events)){events=elemData.events={}}if(!(eventHandle=elemData.handle)){eventHandle=elemData.handle=function(e){return typeof jQuery!==strundefined&&(!e||jQuery.event.triggered!==e.type)?jQuery.event.dispatch.apply(eventHandle.elem,arguments):undefined};eventHandle.elem=elem}types=(types||"").match(rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;special=jQuery.event.special[type]||{};handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn);if(!(handlers=events[type])){handlers=events[type]=[];handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===false){if(elem.addEventListener){elem.addEventListener(type,eventHandle,false)}else if(elem.attachEvent){elem.attachEvent("on"+type,eventHandle)}}}if(special.add){special.add.call(elem,handleObj);if(!handleObj.handler.guid){handleObj.handler.guid=handler.guid}}if(selector){handlers.splice(handlers.delegateCount++,0,handleObj)}else{handlers.push(handleObj)}jQuery.event.global[type]=true}elem=null},remove:function(elem,types,handler,selector,mappedTypes){var j,handleObj,tmp,origCount,t,events,special,handlers,type,namespaces,origType,elemData=jQuery.hasData(elem)&&jQuery._data(elem);if(!elemData||!(events=elemData.events)){return}types=(types||"").match(rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){for(type in events){jQuery.event.remove(elem,type+types[t],handler,selector,true)}continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;handlers=events[type]||[];tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)");origCount=j=handlers.length;while(j--){handleObj=handlers[j];if((mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!tmp||tmp.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)){handlers.splice(j,1);if(handleObj.selector){handlers.delegateCount--}if(special.remove){special.remove.call(elem,handleObj)}}}if(origCount&&!handlers.length){if(!special.teardown||special.teardown.call(elem,namespaces,elemData.handle)===false){jQuery.removeEvent(elem,type,elemData.handle)}delete events[type]}}if(jQuery.isEmptyObject(events)){delete elemData.handle;jQuery._removeData(elem,"events")}},trigger:function(event,data,elem,onlyHandlers){var handle,ontype,cur,bubbleType,special,tmp,i,eventPath=[elem||document],type=hasOwn.call(event,"type")?event.type:event,namespaces=hasOwn.call(event,"namespace")?event.namespace.split("."):[];cur=tmp=elem=elem||document;if(elem.nodeType===3||elem.nodeType===8){return}if(rfocusMorph.test(type+jQuery.event.triggered)){return}if(type.indexOf(".")>=0){namespaces=type.split(".");type=namespaces.shift();namespaces.sort()}ontype=type.indexOf(":")<0&&"on"+type;event=event[jQuery.expando]?event:new jQuery.Event(type,typeof event==="object"&&event);event.isTrigger=onlyHandlers?2:3;event.namespace=namespaces.join(".");event.namespace_re=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;event.result=undefined;if(!event.target){event.target=elem}data=data==null?[event]:jQuery.makeArray(data,[event]);special=jQuery.event.special[type]||{};if(!onlyHandlers&&special.trigger&&special.trigger.apply(elem,data)===false){return}if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type;if(!rfocusMorph.test(bubbleType+type)){cur=cur.parentNode}for(;cur;cur=cur.parentNode){eventPath.push(cur);tmp=cur}if(tmp===(elem.ownerDocument||document)){eventPath.push(tmp.defaultView||tmp.parentWindow||window)}}i=0;while((cur=eventPath[i++])&&!event.isPropagationStopped()){event.type=i>1?bubbleType:special.bindType||type;handle=(jQuery._data(cur,"events")||{})[event.type]&&jQuery._data(cur,"handle");if(handle){handle.apply(cur,data)}handle=ontype&&cur[ontype];if(handle&&handle.apply&&jQuery.acceptData(cur)){event.result=handle.apply(cur,data);if(event.result===false){event.preventDefault()}}}event.type=type;if(!onlyHandlers&&!event.isDefaultPrevented()){if((!special._default||special._default.apply(eventPath.pop(),data)===false)&&jQuery.acceptData(elem)){if(ontype&&elem[type]&&!jQuery.isWindow(elem)){tmp=elem[ontype];if(tmp){elem[ontype]=null}jQuery.event.triggered=type;try{elem[type]()}catch(e){}jQuery.event.triggered=undefined;if(tmp){elem[ontype]=tmp}}}}return event.result},dispatch:function(event){event=jQuery.event.fix(event);var i,ret,handleObj,matched,j,handlerQueue=[],args=slice.call(arguments),handlers=(jQuery._data(this,"events")||{})[event.type]||[],special=jQuery.event.special[event.type]||{};args[0]=event;event.delegateTarget=this;if(special.preDispatch&&special.preDispatch.call(this,event)===false){return}handlerQueue=jQuery.event.handlers.call(this,event,handlers);i=0;while((matched=handlerQueue[i++])&&!event.isPropagationStopped()){event.currentTarget=matched.elem;j=0;while((handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped()){if(!event.namespace_re||event.namespace_re.test(handleObj.namespace)){event.handleObj=handleObj;event.data=handleObj.data;ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args);if(ret!==undefined){if((event.result=ret)===false){event.preventDefault();event.stopPropagation()}}}}}if(special.postDispatch){special.postDispatch.call(this,event)}return event.result},handlers:function(event,handlers){var sel,handleObj,matches,i,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&(!event.button||event.type!=="click")){for(;cur!=this;cur=cur.parentNode||this){if(cur.nodeType===1&&(cur.disabled!==true||event.type!=="click")){matches=[];for(i=0;i<delegateCount;i++){handleObj=handlers[i];sel=handleObj.selector+" ";if(matches[sel]===undefined){matches[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>=0:jQuery.find(sel,this,null,[cur]).length}if(matches[sel]){matches.push(handleObj)}}if(matches.length){handlerQueue.push({elem:cur,handlers:matches})}}}}if(delegateCount<handlers.length){handlerQueue.push({elem:this,handlers:handlers.slice(delegateCount)})}return handlerQueue},fix:function(event){if(event[jQuery.expando]){return event}var i,prop,copy,type=event.type,originalEvent=event,fixHook=this.fixHooks[type];if(!fixHook){this.fixHooks[type]=fixHook=rmouseEvent.test(type)?this.mouseHooks:rkeyEvent.test(type)?this.keyHooks:{}}copy=fixHook.props?this.props.concat(fixHook.props):this.props;event=new jQuery.Event(originalEvent);i=copy.length;while(i--){prop=copy[i];event[prop]=originalEvent[prop]}if(!event.target){event.target=originalEvent.srcElement||document}if(event.target.nodeType===3){event.target=event.target.parentNode}event.metaKey=!!event.metaKey;return fixHook.filter?fixHook.filter(event,originalEvent):event},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){if(event.which==null){event.which=original.charCode!=null?original.charCode:original.keyCode}return event}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var body,eventDoc,doc,button=original.button,fromElement=original.fromElement;if(event.pageX==null&&original.clientX!=null){eventDoc=event.target.ownerDocument||document;doc=eventDoc.documentElement;body=eventDoc.body;event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}if(!event.relatedTarget&&fromElement){event.relatedTarget=fromElement===event.target?original.toElement:fromElement}if(!event.which&&button!==undefined){event.which=button&1?1:button&2?3:button&4?2:0}return event}},special:{load:{noBubble:true},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus){try{this.focus();return false}catch(e){}}},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur){this.blur();return false}},delegateType:"focusout"},click:{trigger:function(){if(jQuery.nodeName(this,"input")&&this.type==="checkbox"&&this.click){this.click();return false}},_default:function(event){return jQuery.nodeName(event.target,"a")}},beforeunload:{postDispatch:function(event){if(event.result!==undefined&&event.originalEvent){event.originalEvent.returnValue=event.result}}}},simulate:function(type,elem,event,bubble){var e=jQuery.extend(new jQuery.Event,event,{type:type,isSimulated:true,originalEvent:{}});if(bubble){jQuery.event.trigger(e,null,elem)}else{jQuery.event.dispatch.call(elem,e)}if(e.isDefaultPrevented()){event.preventDefault()}}};jQuery.removeEvent=document.removeEventListener?function(elem,type,handle){if(elem.removeEventListener){elem.removeEventListener(type,handle,false)}}:function(elem,type,handle){var name="on"+type;if(elem.detachEvent){if(typeof elem[name]===strundefined){elem[name]=null}elem.detachEvent(name,handle)}};jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event)){return new jQuery.Event(src,props)}if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=src.defaultPrevented||src.defaultPrevented===undefined&&src.returnValue===false?returnTrue:returnFalse}else{this.type=src}if(props){jQuery.extend(this,props)}this.timeStamp=src&&src.timeStamp||jQuery.now();this[jQuery.expando]=true};jQuery.Event.prototype={isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue;if(!e){return}if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue;if(!e){return}if(e.stopPropagation){e.stopPropagation()}e.cancelBubble=true},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=returnTrue;if(e&&e.stopImmediatePropagation){e.stopImmediatePropagation()}this.stopPropagation()}};jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj;if(!related||related!==target&&!jQuery.contains(target,related)){event.type=handleObj.origType;ret=handleObj.handler.apply(this,arguments);event.type=fix}return ret}}});if(!support.submitBubbles){jQuery.event.special.submit={setup:function(){if(jQuery.nodeName(this,"form")){return false}jQuery.event.add(this,"click._submit keypress._submit",function(e){var elem=e.target,form=jQuery.nodeName(elem,"input")||jQuery.nodeName(elem,"button")?elem.form:undefined;if(form&&!jQuery._data(form,"submitBubbles")){jQuery.event.add(form,"submit._submit",function(event){event._submit_bubble=true});jQuery._data(form,"submitBubbles",true)}})},postDispatch:function(event){if(event._submit_bubble){delete event._submit_bubble;if(this.parentNode&&!event.isTrigger){jQuery.event.simulate("submit",this.parentNode,event,true)}}},teardown:function(){if(jQuery.nodeName(this,"form")){return false}jQuery.event.remove(this,"._submit")}}}if(!support.changeBubbles){jQuery.event.special.change={setup:function(){if(rformElems.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio"){jQuery.event.add(this,"propertychange._change",function(event){if(event.originalEvent.propertyName==="checked"){this._just_changed=true}});jQuery.event.add(this,"click._change",function(event){if(this._just_changed&&!event.isTrigger){this._just_changed=false}jQuery.event.simulate("change",this,event,true)})}return false}jQuery.event.add(this,"beforeactivate._change",function(e){var elem=e.target;if(rformElems.test(elem.nodeName)&&!jQuery._data(elem,"changeBubbles")){jQuery.event.add(elem,"change._change",function(event){if(this.parentNode&&!event.isSimulated&&!event.isTrigger){jQuery.event.simulate("change",this.parentNode,event,true)}});jQuery._data(elem,"changeBubbles",true)}})},handle:function(event){var elem=event.target;if(this!==elem||event.isSimulated||event.isTrigger||elem.type!=="radio"&&elem.type!=="checkbox"){return event.handleObj.handler.apply(this,arguments)}},teardown:function(){jQuery.event.remove(this,"._change");return!rformElems.test(this.nodeName)}}}if(!support.focusinBubbles){jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event),true)};jQuery.event.special[fix]={setup:function(){var doc=this.ownerDocument||this,attaches=jQuery._data(doc,fix);if(!attaches){doc.addEventListener(orig,handler,true)}jQuery._data(doc,fix,(attaches||0)+1)},teardown:function(){var doc=this.ownerDocument||this,attaches=jQuery._data(doc,fix)-1;if(!attaches){doc.removeEventListener(orig,handler,true);jQuery._removeData(doc,fix)}else{jQuery._data(doc,fix,attaches)}}}})}jQuery.fn.extend({on:function(types,selector,data,fn,one){var type,origFn;if(typeof types==="object"){if(typeof selector!=="string"){data=data||selector;selector=undefined}for(type in types){this.on(type,selector,data,types[type],one)}return this}if(data==null&&fn==null){fn=selector;data=selector=undefined}else if(fn==null){if(typeof selector==="string"){fn=data;data=undefined}else{fn=data;data=selector;selector=undefined}}if(fn===false){fn=returnFalse}else if(!fn){return this}if(one===1){origFn=fn;fn=function(event){jQuery().off(event);return origFn.apply(this,arguments)};fn.guid=origFn.guid||(origFn.guid=jQuery.guid++)}return this.each(function(){jQuery.event.add(this,types,fn,data,selector)})},one:function(types,selector,data,fn){return this.on(types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj){handleObj=types.handleObj;jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler);return this}if(typeof types==="object"){for(type in types){this.off(type,selector,types[type])}return this}if(selector===false||typeof selector==="function"){fn=selector;selector=undefined}if(fn===false){fn=returnFalse}return this.each(function(){jQuery.event.remove(this,types,fn,selector)})},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){var elem=this[0];if(elem){return jQuery.event.trigger(type,data,elem,true)}}});function createSafeFragment(document){var list=nodeNames.split("|"),safeFrag=document.createDocumentFragment();if(safeFrag.createElement){while(list.length){safeFrag.createElement(list.pop())}}return safeFrag}var nodeNames="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|"+"header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",rinlinejQuery=/ jQuery\d+="(?:null|\d+)"/g,rnoshimcache=new RegExp("<(?:"+nodeNames+")[\\s/>]","i"),rleadingWhitespace=/^\s+/,rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rtbody=/<tbody/i,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/^$|\/(?:java|ecma)script/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},safeFragment=createSafeFragment(document),fragmentDiv=safeFragment.appendChild(document.createElement("div"));wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;function getAll(context,tag){var elems,elem,i=0,found=typeof context.getElementsByTagName!==strundefined?context.getElementsByTagName(tag||"*"):typeof context.querySelectorAll!==strundefined?context.querySelectorAll(tag||"*"):undefined;if(!found){for(found=[],elems=context.childNodes||context;(elem=elems[i])!=null;i++){if(!tag||jQuery.nodeName(elem,tag)){found.push(elem)}else{jQuery.merge(found,getAll(elem,tag))}}}return tag===undefined||tag&&jQuery.nodeName(context,tag)?jQuery.merge([context],found):found}function fixDefaultChecked(elem){if(rcheckableType.test(elem.type)){elem.defaultChecked=elem.checked}}function manipulationTarget(elem,content){return jQuery.nodeName(elem,"table")&&jQuery.nodeName(content.nodeType!==11?content:content.firstChild,"tr")?elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody")):elem}function disableScript(elem){elem.type=(jQuery.find.attr(elem,"type")!==null)+"/"+elem.type;return elem}function restoreScript(elem){var match=rscriptTypeMasked.exec(elem.type);if(match){elem.type=match[1]}else{elem.removeAttribute("type")}return elem}function setGlobalEval(elems,refElements){var elem,i=0;for(;(elem=elems[i])!=null;i++){jQuery._data(elem,"globalEval",!refElements||jQuery._data(refElements[i],"globalEval"))}}function cloneCopyEvent(src,dest){if(dest.nodeType!==1||!jQuery.hasData(src)){return}var type,i,l,oldData=jQuery._data(src),curData=jQuery._data(dest,oldData),events=oldData.events;if(events){delete curData.handle;curData.events={};for(type in events){for(i=0,l=events[type].length;i<l;i++){jQuery.event.add(dest,type,events[type][i])}}}if(curData.data){curData.data=jQuery.extend({},curData.data)}}function fixCloneNodeIssues(src,dest){var nodeName,e,data;if(dest.nodeType!==1){return}nodeName=dest.nodeName.toLowerCase();if(!support.noCloneEvent&&dest[jQuery.expando]){data=jQuery._data(dest);for(e in data.events){jQuery.removeEvent(dest,e,data.handle)}dest.removeAttribute(jQuery.expando)}if(nodeName==="script"&&dest.text!==src.text){disableScript(dest).text=src.text;restoreScript(dest)}else if(nodeName==="object"){if(dest.parentNode){dest.outerHTML=src.outerHTML}if(support.html5Clone&&src.innerHTML&&!jQuery.trim(dest.innerHTML)){dest.innerHTML=src.innerHTML}}else if(nodeName==="input"&&rcheckableType.test(src.type)){dest.defaultChecked=dest.checked=src.checked;if(dest.value!==src.value){dest.value=src.value}}else if(nodeName==="option"){dest.defaultSelected=dest.selected=src.defaultSelected}else if(nodeName==="input"||nodeName==="textarea"){dest.defaultValue=src.defaultValue}}jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var destElements,node,clone,i,srcElements,inPage=jQuery.contains(elem.ownerDocument,elem);if(support.html5Clone||jQuery.isXMLDoc(elem)||!rnoshimcache.test("<"+elem.nodeName+">")){clone=elem.cloneNode(true)}else{fragmentDiv.innerHTML=elem.outerHTML;fragmentDiv.removeChild(clone=fragmentDiv.firstChild)}if((!support.noCloneEvent||!support.noCloneChecked)&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){destElements=getAll(clone);srcElements=getAll(elem);for(i=0;(node=srcElements[i])!=null;++i){if(destElements[i]){fixCloneNodeIssues(node,destElements[i])}}}if(dataAndEvents){if(deepDataAndEvents){srcElements=srcElements||getAll(elem);destElements=destElements||getAll(clone);for(i=0;(node=srcElements[i])!=null;i++){cloneCopyEvent(node,destElements[i])}}else{cloneCopyEvent(elem,clone)}}destElements=getAll(clone,"script");if(destElements.length>0){setGlobalEval(destElements,!inPage&&getAll(elem,"script"))}destElements=srcElements=node=null;return clone},buildFragment:function(elems,context,scripts,selection){var j,elem,contains,tmp,tag,tbody,wrap,l=elems.length,safe=createSafeFragment(context),nodes=[],i=0;for(;i<l;i++){elem=elems[i];if(elem||elem===0){if(jQuery.type(elem)==="object"){jQuery.merge(nodes,elem.nodeType?[elem]:elem)}else if(!rhtml.test(elem)){nodes.push(context.createTextNode(elem))}else{tmp=tmp||safe.appendChild(context.createElement("div"));tag=(rtagName.exec(elem)||["",""])[1].toLowerCase();wrap=wrapMap[tag]||wrapMap._default;tmp.innerHTML=wrap[1]+elem.replace(rxhtmlTag,"<$1></$2>")+wrap[2];j=wrap[0];while(j--){tmp=tmp.lastChild}if(!support.leadingWhitespace&&rleadingWhitespace.test(elem)){nodes.push(context.createTextNode(rleadingWhitespace.exec(elem)[0]))}if(!support.tbody){elem=tag==="table"&&!rtbody.test(elem)?tmp.firstChild:wrap[1]==="<table>"&&!rtbody.test(elem)?tmp:0;j=elem&&elem.childNodes.length;while(j--){if(jQuery.nodeName(tbody=elem.childNodes[j],"tbody")&&!tbody.childNodes.length){elem.removeChild(tbody)}}}jQuery.merge(nodes,tmp.childNodes);tmp.textContent="";while(tmp.firstChild){tmp.removeChild(tmp.firstChild)}tmp=safe.lastChild}}}if(tmp){safe.removeChild(tmp)}if(!support.appendChecked){jQuery.grep(getAll(nodes,"input"),fixDefaultChecked)}i=0;while(elem=nodes[i++]){if(selection&&jQuery.inArray(elem,selection)!==-1){continue}contains=jQuery.contains(elem.ownerDocument,elem);tmp=getAll(safe.appendChild(elem),"script");if(contains){setGlobalEval(tmp)}if(scripts){j=0;while(elem=tmp[j++]){if(rscriptType.test(elem.type||"")){scripts.push(elem)}}}}tmp=null;return safe},cleanData:function(elems,acceptData){var elem,type,id,data,i=0,internalKey=jQuery.expando,cache=jQuery.cache,deleteExpando=support.deleteExpando,special=jQuery.event.special;for(;(elem=elems[i])!=null;i++){if(acceptData||jQuery.acceptData(elem)){id=elem[internalKey];data=id&&cache[id];
if(data){if(data.events){for(type in data.events){if(special[type]){jQuery.event.remove(elem,type)}else{jQuery.removeEvent(elem,type,data.handle)}}}if(cache[id]){delete cache[id];if(deleteExpando){delete elem[internalKey]}else if(typeof elem.removeAttribute!==strundefined){elem.removeAttribute(internalKey)}else{elem[internalKey]=null}deletedIds.push(id)}}}}}});jQuery.fn.extend({text:function(value){return access(this,function(value){return value===undefined?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(value))},null,value,arguments.length)},append:function(){return this.domManip(arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.appendChild(elem)}})},prepend:function(){return this.domManip(arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild)}})},before:function(){return this.domManip(arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this)}})},after:function(){return this.domManip(arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this.nextSibling)}})},remove:function(selector,keepData){var elem,elems=selector?jQuery.filter(selector,this):this,i=0;for(;(elem=elems[i])!=null;i++){if(!keepData&&elem.nodeType===1){jQuery.cleanData(getAll(elem))}if(elem.parentNode){if(keepData&&jQuery.contains(elem.ownerDocument,elem)){setGlobalEval(getAll(elem,"script"))}elem.parentNode.removeChild(elem)}}return this},empty:function(){var elem,i=0;for(;(elem=this[i])!=null;i++){if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false))}while(elem.firstChild){elem.removeChild(elem.firstChild)}if(elem.options&&jQuery.nodeName(elem,"select")){elem.options.length=0}}return this},clone:function(dataAndEvents,deepDataAndEvents){dataAndEvents=dataAndEvents==null?false:dataAndEvents;deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents;return this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined){return elem.nodeType===1?elem.innerHTML.replace(rinlinejQuery,""):undefined}if(typeof value==="string"&&!rnoInnerhtml.test(value)&&(support.htmlSerialize||!rnoshimcache.test(value))&&(support.leadingWhitespace||!rleadingWhitespace.test(value))&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=value.replace(rxhtmlTag,"<$1></$2>");try{for(;i<l;i++){elem=this[i]||{};if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.innerHTML=value}}elem=0}catch(e){}}if(elem){this.empty().append(value)}},null,value,arguments.length)},replaceWith:function(){var arg=arguments[0];this.domManip(arguments,function(elem){arg=this.parentNode;jQuery.cleanData(getAll(this));if(arg){arg.replaceChild(elem,this)}});return arg&&(arg.length||arg.nodeType)?this:this.remove()},detach:function(selector){return this.remove(selector,true)},domManip:function(args,callback){args=concat.apply([],args);var first,node,hasScripts,scripts,doc,fragment,i=0,l=this.length,set=this,iNoClone=l-1,value=args[0],isFunction=jQuery.isFunction(value);if(isFunction||l>1&&typeof value==="string"&&!support.checkClone&&rchecked.test(value)){return this.each(function(index){var self=set.eq(index);if(isFunction){args[0]=value.call(this,index,self.html())}self.domManip(args,callback)})}if(l){fragment=jQuery.buildFragment(args,this[0].ownerDocument,false,this);first=fragment.firstChild;if(fragment.childNodes.length===1){fragment=first}if(first){scripts=jQuery.map(getAll(fragment,"script"),disableScript);hasScripts=scripts.length;for(;i<l;i++){node=fragment;if(i!==iNoClone){node=jQuery.clone(node,true,true);if(hasScripts){jQuery.merge(scripts,getAll(node,"script"))}}callback.call(this[i],node,i)}if(hasScripts){doc=scripts[scripts.length-1].ownerDocument;jQuery.map(scripts,restoreScript);for(i=0;i<hasScripts;i++){node=scripts[i];if(rscriptType.test(node.type||"")&&!jQuery._data(node,"globalEval")&&jQuery.contains(doc,node)){if(node.src){if(jQuery._evalUrl){jQuery._evalUrl(node.src)}}else{jQuery.globalEval((node.text||node.textContent||node.innerHTML||"").replace(rcleanScript,""))}}}}fragment=first=null}}return this}});jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var elems,i=0,ret=[],insert=jQuery(selector),last=insert.length-1;for(;i<=last;i++){elems=i===last?this:this.clone(true);jQuery(insert[i])[original](elems);push.apply(ret,elems.get())}return this.pushStack(ret)}});var iframe,elemdisplay={};function actualDisplay(name,doc){var style,elem=jQuery(doc.createElement(name)).appendTo(doc.body),display=window.getDefaultComputedStyle&&(style=window.getDefaultComputedStyle(elem[0]))?style.display:jQuery.css(elem[0],"display");elem.detach();return display}function defaultDisplay(nodeName){var doc=document,display=elemdisplay[nodeName];if(!display){display=actualDisplay(nodeName,doc);if(display==="none"||!display){iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>")).appendTo(doc.documentElement);doc=(iframe[0].contentWindow||iframe[0].contentDocument).document;doc.write();doc.close();display=actualDisplay(nodeName,doc);iframe.detach()}elemdisplay[nodeName]=display}return display}!function(){var shrinkWrapBlocksVal;support.shrinkWrapBlocks=function(){if(shrinkWrapBlocksVal!=null){return shrinkWrapBlocksVal}shrinkWrapBlocksVal=false;var div,body,container;body=document.getElementsByTagName("body")[0];if(!body||!body.style){return}div=document.createElement("div");container=document.createElement("div");container.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px";body.appendChild(container).appendChild(div);if(typeof div.style.zoom!==strundefined){div.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;"+"box-sizing:content-box;display:block;margin:0;border:0;"+"padding:1px;width:1px;zoom:1";div.appendChild(document.createElement("div")).style.width="5px";shrinkWrapBlocksVal=div.offsetWidth!==3}body.removeChild(container);return shrinkWrapBlocksVal}}();var rmargin=/^margin/;var rnumnonpx=new RegExp("^("+pnum+")(?!px)[a-z%]+$","i");var getStyles,curCSS,rposition=/^(top|right|bottom|left)$/;if(window.getComputedStyle){getStyles=function(elem){return elem.ownerDocument.defaultView.getComputedStyle(elem,null)};curCSS=function(elem,name,computed){var width,minWidth,maxWidth,ret,style=elem.style;computed=computed||getStyles(elem);ret=computed?computed.getPropertyValue(name)||computed[name]:undefined;if(computed){if(ret===""&&!jQuery.contains(elem.ownerDocument,elem)){ret=jQuery.style(elem,name)}if(rnumnonpx.test(ret)&&rmargin.test(name)){width=style.width;minWidth=style.minWidth;maxWidth=style.maxWidth;style.minWidth=style.maxWidth=style.width=ret;ret=computed.width;style.width=width;style.minWidth=minWidth;style.maxWidth=maxWidth}}return ret===undefined?ret:ret+""}}else if(document.documentElement.currentStyle){getStyles=function(elem){return elem.currentStyle};curCSS=function(elem,name,computed){var left,rs,rsLeft,ret,style=elem.style;computed=computed||getStyles(elem);ret=computed?computed[name]:undefined;if(ret==null&&style&&style[name]){ret=style[name]}if(rnumnonpx.test(ret)&&!rposition.test(name)){left=style.left;rs=elem.runtimeStyle;rsLeft=rs&&rs.left;if(rsLeft){rs.left=elem.currentStyle.left}style.left=name==="fontSize"?"1em":ret;ret=style.pixelLeft+"px";style.left=left;if(rsLeft){rs.left=rsLeft}}return ret===undefined?ret:ret+""||"auto"}}function addGetHookIf(conditionFn,hookFn){return{get:function(){var condition=conditionFn();if(condition==null){return}if(condition){delete this.get;return}return(this.get=hookFn).apply(this,arguments)}}}!function(){var div,style,a,pixelPositionVal,boxSizingReliableVal,reliableHiddenOffsetsVal,reliableMarginRightVal;div=document.createElement("div");div.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";a=div.getElementsByTagName("a")[0];style=a&&a.style;if(!style){return}style.cssText="float:left;opacity:.5";support.opacity=style.opacity==="0.5";support.cssFloat=!!style.cssFloat;div.style.backgroundClip="content-box";div.cloneNode(true).style.backgroundClip="";support.clearCloneStyle=div.style.backgroundClip==="content-box";support.boxSizing=style.boxSizing===""||style.MozBoxSizing===""||style.WebkitBoxSizing==="";jQuery.extend(support,{reliableHiddenOffsets:function(){if(reliableHiddenOffsetsVal==null){computeStyleTests()}return reliableHiddenOffsetsVal},boxSizingReliable:function(){if(boxSizingReliableVal==null){computeStyleTests()}return boxSizingReliableVal},pixelPosition:function(){if(pixelPositionVal==null){computeStyleTests()}return pixelPositionVal},reliableMarginRight:function(){if(reliableMarginRightVal==null){computeStyleTests()}return reliableMarginRightVal}});function computeStyleTests(){var div,body,container,contents;body=document.getElementsByTagName("body")[0];if(!body||!body.style){return}div=document.createElement("div");container=document.createElement("div");container.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px";body.appendChild(container).appendChild(div);div.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;"+"box-sizing:border-box;display:block;margin-top:1%;top:1%;"+"border:1px;padding:1px;width:4px;position:absolute";pixelPositionVal=boxSizingReliableVal=false;reliableMarginRightVal=true;if(window.getComputedStyle){pixelPositionVal=(window.getComputedStyle(div,null)||{}).top!=="1%";boxSizingReliableVal=(window.getComputedStyle(div,null)||{width:"4px"}).width==="4px";contents=div.appendChild(document.createElement("div"));contents.style.cssText=div.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;"+"box-sizing:content-box;display:block;margin:0;border:0;padding:0";contents.style.marginRight=contents.style.width="0";div.style.width="1px";reliableMarginRightVal=!parseFloat((window.getComputedStyle(contents,null)||{}).marginRight)}div.innerHTML="<table><tr><td></td><td>t</td></tr></table>";contents=div.getElementsByTagName("td");contents[0].style.cssText="margin:0;border:0;padding:0;display:none";reliableHiddenOffsetsVal=contents[0].offsetHeight===0;if(reliableHiddenOffsetsVal){contents[0].style.display="";contents[1].style.display="none";reliableHiddenOffsetsVal=contents[0].offsetHeight===0}body.removeChild(container)}}();jQuery.swap=function(elem,options,callback,args){var ret,name,old={};for(name in options){old[name]=elem.style[name];elem.style[name]=options[name]}ret=callback.apply(elem,args||[]);for(name in options){elem.style[name]=old[name]}return ret};var ralpha=/alpha\([^)]*\)/i,ropacity=/opacity\s*=\s*([^)]*)/,rdisplayswap=/^(none|table(?!-c[ea]).+)/,rnumsplit=new RegExp("^("+pnum+")(.*)$","i"),rrelNum=new RegExp("^([+-])=("+pnum+")","i"),cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:"0",fontWeight:"400"},cssPrefixes=["Webkit","O","Moz","ms"];function vendorPropName(style,name){if(name in style){return name}var capName=name.charAt(0).toUpperCase()+name.slice(1),origName=name,i=cssPrefixes.length;while(i--){name=cssPrefixes[i]+capName;if(name in style){return name}}return origName}function showHide(elements,show){var display,elem,hidden,values=[],index=0,length=elements.length;for(;index<length;index++){elem=elements[index];if(!elem.style){continue}values[index]=jQuery._data(elem,"olddisplay");display=elem.style.display;if(show){if(!values[index]&&display==="none"){elem.style.display=""}if(elem.style.display===""&&isHidden(elem)){values[index]=jQuery._data(elem,"olddisplay",defaultDisplay(elem.nodeName))}}else{hidden=isHidden(elem);if(display&&display!=="none"||!hidden){jQuery._data(elem,"olddisplay",hidden?display:jQuery.css(elem,"display"))}}}for(index=0;index<length;index++){elem=elements[index];if(!elem.style){continue}if(!show||elem.style.display==="none"||elem.style.display===""){elem.style.display=show?values[index]||"":"none"}}return elements}function setPositiveNumber(elem,value,subtract){var matches=rnumsplit.exec(value);return matches?Math.max(0,matches[1]-(subtract||0))+(matches[2]||"px"):value}function augmentWidthOrHeight(elem,name,extra,isBorderBox,styles){var i=extra===(isBorderBox?"border":"content")?4:name==="width"?1:0,val=0;for(;i<4;i+=2){if(extra==="margin"){val+=jQuery.css(elem,extra+cssExpand[i],true,styles)}if(isBorderBox){if(extra==="content"){val-=jQuery.css(elem,"padding"+cssExpand[i],true,styles)}if(extra!=="margin"){val-=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}}else{val+=jQuery.css(elem,"padding"+cssExpand[i],true,styles);if(extra!=="padding"){val+=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}}}return val}function getWidthOrHeight(elem,name,extra){var valueIsBorderBox=true,val=name==="width"?elem.offsetWidth:elem.offsetHeight,styles=getStyles(elem),isBorderBox=support.boxSizing&&jQuery.css(elem,"boxSizing",false,styles)==="border-box";if(val<=0||val==null){val=curCSS(elem,name,styles);if(val<0||val==null){val=elem.style[name]}if(rnumnonpx.test(val)){return val}valueIsBorderBox=isBorderBox&&(support.boxSizingReliable()||val===elem.style[name]);val=parseFloat(val)||0}return val+augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles)+"px"}jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return ret===""?"1":ret}}}},cssNumber:{columnCount:true,fillOpacity:true,flexGrow:true,flexShrink:true,fontWeight:true,lineHeight:true,opacity:true,order:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{"float":support.cssFloat?"cssFloat":"styleFloat"},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style){return}var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(value!==undefined){type=typeof value;if(type==="string"&&(ret=rrelNum.exec(value))){value=(ret[1]+1)*ret[2]+parseFloat(jQuery.css(elem,name));type="number"}if(value==null||value!==value){return}if(type==="number"&&!jQuery.cssNumber[origName]){value+="px"}if(!support.clearCloneStyle&&value===""&&name.indexOf("background")===0){style[name]="inherit"}if(!hooks||!("set"in hooks)||(value=hooks.set(elem,value,extra))!==undefined){try{style[name]=value}catch(e){}}}else{if(hooks&&"get"in hooks&&(ret=hooks.get(elem,false,extra))!==undefined){return ret}return style[name]}},css:function(elem,name,extra,styles){var num,val,hooks,origName=jQuery.camelCase(name);name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(elem.style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(hooks&&"get"in hooks){val=hooks.get(elem,true,extra)}if(val===undefined){val=curCSS(elem,name,styles)}if(val==="normal"&&name in cssNormalTransform){val=cssNormalTransform[name]}if(extra===""||extra){num=parseFloat(val);return extra===true||jQuery.isNumeric(num)?num||0:val}return val}});jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){if(computed){return rdisplayswap.test(jQuery.css(elem,"display"))&&elem.offsetWidth===0?jQuery.swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra)}):getWidthOrHeight(elem,name,extra)}},set:function(elem,value,extra){var styles=extra&&getStyles(elem);return setPositiveNumber(elem,value,extra?augmentWidthOrHeight(elem,name,extra,support.boxSizing&&jQuery.css(elem,"boxSizing",false,styles)==="border-box",styles):0)}}});if(!support.opacity){jQuery.cssHooks.opacity={get:function(elem,computed){return ropacity.test((computed&&elem.currentStyle?elem.currentStyle.filter:elem.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":computed?"1":""},set:function(elem,value){var style=elem.style,currentStyle=elem.currentStyle,opacity=jQuery.isNumeric(value)?"alpha(opacity="+value*100+")":"",filter=currentStyle&&currentStyle.filter||style.filter||"";style.zoom=1;if((value>=1||value==="")&&jQuery.trim(filter.replace(ralpha,""))===""&&style.removeAttribute){style.removeAttribute("filter");if(value===""||currentStyle&&!currentStyle.filter){return}}style.filter=ralpha.test(filter)?filter.replace(ralpha,opacity):filter+" "+opacity}}}jQuery.cssHooks.marginRight=addGetHookIf(support.reliableMarginRight,function(elem,computed){if(computed){return jQuery.swap(elem,{display:"inline-block"},curCSS,[elem,"marginRight"])}});jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){var i=0,expanded={},parts=typeof value==="string"?value.split(" "):[value];for(;i<4;i++){expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0]}return expanded}};if(!rmargin.test(prefix)){jQuery.cssHooks[prefix+suffix].set=setPositiveNumber}});jQuery.fn.extend({css:function(name,value){return access(this,function(elem,name,value){var styles,len,map={},i=0;if(jQuery.isArray(name)){styles=getStyles(elem);len=name.length;for(;i<len;i++){map[name[i]]=jQuery.css(elem,name[i],false,styles)}return map}return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,arguments.length>1)},show:function(){return showHide(this,true)},hide:function(){return showHide(this)},toggle:function(state){if(typeof state==="boolean"){return state?this.show():this.hide()}return this.each(function(){if(isHidden(this)){jQuery(this).show()}else{jQuery(this).hide()}})}});function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}jQuery.Tween=Tween;Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem;this.prop=prop;this.easing=easing||"swing";this.options=options;this.start=this.now=this.cur();this.end=end;this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];if(this.options.duration){this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration)}else{this.pos=eased=percent}this.now=(this.end-this.start)*eased+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this)}if(hooks&&hooks.set){hooks.set(this)}else{Tween.propHooks._default.set(this)}return this}};Tween.prototype.init.prototype=Tween.prototype;Tween.propHooks={_default:{get:function(tween){var result;if(tween.elem[tween.prop]!=null&&(!tween.elem.style||tween.elem.style[tween.prop]==null)){return tween.elem[tween.prop]}result=jQuery.css(tween.elem,tween.prop,"");return!result||result==="auto"?0:result},set:function(tween){if(jQuery.fx.step[tween.prop]){jQuery.fx.step[tween.prop](tween)}else if(tween.elem.style&&(tween.elem.style[jQuery.cssProps[tween.prop]]!=null||jQuery.cssHooks[tween.prop])){jQuery.style(tween.elem,tween.prop,tween.now+tween.unit)}else{tween.elem[tween.prop]=tween.now}}}};Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){if(tween.elem.nodeType&&tween.elem.parentNode){tween.elem[tween.prop]=tween.now}}};jQuery.easing={linear:function(p){return p},swing:function(p){return.5-Math.cos(p*Math.PI)/2}};jQuery.fx=Tween.prototype.init;jQuery.fx.step={};var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([+-])=|)("+pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(prop,value){var tween=this.createTween(prop,value),target=tween.cur(),parts=rfxnum.exec(value),unit=parts&&parts[3]||(jQuery.cssNumber[prop]?"":"px"),start=(jQuery.cssNumber[prop]||unit!=="px"&&+target)&&rfxnum.exec(jQuery.css(tween.elem,prop)),scale=1,maxIterations=20;if(start&&start[3]!==unit){unit=unit||start[3];parts=parts||[];start=+target||1;do{scale=scale||".5";start=start/scale;jQuery.style(tween.elem,prop,start+unit)}while(scale!==(scale=tween.cur()/target)&&scale!==1&&--maxIterations)}if(parts){start=tween.start=+start||+target||0;tween.unit=unit;tween.end=parts[1]?start+(parts[1]+1)*parts[2]:+parts[2]}return tween}]};function createFxNow(){setTimeout(function(){fxNow=undefined});return fxNow=jQuery.now()}function genFx(type,includeWidth){var which,attrs={height:type},i=0;includeWidth=includeWidth?1:0;for(;i<4;i+=2-includeWidth){which=cssExpand[i];attrs["margin"+which]=attrs["padding"+which]=type}if(includeWidth){attrs.opacity=attrs.width=type}return attrs}function createTween(value,prop,animation){var tween,collection=(tweeners[prop]||[]).concat(tweeners["*"]),index=0,length=collection.length;for(;index<length;index++){if(tween=collection[index].call(animation,prop,value)){return tween}}}function defaultPrefilter(elem,props,opts){var prop,value,toggle,tween,hooks,oldfire,display,checkDisplay,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHidden(elem),dataShow=jQuery._data(elem,"fxshow");if(!opts.queue){hooks=jQuery._queueHooks(elem,"fx");if(hooks.unqueued==null){hooks.unqueued=0;oldfire=hooks.empty.fire;hooks.empty.fire=function(){if(!hooks.unqueued){oldfire()}}}hooks.unqueued++;anim.always(function(){anim.always(function(){hooks.unqueued--;if(!jQuery.queue(elem,"fx").length){hooks.empty.fire()}})})}if(elem.nodeType===1&&("height"in props||"width"in props)){opts.overflow=[style.overflow,style.overflowX,style.overflowY];display=jQuery.css(elem,"display");checkDisplay=display==="none"?jQuery._data(elem,"olddisplay")||defaultDisplay(elem.nodeName):display;if(checkDisplay==="inline"&&jQuery.css(elem,"float")==="none"){if(!support.inlineBlockNeedsLayout||defaultDisplay(elem.nodeName)==="inline"){style.display="inline-block"}else{style.zoom=1}}}if(opts.overflow){style.overflow="hidden";if(!support.shrinkWrapBlocks()){anim.always(function(){style.overflow=opts.overflow[0];style.overflowX=opts.overflow[1];style.overflowY=opts.overflow[2]})}}for(prop in props){value=props[prop];if(rfxtypes.exec(value)){delete props[prop];toggle=toggle||value==="toggle";if(value===(hidden?"hide":"show")){if(value==="show"&&dataShow&&dataShow[prop]!==undefined){hidden=true}else{continue}}orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop)}else{display=undefined}}if(!jQuery.isEmptyObject(orig)){if(dataShow){if("hidden"in dataShow){hidden=dataShow.hidden}}else{dataShow=jQuery._data(elem,"fxshow",{})}if(toggle){dataShow.hidden=!hidden}if(hidden){jQuery(elem).show()}else{anim.done(function(){jQuery(elem).hide()})}anim.done(function(){var prop;jQuery._removeData(elem,"fxshow");for(prop in orig){jQuery.style(elem,prop,orig[prop])}});for(prop in orig){tween=createTween(hidden?dataShow[prop]:0,prop,anim);if(!(prop in dataShow)){dataShow[prop]=tween.start;if(hidden){tween.end=tween.start;tween.start=prop==="width"||prop==="height"?1:0}}}}else if((display==="none"?defaultDisplay(elem.nodeName):display)==="inline"){style.display=display}}function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props){name=jQuery.camelCase(index);easing=specialEasing[name];value=props[index];if(jQuery.isArray(value)){easing=value[1];value=props[index]=value[0]}if(index!==name){props[name]=value;delete props[index]}hooks=jQuery.cssHooks[name];if(hooks&&"expand"in hooks){value=hooks.expand(value);delete props[name];for(index in value){if(!(index in props)){props[index]=value[index];specialEasing[index]=easing}}}else{specialEasing[name]=easing}}}function Animation(elem,properties,options){var result,stopped,index=0,length=animationPrefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){if(stopped){return false}var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;for(;index<length;index++){animation.tweens[index].run(percent)}deferred.notifyWith(elem,[animation,percent,remaining]);if(percent<1&&length){return remaining}else{deferred.resolveWith(elem,[animation]);return false}},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(true,{specialEasing:{}},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);animation.tweens.push(tween);return tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped){return this}stopped=true;for(;index<length;index++){animation.tweens[index].run(1)}if(gotoEnd){deferred.resolveWith(elem,[animation,gotoEnd])}else{deferred.rejectWith(elem,[animation,gotoEnd])}return this}}),props=animation.props;propFilter(props,animation.opts.specialEasing);for(;index<length;index++){result=animationPrefilters[index].call(animation,elem,props,animation.opts);if(result){return result}}jQuery.map(props,createTween,animation);if(jQuery.isFunction(animation.opts.start)){animation.opts.start.call(elem,animation)}jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue}));return animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always)}jQuery.Animation=jQuery.extend(Animation,{tweener:function(props,callback){if(jQuery.isFunction(props)){callback=props;props=["*"]}else{props=props.split(" ")}var prop,index=0,length=props.length;for(;index<length;index++){prop=props[index];tweeners[prop]=tweeners[prop]||[];tweeners[prop].unshift(callback)}},prefilter:function(callback,prepend){if(prepend){animationPrefilters.unshift(callback)}else{animationPrefilters.push(callback)}}});jQuery.speed=function(speed,easing,fn){var opt=speed&&typeof speed==="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:typeof opt.duration==="number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;if(opt.queue==null||opt.queue===true){opt.queue="fx"}opt.old=opt.complete;opt.complete=function(){if(jQuery.isFunction(opt.old)){opt.old.call(this)}if(opt.queue){jQuery.dequeue(this,opt.queue)}};return opt};jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);if(empty||jQuery._data(this,"finish")){anim.stop(true)}};doAnimation.finish=doAnimation;return empty||optall.queue===false?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop;stop(gotoEnd)};if(typeof type!=="string"){gotoEnd=clearQueue;clearQueue=type;type=undefined}if(clearQueue&&type!==false){this.queue(type||"fx",[])}return this.each(function(){var dequeue=true,index=type!=null&&type+"queueHooks",timers=jQuery.timers,data=jQuery._data(this);if(index){if(data[index]&&data[index].stop){stopQueue(data[index])}}else{for(index in data){if(data[index]&&data[index].stop&&rrun.test(index)){stopQueue(data[index])}}}for(index=timers.length;index--;){if(timers[index].elem===this&&(type==null||timers[index].queue===type)){timers[index].anim.stop(gotoEnd);dequeue=false;timers.splice(index,1)}}if(dequeue||!gotoEnd){jQuery.dequeue(this,type)}})},finish:function(type){if(type!==false){type=type||"fx"}return this.each(function(){var index,data=jQuery._data(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;data.finish=true;jQuery.queue(this,type,[]);if(hooks&&hooks.stop){hooks.stop.call(this,true)}for(index=timers.length;index--;){if(timers[index].elem===this&&timers[index].queue===type){timers[index].anim.stop(true);timers.splice(index,1)}}for(index=0;index<length;index++){if(queue[index]&&queue[index].finish){queue[index].finish.call(this)}}delete data.finish})}});jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return speed==null||typeof speed==="boolean"?cssFn.apply(this,arguments):this.animate(genFx(name,true),speed,easing,callback)}});jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}});jQuery.timers=[];jQuery.fx.tick=function(){var timer,timers=jQuery.timers,i=0;fxNow=jQuery.now();for(;i<timers.length;i++){timer=timers[i];if(!timer()&&timers[i]===timer){timers.splice(i--,1)}}if(!timers.length){jQuery.fx.stop()}fxNow=undefined};jQuery.fx.timer=function(timer){jQuery.timers.push(timer);if(timer()){jQuery.fx.start()}else{jQuery.timers.pop()}};jQuery.fx.interval=13;jQuery.fx.start=function(){if(!timerId){timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval)}};jQuery.fx.stop=function(){clearInterval(timerId);timerId=null};jQuery.fx.speeds={slow:600,fast:200,_default:400};jQuery.fn.delay=function(time,type){time=jQuery.fx?jQuery.fx.speeds[time]||time:time;type=type||"fx";return this.queue(type,function(next,hooks){var timeout=setTimeout(next,time);hooks.stop=function(){clearTimeout(timeout)}})};!function(){var input,div,select,a,opt;div=document.createElement("div");div.setAttribute("className","t");div.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";a=div.getElementsByTagName("a")[0];select=document.createElement("select");opt=select.appendChild(document.createElement("option"));input=div.getElementsByTagName("input")[0];a.style.cssText="top:1px";support.getSetAttribute=div.className!=="t";support.style=/top/.test(a.getAttribute("style"));support.hrefNormalized=a.getAttribute("href")==="/a";support.checkOn=!!input.value;support.optSelected=opt.selected;support.enctype=!!document.createElement("form").enctype;select.disabled=true;support.optDisabled=!opt.disabled;input=document.createElement("input");input.setAttribute("value","");support.input=input.getAttribute("value")==="";input.value="t";input.setAttribute("type","radio");support.radioValue=input.value==="t"}();var rreturn=/\r/g;jQuery.fn.extend({val:function(value){var hooks,ret,isFunction,elem=this[0];if(!arguments.length){if(elem){hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()];if(hooks&&"get"in hooks&&(ret=hooks.get(elem,"value"))!==undefined){return ret}ret=elem.value;return typeof ret==="string"?ret.replace(rreturn,""):ret==null?"":ret}return}isFunction=jQuery.isFunction(value);return this.each(function(i){var val;if(this.nodeType!==1){return}if(isFunction){val=value.call(this,i,jQuery(this).val())}else{val=value}if(val==null){val=""}else if(typeof val==="number"){val+=""}else if(jQuery.isArray(val)){val=jQuery.map(val,function(value){return value==null?"":value+""})}hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!hooks||!("set"in hooks)||hooks.set(this,val,"value")===undefined){this.value=val}})}});jQuery.extend({valHooks:{option:{get:function(elem){var val=jQuery.find.attr(elem,"value");return val!=null?val:jQuery.trim(jQuery.text(elem))
}},select:{get:function(elem){var value,option,options=elem.options,index=elem.selectedIndex,one=elem.type==="select-one"||index<0,values=one?null:[],max=one?index+1:options.length,i=index<0?max:one?index:0;for(;i<max;i++){option=options[i];if((option.selected||i===index)&&(support.optDisabled?!option.disabled:option.getAttribute("disabled")===null)&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one){return value}values.push(value)}}return values},set:function(elem,value){var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;while(i--){option=options[i];if(jQuery.inArray(jQuery.valHooks.option.get(option),values)>=0){try{option.selected=optionSet=true}catch(_){option.scrollHeight}}else{option.selected=false}}if(!optionSet){elem.selectedIndex=-1}return options}}}});jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(elem,value){if(jQuery.isArray(value)){return elem.checked=jQuery.inArray(jQuery(elem).val(),value)>=0}}};if(!support.checkOn){jQuery.valHooks[this].get=function(elem){return elem.getAttribute("value")===null?"on":elem.value}}});var nodeHook,boolHook,attrHandle=jQuery.expr.attrHandle,ruseDefault=/^(?:checked|selected)$/i,getSetAttribute=support.getSetAttribute,getSetInput=support.input;jQuery.fn.extend({attr:function(name,value){return access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})}});jQuery.extend({attr:function(elem,name,value){var hooks,ret,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}if(typeof elem.getAttribute===strundefined){return jQuery.prop(elem,name,value)}if(nType!==1||!jQuery.isXMLDoc(elem)){name=name.toLowerCase();hooks=jQuery.attrHooks[name]||(jQuery.expr.match.bool.test(name)?boolHook:nodeHook)}if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name)}else if(hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret}else{elem.setAttribute(name,value+"");return value}}else if(hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null){return ret}else{ret=jQuery.find.attr(elem,name);return ret==null?undefined:ret}},removeAttr:function(elem,value){var name,propName,i=0,attrNames=value&&value.match(rnotwhite);if(attrNames&&elem.nodeType===1){while(name=attrNames[i++]){propName=jQuery.propFix[name]||name;if(jQuery.expr.match.bool.test(name)){if(getSetInput&&getSetAttribute||!ruseDefault.test(name)){elem[propName]=false}else{elem[jQuery.camelCase("default-"+name)]=elem[propName]=false}}else{jQuery.attr(elem,name,"")}elem.removeAttribute(getSetAttribute?name:propName)}}},attrHooks:{type:{set:function(elem,value){if(!support.radioValue&&value==="radio"&&jQuery.nodeName(elem,"input")){var val=elem.value;elem.setAttribute("type",value);if(val){elem.value=val}return value}}}}});boolHook={set:function(elem,value,name){if(value===false){jQuery.removeAttr(elem,name)}else if(getSetInput&&getSetAttribute||!ruseDefault.test(name)){elem.setAttribute(!getSetAttribute&&jQuery.propFix[name]||name,name)}else{elem[jQuery.camelCase("default-"+name)]=elem[name]=true}return name}};jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(i,name){var getter=attrHandle[name]||jQuery.find.attr;attrHandle[name]=getSetInput&&getSetAttribute||!ruseDefault.test(name)?function(elem,name,isXML){var ret,handle;if(!isXML){handle=attrHandle[name];attrHandle[name]=ret;ret=getter(elem,name,isXML)!=null?name.toLowerCase():null;attrHandle[name]=handle}return ret}:function(elem,name,isXML){if(!isXML){return elem[jQuery.camelCase("default-"+name)]?name.toLowerCase():null}}});if(!getSetInput||!getSetAttribute){jQuery.attrHooks.value={set:function(elem,value,name){if(jQuery.nodeName(elem,"input")){elem.defaultValue=value}else{return nodeHook&&nodeHook.set(elem,value,name)}}}}if(!getSetAttribute){nodeHook={set:function(elem,value,name){var ret=elem.getAttributeNode(name);if(!ret){elem.setAttributeNode(ret=elem.ownerDocument.createAttribute(name))}ret.value=value+="";if(name==="value"||value===elem.getAttribute(name)){return value}}};attrHandle.id=attrHandle.name=attrHandle.coords=function(elem,name,isXML){var ret;if(!isXML){return(ret=elem.getAttributeNode(name))&&ret.value!==""?ret.value:null}};jQuery.valHooks.button={get:function(elem,name){var ret=elem.getAttributeNode(name);if(ret&&ret.specified){return ret.value}},set:nodeHook.set};jQuery.attrHooks.contenteditable={set:function(elem,value,name){nodeHook.set(elem,value===""?false:value,name)}};jQuery.each(["width","height"],function(i,name){jQuery.attrHooks[name]={set:function(elem,value){if(value===""){elem.setAttribute(name,"auto");return value}}}})}if(!support.style){jQuery.attrHooks.style={get:function(elem){return elem.style.cssText||undefined},set:function(elem,value){return elem.style.cssText=value+""}}}var rfocusable=/^(?:input|select|textarea|button|object)$/i,rclickable=/^(?:a|area)$/i;jQuery.fn.extend({prop:function(name,value){return access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){name=jQuery.propFix[name]||name;return this.each(function(){try{this[name]=undefined;delete this[name]}catch(e){}})}});jQuery.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(elem,name,value){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}notxml=nType!==1||!jQuery.isXMLDoc(elem);if(notxml){name=jQuery.propFix[name]||name;hooks=jQuery.propHooks[name]}if(value!==undefined){return hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined?ret:elem[name]=value}else{return hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null?ret:elem[name]}},propHooks:{tabIndex:{get:function(elem){var tabindex=jQuery.find.attr(elem,"tabindex");return tabindex?parseInt(tabindex,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:-1}}}});if(!support.hrefNormalized){jQuery.each(["href","src"],function(i,name){jQuery.propHooks[name]={get:function(elem){return elem.getAttribute(name,4)}}})}if(!support.optSelected){jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;if(parent){parent.selectedIndex;if(parent.parentNode){parent.parentNode.selectedIndex}}return null}}}jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this});if(!support.enctype){jQuery.propFix.enctype="encoding"}var rclass=/[\t\r\n\f]/g;jQuery.fn.extend({addClass:function(value){var classes,elem,cur,clazz,j,finalValue,i=0,len=this.length,proceed=typeof value==="string"&&value;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className))})}if(proceed){classes=(value||"").match(rnotwhite)||[];for(;i<len;i++){elem=this[i];cur=elem.nodeType===1&&(elem.className?(" "+elem.className+" ").replace(rclass," "):" ");if(cur){j=0;while(clazz=classes[j++]){if(cur.indexOf(" "+clazz+" ")<0){cur+=clazz+" "}}finalValue=jQuery.trim(cur);if(elem.className!==finalValue){elem.className=finalValue}}}}return this},removeClass:function(value){var classes,elem,cur,clazz,j,finalValue,i=0,len=this.length,proceed=arguments.length===0||typeof value==="string"&&value;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className))})}if(proceed){classes=(value||"").match(rnotwhite)||[];for(;i<len;i++){elem=this[i];cur=elem.nodeType===1&&(elem.className?(" "+elem.className+" ").replace(rclass," "):"");if(cur){j=0;while(clazz=classes[j++]){while(cur.indexOf(" "+clazz+" ")>=0){cur=cur.replace(" "+clazz+" "," ")}}finalValue=value?jQuery.trim(cur):"";if(elem.className!==finalValue){elem.className=finalValue}}}}return this},toggleClass:function(value,stateVal){var type=typeof value;if(typeof stateVal==="boolean"&&type==="string"){return stateVal?this.addClass(value):this.removeClass(value)}if(jQuery.isFunction(value)){return this.each(function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal)})}return this.each(function(){if(type==="string"){var className,i=0,self=jQuery(this),classNames=value.match(rnotwhite)||[];while(className=classNames[i++]){if(self.hasClass(className)){self.removeClass(className)}else{self.addClass(className)}}}else if(type===strundefined||type==="boolean"){if(this.className){jQuery._data(this,"__className__",this.className)}this.className=this.className||value===false?"":jQuery._data(this,"__className__")||""}})},hasClass:function(selector){var className=" "+selector+" ",i=0,l=this.length;for(;i<l;i++){if(this[i].nodeType===1&&(" "+this[i].className+" ").replace(rclass," ").indexOf(className)>=0){return true}}return false}});jQuery.each(("blur focus focusin focusout load resize scroll unload click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select submit keydown keypress keyup error contextmenu").split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)}});jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)},bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return arguments.length===1?this.off(selector,"**"):this.off(types,selector||"**",fn)}});var nonce=jQuery.now();var rquery=/\?/;var rvalidtokens=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;jQuery.parseJSON=function(data){if(window.JSON&&window.JSON.parse){return window.JSON.parse(data+"")}var requireNonComma,depth=null,str=jQuery.trim(data+"");return str&&!jQuery.trim(str.replace(rvalidtokens,function(token,comma,open,close){if(requireNonComma&&comma){depth=0}if(depth===0){return token}requireNonComma=open||comma;depth+=!close-!open;return""}))?Function("return "+str)():jQuery.error("Invalid JSON: "+data)};jQuery.parseXML=function(data){var xml,tmp;if(!data||typeof data!=="string"){return null}try{if(window.DOMParser){tmp=new DOMParser;xml=tmp.parseFromString(data,"text/xml")}else{xml=new ActiveXObject("Microsoft.XMLDOM");xml.async="false";xml.loadXML(data)}}catch(e){xml=undefined}if(!xml||!xml.documentElement||xml.getElementsByTagName("parsererror").length){jQuery.error("Invalid XML: "+data)}return xml};var ajaxLocParts,ajaxLocation,rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rurl=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,prefilters={},transports={},allTypes="*/".concat("*");try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a");ajaxLocation.href="";ajaxLocation=ajaxLocation.href}ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[];function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if(typeof dataTypeExpression!=="string"){func=dataTypeExpression;dataTypeExpression="*"}var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(rnotwhite)||[];if(jQuery.isFunction(func)){while(dataType=dataTypes[i++]){if(dataType.charAt(0)==="+"){dataType=dataType.slice(1)||"*";(structure[dataType]=structure[dataType]||[]).unshift(func)}else{(structure[dataType]=structure[dataType]||[]).push(func)}}}}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){var inspected={},seekingTransport=structure===transports;function inspect(dataType){var selected;inspected[dataType]=true;jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);if(typeof dataTypeOrTransport==="string"&&!seekingTransport&&!inspected[dataTypeOrTransport]){options.dataTypes.unshift(dataTypeOrTransport);inspect(dataTypeOrTransport);return false}else if(seekingTransport){return!(selected=dataTypeOrTransport)}});return selected}return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*")}function ajaxExtend(target,src){var deep,key,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src){if(src[key]!==undefined){(flatOptions[key]?target:deep||(deep={}))[key]=src[key]}}if(deep){jQuery.extend(true,target,deep)}return target}function ajaxHandleResponses(s,jqXHR,responses){var firstDataType,ct,finalDataType,type,contents=s.contents,dataTypes=s.dataTypes;while(dataTypes[0]==="*"){dataTypes.shift();if(ct===undefined){ct=s.mimeType||jqXHR.getResponseHeader("Content-Type")}}if(ct){for(type in contents){if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}}}if(dataTypes[0]in responses){finalDataType=dataTypes[0]}else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}if(!firstDataType){firstDataType=type}}finalDataType=finalDataType||firstDataType}if(finalDataType){if(finalDataType!==dataTypes[0]){dataTypes.unshift(finalDataType)}return responses[finalDataType]}}function ajaxConvert(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1]){for(conv in s.converters){converters[conv.toLowerCase()]=s.converters[conv]}}current=dataTypes.shift();while(current){if(s.responseFields[current]){jqXHR[s.responseFields[current]]=response}if(!prev&&isSuccess&&s.dataFilter){response=s.dataFilter(response,s.dataType)}prev=current;current=dataTypes.shift();if(current){if(current==="*"){current=prev}else if(prev!=="*"&&prev!==current){conv=converters[prev+" "+current]||converters["* "+current];if(!conv){for(conv2 in converters){tmp=conv2.split(" ");if(tmp[1]===current){conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]];if(conv){if(conv===true){conv=converters[conv2]}else if(converters[conv2]!==true){current=tmp[0];dataTypes.unshift(tmp[1])}break}}}}if(conv!==true){if(conv&&s["throws"]){response=conv(response)}else{try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}}}}}}}return{state:"success",data:response}}jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:"GET",isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:true,processData:true,async:true,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":true,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:true,context:true}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){if(typeof url==="object"){options=url;url=undefined}options=options||{};var parts,i,cacheURL,responseHeadersString,timeoutTimer,fireGlobals,transport,responseHeaders,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(state===2){if(!responseHeaders){responseHeaders={};while(match=rheaders.exec(responseHeadersString)){responseHeaders[match[1].toLowerCase()]=match[2]}}match=responseHeaders[key.toLowerCase()]}return match==null?null:match},getAllResponseHeaders:function(){return state===2?responseHeadersString:null},setRequestHeader:function(name,value){var lname=name.toLowerCase();if(!state){name=requestHeadersNames[lname]=requestHeadersNames[lname]||name;requestHeaders[name]=value}return this},overrideMimeType:function(type){if(!state){s.mimeType=type}return this},statusCode:function(map){var code;if(map){if(state<2){for(code in map){statusCode[code]=[statusCode[code],map[code]]}}else{jqXHR.always(map[jqXHR.status])}}return this},abort:function(statusText){var finalText=statusText||strAbort;if(transport){transport.abort(finalText)}done(0,finalText);return this}};deferred.promise(jqXHR).complete=completeDeferred.add;jqXHR.success=jqXHR.done;jqXHR.error=jqXHR.fail;s.url=((url||s.url||ajaxLocation)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//");s.type=options.method||options.type||s.method||s.type;s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().match(rnotwhite)||[""];if(s.crossDomain==null){parts=rurl.exec(s.url.toLowerCase());s.crossDomain=!!(parts&&(parts[1]!==ajaxLocParts[1]||parts[2]!==ajaxLocParts[2]||(parts[3]||(parts[1]==="http:"?"80":"443"))!==(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?"80":"443"))))}if(s.data&&s.processData&&typeof s.data!=="string"){s.data=jQuery.param(s.data,s.traditional)}inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(state===2){return jqXHR}fireGlobals=s.global;if(fireGlobals&&jQuery.active++===0){jQuery.event.trigger("ajaxStart")}s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);cacheURL=s.url;if(!s.hasContent){if(s.data){cacheURL=s.url+=(rquery.test(cacheURL)?"&":"?")+s.data;delete s.data}if(s.cache===false){s.url=rts.test(cacheURL)?cacheURL.replace(rts,"$1_="+nonce++):cacheURL+(rquery.test(cacheURL)?"&":"?")+"_="+nonce++}}if(s.ifModified){if(jQuery.lastModified[cacheURL]){jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL])}if(jQuery.etag[cacheURL]){jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL])}}if(s.data&&s.hasContent&&s.contentType!==false||options.contentType){jqXHR.setRequestHeader("Content-Type",s.contentType)}jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers){jqXHR.setRequestHeader(i,s.headers[i])}if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===false||state===2)){return jqXHR.abort()}strAbort="abort";for(i in{success:1,error:1,complete:1}){jqXHR[i](s[i])}transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport){done(-1,"No Transport")}else{jqXHR.readyState=1;if(fireGlobals){globalEventContext.trigger("ajaxSend",[jqXHR,s])}if(s.async&&s.timeout>0){timeoutTimer=setTimeout(function(){jqXHR.abort("timeout")},s.timeout)}try{state=1;transport.send(requestHeaders,done)}catch(e){if(state<2){done(-1,e)}else{throw e}}}function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;if(state===2){return}state=2;if(timeoutTimer){clearTimeout(timeoutTimer)}transport=undefined;responseHeadersString=headers||"";jqXHR.readyState=status>0?4:0;isSuccess=status>=200&&status<300||status===304;if(responses){response=ajaxHandleResponses(s,jqXHR,responses)}response=ajaxConvert(s,response,jqXHR,isSuccess);if(isSuccess){if(s.ifModified){modified=jqXHR.getResponseHeader("Last-Modified");if(modified){jQuery.lastModified[cacheURL]=modified}modified=jqXHR.getResponseHeader("etag");if(modified){jQuery.etag[cacheURL]=modified}}if(status===204||s.type==="HEAD"){statusText="nocontent"}else if(status===304){statusText="notmodified"}else{statusText=response.state;success=response.data;error=response.error;isSuccess=!error}}else{error=statusText;if(status||!statusText){statusText="error";if(status<0){status=0}}}jqXHR.status=status;jqXHR.statusText=(nativeStatusText||statusText)+"";if(isSuccess){deferred.resolveWith(callbackContext,[success,statusText,jqXHR])}else{deferred.rejectWith(callbackContext,[jqXHR,statusText,error])}jqXHR.statusCode(statusCode);statusCode=undefined;if(fireGlobals){globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error])}completeDeferred.fireWith(callbackContext,[jqXHR,statusText]);if(fireGlobals){globalEventContext.trigger("ajaxComplete",[jqXHR,s]);if(!--jQuery.active){jQuery.event.trigger("ajaxStop")}}}return jqXHR},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script")}});jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=undefined}return jQuery.ajax({url:url,type:method,dataType:type,data:data,success:callback})}});jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn)}});jQuery._evalUrl=function(url){return jQuery.ajax({url:url,type:"GET",dataType:"script",async:false,global:false,"throws":true})};jQuery.fn.extend({wrapAll:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapAll(html.call(this,i))})}if(this[0]){var wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){wrap.insertBefore(this[0])}wrap.map(function(){var elem=this;while(elem.firstChild&&elem.firstChild.nodeType===1){elem=elem.firstChild}return elem}).append(this)}return this},wrapInner:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapInner(html.call(this,i))})}return this.each(function(){var self=jQuery(this),contents=self.contents();if(contents.length){contents.wrapAll(html)}else{self.append(html)}})},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html)})},unwrap:function(){return this.parent().each(function(){if(!jQuery.nodeName(this,"body")){jQuery(this).replaceWith(this.childNodes)}}).end()}});jQuery.expr.filters.hidden=function(elem){return elem.offsetWidth<=0&&elem.offsetHeight<=0||!support.reliableHiddenOffsets()&&(elem.style&&elem.style.display||jQuery.css(elem,"display"))==="none"};jQuery.expr.filters.visible=function(elem){return!jQuery.expr.filters.hidden(elem)};var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj)){jQuery.each(obj,function(i,v){if(traditional||rbracket.test(prefix)){add(prefix,v)}else{buildParams(prefix+"["+(typeof v==="object"?i:"")+"]",v,traditional,add)}})}else if(!traditional&&jQuery.type(obj)==="object"){for(name in obj){buildParams(prefix+"["+name+"]",obj[name],traditional,add)}}else{add(prefix,obj)}}jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():value==null?"":value;s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};if(traditional===undefined){traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional}if(jQuery.isArray(a)||a.jquery&&!jQuery.isPlainObject(a)){jQuery.each(a,function(){add(this.name,this.value)})}else{for(prefix in a){buildParams(prefix,a[prefix],traditional,add)}}return s.join("&").replace(r20,"+")};jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!rcheckableType.test(type))}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:jQuery.isArray(val)?jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}});jQuery.ajaxSettings.xhr=window.ActiveXObject!==undefined?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&createStandardXHR()||createActiveXHR()}:createStandardXHR;var xhrId=0,xhrCallbacks={},xhrSupported=jQuery.ajaxSettings.xhr();if(window.ActiveXObject){jQuery(window).on("unload",function(){for(var key in xhrCallbacks){xhrCallbacks[key](undefined,true)}})}support.cors=!!xhrSupported&&"withCredentials"in xhrSupported;xhrSupported=support.ajax=!!xhrSupported;if(xhrSupported){jQuery.ajaxTransport(function(options){if(!options.crossDomain||support.cors){var callback;return{send:function(headers,complete){var i,xhr=options.xhr(),id=++xhrId;xhr.open(options.type,options.url,options.async,options.username,options.password);if(options.xhrFields){for(i in options.xhrFields){xhr[i]=options.xhrFields[i]}}if(options.mimeType&&xhr.overrideMimeType){xhr.overrideMimeType(options.mimeType)}if(!options.crossDomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest"}for(i in headers){if(headers[i]!==undefined){xhr.setRequestHeader(i,headers[i]+"")}}xhr.send(options.hasContent&&options.data||null);callback=function(_,isAbort){var status,statusText,responses;if(callback&&(isAbort||xhr.readyState===4)){delete xhrCallbacks[id];callback=undefined;xhr.onreadystatechange=jQuery.noop;if(isAbort){if(xhr.readyState!==4){xhr.abort()}}else{responses={};status=xhr.status;if(typeof xhr.responseText==="string"){responses.text=xhr.responseText}try{statusText=xhr.statusText}catch(e){statusText=""}if(!status&&options.isLocal&&!options.crossDomain){status=responses.text?200:404}else if(status===1223){status=204}}}if(responses){complete(status,statusText,responses,xhr.getAllResponseHeaders())}};if(!options.async){callback()}else if(xhr.readyState===4){setTimeout(callback)}else{xhr.onreadystatechange=xhrCallbacks[id]=callback}},abort:function(){if(callback){callback(undefined,true)}}}}})}function createStandardXHR(){try{return new window.XMLHttpRequest}catch(e){}}function createActiveXHR(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(text){jQuery.globalEval(text);return text}}});jQuery.ajaxPrefilter("script",function(s){if(s.cache===undefined){s.cache=false}if(s.crossDomain){s.type="GET";s.global=false}});jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,head=document.head||jQuery("head")[0]||document.documentElement;return{send:function(_,callback){script=document.createElement("script");script.async=true;if(s.scriptCharset){script.charset=s.scriptCharset}script.src=s.url;script.onload=script.onreadystatechange=function(_,isAbort){if(isAbort||!script.readyState||/loaded|complete/.test(script.readyState)){script.onload=script.onreadystatechange=null;if(script.parentNode){script.parentNode.removeChild(script)}script=null;if(!isAbort){callback(200,"success")}}};head.insertBefore(script,head.firstChild)},abort:function(){if(script){script.onload(undefined,true)}}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||jQuery.expando+"_"+nonce++;this[callback]=true;return callback}});jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=s.jsonp!==false&&(rjsonp.test(s.url)?"url":typeof s.data==="string"&&!(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(s.data)&&"data");if(jsonProp||s.dataTypes[0]==="jsonp"){callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback;if(jsonProp){s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName)}else if(s.jsonp!==false){s.url+=(rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName}s.converters["script json"]=function(){if(!responseContainer){jQuery.error(callbackName+" was not called")}return responseContainer[0]};s.dataTypes[0]="json";overwritten=window[callbackName];window[callbackName]=function(){responseContainer=arguments};jqXHR.always(function(){window[callbackName]=overwritten;if(s[callbackName]){s.jsonpCallback=originalSettings.jsonpCallback;oldCallbacks.push(callbackName)}if(responseContainer&&jQuery.isFunction(overwritten)){overwritten(responseContainer[0])}responseContainer=overwritten=undefined});return"script"}});jQuery.parseHTML=function(data,context,keepScripts){if(!data||typeof data!=="string"){return null}if(typeof context==="boolean"){keepScripts=context;context=false}context=context||document;var parsed=rsingleTag.exec(data),scripts=!keepScripts&&[];if(parsed){return[context.createElement(parsed[1])]}parsed=jQuery.buildFragment([data],context,scripts);if(scripts&&scripts.length){jQuery(scripts).remove()}return jQuery.merge([],parsed.childNodes)};var _load=jQuery.fn.load;jQuery.fn.load=function(url,params,callback){if(typeof url!=="string"&&_load){return _load.apply(this,arguments)}var selector,response,type,self=this,off=url.indexOf(" ");if(off>=0){selector=jQuery.trim(url.slice(off,url.length));url=url.slice(0,off)}if(jQuery.isFunction(params)){callback=params;params=undefined}else if(params&&typeof params==="object"){type="POST"}if(self.length>0){jQuery.ajax({url:url,type:type,dataType:"html",data:params}).done(function(responseText){response=arguments;self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText)}).complete(callback&&function(jqXHR,status){self.each(callback,response||[jqXHR.responseText,status,jqXHR])})}return this};jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length};var docElem=window.document.documentElement;function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType===9?elem.defaultView||elem.parentWindow:false}jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,calculatePosition,position=jQuery.css(elem,"position"),curElem=jQuery(elem),props={};if(position==="static"){elem.style.position="relative"}curOffset=curElem.offset();curCSSTop=jQuery.css(elem,"top");curCSSLeft=jQuery.css(elem,"left");calculatePosition=(position==="absolute"||position==="fixed")&&jQuery.inArray("auto",[curCSSTop,curCSSLeft])>-1;if(calculatePosition){curPosition=curElem.position();curTop=curPosition.top;curLeft=curPosition.left}else{curTop=parseFloat(curCSSTop)||0;curLeft=parseFloat(curCSSLeft)||0}if(jQuery.isFunction(options)){options=options.call(elem,i,curOffset)}if(options.top!=null){props.top=options.top-curOffset.top+curTop}if(options.left!=null){props.left=options.left-curOffset.left+curLeft}if("using"in options){options.using.call(elem,props)}else{curElem.css(props)}}};jQuery.fn.extend({offset:function(options){if(arguments.length){return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)})}var docElem,win,box={top:0,left:0},elem=this[0],doc=elem&&elem.ownerDocument;if(!doc){return}docElem=doc.documentElement;if(!jQuery.contains(docElem,elem)){return box}if(typeof elem.getBoundingClientRect!==strundefined){box=elem.getBoundingClientRect()}win=getWindow(doc);return{top:box.top+(win.pageYOffset||docElem.scrollTop)-(docElem.clientTop||0),left:box.left+(win.pageXOffset||docElem.scrollLeft)-(docElem.clientLeft||0)}},position:function(){if(!this[0]){return}var offsetParent,offset,parentOffset={top:0,left:0},elem=this[0];if(jQuery.css(elem,"position")==="fixed"){offset=elem.getBoundingClientRect()}else{offsetParent=this.offsetParent();
offset=this.offset();if(!jQuery.nodeName(offsetParent[0],"html")){parentOffset=offsetParent.offset()}parentOffset.top+=jQuery.css(offsetParent[0],"borderTopWidth",true);parentOffset.left+=jQuery.css(offsetParent[0],"borderLeftWidth",true)}return{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",true),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",true)}},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent||docElem;while(offsetParent&&!jQuery.nodeName(offsetParent,"html")&&jQuery.css(offsetParent,"position")==="static"){offsetParent=offsetParent.offsetParent}return offsetParent||docElem})}});jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top=/Y/.test(prop);jQuery.fn[method]=function(val){return access(this,function(elem,method,val){var win=getWindow(elem);if(val===undefined){return win?prop in win?win[prop]:win.document.documentElement[method]:elem[method]}if(win){win.scrollTo(!top?val:jQuery(win).scrollLeft(),top?val:jQuery(win).scrollTop())}else{elem[method]=val}},method,val,arguments.length,null)}});jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]=addGetHookIf(support.pixelPosition,function(elem,computed){if(computed){computed=curCSS(elem,prop);return rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed}})});jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||typeof margin!=="boolean"),extra=defaultExtra||(margin===true||value===true?"margin":"border");return access(this,function(elem,type,value){var doc;if(jQuery.isWindow(elem)){return elem.document.documentElement["client"+name]}if(elem.nodeType===9){doc=elem.documentElement;return Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])}return value===undefined?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:undefined,chainable,null)}})});jQuery.fn.size=function(){return this.length};jQuery.fn.andSelf=jQuery.fn.addBack;if(typeof define==="function"&&define.amd){define("jquery",[],function(){return jQuery})}expands.jQuery=expands.$=jQuery;return jQuery})}();!function(){var $=Lib.Expands.$;var isIE=/msie/.test(navigator.userAgent.toLowerCase());var isIE6=isIE&&"undefined"==typeof document.body.style.maxHeight;function _replace(arr,str){$.each(arr,function(key,value){str=str.replace("{{"+key+"}}",value)});return str}var Mask=function(opts){this.config=$.extend({maskHtml:'<div style="width:100%;height:100%;position:{{position}};z-index: 998;background:{{maskColor}};{{maskopactiy}};top:0;left:0;" class="__mask"></div>',opacity:.5,maskColor:"#000"},opts);this.dom=null;this.initMask()};Mask.prototype={constructor:Mask,destory:function(){if(this.dom){this.dom.remove();if(isIE6){$(window).unbind("scroll resize",this._bindWindow)}}},show:function(){if(this.dom)this.dom.show()},hide:function(){if(this.dom)this.dom.hide()},initMask:function(){if(!this.dom){var maskColor=this.config.maskColor;var opacity=this.config.opacity;var html=_replace({maskColor:maskColor,position:isIE6?"absolute":"fixed",maskopactiy:isIE?"filter:alpha(opacity="+parseInt(opacity*100,10)+")":"opacity:"+opacity},this.config.maskHtml);this.dom=$(html);if(isIE6){this.dom.append('<iframe style="width:100%;height:100%;" frameBorder="0" allowTransparency="true"></iframe>')}this.dom.hide();this.dom.appendTo("body");this.initEvent()}},_bindWindow:function(e){var self=e.data.self;self.dom.css({height:document.documentElement.clientHeight,width:document.documentElement.clientWidth})},initEvent:function(){var self=this;if(isIE6){$(window).bind("scroll resize",{self:self},self._bindWindow)}}};var WinBox=function(opts){this.config=$.extend({hasMask:true,title:"WinBox",width:500,html:"WinBox",autoHide:false,maskColor:"#000",hasDrag:true},opts);this.dom=null;this.mask=null;this.tmpHtml='<div style="background:#fff;width:{{width}}px;" class="L_layer">                <div class="titlebox" data-role="drag">                  <a class="C_ico C_ico_close " href="#" data-role="closeWinBox">x</a>                  <span>{{title}}</span>                </div>                <div class="contentbox">{{html}}</div>              </div>';this.styleText="";this.styleInline=null;this.initDom();this.initStyle();if(this.config.hasMask)this.initMask()};WinBox.prototype={constructor:WinBox,destory:function(){if(this.mask)this.mask.destory();if(this.dom){this.dom.remove();$(window).unbind("scroll reszie",this._bindWindow);this.dom.off("mousedown","[data-role=drag]");this.dom.off("mouseup","[data-role=drag]")}if(this.styleInline)this.styleInline.remove()},initStyle:function(){if(!this.styleInline){this.styleInline=$("<style>"+this.styleText+"</style>").appendTo($("head:eq(0)"))}},initDom:function(){var config=this.config;if(!this.dom){this.dom=$(_replace({width:config.width,title:config.title,html:config.html},this.tmpHtml));this.dom.hide();this.dom.appendTo("body");this.initEvent()}},initEvent:function(){var self=this;if(this.dom){this.dom.on("click",'[data-role="closeWinBox"]',{self:this},this._close);$(window).bind("scroll resize",{self:this},this._bindWindow);if(this.config.hasDrag){var iDiffX,iDiffY;function _mousemove(e){if(iDiffX&&iDiffY){var top=e.pageY-iDiffY,left=e.pageX-iDiffX,boxWidth=self.dom.outerWidth(),boxHeight=self.dom.outerHeight();if(top>=$(window).scrollTop()&&top<=$(window).scrollTop()+$(window).height()-boxHeight&&left>=0&&left<=$(window).scrollLeft()+$(window).width()-boxWidth){self.dom.offset({left:left,top:top})}}}this.dom.on("mousedown","[data-role=drag]",function(e){iDiffX=e.pageX-self.dom.offset().left;iDiffY=e.pageY-self.dom.offset().top;self.dom.css("cursor","move");$(document).on("mousemove",_mousemove)});$(document).on("mouseup",function(e){iDiffX=0;iDiffY=0;$(document).off("mousemove",_mousemove);self.dom.css("cursor","")})}}},_bindWindow:function(e){var self=e.data.self;self.setCenter()},_close:function(e){var self=e.data.self;self.hide()},initMask:function(){if(!this.mask){this.mask=new Mask}},setCenter:function(){if(this.dom){this.dom.css({position:isIE6?"absolute":"fixed",zIndex:999});if(isIE6){var topVal=$(window).height()/2+$(window).scrollTop()-boxHeight/2;this.dom.css({top:topVal,left:$(window).width()/2-boxWidth/2})}else{var boxWidth=this.dom.outerWidth();var boxHeight=this.dom.outerHeight();this.dom.css({top:"50%",left:"50%",marginTop:-(boxHeight/2),marginLeft:-(boxWidth/2)})}}},show:function(offset){this.mask.show();if(this.dom)this.dom.show();this.setCenter()},hide:function(){this.mask.hide();if(this.dom)this.dom.hide()}};$.WinBox=WinBox}();Core.Math.getRandomNumber=function(_start,_end){if(isNaN(_start)||isNaN(_end)||_start<0&&_end<0){return null}var _s=Math.ceil(Math.min(_start,_end));var _e=Math.floor(Math.max(_start,_end));_s=_s>0?_s:0;return Math.round(_s+Math.random()*(_e-_s))};Core.Dom.opacity=function(elm,value){elm=typeof elm=="string"?$E(elm):elm;elm.style.filter="alpha(opacity="+value+")";elm.style.opacity=value/100};Core.Dom.getLeft=function(element){var left=0;var el=$E(element);if(typeof el.offsetParent!="unknown"){while(el.offsetParent){left+=el.offsetLeft;el=el.offsetParent}}else if(el.x){left+=el.x}return left};Core.Dom.getTop=function(element){var top=0;var el=$E(element);if(typeof el.offsetParent!="unknown"){while(el.offsetParent){top+=el.offsetTop;el=el.offsetParent}}else if(el.y){top+=el.y}return top};Core.Dom.setXY=function(el,pos,noRetry){var pos_style=Core.Dom.getStyle(el,"position");if(pos_style=="static"){Core.Dom.setStyle(el,"position","relative");pos_style="relative"}var page_xy=Core.Dom.getXY(el);if(page_xy==false){return false}var delta=[parseInt(Core.Dom.getStyle(el,"left"),10),parseInt(Core.Dom.getStyle(el,"top"),10)];if(isNaN(delta[0])){delta[0]=pos_style=="relative"?0:el.offsetLeft}if(isNaN(delta[1])){delta[1]=pos_style=="relative"?0:el.offsetTop}if(pos[0]!=null){el.style.left=pos[0]-page_xy[0]+delta[0]+"px"}if(pos[1]!=null){el.style.top=pos[1]-page_xy[1]+delta[1]+"px"}return true};Sina.pkg("Utils.Flash");if(typeof deconcept=="undefined")var deconcept=new Object;if(typeof deconcept.util=="undefined")deconcept.util=new Object;if(typeof deconcept.SWFObjectUtil=="undefined")deconcept.SWFObjectUtil=new Object;deconcept.SWFObject=function(swf,id,w,h,ver,c,quality,xiRedirectUrl,redirectUrl,detectKey){if(!document.getElementById){return}this.DETECT_KEY=detectKey?detectKey:"detectflash";this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY);this.params=new Object;this.variables=new Object;this.attributes=new Array;if(swf){this.setAttribute("swf",swf)}if(id){this.setAttribute("id",id)}if(w){this.setAttribute("width",w)}if(h){this.setAttribute("height",h)}if(ver){this.setAttribute("version",new deconcept.PlayerVersion(ver.toString().split(".")))}this.installedVer=deconcept.SWFObjectUtil.getPlayerVersion();if(!window.opera&&document.all&&this.installedVer.major>7){deconcept.SWFObject.doPrepUnload=true}if(c){this.addParam("bgcolor",c)}var q=quality?quality:"high";this.addParam("quality",q);this.setAttribute("useExpressInstall",false);this.setAttribute("doExpressInstall",false);var xir=xiRedirectUrl?xiRedirectUrl:window.location;this.setAttribute("xiRedirectUrl",xir);this.setAttribute("redirectUrl","");if(redirectUrl){this.setAttribute("redirectUrl",redirectUrl)}};deconcept.SWFObject.prototype={useExpressInstall:function(path){this.xiSWFPath=!path?"expressinstall.swf":path;this.setAttribute("useExpressInstall",true)},setAttribute:function(name,value){this.attributes[name]=value},getAttribute:function(name){return this.attributes[name]},addParam:function(name,value){this.params[name]=value},getParams:function(){return this.params},addVariable:function(name,value){this.variables[name]=value},getVariable:function(name){return this.variables[name]},getVariables:function(){return this.variables},getVariablePairs:function(){var variablePairs=new Array;var key;var variables=this.getVariables();for(key in variables){variablePairs[variablePairs.length]=key+"="+variables[key]}return variablePairs},getSWFHTML:function(){var swfNode="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute("swf",this.xiSWFPath)}swfNode='<embed pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" src="'+this.getAttribute("swf")+'" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'" style="'+this.getAttribute("style")+'"';swfNode+=' id="'+this.getAttribute("id")+'" name="'+this.getAttribute("id")+'" ';var params=this.getParams();for(var key in params){swfNode+=[key]+'="'+params[key]+'" '}var pairs=this.getVariablePairs().join("&");if(pairs.length>0){swfNode+="flashvars="+pairs+'&realfull=1&moz=1"'}swfNode+="/>"}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute("swf",this.xiSWFPath)}swfNode='<object id="'+this.getAttribute("id")+'" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,28,0" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'" style="'+this.getAttribute("style")+'">';swfNode+='<param name="movie" value="'+this.getAttribute("swf")+'" />';var params=this.getParams();for(var key in params){swfNode+='<param name="'+key+'" value="'+params[key]+'" />'}var pairs=this.getVariablePairs().join("&");if(pairs.length>0){swfNode+='<param name="flashvars" value="'+pairs+'" />'}swfNode+="</object>"}return swfNode},write:function(elementId){if(this.getAttribute("useExpressInstall")){var expressInstallReqVer=new deconcept.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(expressInstallReqVer)&&!this.installedVer.versionIsValid(this.getAttribute("version"))){this.setAttribute("doExpressInstall",true);this.addVariable("MMredirectURL",escape(this.getAttribute("xiRedirectUrl")));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title)}}if(this.skipDetect||this.getAttribute("doExpressInstall")||this.installedVer.versionIsValid(this.getAttribute("version"))){}else{if(this.getAttribute("redirectUrl")!=""){document.location.replace(this.getAttribute("redirectUrl"))}}var n=typeof elementId=="string"?document.getElementById(elementId):elementId;var oldTitle=document.title;n.innerHTML=this.getSWFHTML();if(oldTitle!==document.title){document.title=oldTitle}return true}};deconcept.SWFObjectUtil.getPlayerVersion=function(){var PlayerVersion=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var x=navigator.plugins["Shockwave Flash"];if(x&&x.description){PlayerVersion=new deconcept.PlayerVersion(x.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split("."))}}else if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var axo=1;var counter=3;while(axo){try{counter++;axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+counter);PlayerVersion=new deconcept.PlayerVersion([counter,0,0])}catch(e){axo=null}}}else{try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7")}catch(e){try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");PlayerVersion=new deconcept.PlayerVersion([6,0,21]);axo.AllowScriptAccess="always"}catch(e){if(PlayerVersion.major==6){return PlayerVersion}}try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(e){}}if(axo!=null){PlayerVersion=new deconcept.PlayerVersion(axo.GetVariable("$version").split(" ")[1].split(","))}}return PlayerVersion};deconcept.PlayerVersion=function(arrVersion){this.major=arrVersion[0]!=null?parseInt(arrVersion[0]):0;this.minor=arrVersion[1]!=null?parseInt(arrVersion[1]):0;this.rev=arrVersion[2]!=null?parseInt(arrVersion[2]):0};deconcept.PlayerVersion.prototype.versionIsValid=function(fv){if(this.major<fv.major)return false;if(this.major>fv.major)return true;if(this.minor<fv.minor)return false;if(this.minor>fv.minor)return true;if(this.rev<fv.rev)return false;return true};deconcept.util={getRequestParameter:function(param){var q=document.location.search||document.location.hash;if(param==null){return q}if(q){var pairs=q.substring(1).split("&");for(var i=0;i<pairs.length;i++){if(pairs[i].substring(0,pairs[i].indexOf("="))==param){return pairs[i].substring(pairs[i].indexOf("=")+1)}}}return""}};deconcept.SWFObjectUtil.cleanupSWFs=function(){var objects=document.getElementsByTagName("OBJECT");for(var i=objects.length-1;i>=0;i--){objects[i].style.display="none";for(var x in objects[i]){if(typeof objects[i][x]=="function"){objects[i][x]=function(){}}}}};if(deconcept.SWFObject.doPrepUnload){if(!deconcept.unloadSet){deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",deconcept.SWFObjectUtil.cleanupSWFs)};window.attachEvent("onbeforeunload",deconcept.SWFObjectUtil.prepUnload);deconcept.unloadSet=true}}if(!document.getElementById&&document.all){document.getElementById=function(id){return document.all[id]}}var getQueryParamValue=deconcept.util.getRequestParameter;var FlashObject=deconcept.SWFObject;Utils.Flash.swfObject=deconcept.SWFObject;Utils.Flash.swfView={swfList:[],Add:function(sURL,sID,sPID,nWidth,nHeight,nVersion,sBGColor,oVar,oParam){if(sURL&&sPID){this.swfList[this.swfList.length]={sURL:sURL,sID:sID,sPID:sPID,nWidth:nWidth,nHeight:nHeight,nVersion:nVersion,sBGColor:sBGColor,oVar:oVar,oParam:oParam};this.Init();return}},Init:function(){var so;var list=this.swfList;for(var i=0,len=list.length;i<len;i++){var _list=list[i];so=new Utils.Flash.swfObject(_list.sURL,_list.sPID,_list.nWidth,_list.nHeight,_list.nVersion,_list.sBGColor);if(_list.oVar){for(var key in _list.oVar){so.addVariable(key,_list.oVar[key])}}if(_list.oParam){for(var Key in _list.oParam){so.addParam(Key,_list.oParam[Key])}}so.write(_list.sID)}list=[];_list=null;so=null}};Core.String.shorten=function(str,len,suffix){if(Core.String.byteLength(str)<=len){return str}if(suffix!=""){suffix=suffix||"..."}else{suffix=""}return Core.String.leftB(str,len)+suffix};Core.Dom.addHTML=function(oParentNode,sHTML){oParentNode.insertAdjacentHTML("beforeend",sHTML)};if(!$C("div").insertAdjacentHTML){Core.Dom.addHTML=function(oParentNode,sHTML){var oRange=oParentNode.ownerDocument.createRange();oRange.setStartBefore(oParentNode);var oFrag=oRange.createContextualFragment(sHTML);oParentNode.appendChild(oFrag)}}Core.Dom.removeNode=function(node){node=$E(node)||node;try{node.parentNode.removeChild(node)}catch(e){}};var $SYSMSG={};$SYSMSG.extend=function(info,override){for(var i in info){$SYSMSG[i]=!!override==false?info[i]:$SYSMSG[i]}};$SYSMSG.extend({A77771:"超出限制",A77772:"图片错误",A77773:"上传错误",A77774:"图片不存在",A77775:"关闭操作浮层将导致添加失败，是否继续？",A77776:"新浪声明：<br/>新浪博客允许用户上传图片并加水印的行为是出于传递更多信息、保护作者版权之目的，但并不意味着新浪博客已核实图片版权、认同其版权归属。用户据此操作，风险自担。  特此声明！"});Core.Array.without=function(array,at){var arr1=array.slice(0,at);var arr2=array.slice(at+1);return arr1.concat(arr2)};Core.Array.up=function(arr,index,num){num=num>index?index:num;return arr.slice(0,index-num).concat(arr[index],arr.slice(index-num,index),arr.slice(index+1))};Core.Array.down=function(arr,index,num){num=num>arr.length-index?arr.length-index:num;return arr.slice(0,index).concat(arr.slice(index+1,index+num+1),arr[index],arr.slice(index+num+1))};Ui.Drag2={init:function(_root,_handle){var o=this;var blk=_root;blk.hdl=_handle;if(typeof blk.hdl=="undefined"||typeof _handle==undefined)blk.hdl=blk;blk.hdl.onmousedown=start;blk.onDragStart=new Function;blk.onDrag=new Function;blk.onDragEnd=new Function;function start(e){e=e||event;var src=e.target||e.srcElement;if(src.tagName.toUpperCase()=="A"||src.parentNode.tagName.toUpperCase()=="A"&&src.tagName.toUpperCase()!="IMG")return;var o=Ui.Drag2;v=blk;v.onDragStart();v.oX=o.getX(e);v.oY=o.getY(e);v.depth=v.style.zIndex;v.style.zIndex=1e6;v.rL=parseInt(v.style.left?v.style.left:0);v.rT=parseInt(v.style.top?v.style.top:0);document.onmousemove=drag;document.onmouseup=end;return false}function drag(e){var o=Ui.Drag2;var v=blk;var nX=o.getX(e);var nY=o.getY(e);var ll=v.rL+nX-v.oX;var tt=v.rT+nY-v.oY;v.style.left=ll+"px";v.style.top=tt+"px";v.onDrag(ll,tt);return false}function end(){v.style.zIndex=v.depth;document.onmousemove=null;document.onmouseup=null;v.onDragEnd()}},fixE:function(e){if(typeof e=="undefined")e=window.event;if(typeof e.layerX=="undefined")e.layerX=e.offsetX;if(typeof e.layerY=="undefined")e.layerY=e.offsetY;return e},getX:function(e){return this.fixE(e).clientX},getY:function(e){return this.fixE(e).clientY}};Core.Dom.insertHTML=function(el,html,where){el=$E(el)||document.body;where=where.toLowerCase()||"beforeend";if(el.insertAdjacentHTML){switch(where){case"beforebegin":el.insertAdjacentHTML("BeforeBegin",html);return el.previousSibling;case"afterbegin":el.insertAdjacentHTML("AfterBegin",html);return el.firstChild;case"beforeend":el.insertAdjacentHTML("BeforeEnd",html);return el.lastChild;case"afterend":el.insertAdjacentHTML("AfterEnd",html);return el.nextSibling}throw'Illegal insertion point -> "'+where+'"'}var range=el.ownerDocument.createRange();var frag;switch(where){case"beforebegin":range.setStartBefore(el);frag=range.createContextualFragment(html);el.parentNode.insertBefore(frag,el);return el.previousSibling;case"afterbegin":if(el.firstChild){range.setStartBefore(el.firstChild);frag=range.createContextualFragment(html);el.insertBefore(frag,el.firstChild);return el.firstChild}else{el.innerHTML=html;return el.firstChild}break;case"beforeend":if(el.lastChild){range.setStartAfter(el.lastChild);frag=range.createContextualFragment(html);el.appendChild(frag);return el.lastChild}else{el.innerHTML=html;return el.lastChild}break;case"afterend":range.setStartAfter(el);frag=range.createContextualFragment(html);el.parentNode.insertBefore(frag,el.nextSibling);return el.nextSibling}throw'Illegal insertion point -> "'+where+'"'};Core.Events.stopBubble=function(el){var ev=el?el:Core.Events.getEvent();if(ev!=null){ev.cancelBubble=true}};if(!$IE||$IE>8){Core.Events.stopBubble=function(el){var ev=el?el:Core.Events.getEvent();if(ev!=null){ev.stopPropagation()}}}Core.Events.stopDefaultEvent=function(el){var ev=el?el:Core.Events.getEvent();if(ev!=null){if(ev.preventDefault){ev.preventDefault()}else{ev.returnValue=false}}};var ImageDrag=Core.Class.create();ImageDrag.dragElementCounter=0;ImageDrag.dragSortObj={baseOffsetLeft:0,baseOffsetTop:0,imgOffsetWidth:0,imgOffsetHeight:0,horizontalGap:0,verticalGap:0};ImageDrag.prototype={constructor:ImageDrag,dragElementIndex:0,BLOCK_ID:"idarg_block",BORDER_ID:"id_border",BORDER_DIV:'<div id="id_border" style="position:absolute;top:0;left:0;float:left;width:2px;height:50px;border:2px dotted #51bd2f; margin-top: 2px;"></div>',CONTAINER_ID:"img_list",ITEM_ID:"image_list_",IMG_ID:"item_img_",ROW:2,COL:10,sortImagesByDrag:function(event){var dso=this.constructor.dragSortObj;if(this.constructor.dragElementCounter<=1){return}var mX=event.clientX,mY=event.clientY,v=mX-dso.baseOffsetLeft,v1=mY-dso.baseOffsetTop,modX=v%(dso.imgOffsetWidth+dso.horizontalGap),modY=v1%(dso.imgOffsetHeight+dso.verticalGap);if(modX<0||modX>dso.imgOffsetWidth||modY<0||modY>dso.imgOffsetHeight){return}var xMouseoverImgIndex=Math.ceil(v/(dso.imgOffsetWidth+dso.horizontalGap)),yMouseoverImgIndex=Math.ceil(v1/(dso.imgOffsetHeight+dso.verticalGap)),f=(yMouseoverImgIndex-1)*this.COL+xMouseoverImgIndex-1;if(f==this.dragElementIndex||f==this.dragElementIndex+1){$E(this.BORDER_ID).style.display="none";return}var eles=Core.Dom.getChildrenByClass($E(this.CONTAINER_ID),"orderCell");if(eles[f].getAttribute("isadd")=="yes"||f==this.constructor.dragElementCounter){var xy=Core.Dom.getXY(eles[f]);$E(this.BORDER_ID).style.display="";$E(this.BORDER_ID).style.left=xy[0]-5+"px";$E(this.BORDER_ID).style.top=xy[1]+"px";$E(this.BORDER_ID).borderIndex=f}else{$E(this.BORDER_ID).style.display="none"}},initialize:function(ele){var dso=this.constructor.dragSortObj;if(++this.constructor.dragElementCounter==1){var d=document.createElement("div");d.id="id_border";d.style.cssText="display:none;position:absolute;top:0;left:0;float:left;width:2px;height:50px;border:2px dotted #51bd2f; margin-top: 2px;";document.body.appendChild(d)}var r=Core.Dom.getElementsByClass($E(this.CONTAINER_ID),"div","divImg");if(r.length!=this.ROW*this.COL){return}var firstImg=r[0].getElementsByTagName("img")[0];var xy=Core.Dom.getXY(firstImg);dso.baseOffsetLeft=xy[0];dso.baseOffsetTop=xy[1];dso.imgOffsetWidth=firstImg.offsetWidth;dso.imgOffsetHeight=firstImg.offsetHeight;var nImg=r[this.COL+1].getElementsByTagName("img")[0];var xy1=Core.Dom.getXY(nImg);dso.horizontalGap=xy1[0]-dso.baseOffsetLeft-dso.imgOffsetWidth;dso.verticalGap=xy1[1]-dso.baseOffsetTop-dso.imgOffsetHeight;ImageDragArea.setAreaNumber(this.CONTAINER_ID);var _this=this;var headerTab=$E("headerTab");if(headerTab){var _CONTAINER_ID=this.CONTAINER_ID;var liArr=headerTab.getElementsByTagName("li");for(var i=0;i<liArr.length;i++){Core.Events.addEvent(liArr[i],function(){setTimeout(function(){var xy=Core.Dom.getXY($E(_CONTAINER_ID).firstChild.getElementsByTagName("img")[0]);dso.baseOffsetLeft=xy[0];dso.baseOffsetTop=xy[1];ImageDragArea.setAreaNumber(_CONTAINER_ID)},100)})}}var id=ele.id.split("_")[2];$E(this.IMG_ID+id).style.cursor="move";Core.Events.addEvent(ele,function(e){_this.drag(e,ele)},"mousedown",false);ele.onDragStart=this.onDragStart.bind2(this);ele.onDrag=this.onDrag.bind2(this);ele.onDragEnd=this.onDragEnd.bind2(this)},drag:function(e,dragElement){if(!document.all&&dragElement.style.position=="absolute"){return}e=e||window.event;if(!e.target){e.target=e.srcElement}if(e.target.tagName.toUpperCase()=="A"){this.constructor.dragElementCounter--;return}var xy=Core.Dom.getXY(dragElement);var startX=e.clientX-xy[0],startY=e.clientY-xy[1];if(Object.prototype.toString.call(dragElement.onDragStart)==="[object Function]"){dragElement.onDragStart()}if(document.addEventListener){document.addEventListener("mousemove",mousemove,true);document.addEventListener("mouseup",mouseup,true)}else{dragElement.setCapture();dragElement.attachEvent("onmousemove",mousemove);dragElement.attachEvent("onmouseup",mouseup);dragElement.attachEvent("onlosecapture",mouseup)}Core.Events.stopBubble(e);Core.Events.stopDefaultEvent(e);function mousemove(moveEvent){moveEvent=moveEvent||windwo.event;var currentLeft=moveEvent.clientX-startX;var currentTop=moveEvent.clientY-startY;if(ImageDragArea.minX){currentLeft=Math.max(Math.min(currentLeft,ImageDragArea.maxX),ImageDragArea.minX);currentTop=Math.max(Math.min(currentTop,ImageDragArea.maxY),ImageDragArea.minY)}dragElement.style.left=currentLeft+"px";dragElement.style.top=currentTop+"px";Core.Events.stopBubble(e);Core.Events.stopDefaultEvent(e);if(Object.prototype.toString.call(dragElement.onDrag)==="[object Function]"){dragElement.onDrag(moveEvent)}}function mouseup(upEvent){upEvent=upEvent||window.event;if(document.removeEventListener){document.removeEventListener("mousemove",mousemove,true);document.removeEventListener("mouseup",mouseup,true)}else{dragElement.detachEvent("onmousemove",mousemove);dragElement.detachEvent("onmouseup",mouseup);dragElement.detachEvent("onlosecapture",mouseup);dragElement.releaseCapture()}Core.Events.stopBubble(e);Core.Events.stopDefaultEvent(e);if(Object.prototype.toString.call(dragElement.onDragEnd)==="[object Function]"){dragElement.onDragEnd()}}},setBlockEle:function(ele){var html='<div id="'+this.BLOCK_ID+'" style="border: 2px dotted #51bd2f; float:left;height:58px;margin-left:4px;margin-bottom:12px;overflow:hidden;width:54px;"></div>';var blockEle=$E(this.BLOCK_ID);if(blockEle){this.removeBlockEle()}Core.Dom.insertHTML(ele,html,"BeforeBegin")},initDragPosition:function(ele){var xy=Core.Dom.getXY($E(this.BLOCK_ID));ele.style.position="absolute";ele.style.zIndex=1e6;ele.style.top=xy[1]+1+"px";ele.style.left=xy[0]+1+"px"},onDragStart:function(e){var id=this.getIdByEle(Core.Events.getEventTarget());var ele=$E(this.ITEM_ID+id);var child=$E("img_list").childNodes;for(var i=0;i<child.length;i++){if(ele==child[i]){this.dragElementIndex=i;break}}child=null;ele.style.position="absolute";this.setBlockEle(ele);this.initDragPosition(ele);var useClient=$E("useClient");if(useClient&&useClient.style.display!="none"){var flashDiv=useClient.lastChild;if(flashDiv.tagName=="DIV"){flashDiv.style.display="none"}}},onDrag:function(event){this.sortImagesByDrag(event)},onDragEnd:function(){var useClient=$E("useClient");if(useClient&&useClient.style.display!="none"){var flashDiv=useClient.lastChild;if(flashDiv.tagName=="DIV"){flashDiv.style.display="block"}}var border_ele=$E(this.BORDER_ID);var eles=Core.Dom.getChildrenByClass($E(this.CONTAINER_ID),"orderCell");if(border_ele.style.display==""){imageList.inserBefore(eles[border_ele.borderIndex],eles[this.dragElementIndex]);border_ele.style.display="none"}else{var item=eles[this.dragElementIndex];item.style.position="";if(!document.all){item.getElementsByTagName("a")[1].blur()}else{item.firstChild.getElementsByTagName("div")[0].firstChild.style.borderColor="#F5F5F5"}}this.removeBlockEle()},getIdByEle:function(ele){var arr=ele.id.split("_");return arr[arr.length-1]},removeBlockEle:function(){Core.Dom.removeNode($E(this.BLOCK_ID))}};ImageDragArea={setAreaNumber:function(containerId){var container=$E(containerId);xy=Core.Dom.getXY(container);trace(">>>>>>>>>xy:"+xy);this.minX=xy[0];this.minY=xy[1];this.maxX=xy[0]+container.offsetWidth-57;this.maxY=xy[1]+container.offsetHeight-57}};Core.Array.insert=function(arr,index,value){return arr.slice(0,index).concat(value,arr.slice(index))};var ImageList=Core.Class.create();ImageList.prototype={ITEM_ID:"image_list_",CONTAINER_ID:"img_list",IMG_ID:"item_img_",TIP_ID:"image_list_tip_",DEL_ID:"item_del_",drags:{},containerId:"",eleList:[],eleMax:20,at:0,delCallbacks:[],initialize:function(containerId,max,operateCallback){this.containerId=containerId;this.operateCallback=operateCallback||function(){};if(max){this.eleMax=max}this.initElement()},initElement:function(){var innerHtml="";for(var i=0;i<this.eleMax;i++){var obj={};obj.id=Core.Math.getUniqueId();this.eleList.push(obj);innerHtml+=this.createNodes(obj.id)}$E(this.containerId).innerHTML=innerHtml},add:function(imageUrl,type){var type=type||"";if(type!="upload"){if(window.loadingList.checkIsWoking()){return false}}if(this.at<this.eleMax){this.eleList[this.at].value=imageUrl;this.eleList[this.at].type=type;var itemEle=$E(this.ITEM_ID+this.eleList[this.at].id);var imgEle=$E(this.IMG_ID+this.eleList[this.at].id);itemEle.isadd="yes";itemEle.setAttribute("isadd","yes");imgEle.src=imageUrl;this.getImageSize(this.at);this.drags[this.eleList[this.at].id]=new ImageDrag(itemEle);this.showDelEle(this.eleList[this.at].id);this.swapStatus();this.operateCallback(this.at+1,"add");return this.eleList[this.at++].id}return false},showDelEle:function(id){$E(this.DEL_ID+id).style.display=""},getIdByIndex:function(index){return this.eleList[index].id},addToEditor:function(){},remove:function(type,value){var delId,isAt=false,array=this.eleList,len=this.eleList.length,clen=this.delCallbacks.length;for(var i=0;i<len;i++){if(type=="id"){if(this.eleList[i].id==value){isAt=true}}else{if(this.eleList[i].value==value){isAt=true}}if(isAt==true){delId=this.eleList[i].id;for(var j=0;j<clen;j++){this.delCallbacks[j](delId,this.eleList[i].value)}this.eleList=Core.Array.without(this.eleList,i);break}}if(!isAt){return}var itemEle=$E(this.ITEM_ID+delId),isAdded=itemEle.getAttribute("isadd");if("yes"===isAdded&&this.at>0){this.at--}Core.Dom.removeNode(itemEle);var newid=Core.Math.getUniqueId();Core.Dom.addHTML($E(this.CONTAINER_ID),this.createNodes(newid));this.eleList.push({id:newid});this.swapStatus();this.operateCallback(this.at,"remove")},addDelCallback:function(callback){this.delCallbacks.push(callback)},getList:function(){return this.eleList},checkValue:function(value){for(var i=0;i<this.at;i++){if(this.eleList[i].value==value){return this.eleList[i].id}}return false},swapNode:function(id,type){var len=this.eleList.length;for(var i=0;i<this.at;i++){if(this.eleList[i].id==id){if(type=="left"){var up_node=$E(this.ITEM_ID+this.eleList[i-1].id);$E(this.ITEM_ID+id).id=up_node.id;up_node.id=this.ITEM_ID+id;var obj_bak=this.eleList[i];this.eleList[i]=this.eleList[i-1];this.eleList[i-1]=obj_bak;Core.Array.up(this.eleList,i,1)}else{var next_node=$E(this.ITEM_ID+this.eleList[i+1].id);$E(this.ITEM_ID+id).id=next_node.id;next_node.id=this.ITEM_ID+id;var obj_bak=this.eleList[i];this.eleList[i]=this.eleList[i+1];this.eleList[i+1]=obj_bak;Core.Array.down(this.eleList,i,1)}break}}this.createAllNodes()},inserBefore:function(itemEle,moveEle){itemEle.parentNode.insertBefore(moveEle,itemEle);moveEle.style.position="";if(document.all){moveEle.firstChild.getElementsByTagName("div")[0].firstChild.style.borderColor="#F5F5F5"}this.changeEleList(uploadMain.getIdByEle(moveEle),uploadMain.getIdByEle(itemEle))},changeEleList:function(moveId,atId){trace(moveId+":"+atId);var len=this.eleList.length;var moveObj={};for(var i=0;i<len;i++){if(this.eleList[i].id==moveId){moveObj=this.eleList[i];this.eleList=Core.Array.without(this.eleList,i);break}}len=this.eleList.length;for(var j=0;j<len;j++){if(this.eleList[j].id==atId){this.eleList=Core.Array.insert(this.eleList,j,moveObj);break}}},createAllNodes:function(){for(var i=0;i<this.at;i++){this.createNodes(i)}this.swapStatus()},swapStatus:function(){var l_class,l_click,r_class,r_click;for(var i=0;i<this.at;i++){if(i<1){l_class="La";l_click="javascript:;"}else{l_class="";l_click="javascript:window.imageList.swapNode('"+this.eleList[i].id+"','left');"}if(i>=this.at-1){r_class="Ra";r_click="javascript:;"}else{r_class="";
r_click="javascript:window.imageList.swapNode('"+this.eleList[i].id+"','right');"}}},isFull:function(){if(this.at>=this.eleMax){return true}return false},createNodes:function(id){var html='<div isadd="no" id="'+this.ITEM_ID+id+'" class="orderCell"><div class="orderBlock">             <a style="display:none" id="'+this.DEL_ID+id+'" title="删除" class="del" onclick="window.uploadMain.removeImage(\''+id+'\');return false;" href="javascript:void(0);">             </a>            <div class="divImg">                <a onmouseover="this.style.borderColor=\'\';" href="javascript:void(0)">                    <img id="'+this.IMG_ID+id+'" height="50" width="50" alt=""  src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif"/>                </a>                <div id="loading_'+id+'" class="divImg_loading" style="display:none">               </div>            </div>             <span class="err" id="'+this.TIP_ID+id+'" style="display:none"></span>            </div></div>';return html},getImageSize:function(id){if(top.isPicFlaReady){try{uploadImage.getSizeStart();parent.trace(this.eleList[id].value);var t=this.eleList[id].value.replace(/square/,"mw690");uploadImage.getSize(t)}catch(e){}}}};var UploadLoading=Core.Class.create();UploadLoading.prototype={ELE_ID:"loading_",RATD_ID:"loading_range_",ERROR_ID:"image_list_tip_",TIP_ID:"loading_tip_",DEL_ID:"item_del_",state:1,initialize:function(containerId,name,cancelCallback){this.id=containerId;this.name=name;this.show();this.showDel();this.cancelCallback=cancelCallback||function(){};this.initElement()},hiddenDel:function(){$E(this.DEL_ID+this.id).style.display="none"},showDel:function(){$E(this.DEL_ID+this.id).style.display=""},show:function(){$E(this.ELE_ID+this.id).style.display="";this.state=2},setError:function(error,tip){var ele=$E(this.ERROR_ID+this.id),imgItemEl=$E(ImageList.prototype.ITEM_ID+this.id);if(error){ele.innerHTML=tip||$SYSMSG["A77773"];ele.style.display="";this.state=3;imgItemEl.setAttribute("isadd","yes")}else{ele.innerHTML="";ele.style.display=""}},setRange:function(range){$E(this.RATD_ID+this.id).style.width=range},setFinish:function(){var ele=$E(this.ELE_ID+this.id);ele.style.display="none";ele.innerHTML="";this.state=4},setTip:function(text){$E(this.TIP_ID+this.id).innerHTML=text},cancel:function(){var ele=$E(this.ELE_ID+this.id);ele.style.display="none";this.setError(false);ele.innerHTML="";this.hiddenDel();this.state=5;try{$E("uploadimage_"+uploadImage.id).cancel(this.name)}catch(e){}this.cancelCallback(this.name)},initElement:function(){var loadingTemplate='<p id="#{TIP_ID}#{id}">0%</p>         <div class="loadbanner">         	<div  style="width:0%;" id="#{RATD_ID}#{id}"class="loadbanner_c"></div>         </div>';this.setError(false);var loadEl=$E(this.TIP_ID+this.id);if(!loadEl){var l_t=new Ui.Template(loadingTemplate);var html=l_t.evaluate({id:this.id,RATD_ID:this.RATD_ID,TIP_ID:this.TIP_ID});Core.Dom.addHTML($E(this.ELE_ID+this.id),html)}}};Core.Array.ArrayWithout=function(){if(arguments.length<2){return arguments.length==1?arguments[0]:null}var results=[];var aa=arguments[0];if(aa===null||aa.constructor!=Array){return null}if(arguments[1].constructor==Array){var args=[];args[0]=aa;Core.Array.foreach(arguments[1],function(v,i){args[i+1]=v})}else{args=arguments}for(var i=0;i<aa.length;i++){var isWithout=true;for(var j=1;j<args.length;j++){if(aa[i]==args[j]){isWithout=false;break}}if(isWithout){results.push(aa[i])}}return results};var LoadingList=Core.Class.create();LoadingList.prototype={lst:{},key:[],initialize:function(){},add:function(id,name){this.key.push(name);this.lst[name]=new UploadLoading(id,name,this.cancelCallback.bind2(this))},cancelCallback:function(name){this.key=Core.Array.ArrayWithout(this.key,name);if(this.key.length<1){}},setRange:function(name,num){var text=num+"%";this.lst[name].setRange(text);this.lst[name].setTip(text);if(num==100){this.lst[name].state=4;this.lst[name].setFinish()}else{this.lst[name].state=2}},checkIsWoking:function(){var len=this.key.length;for(var i=0;i<len;i++){if(this.lst[this.key[i]].state==2){return true}}return false},error:function(name,isError,tip){var list=this.lst[name];if(list&&list.setError){list.setError(isError,tip)}},allError:function(){var len=this.key.length;for(var i=0;i<len;i++){if(this.lst[this.key[i]].state!=4){this.lst[this.key[i]].setError(true)}}},setFinish:function(name){this.lst[name].setFinish()},remove:function(id){var i=0;for(name in this.lst){if(this.lst[name].id==id){this.lst[name].cancel();delete this.lst[name]}}},setPid:function(name,pid){this.lst[name].pid=pid}};var WaterCopyright=Core.Class.create();WaterCopyright.prototype={initialize:function(eleId){this.layer=new Ui.Panel;this.layer.setTemplate(this.initElement());this.attachEvent(eleId)},initElement:function(){var html='		<div id="#{entity}" class="signtipLayer">	        <div class="arrow"></div>	        <div id="#{content}" class="signtipLayer_txt">'+$SYSMSG["A77776"]+"	        </div>        </div>";return html},setPosition:function(){var ele=Core.Events.getEventTarget();var left=Core.Dom.getLeft(ele)+ele.offsetWidth+5;var top=Core.Dom.getTop(ele)-8;this.layer.setPosition({x:left,y:top})},attachEvent:function(eleId){Core.Events.addEvent($E(eleId),this.show.bind2(this),"mouseover");Core.Events.addEvent($E(eleId),this.hidden.bind2(this),"mouseout")},show:function(){this.setPosition();this.layer.show()},hidden:function(){this.layer.hidden()}};!function(){var getImgStaticPath=function(pid,type){if(!pid){return""}var type=type||"orignal";try{var num=eval("0X"+pid.substring(pid.length-2))%16+1;return"http://s"+num+".sinaimg.cn/"+type+"/"+pid}catch(e){trace("图片URL计算出错！PID:"+pid);return""}};window.getImgStaticPath=getImgStaticPath}();Utils.Json={eval:function(str){return eval("("+str+")")},flatten:function(x){var self=Utils.Json;if(x==null)return null;else if(x.constructor.toString()==String)return self.str2json(x);else if(x.constructor.toString()==Array)return self.arr2json(x);else if(x.constructor.toString()==Object)return self.obj2json(x);else if(x.constructor.toString()==Boolean)return self.bool2json(x);else if(x.constructor.toString()==Number)return self.num2json(x);else if(x.constructor.toString()==Date)return self.date2json(x);else return null},arr2json:function(x){var self=Utils.Json;var p=[];var l=x.length;var t;for(var i=0;i<l;++i){t=self.flatten(x[i]);if(t)p.push(t)}return"["+p.join(",")+"]"},obj2json:function(x){var self=Utils.Json;var p=[];var t;for(var i in x){t=self.flatten(x[i]);if(t)p.push(self.flatten(i)+":"+t)}return"{"+p.join(",")+"}"},date2json:function(x){function f(n){return n<10?"0"+n:n}return'"'+x.getFullYear()+"-"+f(x.getMonth()+1)+"-"+f(x.getDate())+"T"+f(x.getHours())+":"+f(x.getMinutes())+":"+f(x.getSeconds())+'"'},stringify:function(jsonObject){var self=Utils.Json;return self.flatten(jsonObject)},parse:function(jsonStr){return Utils.Json.eval(jsonStr)},num2json:function(x){return x?String(x):"0"},bool2json:function(x){return String(x)},str2json:function(x){var m={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};if(/["\\\x00-\x1f]/.test(x)){return'"'+x.replace(/([\x00-\x1f\\"])/g,function(a,b){var c=m[b];if(c)return c;c=b.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"'}return'"'+x+'"'}};Lib.applyIf=function(o,s,defaults){if(defaults){Lib.applyIf(o,defaults)}if(o&&s&&Lib.isObject(s)){for(var p in s){if(s.hasOwnProperty(p)&&!o[p]){o[p]=s[p]}}}return o};Lib.isObject=function(o){return Object.prototype.toString.call(o)==="[object Object]"};Lib.apply=function(o,ref,defaults,deep,original){if(defaults){Lib.applyIf(o,defaults)}for(var p in ref){if(original&&o[p]&&!Lib.isObject(o[p])){continue}if(ref.hasOwnProperty(p)){if(deep&&Lib.isObject(ref[p])){o[p]=Lib.apply(o[p]||{},ref[p],deep,original)}else{o[p]=ref[p]}}}return o};Lib.Ticket={requestTickets:[],_interface:"https://login.sina.com.cn/sso/getst.php",_setParam:function(param){var urlArray=[];urlArray.push(this._interface);var i=0;for(var name in param){if(i==0){urlArray.push("?")}else{urlArray.push("&")}urlArray.push(name);urlArray.push("=");urlArray.push(param[name]);i++}return urlArray.join("")},get:function(callbackFunc,count,entry,service){if(!callbackFunc){return}var options={success:function(){},fail:function(){}};if(typeof callbackFunc=="function"){options.success=callbackFunc}else{if(typeof callbackFunc.success=="function"){options.success=callbackFunc.success}if(typeof callbackFunc.fail=="function"){options.fail=callbackFunc.fail}}var param={};param.entry=entry||"blog";param.service=service||"tupian";param.cnt=count||20;var url=this._setParam(param);Utils.Io.JsLoad.request(url,{onComplete:function(result){var oldTickets=Lib.Ticket.requestTickets;if(result){Lib.Ticket.requestTickets=oldTickets.concat(result.ticket)}options.success(result)},onException:function(){options.fail()},timeout:3e4,charset:"UTF-8"})}};var UploadImage=Core.Class.create();UploadImage.prototype={width:310,height:30,view:"select",nodes:{relatedId:"upload_file_li",waterMarkId:"watermark",waterMarkNoticeId:"waternotice"},FLASH_ID:"uploadimageflash_",EMBED_ID:"uploadimage_",initialize:function(container,dialogName,opts){opts=opts||{};Lib.apply(this.nodes,opts.nodes,{},true);this.width=opts.width||this.width;this.height=opts.height||this.height;this.opts=opts;this.initFlashContainer(container);this.dialogName=dialogName||"imageDialog";this.initUploadFlash();if(false!==this.nodes.relatedId){this.initFlashPosition()}window.loadingList=new LoadingList;if(!opts.noMarker){Core.Events.addEvent($E(this.nodes.waterMarkId),this.waterMark.bind2(this));this.waterCopyright=new WaterCopyright(this.nodes.waterMarkNoticeId);this.initWaterMarkSelect()}this.initGetPicSizeFla()},initUploadFlash:function(){var params="uploadImage.setparams|uploadImage.error";var swf_url=$_GLOBAL.flashBasicURL+(!this.opts.flashFile?"fileuploadv6.swf?":this.opts.flashFile+"?")+Core.Math.getUniqueId();var x=Utils.Flash.swfView.Add(swf_url,this.FLASH_ID+this.id,this.EMBED_ID+this.id,this.width,this.height,"11.8","#000",{setparams:"uploadImage.setParams",isready:"uploadImageIsRead"},{scale:"showall",loop:"true",play:"true",pluginspage:"http://www.macromedia.com/go/getflashplayer",allowScriptAccess:"always",wmode:"transparent",allowFullScreen:"false",wmode:"transparent"})},initFlashContainer:function(container){this.id=Core.Math.getUniqueId();var flashContainer=$C("div");flashContainer.style.width=this.width+"px";flashContainer.style.height=this.height+"px";flashContainer.style.position="absolute";flashContainer.style.overflow="hidden";if(this.opts.zIndex){flashContainer.style.zIndex=this.opts.zIndex}flashContainer.id=this.FLASH_ID+this.id;Core.Dom.opacity(flashContainer,0);$E(container).appendChild(flashContainer)},initFlashPosition:function(){this.moveFlash()},uploadFinish:function(fileName,data,flashInfo){data=data.replace(/(<meta[\.\w\s\S\d]*\/><script[\.\w\s\S\d]*>[\.\w\s\S\d]*<\/script>)/gi,"");data=Core.String.j2o(data);if(this.opts.uploadFinish){this.opts.uploadFinish(fileName,data)}else if(data.code=="A00006"){trace(fileName+":sucsess");var imageData=data.data.pics.pic_1;this.setAllTip("finish");var isAdd=imageList.add(getImgStaticPath(imageData.pid,"square"),"upload");if(isAdd){window.loadingList.setPid(imageData.name,imageData.pid);window.loadingList.setRange(imageData.name,100)}else{window.loadingList.error(imageData.name,true,"图片已满")}}else{imageList.at++;var count=data.data.count.toString();switch(count){case"1":var imageData=data.data.pics.pic_1;var str=imageData.ret.toString();var name=imageData.name;switch(str){case"-11":window.loadingList.error(name,true,$SYSMSG["A77772"]);break;default:window.loadingList.error(name,true)}break;default:window.loadingList.error(fileName,true,$SYSMSG["A77772"])}this.setAllTip()}this.moveFlash()},error:function(code,name){try{var self=this,opts=self.opts,msg;switch(code){case"A06004":msg=$SYSMSG["A77771"];break;case"A06003":msg=$SYSMSG["A77773"];break;default:msg=$SYSMSG["A77774"]}if(opts.error){opts.error(code,name,msg)}else if(name){self.setAllTip();window.loadingList.error(name,true,msg)}else if(code!=="A00650"){self.setAllTip();window.loadingList.allError()}if(!opts.allFinish&&"A06004"===code){this.redeemPoints()}}catch(e){console.error(e.message,e.stack)}},redeemPoints:function(){var self=this;if(!parent.scope.$is_photo_vip&&parent.scope.$redeemImgBloggerDialog){parent.scope.$redeemImgBloggerDialog(function(data){var id=imageList.getIdByIndex(imageList.at);window.uploadMain.removeImage(id);scope.$token=data.token;scope.$vipsign=data.vipsign;scope.$pic_encrypt=data.pic_encrypt;self.setParams()})}},errorLog:function(msg){try{var createInput=function(name,value){var el=$C("input");el.setAttribute("name",name);el.setAttribute("value",value);el.setAttribute("type","hidden");return el};var err_log_url="http://control.blog.sina.com.cn/admin/article/ria_debug.php?timestamp="+ +new Date;var postIframe=$C("iframe"),postForm=$C("form");postIframe.id=postIframe.name="__flash_error_log"+ +new Date+parseInt(1e3*Math.random());postIframe.style.display="none";postForm.target=postIframe.name;postForm.method="POST";postForm.setAttribute("action",err_log_url);var typeEl=createInput("type","flash_err_log"),pageEl=createInput("page",scope.$PRODUCT_NAME+"_"+scope.$pageid),codeEl=createInput("code",500),descEl=createInput("desc","getTickets="+Lib.Ticket.requestTickets.join(",")+"||"+msg);postForm.appendChild(typeEl);postForm.appendChild(pageEl);postForm.appendChild(codeEl);postForm.appendChild(descEl);document.body.appendChild(postForm);document.body.appendChild(postIframe);postForm.submit();setTimeout(function(){document.body.removeChild(postForm);document.body.removeChild(postIframe)},50)}catch(e){}},selectFile:function(names){var loadFiles=names.split("|");var opts=this.opts;if(opts&&opts.selectFile){opts.selectFile(loadFiles)}else{for(var i=0;i<loadFiles.length;i++){if(imageList.eleMax-imageList.at-i>0){window.loadingList.add(imageList.getIdByIndex(imageList.at+i),loadFiles[i]);if(!imageList.isAddRemvoeFunc){imageList.addDelCallback(window.loadingList.remove.bind2(window.loadingList));imageList.isAddRemvoeFunc=true}}else{this.setAllTip("error");this.stopUpload(loadFiles[i])}}}this.setSize();this.moveFlash()},progress:function(name,num){if(num<100){window.loadingList.setRange(name,num)}},setParams:function(){try{var type="multi";if(window.imageList&&imageList.eleMax<2){type="single"}var url="http://upload.photo.sina.com.cn/interface/pic_upload.php?app=blog&s=json";if(scope.$token){url+="&token="+scope.$token}if(scope.$vipsign){url+="&vipsign="+scope.$vipsign}if(scope.$pic_encrypt){url+="&pic_encrypt="+scope.$pic_encrypt}var size="5M";if(parent.scope.$is_photo_vip){size="10M"}var params={phpurl:url,mode:type,maxsize:size,filterStr:"Images(jpg,jpeg,gif,png):*.jpg;*.jpeg;*.gif;*.png",begin:"uploadImage.selectFile",progress:"uploadImage.progress",end:"uploadImage.uploadFinish",error:"uploadImage.error",getTicket:"uploadImage.getTicket",overdue:"redo",errorLog:"uploadImage.errorLog",clickCb:"uploadImage.flashClick",allFinish:"uploadImage.allFinish",imageInfo:this.opts.imageInfo?"uploadImage.imageInfo":""};var paramsStr=Utils.Json.obj2json(params);$E(this.EMBED_ID+this.id).setParams(paramsStr)}catch(e){console.error(e.message,e.stack)}},imageInfo:function(name,width,height){this.opts.imageInfo(name,width,height)},flashClick:function(){var opts=this.opts;opts.click&&this.opts.click()},allFinish:function(total,finishFiles,cancelFiles,errorFiles){var JSON=Utils.Json;this.opts&&this.opts.allFinish(total,JSON.parse(finishFiles),JSON.parse(cancelFiles),JSON.parse(errorFiles))},waterDisabled:function(disabled){var id=this.nodes.waterMarkId;if(disabled){$E(id).disabled=true}else{$E(id).disabled=false}},setFlashSize:function(size){var ele=$E(this.FLASH_ID+this.id);var size=size||"small";switch(size){case"small":ele.style.width=60+"px";ele.style.height=25+"px";break;case"hidden":ele.style.width=1+"px";ele.style.height=1+"px";break;default:ele.style.width=this.width+"px";ele.style.height=this.height+"px"}},setSize:function(){top[this.dialogName].setSize(660,document.body.offsetHeight)},setAllTip:function(type){var html="";switch(type){case"error":html='<span class="cRed">'+imageList.eleMax+"张以后的图片已自动忽略</span>";break;case"wait":html='<span class="cGreen">添加中，请等待...</span>';break;case"finish":html='<span class="cGreen">图片已经添加完成</span>';break;default:html=""}$E("upload_image_note").innerHTML=html;this.moveFlash()},moveFlash:function(){var xy=Core.Dom.getXY($E(this.nodes.relatedId));this.setFlashPosition(xy[0]+100,xy[1])},getTicket:function(){var _this=this;Lib.Ticket.get(_this.ticketCallback.bind2(_this),20)},ticketCallback:function(json){var ele=$E(this.EMBED_ID+this.id);if(!json||6103===parseInt(json.retcode)){top.winDialog.alert("您已退出登录，请先登录！");return}var jsonStr=Utils.Json.obj2json(json);ele.addTicket(jsonStr)},setFlashPosition:function(x,y){var flashEle=$E(this.FLASH_ID+this.id);Core.Dom.setXY(flashEle,[x,y])},stopUpload:function(name){$E(this.EMBED_ID+this.id).cancel(name)},swapGoto:function(type){var type=type||"show";if(typeof this.gotoType=="undefined"){this.gotoType="show"}if(type=="show"&&this.gotoType!="show"){$E("upload_go_on").parentNode.style.display="";this.gotoType="show";this.moveFlash()}if(type=="hidden"&&this.gotoType!="hidden"){$E("upload_go_on").parentNode.style.display="none";this.setFlashSize("hidden");this.gotoType="hidden"}},initWaterMarkSelect:function(){var id=this.nodes.waterMarkId;var ele=$E(id);var cookieValue=Utils.Cookie.getCookie("water_mark_"+scope.$uid);if(cookieValue=="1"){ele.checked=true;this.waterMark()}else{ele.checked=false}},waterMark:function(){var id=this.nodes.waterMarkId;var ele=$E(id);var url;var flashEle=$E(this.EMBED_ID+this.id);if(typeof flashEle.setMask!="undefined"){if(ele.checked){if(top.scope.$uhost&&top.scope.$uhost!=""){url="blog.sina.com.cn/"+top.scope.$uhost}else{url="blog.sina.com.cn/u/"+top.scope.$uid}flashEle.setMask(1,url);Utils.Cookie.setCookie("water_mark_"+scope.$uid,"1",999)}else{flashEle.setMask(0);Utils.Cookie.setCookie("water_mark_"+scope.$uid,"0",999)}}else{setTimeout(this.waterMark.bind2(this),50)}},initGetPicSizeFla:function(){try{var fNode=$C("div");fNode.id="GetPicSize";$E("headerTab").appendChild(fNode);var tStr="";if($TT||$360||$Maxthon){tStr="?t="+Core.Math.getRandomNumber(1,99999)}Utils.Flash.swfView.Add($_GLOBAL.flashBasicURL+"getPicSize.swf"+tStr,"GetPicSize","getPicSizeSWF","1","1","8","#ffffff",{},{allowScriptAccess:"always",wmode:"transparent"});Utils.Flash.swfView.Init();this._getPicSizeSWF=$E("getPicSizeSWF");parent.trace("获取图片大小flash加载成功！！！！！")}catch(ex){parent.trace("获取图片大小flash加载失败")}},getFlashReady:function(){parent.trace("flash回调");top.isPicFlaReady=true},getSizeStart:function(){try{$E("getPicSizeSWF").getStart()}catch(e){parent.trace("flash getStart函数不可用")}},getSize:function(url){try{this._getPicSizeSWF.getPicSize(url)}catch(e){parent.trace("flash getPicSize函数不可用")}},ImgSizeRet:function(url,obj){if(url.indexOf("photo.sina")!=-1||url.indexOf("sinaimg.cn")!=-1){var pId=url.substring(url.lastIndexOf("/")+1);pId=pId.replace(/&\d{3}/,"");parent.top.ArticleIMGFuncs.picSizeObj[pId]=obj}else{parent.top.ArticleIMGFuncs.picSizeObj[url]=obj}}};!function(w){"use strict";!function(global,undef){if(![].indexOf){Array.prototype.indexOf=function(val){var obj,arr=this;for(var i=0,len=arr.length;i<len;i++){obj=arr[i];if(obj===val){return i}}return-1}}var __instance=[];var SinaEditor={noSpaceReg:/[^ \t\n\r\u200B\uFEFF]/,spaceChar:"﻿",editorId:0,create:function(opts){var self=this;var editor=new self.Editor(opts);self.add(editor);return editor},get:function(id){if("string"===typeof id){for(var i=0,len=__instance.length;i<len;i++){if(id===__instance[i].id){return __instance[i]}}}else{return __instance[id]}},add:function(editor){__instance.push(editor)},regist:function(name,func){var pkgs=name.split("."),self=this,pkg,namespace=this;for(var i=0,len=pkgs.length;i<len-1;i++){pkg=pkgs[i];if(namespace[pkg]===undef){namespace[pkg]={}}namespace=namespace[pkg]}if(namespace[pkgs[i]]!==undef){throw Error(name+" is defined!")}else{namespace[pkgs[i]]=func.call(self,self)}}};global.SinaEditor=SinaEditor}(window);SinaEditor.regist("Util",function(SE){var Util={};Util.inArray=function(arr,item){var i=this.arrayIndexOf(arr,item);return i>-1?true:false};Util.isArray=function(arr){return"[object Array]"===Object.prototype.toString.call(arr)};Util.toArray=function(list){var arr=[];if(Util.isArray(list)){return list}else{for(var i=0,len=list.length;i<len;i++){arr.push(list[i])}}return arr};Util.isObject=function(o){return"[object Object]"===o.toString()};Util.bind=function(func,scope){return function(){func.apply(scope,arguments)}};Util.arrayIndexOf=function(arr,item){var i=0,l=arr.length;for(;i<l;i++){if(arr[i]==item){return i}}return-1};Util.extend=function(defaults,settings){var args=arguments;defaults=defaults||{};if(args.length==2){defaults=Util.mix(defaults,settings)}else{for(var i=1,len=args.length;i<len;i++){defaults=Util.mix(defaults,args[i])}}return defaults};Util.mix=function(o,ref,deep){for(var p in ref){if(ref.hasOwnProperty(p)){if(deep&&o[p]&&Util.isObject(o[p])){Util.mix(o[p],ref[p],deep)}else{o[p]=ref[p]}}}return o};Util.merge=function(o,ref,deep,original){if(!o){o={}}for(var p in ref){if(original&&o[p]&&!Util.isObject(o[p])){continue}if(ref.hasOwnProperty(p)){if(deep&&Util.isObject(ref[p])){o[p]=Util.merge(o[p]||{},ref[p],deep,original)}else{o[p]=ref[p]}}}return o};Util.inherits=function(subClass,superClass,proto){var oldPro=subClass.prototype;proto=proto||{};var newFun=new Function;newFun.prototype=superClass.prototype;var newPro=new newFun;for(var p in oldPro){newPro[p]=oldPro[p]}Util.mix(newPro,proto);subClass.prototype=newPro;return newPro.constructor=subClass};Util.each=function(arr,func){if(!arr){return}if("length"in arr){var i=0,len=arr.length,item;for(;i<len;i++){item=arr[i];if(false===func.call(item,i,item,arr)){break}}return arr}else{for(var p in arr){if(arr.hasOwnProperty(p)&&false===func.call(arr[p],p,arr[p],arr)){break}}return arr}};Util.Deffer=function(func){var deffered={queue:[],then:function(func){this.queue.push(func);return this},next:function(){var func=this.queue.shift();func&&func.call(null,this)},start:function(){this.next()}};func&&deffered.queue.push(func);return deffered};Util.urlParser=function(url,encode){var parser=document.createElement("a");parser.href=url;var search=parser.search;var paramstr=search.replace("?","");var paramArr=paramstr.split("&"),matches,params={};for(var i=paramArr.length-1;i>=0;i--){matches=paramArr[i].match(/([^=]+)(=(.*)){0,1}/);if(matches&&matches[1]){params[matches[1]]=encode?decodeURIComponent(matches[3]):matches[3]}}var pathname=parser.pathname;if("/"!==pathname.charAt(0)){pathname="/"+pathname}return{hostname:parser.hostname||location.hostname,protocol:parser.protocol||"http:",port:parseInt(parser.port||80),pathname:pathname,search:search,hash:parser.hash,host:parser.host||location.host,params:params,param:function(name,val){if("undefined"===typeof val){return params[name]}else{params[name]=val;this.search=search="?"+this.serialize();return val}},toString:function(){var self=this;var url=self.protocol+"//"+self.hostname+(80!==self.port?":"+self.port:"")+self.pathname+self.search+self.hash;return url},serialize:function(){var ar=[];for(var i in params){if(!params.hasOwnProperty(i)){continue}if(params[i]==null||params[i]==""){ar.push(i+"=")}else{ar.push(i+"="+params[i])}}var str=ar.join("&");return encode?encodeURIComponent(str):str}}};Util.trim=function(str){var ws="	\n\f\r   ᠎    "+"         　\u2028"+"\u2029﻿";ws="["+ws+"]";var trimBeginRegexp=new RegExp("^"+ws+ws+"*"),trimEndRegexp=new RegExp(ws+ws+"*$");return str.replace(trimBeginRegexp,"").replace(trimEndRegexp,"")};Util.uniqueId=function(){var pre="SinaEditor_";var count=0;return function(type){var now=+new Date;return(false!==type?pre+(type||""):"")+now+"_"+count++}}();Util.ajax=function(){function createRequest(){var request=null;try{request=new XMLHttpRequest}catch(trymicrosoft){try{request=new ActiveXObject("Msxml2.XMLHTTP")}catch(othermicrosoft){try{request=ActiveXObject("Microsoft.XMLHTTP")}catch(failed){}}}return request}function request(url,option){option=option||{};option.onComplete=option.onComplete||function(){};option.onException=option.onException||function(){};option.returnType=option.returnType||"txt";option.method=option.method||"get";option.data=option.data||{};if(typeof option.GET!="undefined"&&typeof option.GET.url_random!="undefined"&&option.GET.url_random==0){this.rand=false;option.GET.url_random=null}return loadData(url,option)}function loadData(url,option){var timer;var request=createRequest(),tmpArr=[];var _url=new Util.urlParser(url);if(option.POST){for(var postkey in option.POST){var postvalue=option.POST[postkey];if(postvalue!=null){tmpArr.push(postkey+"="+encodeURIComponent(postvalue))}}}var sParameter=tmpArr.join("&")||"";if(option.GET){for(var key in option.GET){if(key!="url_random"){_url.param(key,encodeURIComponent(option.GET[key]))}}}if(option.rand!=false){}request.onreadystatechange=function(){clearTimeout(timer);if(request.readyState==4){var response,type=option.returnType;try{switch(type){case"txt":response=request.responseText;break;case"xml":if($IE){response=request.responseXML}else{var Dparser=new DOMParser;response=Dparser.parseFromString(request.responseText,"text/xml")}break;case"json":response=eval("("+request.responseText+")");break}option.onComplete(response)}catch(e){option.onException(e.message,_url);return false}}};try{if(option.POST){request.open("POST",_url,true);request.setRequestHeader("Content-Type","application/x-www-form-urlencoded");request.send(sParameter)}else{request.open("GET",_url,true);request.send(null)}if(option.timeout&&option.onTimeout){timer=setTimeout(function(){onTimeout("请求超时",_url)},option.timeout)}}catch(e){clearTimeout(timer);option.onException(e.message,_url);return false}return request}return{request:request}};Util.unhtml=function(str){return str?str.replace(/[&<">'](?:(amp|lt|quot|gt|#39|nbsp|#\d+);)?/g,function(a,b){if(b){return a}else{return{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[a]}}):""};Util.unit2Pixel=function(val){if(!/(pt|cm)/.test(val)){return val}var unit;val.replace(/([\d.]+)(\w+)/,function(str,v,u){val=v;unit=u});switch(unit){case"cm":val=parseFloat(val)*25;break;case"pt":val=Math.round(parseFloat(val)*96/72)}return val+(val?"px":"")};return Util});SinaEditor.regist("VK",function(SE){var VK={BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,LEFT:37,RIGHT:39,SPACEBAR:32,TAB:9,UP:38,COMMOND:91,modifierPressed:function(e){return e.shiftKey||e.ctrlKey||e.altKey},metaKeyPressed:function(e){return(SE.env.mac?e.ctrlKey||e.metaKey:e.ctrlKey)&&!e.altKey}};return VK});SinaEditor.regist("env",function(SE){function userAgent(){var ua=navigator.userAgent;var matches;if(matches=/msie (\d+\.\d+)/i.exec(ua)){Env.$msie=true}else if(/Trident\/\d+\.\d+;/i.exec(ua)){Env.$msie=true;matches=/(?:rv:|MSIE)[ ]*(\d+\.{0,1}\d*)/i.exec(ua)}else if(matches=/firefox[\/\s](\d+\.\d+)/i.exec(ua)){Env.$firefox=true}else if(matches=/chrome\/(\S+) safari\/(?:\S+)/i.exec(ua)){Env.$webkit=true;Env.$chrome=true}else if(matches=/safari\/(\S+)/i.exec(ua)){Env.$webkit=true;Env.$safari=true}else if(matches=/opera[\/\s](\d+\.\d+)/i.exec(ua)){Env.$opera=true}if(matches){Env.version=parseInt(matches[1],10)}if(/Mac OS/.test(ua)&&/Mac/.test(navigator.platform)){Env.mac=!0}if(Env.$msie&&Env.version<7){Env.$ie6=true}if(Env.$msie){Env.$belowIe9=false;if(Env.version<9){Env.$belowIe9=true}}}var Env={mac:!1,version:0,$webkit:false,$firefox:false,$msie:false,$safari:false,$opera:false,$ie6:false,$belowIe9:undefined};var userAgentStr=navigator.userAgent;userAgent(userAgentStr);return Env});SinaEditor.regist("Event",function(SE){var util=SE.Util;var Event=function(){this.__Events={};this.__hasFire={}};Event.prototype={constructor:Event,fire:function(object,evtName,data){evtName=evtName.toLowerCase();var funcs=this.__Events[evtName]||[];var datas=Array.prototype.slice.apply(arguments,[2]);var returnValue;for(var a=0;a<funcs.length;a++){var item=funcs[a],e={};if(typeof item!="function"){continue}e.returnValue=true;e.event=evtName;e.undo=false;var params=datas.concat([]);params.unshift(e);if(returnValue===false){item.apply(object||this,params)}else{returnValue=item.apply(object||this,params)}if(e.undo===true){this.__Events[evtName][a]=undefined;this.__Events[evtName].splice(a,1);a--}if(e.returnValue===false){break}}this.__hasFire[evtName]=arguments;return returnValue},bind:function(evtName,func,isFirst){evtName=evtName.toLowerCase();var names=evtName.split(" ");for(var i=0;i<names.length;i++){var name=names[i];if(!this.__Events[name]){this.__Events[name]=[]}if(isFirst&&this.__hasFire[name]){if(typeof func==="function"){var e={};e.returnValue=true;e.event=name;e.undo=false;var object=this.__hasFire[name][0]||this;var data=this.__hasFire[name],datas=[];if(data){datas=Array.prototype.slice.apply(data,[2,data.length])}datas.unshift(e);func.apply(object,datas);if(e.undo!==true){this.__Events[name].unshift(func)}}}else{this.__Events[name].unshift(func)}}},unbind:function(evtName,func){var funcs=this.__Events[evtName]||[];var i=util.arrayIndexOf(funcs,func);if(i>-1){funcs.splice(i,1)}},on:function(evtName,func,isFirst){return this.bind(evtName,func,isFirst)},off:function(naevtNameme,func){return this.unbind(evtName,func)}};return Event});SinaEditor.regist("dtd",function(SE){var Util=SE.Util;var dtd=function(){function _(s){for(var k in s){s[k.toUpperCase()]=s[k]}return s}var X=Util.extend;var A=_({isindex:1,fieldset:1}),B=_({input:1,button:1,select:1,textarea:1,label:1}),C=X(_({a:1}),B),D=X({iframe:1},C),E=_({hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1}),F=_({ins:1,del:1,script:1,style:1}),G=X(_({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1}),F),H=X(_({sub:1,img:1,embed:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1}),G),I=X(_({p:1}),H),J=X(_({iframe:1}),H,B),K=_({img:1,embed:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1}),L=X(_({a:0}),J),M=_({tr:1}),N=_({"#":1}),O=X(_({param:1}),K),P=X(_({form:1}),A,D,E,I),Q=_({li:1,ol:1,ul:1}),R=_({style:1,script:1}),S=_({base:1,link:1,meta:1,title:1}),T=X(S,R),U=_({head:1,body:1}),V=_({html:1});var block=_({address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1}),empty=_({area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1});return _({$nonBodyContent:X(V,U,S),$block:block,$inline:L,$inlineWithA:X(_({a:1}),L),$body:X(_({script:1,style:1}),block),$cdata:_({script:1,style:1}),$empty:empty,$nonChild:_({iframe:1,textarea:1}),$listItem:_({dd:1,dt:1,li:1}),$list:_({ul:1,ol:1,dl:1}),$isNotEmpty:_({table:1,ul:1,ol:1,dl:1,iframe:1,area:1,base:1,col:1,hr:1,img:1,embed:1,input:1,link:1,meta:1,param:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1}),$removeEmpty:_({a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1}),$removeEmptyBlock:_({p:1,div:1}),$tableContent:_({caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,table:1}),$notTransContent:_({pre:1,script:1,style:1,textarea:1}),html:U,head:T,style:N,script:N,body:P,base:{},link:{},meta:{},title:N,col:{},tr:_({td:1,th:1}),img:{},embed:{},colgroup:_({thead:1,col:1,tbody:1,tr:1,tfoot:1}),noscript:P,td:P,br:{},th:P,center:P,kbd:L,button:X(I,E),basefont:{},h5:L,h4:L,samp:L,h6:L,ol:Q,h1:L,h3:L,option:N,h2:L,form:X(A,D,E,I),select:_({optgroup:1,option:1}),font:L,ins:L,menu:Q,abbr:L,label:L,table:_({thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1}),code:L,tfoot:M,cite:L,li:P,input:{},iframe:P,strong:L,textarea:N,noframes:P,big:L,small:L,span:_({"#":1,br:1,b:1,strong:1,u:1,i:1,em:1,sub:1,sup:1,strike:1,span:1}),hr:L,dt:L,sub:L,optgroup:_({option:1}),param:{},bdo:L,"var":L,div:P,object:O,sup:L,dd:P,strike:L,area:{},dir:Q,map:X(_({area:1,form:1,p:1}),A,F,E),applet:O,dl:_({dt:1,dd:1}),del:L,isindex:{},fieldset:X(_({legend:1}),K),thead:M,ul:Q,acronym:L,b:L,a:X(_({a:1}),J),blockquote:X(_({td:1,tr:1,tbody:1,li:1}),P),caption:L,i:L,u:L,tbody:M,s:L,address:X(D,I),tt:L,legend:L,q:L,pre:X(G,C),p:X(_({a:1}),L),em:L,dfn:L})
}();return dtd});function qwery(){var doc=document,html=doc.documentElement,byClass="getElementsByClassName",byTag="getElementsByTagName",qSA="querySelectorAll",useNativeQSA="useNativeQSA",tagName="tagName",nodeType="nodeType",select,id=/#([\w\-]+)/,clas=/\.[\w\-]+/g,idOnly=/^#([\w\-]+)$/,classOnly=/^\.([\w\-]+)$/,tagOnly=/^([\w\-]+)$/,tagAndOrClass=/^([\w]+)?\.([\w\-]+)$/,splittable=/(^|,)\s*[>~+]/,normalizr=/^\s+|\s*([,\s\+\~>]|$)\s*/g,splitters=/[\s\>\+\~]/,splittersMore=/(?![\s\w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^'"]*\]|[\s\w\+\-]*\))/,specialChars=/([.*+?\^=!:${}()|\[\]\/\\])/g,simple=/^(\*|[a-z0-9]+)?(?:([\.\#]+[\w\-\.#]+)?)/,attr=/\[([\w\-]+)(?:([\|\^\$\*\~]?\=)['"]?([ \w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^]+)["']?)?\]/,pseudo=/:([\w\-]+)(\(['"]?([^()]+)['"]?\))?/,easy=new RegExp(idOnly.source+"|"+tagOnly.source+"|"+classOnly.source),dividers=new RegExp("("+splitters.source+")"+splittersMore.source,"g"),tokenizr=new RegExp(splitters.source+splittersMore.source),chunker=new RegExp(simple.source+"("+attr.source+")?"+"("+pseudo.source+")?");var walker={" ":function(node){return node&&node!==html&&node.parentNode},">":function(node,contestant){return node&&node.parentNode==contestant.parentNode&&node.parentNode},"~":function(node){return node&&node.previousSibling},"+":function(node,contestant,p1,p2){if(!node)return false;return(p1=previous(node))&&(p2=previous(contestant))&&p1==p2&&p1}};function cache(){this.c={}}cache.prototype={g:function(k){return this.c[k]||undefined},s:function(k,v,r){v=r?new RegExp(v):v;return this.c[k]=v}};var classCache=new cache,cleanCache=new cache,attrCache=new cache,tokenCache=new cache;function classRegex(c){return classCache.g(c)||classCache.s(c,"(^|\\s+)"+c+"(\\s+|$)",1)}function each(a,fn){var i=0,l=a.length;for(;i<l;i++)fn(a[i])}function flatten(ar){for(var r=[],i=0,l=ar.length;i<l;++i)arrayLike(ar[i])?r=r.concat(ar[i]):r[r.length]=ar[i];return r}function arrayify(ar){var i=0,l=ar.length,r=[];for(;i<l;i++)r[i]=ar[i];return r}function previous(n){while(n=n.previousSibling)if(n[nodeType]==1)break;return n}function q(query){return query.match(chunker)}function interpret(whole,tag,idsAndClasses,wholeAttribute,attribute,qualifier,value,wholePseudo,pseudo,wholePseudoVal,pseudoVal){var i,m,k,o,classes;if(this[nodeType]!==1)return false;if(tag&&tag!=="*"&&this[tagName]&&this[tagName].toLowerCase()!==tag)return false;if(idsAndClasses&&(m=idsAndClasses.match(id))&&m[1]!==this.id)return false;if(idsAndClasses&&(classes=idsAndClasses.match(clas))){for(i=classes.length;i--;)if(!classRegex(classes[i].slice(1)).test(this.className))return false}if(pseudo&&qwery.pseudos[pseudo]&&!qwery.pseudos[pseudo](this,pseudoVal))return false;if(wholeAttribute&&!value){o=this.attributes;for(k in o){if(Object.prototype.hasOwnProperty.call(o,k)&&(o[k].name||k)==attribute){return this}}}if(wholeAttribute&&!checkAttr(qualifier,getAttr(this,attribute)||"",value)){return false}return this}function clean(s){return cleanCache.g(s)||cleanCache.s(s,s.replace(specialChars,"\\$1"))}function checkAttr(qualify,actual,val){switch(qualify){case"=":return actual==val;case"^=":return actual.match(attrCache.g("^="+val)||attrCache.s("^="+val,"^"+clean(val),1));case"$=":return actual.match(attrCache.g("$="+val)||attrCache.s("$="+val,clean(val)+"$",1));case"*=":return actual.match(attrCache.g(val)||attrCache.s(val,clean(val),1));case"~=":return actual.match(attrCache.g("~="+val)||attrCache.s("~="+val,"(?:^|\\s+)"+clean(val)+"(?:\\s+|$)",1));case"|=":return actual.match(attrCache.g("|="+val)||attrCache.s("|="+val,"^"+clean(val)+"(-|$)",1))}return 0}function _qwery(selector,_root){var r=[],ret=[],i,l,m,token,tag,els,intr,item,root=_root,tokens=tokenCache.g(selector)||tokenCache.s(selector,selector.split(tokenizr)),dividedTokens=selector.match(dividers);if(!tokens.length)return r;token=(tokens=tokens.slice(0)).pop();if(tokens.length&&(m=tokens[tokens.length-1].match(idOnly)))root=byId(_root,m[1]);if(!root)return r;intr=q(token);els=root!==_root&&root[nodeType]!==9&&dividedTokens&&/^[+~]$/.test(dividedTokens[dividedTokens.length-1])?function(r){while(root=root.nextSibling){root[nodeType]==1&&(intr[1]?intr[1]==root[tagName].toLowerCase():1)&&(r[r.length]=root)}return r}([]):root[byTag](intr[1]||"*");for(i=0,l=els.length;i<l;i++){if(item=interpret.apply(els[i],intr))r[r.length]=item}if(!tokens.length)return r;each(r,function(e){if(ancestorMatch(e,tokens,dividedTokens))ret[ret.length]=e});return ret}function is(el,selector,root){if(isNode(selector))return el==selector;if(arrayLike(selector))return!!~flatten(selector).indexOf(el);var selectors=selector.split(","),tokens,dividedTokens;while(selector=selectors.pop()){tokens=tokenCache.g(selector)||tokenCache.s(selector,selector.split(tokenizr));dividedTokens=selector.match(dividers);tokens=tokens.slice(0);if(interpret.apply(el,q(tokens.pop()))&&(!tokens.length||ancestorMatch(el,tokens,dividedTokens,root))){return true}}return false}function ancestorMatch(el,tokens,dividedTokens,root){var cand;function crawl(e,i,p){while(p=walker[dividedTokens[i]](p,e)){if(isNode(p)&&interpret.apply(p,q(tokens[i]))){if(i){if(cand=crawl(p,i-1,p))return cand}else return p}}}return(cand=crawl(el,tokens.length-1,el))&&(!root||isAncestor(cand,root))}function isNode(el,t){return el&&typeof el==="object"&&(t=el[nodeType])&&(t==1||t==9)}function uniq(ar){var a=[],i,j;o:for(i=0;i<ar.length;++i){for(j=0;j<a.length;++j)if(a[j]==ar[i])continue o;a[a.length]=ar[i]}return a}function arrayLike(o){return typeof o==="object"&&isFinite(o.length)}function normalizeRoot(root){if(!root)return doc;if(typeof root=="string")return qwery(root)[0];if(!root[nodeType]&&arrayLike(root))return root[0];return root}function byId(root,id,el){return root[nodeType]===9?root.getElementById(id):root.ownerDocument&&((el=root.ownerDocument.getElementById(id))&&isAncestor(el,root)&&el||!isAncestor(root,root.ownerDocument)&&select('[id="'+id+'"]',root)[0])}function qwery(selector,_root){var m,el,root=normalizeRoot(_root);if(!root||!selector)return[];if(selector===window||isNode(selector)){return!_root||selector!==window&&isNode(root)&&isAncestor(selector,root)?[selector]:[]}if(selector&&arrayLike(selector))return flatten(selector);if(m=selector.match(easy)){if(m[1])return(el=byId(root,m[1]))?[el]:[];if(m[2])return arrayify(root[byTag](m[2]));if(hasByClass&&m[3])return arrayify(root[byClass](m[3]))}return select(selector,root)}function collectSelector(root,collector){return function(s){var oid,nid;if(splittable.test(s)){if(root[nodeType]!==9){if(!(nid=oid=root.getAttribute("id")))root.setAttribute("id",nid="__qwerymeupscotty");s='[id="'+nid+'"]'+s;collector(root.parentNode||root,s,true);oid||root.removeAttribute("id")}return}s.length&&collector(root,s,false)}}var isAncestor="compareDocumentPosition"in html?function(element,container){return(container.compareDocumentPosition(element)&16)==16}:"contains"in html?function(element,container){container=container[nodeType]===9||container==window?html:container;return container!==element&&container.contains(element)}:function(element,container){while(element=element.parentNode)if(element===container)return 1;return 0},getAttr=function(){var e=doc.createElement("p");return(e.innerHTML='<a href="#x">x</a>')&&e.firstChild.getAttribute("href")!="#x"?function(e,a){return a==="class"?e.className:a==="href"||a==="src"?e.getAttribute(a,2):e.getAttribute(a)}:function(e,a){return e.getAttribute(a)}}(),hasByClass=!!doc[byClass],hasQSA=doc.querySelector&&doc[qSA],selectQSA=function(selector,root){var result=[],ss,e;try{if(root[nodeType]===9||!splittable.test(selector)){return arrayify(root[qSA](selector))}each(ss=selector.split(","),collectSelector(root,function(ctx,s){e=ctx[qSA](s);if(e.length==1){result[result.length]=e.item(0)}else if(e.length){result=result.concat(arrayify(e))}}));return ss.length>1&&result.length>1?uniq(result):result}catch(ex){}return selectNonNative(selector,root)},selectNonNative=function(selector,root){var result=[],items,m,i,l,r,ss;selector=selector.replace(normalizr,"$1");if(m=selector.match(tagAndOrClass)){r=classRegex(m[2]);items=root[byTag](m[1]||"*");for(i=0,l=items.length;i<l;i++){if(r.test(items[i].className))result[result.length]=items[i]}return result}each(ss=selector.split(","),collectSelector(root,function(ctx,s,rewrite){r=_qwery(s,ctx);for(i=0,l=r.length;i<l;i++){if(ctx[nodeType]===9||rewrite||isAncestor(r[i],root))result[result.length]=r[i]}}));return ss.length>1&&result.length>1?uniq(result):result},configure=function(options){if(typeof options[useNativeQSA]!=="undefined")select=!options[useNativeQSA]?selectNonNative:hasQSA?selectQSA:selectNonNative};configure({useNativeQSA:true});qwery.configure=configure;qwery.uniq=uniq;qwery.is=is;qwery.pseudos={};return qwery}SinaEditor.regist("DOMUtil",function(SE){var Util=SE.Util,dtd=SE.dtd,env=SE.env;var hasContain=!!document.createElement("div").contains;function DOMUtil(doc,win,body){var self=this;self.doc=doc||document;self.win=win||window;self.body=body||self.doc.body;self.dtd=dtd;self.qwery=qwery();self.isBlock=function(node){return dtd.$block[node.nodeName.toLowerCase()]}}DOMUtil.prototype={constructor:DOMUtil,isIE:env.$msie,dtd:dtd,$:function(selector,root){var root=root||this.body||this.doc;return this.qwery(selector,root)},append:function(child,parent){return parent.appendChild(child)},getNodes:function(selector,root){var root=root||this.body||this.doc,match,simpleReg=/^#([\w\-]+)$|^\.([\w\-]+)$|^([\w\-]+)|^([\[\w\-\]]+)$/;if(match=simpleReg.exec(selector)){if(match[1]){return this.doc.getElementById(match[1])}else if(match[2]){return this.__getByCls(match[2],root)}else if(match[3]){return root.getElementsByTagName(match[3])}else if(match[4]){return this.__getByAttr(match[4],root)}}},attr:function(el,name,value){if(!this.isNode(el)&&11!=el.nodeType){return undefined}if("undefined"===typeof value){switch(name){case"id":value=el.id;break;case"className":case"class":value=el.className;break;case"style":cssText=el.style.cssText;break;case"innerHTML":case"value":value=el[name];break;default:value=el.getAttribute&&el.getAttribute(name)}return value}else{switch(name){case"id":el.id=value;break;case"className":case"class":el.className=value;break;case"style":if("string"===typeof value){el.style.cssText=el.style.cssText+";"+value}else{this.setStyle(el,value)}break;case"innerHTML":el[name]=value;break;case"value":el.value=value;break;default:el.setAttribute(name,value)}}return this},removeAttr:function(el,attrName){var elems,self=this;if("length"in el){elems=el}else{elems=[el]}self.each(elems,function(i,el){if(!Util.isArray(attrName)){attrName=[attrName]}self.each(attrName,function(i,attr){el.removeAttribute(attr)})})},attrs:function(el,attrs){for(var attr in attrs){if(attrs.hasOwnProperty(attr)){this.attr(el,attr,attrs[attr])}}return this},setStyle:function(){var env=SinaEditor.env;var belowIE9=env.$msie&&env.version<9;var styleFloat=belowIE9?"styleFloat":"cssFloat";var opacity=belowIE9?function(el,val){el.style.filter="alpha(opacity="+val*100+")";if(!el.currentStyle||!el.currentStyle.hasLayout){el.style.zoom=1}}:function(el,val){el.style.opacity=val};return function(el,style){var self=this;if("length"in el){self.each(el,function(i,node){self.setStyle(node,style)})}else{self.each(style,function(styleName,val){var arr;if((arr=styleName.split("-"))&&1<arr.length){styleName=arr[0];for(var i=1;i<arr.length;i++){styleName+=arr[i].charAt(0).toUpperCase()+arr[i].substring(1)}}switch(styleName){case"opacity":opacity(el,val);break;case"float":styleName="float";default:try{el.style[styleName]=val}catch(e){}}})}return this}}(),getStyle:function(){var env=SinaEditor.env;var belowIE9=env.$msie&&env.version<9;var changeProperty=function(p){var arr;if((arr=p.split("-"))&&1<arr.length){p=arr[0];for(var i=1;i<arr.length;i++){p+=arr[i].charAt(0).toUpperCase()+arr[i].substring(1)}}return p};if(belowIE9){return function(el,property){var self=this,cssValue,cssText,css=property;property=changeProperty(property);switch(property){case"opacity":var val=100;try{val=el.filters["DXImageTransform.Microsoft.Alpha"].opacity}catch(e){try{val=el.filters("alpha").opacity}catch(e){}}cssValue=val/100;break;case"float":property="styleFloat";default:var value=el.currentStyle?el.currentStyle[property]:null;cssValue=el.style[property]||value}if(!cssValue&&(cssText=el.style.cssText)){var reg=new RegExp(css+":[ ]*([^;]+)","i");cssValue=cssText.match(reg);cssValue=cssValue?cssValue[1]:undefined}return cssValue}}else{return function(el,property){var self=this;property=changeProperty(property);if(property=="float"){property="cssFloat"}try{var computed=self.doc.defaultView.getComputedStyle(el,"")}catch(e){}return el.style[property]||(computed?computed[property]:null)}}}(),setCSSText:function(el,cssText){function upperToHorizontalLineAndLower(text){text=text.replace(/([A-Z])/g,function(match){return"-"+match.toLowerCase()});return text}if("object"===typeof cssText){var css=[];var env=SinaEditor.env;var belowIE9=env.$msie&&env.version<9;this.each(cssText,function(p,val){switch(p){case"styleFloat":case"cssFloat":p="float";break;case"opacity":if(belowIE9){p="filter";val="alpha(opacity="+val*100+")"}break}css.push(upperToHorizontalLineAndLower(p),":",val,";")});cssText=css.join("")}el.style.cssText=cssText},getStart:function(rng){var start=rng.startContainer,startOffset=rng.startOffset;if(start.nodeType!==1){return start}else if(start.childNodes.length>startOffset){return start.childNodes.item(startOffset)}else{return start}},getEnd:function(rng){var end=rng.endContainer;var returnObj;if(1===end.nodeType&&(returnObj=end.childNodes[rng.endOffset-1])){return returnObj}else{return end}},toArray:function(arr){var resultArr=[];if(!this.isNode(arr)){if("length"in arr){for(var i=0,l=arr.length;i<l;i++){resultArr[i]=arr[i]}}else{for(var i in arr){resultArr[i]=arr[i]}}}else{resultArr.push(arr)}return resultArr},isNode:function(node){return node&&node.nodeName&&(node.nodeType==1||node.nodeType==11||node.nodeType==3)},__getByCls:function(cls,root){var children,resultArr=[],hasByCls=!!this.doc.getElementsByClassName;if(hasByCls){return root.getElementsByClassName(cls)}else{children=root.getElementsByTagName("*");this.each(children,function(index,elem){if(elem.className.indexOf(cls)>=0){resultArr.push(elem)}},true);return resultArr}},__getByAttr:function(str,root){var children,resultArr=[];children=this.toArray(root.getElementsByTagName("*"));var attr=attr.replace(/\[|\]/g,"").split("=");if(attr.length===1){this.each(children,function(index,elem){if(elem.getAttribute(attr[0])){resultArr.push(elem)}})}else if(attr.length===2){this.each(children,function(index,elem){if(elem.getAttribute(attr[0])===attr[1]){resultArr.push(elem)}})}return resultArr},getCommonAncestor:function(nodeA,nodeB){if(!nodeA||!nodeB){return}if(nodeA==nodeB){return nodeA}if(nodeA.nodeType==3){nodeA=nodeA.parentNode}if(nodeB.nodeType==3){nodeB=nodeB.parentNode}var method="compareDocumentPosition",bitmask=16;if(hasContain){method="contains";bitmask=1}while(nodeA){if((nodeA[method](nodeB)&bitmask)!==bitmask){nodeA=nodeA.parentNode;continue}else{return nodeA}}return undefined},treeWalker:function(start,root,filter,walkParent){var root=root||this.body||this.doc.body;var Walker=function(start,root,filter,walkParent){var node=start,__findSibling=function(node,root,start_name,sibling_name,shallow,filter){var sibling,parent,tmpNode;filter=filter||function(node){return!!node};if(node){tmpNode=node[start_name];if(!shallow&&tmpNode){if(false!==filter(tmpNode)){return tmpNode}else{return __findSibling(tmpNode,root,start_name,sibling_name,shallow,filter)}}if(node!==root){sibling=node[sibling_name];if(sibling&&false!==filter(sibling)){return sibling}while((parent=node.parentNode)&&parent!=root){while(sibling=parent[sibling_name]){if(sibling&&false!==filter(sibling)){return sibling}else{parent=sibling}}node=parent}}}};this.current=function(){return node},this.next=function(shallow){var nextNode=__findSibling(node,root,"firstChild","nextSibling",shallow,filter);if(nextNode){node=nextNode}return nextNode},this.prev=function(shallow){var prevNode=__findSibling(node,root,"lastChild","previousSibling",shallow,filter);if(prevNode){node=prevNode}return prevNode}};return new Walker(start,root,filter,walkParent)},findAllTextNodes:function(start,end,ancestor){function getTextNodes(walker,end,nodes){var current=walker.current();while(current){if(3===current.nodeType){nodes.push(current)}if(end==current){break}current=walker.next()}return nodes}ancestor=ancestor||this.body;var walker=this.treeWalker(start,ancestor),nodes=[];nodes=getTextNodes(walker,end,nodes);if(1===end.nodeType){walker=this.treeWalker(end.firstChild,end);nodes=getTextNodes(walker,end,nodes)}return nodes},addClass:function(elem,cls){if(!elem||!cls){return false}if(!this.hasClass(elem,cls)){elem.className+=" "+cls}return elem},delClass:function(elem,cls){if(!elem||!cls){return false}if(this.hasClass(elem,cls)){elem.className=Util.trim(elem.className.replace(cls,""))}return elem},hasClass:function(elem,cls){if(!elem||!cls){return false}var classReg=new RegExp("(^|\\s+)"+cls+"(\\s+|$)","g");return classReg.test(elem.className)},each:function(arr,fun,deep){if(!arr){return}if("length"in arr){var i=0,len=arr.length,isBreak;for(;i<len;i++){if(this.isNode(arr[i])){isBreak=fun.call(arr[i],i,arr[i],arr);if(false===isBreak){break}deep?forEach(arr[i].children,fun,deep):this.__emptyFun}else{isBreak=fun.call(arr[i],i,arr[i],arr);if(false===isBreak){break}}}return arr}else{for(var p in arr){if(arr.hasOwnProperty(p)){fun.call(arr[p],p,arr[p],arr)}}return arr}},__emptyFun:function(){},contains:function(srcElement,desElement){if(!srcElement||!desElement){return false}var result=this.getNodePosition(srcElement,desElement);return!!(result&16)||result===0},isSpecificParent:function(elem,tags,beSelf){var pNode,pTag,tt,self=this;if(elem&&tags){if(typeof tags==="string"){tags=tags.split(",")}else if(tags.length===undefined){tags=this.toArray(tags)}pNode=beSelf&&elem.nodeType==1?elem:elem.parentNode;while(pNode&&pNode!==this.body){pTag=pNode.nodeName.toLowerCase();for(var i=0,l=tags.length;i<l;i++){var tag=tags[i];if(typeof tag!=="string"){if(self.isSameElement(tag,pNode)){return pNode}continue}tt=tags[i].toLowerCase();if(tt===pTag){return pNode}}pNode=pNode.parentNode}return false}},remove:function(node,keepChild){if(!node.parentNode){return false}if(keepChild){while(node.firstChild){node.parentNode.insertBefore(node.firstChild,node)}}return node.parentNode.removeChild(node)},parentUntilBody:function(elem){if(elem.nodeType==9){return elem}var pNode=elem;if(pNode==this.body){return pNode}while(pNode){if(pNode==this.body){return pNode}else{pNode=pNode.parentNode}}return null},prev:function(elem){return this.__findNode(elem,"previousSibling")},next:function(elem){return this.__findNode(elem,"nextSibling")},__findNode:function(elem,dir){var node=elem[dir];while(node&&node.nodeType!==1){node=node[dir]}return node||null},createText:function(txt){return this.doc.createTextNode(txt)},createFragment:function(){return this.doc.createDocumentFragment()},setAttributes:function(node,attrs){var self=this;self.each(attrs,function(attr,value){self.attr(node,attr,value)});return node},create:function(name,attrs,html){var self=this,el=self.doc.createElement(name);if(attrs){self.attrs(el,attrs)}if("string"===typeof html){el.innerHTML=html}return el},createCSSClass:function(selector,style){function getHeads(){return doc.getElementsByTagName("head")}var doc=this.document,styleSheet,mediaType,heads;if(!doc.styleSheets){return}heads=getHeads();if(heads.length==0){return}if(doc.styleSheets.length>0){for(i=0;i<doc.styleSheets.length;i++){if(doc.styleSheets[i].disabled){continue}var media=doc.styleSheets[i].media;mediaType=typeof media;if(mediaType=="string"){if(media==""||media.indexOf("screen")!=-1){styleSheet=doc.styleSheets[i]}}else if(mediaType=="object"){if(media.mediaText==""||media.mediaText.indexOf("screen")!=-1){styleSheet=doc.styleSheets[i]}}if(typeof styleSheet!="undefined"){break}}}if(typeof styleSheet=="undefined"){var styleSheetElement=doc.createElement("style");styleSheetElement.type="text/css";heads[0].appendChild(styleSheetElement);for(i=0;i<doc.styleSheets.length;i++){if(doc.styleSheets[i].disabled){continue}styleSheet=doc.styleSheets[i]}var media=styleSheet.media;mediaType=typeof media}if(mediaType=="string"){for(i=0;i<styleSheet.rules.length;i++){if(styleSheet.rules[i].selectorText.toLowerCase()==selector.toLowerCase()){styleSheet.rules[i].style.cssText=style;return}}styleSheet.addRule(selector,style)}else if(mediaType=="object"){for(i=0;i<styleSheet.cssRules.length;i++){if(styleSheet.cssRules[i].selectorText.toLowerCase()==selector.toLowerCase()){styleSheet.cssRules[i].style.cssText=style;return}}styleSheet.insertRule(selector+"{"+style+"}",0)}},createElementByHTML:function(html){var tmpDiv=this.doc.createElement("div");tmpDiv.innerHTML=html;var frag=this.createFragment();this.each(tmpDiv.childNodes,function(i,el){frag.appendChild(el)});tmpDiv=null;return frag},getWin:function(doc){doc=doc||this.doc;return doc.defaultView||doc.parentWindow},html:function(elem,str){if(!elem){return}if(typeof str!=undefined&&typeof str=="string"){elem.innerHTML=str;return elem}else{return elem.innerHTML}},parents:function(elem,count){var resultArr=[];var isCount=typeof count==="number";var pNode=count===true?elem:elem.parentNode;while(pNode&&pNode!=this.body){if(isCount){if(count===0){return resultArr}count--}resultArr.push(pNode);pNode=pNode.parentNode}return resultArr},splitText:function(node,index){var newNode=node.cloneNode(false);newNode.deleteData(index,node.length);node.deleteData(0,index);this.insertBefore(newNode,node);return node},getIndexByChild:function(elem){if(!elem||!elem.parentNode){}var parent=elem.parentNode,i=-1,childNodes=parent.childNodes;for(var l=childNodes.length-1;i<l;i++){if(elem===childNodes[i]){break}}return i},text:function(el,text){var hasText="string"===typeof text;if("textContent"in el){hasText&&(el.textContent=text);return el.textContent}else{hasText&&(el.innerText=text);return el.innerText}},on:function(elem,type,fn,capture,selector){if(!elem){return this}var me=this;var bind=function(el){var types=type.split(" "),pre="",method="addEventListener";if(!(method in el)){method="attachEvent";pre="on"}capture=capture||false;me.each(types,function(idx,type){if(selector===undefined){el[method](pre+type,function(evt){var e=me.fixEvent(evt);fn.call(el,e)},capture)}else{el[method](pre+type,me.delegate(selector,function(evt){var e=me.fixEvent(evt);fn.call(this,e)},el))}})};if(Util.isArray(elem)||elem.length&&elem.item){me.each(elem,function(i,el){bind(el)})}else{bind(elem)}return this},delegate:function(selector,fn,el){var _this=this;var findTarget=function(target,root){var i,array=_this.$(selector,root);for(;target&&target!==root;target=target.parentNode){for(i=array.length;i--;){if(array[i]===target)return target}}};return function(e){var e=_this.fixEvent(e);var target=findTarget(e.target,el);if(target){fn.apply(target,arguments)}}},off:function(el,type,fn){var types=type.split(" "),pre="",method="removeEventListener";if(!(method in el)){method="detachEvent";pre="on"}this.each(types,function(idx,type){el[method](pre+type,fn)});return this},fixEvent:function(e){e=e||this.win.event;if(!e.target){e.target=e.srcElement}if(!e.stopPropagation){e.stopPropagation=function(){e.cancelBubble=true}}if(!e.preventDefault){e.preventDefault=function(){e.returnValue=false}}if(!e.stop){e.stop=function(){e.stopPropagation();e.preventDefault()}}if(SE.env.$msie&&9>SE.env.version){if("mouseover"==e.type){e.relatedTarget=e.fromElement}else if("mouseout"==e.type){e.relatedTarget=e.toElement}}return e},getPos:function(el){if((el.parentNode==null||el.offsetParent==null||el.style.display=="none")&&el!=document.body){return false}var parentNode=null;var pos=[];var box;var doc=el.ownerDocument;pos=[el.offsetLeft,el.offsetTop];parentNode=el.offsetParent;var hasAbs=el.style.position=="absolute";if(parentNode!=el){while(parentNode){pos[0]+=parentNode.offsetLeft;pos[1]+=parentNode.offsetTop;if(!hasAbs&&parentNode.style.position=="absolute"){hasAbs=true}parentNode=parentNode.offsetParent}}parentNode=el.parentNode;while(parentNode.tagName&&!/^body|html$/i.test(parentNode.tagName)){if(parentNode.style.display.search(/^inline|table-row.*$/i)){pos[0]-=parentNode.scrollLeft;pos[1]-=parentNode.scrollTop}parentNode=parentNode.parentNode}return{left:pos[0],top:pos[1]}},getRect:function(el){var rect=el.getBoundingClientRect();if(!("width"in rect)){rect={bottom:rect.bottom,left:rect.left,right:rect.right,top:rect.top,width:el.offsetWidth,height:el.offsetHeight}}return rect},insertBefore:function(newElement,referenceElement){var pn=referenceElement.parentNode;return pn.insertBefore(newElement,referenceElement)},insertAfter:function(newElement,referenceElement){var pn=referenceElement.parentNode;var node=referenceElement.nextSibling;if(node){return this.insertBefore(newElement,node)}else{return pn.appendChild(newElement)}},insertNode:function(newElement,referenceElement,where){var self=this;where=where.toLowerCase()||"beforeend";switch(where){case"beforebegin":return self.insertBefore(newElement,referenceElement);case"afterbegin":if(!referenceElement.firstChild){return self.append(newElement,referenceElement)}else{return self.insertBefore(newElement,referenceElement.firstChild)}case"beforeend":if(!referenceElement.lastChild){return self.append(newElement,referenceElement)}else{return self.insertAfter(newElement,referenceElement.lastChild)}case"afterend":return self.insertAfter(newElement,referenceElement)}},filterNodeList:function(nodelist,filter,forAll){var results=[];if(typeof filter!="function"){var str=filter;filter=function(n){return Util.inArray(str.length!==undefined?str:str.split(" "),n.tagName.toLowerCase())}}this.each(nodelist,function(i,n){filter(n)&&results.push(n)});return results.length==0?null:results.length==1||!forAll?results[0]:results},getElementPath:function(rng){var start=rng.startContainer,offset=rng.startOffset;if(start.nodeType==1&&start.childNodes.length>0){start=start.childNodes[offset]||start}return this.parents(start,!0)},isSamePath:function(pathA,pathB){var lenA=pathA.length,lenB=pathB.length,nodeA,nodeB;if(lenA!=lenB){return false}if(0===lenB||0==lenA){return false}var isSame=!1;for(var i=0;i<lenA;i++){nodeA=pathA[i];nodeB=pathB[i];if(3==nodeA.nodeType&&3==nodeB.nodeType&&nodeB.nodeValue==nodeA.nodeValue){isSame=true;continue}else{isSame=this.isSameElement(nodeA,nodeB)}if(!isSame){return false}}return isSame},getFilterTreeDom:function(node,root,filter,flag,guard){var root=root||this.body||this.doc;var tmpNode=flag&&node.firstChild,parent;!tmpNode&&(tmpNode=node.nextSibling);while(!tmpNode&&(parent=(parent||node).parentNode)){if(parent.tagName=="BODY"||parent==root||guard&&!guard(parent)){return null}tmpNode=parent.nextSibling}if(tmpNode&&filter&&!filter(tmpNode)){return this.getFilterTreeDom(tmpNode,false,filter,flag,guard)}return tmpNode},isBookMarkTag:function(node){return node&&node.nodeType==1&&node.tagName=="SPAN"&&node.getAttribute("bookmarkTag")},isEmptyInlineElement:function(node){if(node.nodeType!=1||!dtd.$removeEmpty[node.tagName]){return 0}node=node.firstChild;while(node){if(this.isBookMarkTag(node)){return 0}if(node.nodeType==1&&!this.isEmptyInlineElement(node)||node.nodeType==3&&!!SinaEditor.noSpaceReg.test(node.nodeValue)){return 0}node=node.nextSibling}return 1},clearSpecialNode:function(node,ignoreNext,ignorePre){var self=this;function clear(next,dir){var tmpNode;while(next&&!self.isBookMarkTag(next)&&(self.isEmptyInlineElement(next)||!new RegExp(/[^\t\n\r\u200B\uFEFF]/.test(next.nodeValue)))){tmpNode=next[dir];self.remove(next);next=tmpNode}}!ignoreNext&&clear(node.nextSibling,"nextSibling");!ignorePre&&clear(node.previousSibling,"previousSibling")},cssStyleToDomStyle:function(){var test=document.createElement("div").style,cache={"float":test.cssFloat!=undefined?"cssFloat":test.styleFloat!=undefined?"styleFloat":"float"};return function(cssName){return cache[cssName]||(cache[cssName]=cssName.toLowerCase().replace(/-./g,function(match){return match.charAt(1).toUpperCase()}))}}(),getNodePosition:function(nodeA,nodeB){if(nodeA===nodeB){return 0}if(nodeA.compareDocumentPosition){return nodeA.compareDocumentPosition(nodeB)}var node,parentsA=[nodeA],parentsB=[nodeB];node=nodeA;while(node=node.parentNode){if(node===nodeB){return 10}parentsA.push(node)}node=nodeB;while(node=node.parentNode){if(node===nodeA){return 20}parentsB.push(node)}parentsA.reverse();parentsB.reverse();if(parentsA[0]!==parentsB[0])return 1;var i=-1;while(i++,parentsA[i]===parentsB[i]);nodeA=parentsA[i];nodeB=parentsB[i];while(nodeA=nodeA.nextSibling){if(nodeA===nodeB){return 4}}return 2},isSameStyle:function(nodeA,nodeB,noStrict){var styleA=nodeA.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":"),styleB=nodeB.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":");if(window.opera&&window.opera.version){styleA=nodeA.style;styleB=nodeB.style;if(styleA.length!=styleB.length)return false;for(var p in styleA){if(/^(\d+|csstext)$/i.test(p)){continue}if(styleA[p]!=styleB[p]){return false}}return true}if(!styleA||!styleB){return styleA==styleB}styleA=styleA.split(";");styleB=styleB.split(";");if(styleA.length!=styleB.length&&!noStrict){return false}for(var i=0,ci;ci=styleA[i++];){if(!Util.inArray(styleB,ci)){return false}}return true},isSameElement:function(nodeA,nodeB){var ie=this.isIE;if(3==nodeA.nodeType&&3==nodeB.nodeType){if(3!==nodeB.nodeType){return false}if(nodeA!==nodeB){return false}return true}if(nodeA.tagName!=nodeB.tagName){return false}var thisAttrs=nodeA.attributes,otherAttrs=nodeB.attributes;if(!(thisAttrs&&thisAttrs)){return false}if(!ie&&thisAttrs.length!=otherAttrs.length){return false}var attrA,attrB,al=0,bl=0;for(var i=0;attrA=thisAttrs[i++];){if(attrA.nodeName=="style"){if(attrA.specified){al++}if(this.isSameStyle(nodeA,nodeB)){continue}else{return false}}if(ie){if(attrA.specified){al++;attrB=otherAttrs.getNamedItem(attrA.nodeName)}else{continue}}else{attrB=nodeB.attributes[attrA.nodeName]}if(!attrB.specified||attrA.value!=attrB.value){return false}}if(ie){for(i=0;attrB=otherAttrs[i++];){if(attrB.specified){bl++}}if(al!=bl){return false}}return true},trimWhiteTextNode:function(node){function remove(dir){var child;while((child=node[dir])&&child.nodeType==3&&!SinaEditor.noSpaceReg.test(child.nodeValue)){node.removeChild(child)}}remove("firstChild");remove("lastChild")},mergeSibling:function(node,ignorePre,ignoreNext){var self=this;function merge(rtl,start,node){var next;if((next=node[rtl])&&!self.isBookMarkTag(next)&&next.nodeType==1&&self.isSameElement(node,next)){while(next.firstChild){if(start=="firstChild"){node.insertBefore(next.lastChild,node.firstChild)}else{node.appendChild(next.firstChild)}}self.remove(next)}}!ignorePre&&merge("previousSibling","firstChild",node);!ignoreNext&&merge("nextSibling","lastChild",node)},mergeChild:function(node,tagName,attrs){var self=this;var list=node.getElementsByTagName(node.tagName.toLowerCase());for(var i=0,ci;ci=list[i++];){if(!ci.parentNode||self.isBookMarkTag(ci)){continue}if(ci.tagName.toLowerCase()=="span"){if(node===ci.parentNode){self.trimWhiteTextNode(node);if(node.childNodes.length==1){node.style.cssText=ci.style.cssText+";"+node.style.cssText;if(ci.parentNode){while(ci&&ci.firstChild){ci.parentNode.insertBefore(ci.firstChild,ci)}}self.remove(ci);continue}}ci.style.cssText=node.style.cssText+";"+ci.style.cssText;if(attrs){var style=attrs.style;if(style){style=style.split(";");for(var j=0,s;s=style[j++];){ci.style[self.cssStyleToDomStyle(s.split(":")[0])]=s.split(":")[1]}}}if(self.isSameStyle(ci,node)){if(ci.parentNode){while(ci&&ci.firstChild){ci.parentNode.insertBefore(ci.firstChild,ci)}}self.remove(ci)}continue}if(self.isSameElement(node,ci)){if(ci.parentNode){while(ci&&ci.firstChild){ci.parentNode.insertBefore(ci.firstChild,ci)
}}self.remove(ci)}}},mergeToParent:function(node){var parent=node.parentNode,self=this;while(parent&&dtd.$removeEmpty[parent.tagName]){if(parent.tagName==node.tagName||parent.tagName=="A"){self.trimWhiteTextNode(parent);if(parent.tagName=="SPAN"&&!self.isSameStyle(parent,node)||parent.tagName=="A"&&node.tagName=="SPAN"){if(parent.childNodes.length>1||parent!==node.parentNode){parent=parent.parentNode;continue}else{if(parent.tagName=="A"){}}}if(parent.tagName!="A"){if(parent===node.parentNode){while(node&&node.firstChild){node.parentNode.insertBefore(node.firstChild,node)}self.remove(node)}break}}parent=parent.parentNode}},copyAttrs:function(nodeA,nodeB){var self=this;var cssText=nodeB.style.cssText;var attributes=nodeA.attributes;if(attributes){if(SinaEditor.env.$msie&&SinaEditor.env.version<9){attributes=[];var html=nodeA.outerHTML;html.replace(/\s+([a-z0-9]+)(=['"]?([^='"\s>]+)['"]?(?=>|\s+?))?/gi,function(a,b,c,d){if(b!="bookmarkTag"&&b!="style"){attributes.push({nodeType:2,value:d,nodeName:b})}})}if(attributes.length==0){return nodeB}var attrs={};self.each(attributes,function(i,n){if(n&&n.nodeType==2){attrs[n.nodeName]=n.value}});self.setAttributes(nodeB,attrs)}if(cssText){self.setAttributes(nodeB,{style:cssText})}return nodeB},removeToAllChilds:function(nodeA,nodeB){if(nodeA.nodeType==1&&nodeA.childNodes.length>0){while(nodeA.firstChild){nodeB.appendChild(nodeA.firstChild)}}return nodeB},mergeTextNode:function(txtNode){if(txtNode.nodeType!=3){return}var self=this;function merge(node,ltr){while(node[ltr]&&node[ltr].nodeType==3){if(ltr=="previousSibling"){node.insertData(0,node[ltr].nodeValue)}else{node.appendData(node[ltr].nodeValue)}self.remove(node[ltr])}}merge(txtNode,"previousSibling");merge(txtNode,"nextSibling");return txtNode},hover:function(el,enterFunc,leaveFunc,selector){var self=this;function withInElement(evt,elem,func,type){var parent=evt.relatedTarget;try{if(parent&&parent!==self.doc&&!parent.parentNode){return}while(parent&&parent!==elem){parent=parent.parentNode}if(parent!==elem){func.apply(elem,[evt,elem])}}catch(e){}}function findTarget(el,target){var elem;if(selector){var elemArr=self.$(selector,el);var parents=self.parents(target,true);self.each(elemArr,function(i,child){self.each(parents,function(j,t){if(t==child){elem=child;return false}});if(elem){return false}})}else{elem=el}return elem}enterFunc&&self.on(el,"mouseover",function(evt){evt=self.fixEvent(evt);var target=evt.target;var elem=findTarget(el,target);withInElement(evt,elem,enterFunc,"enter")},false,selector);leaveFunc&&self.on(el,"mouseout",function(evt){evt=self.fixEvent(evt);var target=evt.target;var elem=findTarget(el,target);withInElement(evt,elem,leaveFunc,"leave")},false,selector);return self},breakParent:function(node,parent){var tmpNode,parentClone=node,clone=node,leftNodes,rightNodes;do{parentClone=parentClone.parentNode;if(leftNodes){tmpNode=parentClone.cloneNode(false);tmpNode.appendChild(leftNodes);leftNodes=tmpNode;tmpNode=parentClone.cloneNode(false);tmpNode.appendChild(rightNodes);rightNodes=tmpNode}else{leftNodes=parentClone.cloneNode(false);rightNodes=leftNodes.cloneNode(false)}while(tmpNode=clone.previousSibling){leftNodes.insertBefore(tmpNode,leftNodes.firstChild)}while(tmpNode=clone.nextSibling){rightNodes.appendChild(tmpNode)}clone=parentClone}while(parent!==parentClone);tmpNode=parent.parentNode;tmpNode.insertBefore(leftNodes,parent);tmpNode.insertBefore(rightNodes,parent);tmpNode.insertBefore(node,rightNodes);this.remove(parent);return node},scrollTop:function(top){var doc=this.doc;if(undefined==top){return doc.body.scrollTop+doc.documentElement.scrollTop}else{doc.documentElement.scrollTop=top;doc.body.scrollTop=top}return top}};return DOMUtil});SinaEditor.regist("Range",function(){var SE=SinaEditor,$dtd=SE.dtd,env=SE.env,Util=SE.Util;function Range(doc,editor){var range=this;range.domUtil=editor.domUtil;range.editor=editor;range.doc=doc;range.collapsed=true;range.bookmarkList=[];range.skipSign=editor.holder}Range.prototype={constructor:Range,domUtil:null,doc:null,startContainer:null,startOffset:null,endContainer:null,endOffset:null,bookmarkList:[],collapsed:true,collapse:function(toStart){var range=this;if(toStart){range.endContainer=range.startContainer;range.endOffset=range.startOffset}else{range.startContainer=range.endContainer;range.startOffset=range.endOffset}range.collapsed=true;return range},cloneContents:function(){return this.__proccessContents(0)},deleteContents:function(){var self=this;self.__proccessContents(1);self.select(true);return self},extractContents:function(){return this.__proccessContents(2)},cloneRange:function(noCache){var range=new Range(this.doc,this.editor);range.setStart(this.startContainer,this.startOffset);range.setEnd(this.endContainer,this.endOffset);return range},equals:function(rng){if(!rng){return false}var start=rng.startContainer==this.startContainer&&rng.startOffset==this.startOffset,end=rng.endContainer==this.endContainer&&rng.endOffset==this.endOffset;return start&&end},shrinkBoundary:function(ignoreEnd){var self=this,child;function check(node){return node.nodeType==1&&!self.domUtil.isBookMarkTag(node)&&!$dtd.$empty[node.tagName]&&!$dtd.$nonChild[node.tagName]}while(self.startContainer.nodeType==1&&(child=self.startContainer.childNodes[self.startOffset])&&check(child)){self.setStart(child,0)}if(self.collapsed){self.collapse(true)}if(!ignoreEnd){while(self.endContainer.nodeType==1&&self.endOffset>0&&(child=self.endContainer.childNodes[self.endOffset-1])&&check(child)){self.setEnd(child,child.childNodes.length)}}},removeNode:function(node){var domUtil=this.domUtil,parent=node.parentNode;if(!parent){return}if(!parent||node==domUtil.body){return this}var start=this.startContainer,sOffset=this.startOffset,end=this.endContainer,eOffset=this.endOffset,index=domUtil.getIndexByChild(node),currNode;if(parent==start){if(index<Math.min(sOffset,start.childNodes.length-1)){this.startOffset-=1;if(start==end){this.endOffset-=1}}}if(parent==end&&end!=start){if(index<Math.min(eOffset,end.childNodes.length-1)){this.endOffset-=1}}parent.removeChild(node);node=parent=null;return this},boundaryTxt:function(isEnd){var self=this;var flagName=isEnd?"end":"start",node=self[flagName+"Container"],offset=self[flagName+"Offset"],setAfter="set"+flagName.replace(/^(\w)/,function(a){return a.toUpperCase()})+"After",setBefore="set"+flagName.replace(/^(\w)/,function(a){return a.toUpperCase()})+"Before";if(node.nodeType!=3){return self}if(offset===0){self[setBefore](node)}else{if(offset>=node.nodeValue.length){self[setAfter](node)}else{var tNode=self.domUtil.splitText(node,offset);if(!isEnd){if(node===self.endContainer){self.setEnd(tNode,self.endOffset-offset)}else if(node.parentNode===self.endContainer){self.endOffset++}}else{self.setEndAfter(node)}self[setBefore](tNode)}}return self},insertNode:function(node){var self=this;var start=self.startContainer,offset=self.startOffset,end=self.endContainer,eOffset=self.endOffset,len=1,cNode=node;self.boundaryTxt();start=self.startContainer,offset=self.startOffset;if(node.nodeType==11){len=node.childNodes.length;if(len==0){return}cNode=node.firstChild}var child=start.childNodes[offset];if(child){start.insertBefore(node,child)}else{start.appendChild(node)}if(cNode.parentNode==self.endContainer){self.endOffset+=len}self.setStartAfter(cNode);return self},boundaryToBlock:function(){var domUtil=this.domUtil,pre,node,tmp=this.doc.createTextNode(""),node=this.startContainer;if(node.nodeType==1){if(node.childNodes[this.startOffset]){pre=node=node.childNodes[this.startOffset]}else{node.appendChild(tmp);pre=node=tmp}}else{pre=node}while(1){if(domUtil.isBlock(node)){node=pre;while((pre=node.previousSibling)&&!domUtil.isBlock(pre)){node=pre}this.setStartBefore(node);break}pre=node;node=node.parentNode}node=this.endContainer;if(node.nodeType==1){if(pre=node.childNodes[this.endOffset]){node.insertBefore(tmp,pre)}else{node.appendChild(tmp)}pre=node=tmp}else{pre=node}while(1){if(domUtil.isBlock(node)){node=pre;while((pre=node.nextSibling)&&!domUtil.isBlock(pre)){node=pre}this.setEndAfter(node);break}pre=node;node=node.parentNode}if(tmp.parentNode===this.endContainer){this.endOffset--}domUtil.remove(tmp);this.fixBoundary()},getStart:function(){var range=this;var start=range.startContainer,offset=range.startOffset;if(start.nodeType==3&&start.nodeValue.length<=offset){start=start.nextSibling||start.parentNode.nextSibling||start;offset=0}if(start.nodeType==1&&start.childNodes.length>0){start=start.childNodes[offset]||start.lastChild}return start},getEnd:function(){var range=this;var end=range.endContainer,offset=range.endOffset;if(end.nodeType==1){if(offset!=0){end=end.childNodes[offset]||end.lastChild}}return end},fixBoundary:function(){var self=this;if(!self.collapsed){while(self.startContainer!=self.domUtil.body&&self.startOffset==self.startContainer[self.startContainer.nodeType==3?"nodeValue":"childNodes"].length&&self.startContainer[self.startContainer.nodeType==3?"nodeValue":"childNodes"].length){self.setStartAfter(self.startContainer)}while(self.endContainer!=self.domUtil.body&&!self.endOffset&&self.endContainer[self.endContainer.nodeType==3?"nodeValue":"childNodes"].length){self.setEndBefore(self.endContainer)}}},insertInlineTag:function(tag,attributes,customFilter){var self=this;if(self.collapsed){return}self.shrinkBoundary();self.boundaryTxt();self.boundaryTxt(true);var self=this;while(self.startOffset==0){var start=self.startContainer;if(start.nodeType==1&&self.domUtil.isBlock(start)){break}if(start==self.domUtil.body){break}self.setStartBefore(start)}while(self.endOffset==(self.endContainer.nodeType==3?self.endContainer.nodeValue.length:self.endContainer.childNodes.length)){var end=self.endContainer;if(end.nodeType==1&&self.domUtil.isBlock(end)){break}if(end==self.domUtil.body){break}self.setEndAfter(end)}self.fixBoundary();var filter=function(node){if("function"==typeof customFilter&&!customFilter(node)){return false}var txt=node.textContent||node.innerText||"";return node.nodeType==1?!node.getAttribute(self.skipSign)&&node.tagName.toLowerCase()!="br"&&txt.length>0:!!SinaEditor.noSpaceReg.test(node.nodeValue)&&!node.parentNode.getAttribute(self.skipSign)};var bookmark=self.createBookMark();var range=self.cloneRange();var start=bookmark.start,end=bookmark.end,next=self.domUtil.getFilterTreeDom(start,null,filter,false),endNode,domList=[];while(next&&self.domUtil.getNodePosition(next,end)&4){if(next.nodeType==3||$dtd[tag][next.tagName]){range.setStartBefore(next);var tNode=next;while(tNode&&(tNode.nodeType==3||$dtd[tag][tNode.tagName])&&tNode!==end){endNode=tNode;tNode=self.domUtil.getFilterTreeDom(tNode,null,null,tNode.nodeType==1,function(node){return $dtd[tag][node.tagName]})}range.setEndAfter(endNode);var dom=range.doc.createElement(tag);self.domUtil.setAttributes(dom,attributes);var fragment=range.extractContents();dom.appendChild(fragment);domList.push(dom);range.insertNode(dom);self.domUtil.mergeSibling(dom);self.domUtil.clearSpecialNode(dom);self.domUtil.mergeChild(dom,tag,attributes);next=self.domUtil.getFilterTreeDom(dom,null,filter,false);self.domUtil.mergeToParent(dom);if(tNode===end){break}}else{next=self.domUtil.getFilterTreeDom(next,null,filter,true)}}range=null;for(var d=0;d<domList.length;d++){self.domUtil.mergeSibling(domList[d])}self.removeBookMark(bookmark);self.moveToTxtNode()},removeInlineTag:function(tags,filter,noMergeTxt){if("string"==typeof tags){tags=[tags]}var self=this;if(self.collapsed){return}self.fixBoundary();var start=self.startContainer,end=self.endContainer;while(1){if(start.nodeType==1){if(Util.inArray(tags,start.tagName.toLowerCase())){break}if(start==self.domUtil.body){start=null;break}}start=start.parentNode}while(1){if(end.nodeType==1){if(Util.inArray(tags,end.tagName.toLowerCase())){break}if(end==self.domUtil.body){end=null;break}}end=end.parentNode}var bookmark=self.createBookMark(),frag,tmpRange;if(start){tmpRange=self.cloneRange();tmpRange.setEndBefore(bookmark.start);tmpRange.setStartBefore(start);frag=tmpRange.extractContents();tmpRange.insertNode(frag);self.domUtil.clearSpecialNode(start,true);start.parentNode.insertBefore(bookmark.start,start)}if(end){tmpRange=self.cloneRange();tmpRange.setStartAfter(bookmark.end);tmpRange.setEndAfter(end);frag=tmpRange.extractContents();tmpRange.insertNode(frag);self.domUtil.clearSpecialNode(end,false,true);end.parentNode.insertBefore(bookmark.end,end.nextSibling)}var current=self.domUtil.getFilterTreeDom(bookmark.start,null,filter||function(node){return node.nodeType==1&&!node.getAttribute(self.skipSign)}),next;while(current&&current!==bookmark.end){next=self.domUtil.getFilterTreeDom(current,null,function(node){return node.nodeType==1},true);if(Util.inArray(tags,current.tagName.toLowerCase())){if(current.parentNode){while(current&&current.firstChild){current.parentNode.insertBefore(current.firstChild,current)}self.domUtil.remove(current)}}current=next}self.removeBookMark(bookmark);if(!noMergeTxt){self.moveToTxtNode()}else{self.select()}},selectNode:function(node){var self=this;self.setStartBefore(node);self.setEndAfter(node);self.select();return self},select:function(nofillChar){var self=this,editor=self.editor,domUtil=self.domUtil,doc=self.doc,w=self.domUtil.getWin(self.doc);var activeElement=doc.activeElement;try{var scrollTop=domUtil.scrollTop();if(env.$firefox&&editor.body.focus){editor.body.focus();domUtil.scrollTop(scrollTop)}else if(!activeElement||!domUtil.contains(editor.body,activeElement)){w.focus();var afterTop=domUtil.scrollTop();if(scrollTop!==afterTop){domUtil.scrollTop(scrollTop)}}}catch(e){}var selection=w.getSelection();if(selection){selection.removeAllRanges();var nativeRange=self.doc.createRange();if(self.collapsed&&self.startContainer.nodeType!==3){}fixRange(this,nofillChar);try{nativeRange.setStart(self.startContainer,self.startOffset);nativeRange.setEnd(self.endContainer,self.endOffset);selection.addRange(nativeRange)}catch(e){}}function fixRange(range,nofillChar){if(range.collapsed&&!nofillChar){var start=range.startContainer,child=start;if(start.nodeType==1){child=start.childNodes[range.startOffset]}if(!(start.nodeType==3&&range.startOffset)&&(child?!child.previousSibling||child.previousSibling.nodeType!=3:!start.lastChild||start.lastChild.nodeType!=3)){var txtNode=range.doc.createTextNode(SinaEditor.spaceChar);range.insertNode(txtNode);range.setStart(txtNode,SinaEditor.env.$webkit?1:0);range.collapse(true)}}if(range.startContainer.nodeType==1&&range.startContainer.childNodes.length<range.startOffset){range.startOffset=range.startContainer.childNodes.length}if(range.endContainer.nodeType==1&&range.endContainer.childNodes.length<range.endOffset){range.endOffset=range.endContainer.childNodes.length}if(range.startContainer.nodeType==3&&range.startContainer.nodeValue.length<range.startOffset){range.startOffset=range.startContainer.nodeValue.length}if(range.endContainer.nodeType==3&&range.endContainer.nodeValue.length<range.endOffset){range.endOffset=range.endContainer.nodeValue.length}return range}this.editor.selection.saveNative();return self},setEnd:function(node,offset){return this.relovseRange(node,offset)},setEndAfter:function(node){return this.setEnd(node.parentNode,this.domUtil.getIndexByChild(node)+1)},setEndBefore:function(node){return this.setEnd(node.parentNode,this.domUtil.getIndexByChild(node))},setStart:function(node,offset){this.relovseRange(node,offset,true)},setStartAfter:function(node){return this.setStart(node.parentNode,this.domUtil.getIndexByChild(node)+1)},setStartBefore:function(node){var index=this.domUtil.getIndexByChild(node);return this.setStart(node.parentNode,index)},getCommonAncestor:function(){var start=this.startContainer,end=this.endContainer;if(start==end){return start}else{return this.domUtil.getCommonAncestor(start,end)}},createBookMark:function(id){var rng=this;var start,end=null;var endContainer=rng.endContainer;var endOffset=rng.endOffset;start=rng.doc.createElement("span");start.style.display="none";start.setAttribute("bookmarkTag","range_bookmark_start_sign");if(id){start.id="start_"+id}if(!rng.collapsed){end=rng.doc.createElement("span");end.style.display="none";end.setAttribute("bookmarkTag","range_bookmark_end_sign");if(id){end.id="end_"+id}}if($dtd.$empty[rng.startContainer.nodeName.toLocaleLowerCase()]){}rng.insertNode(start);if(end){rng.collapse(false);rng.insertNode(end);rng.setStartAfter(start);rng.setEndBefore(end)}else{rng.collapse(true)}var bookmark={start:start,end:end};this.bookmarkList.push(bookmark);return bookmark},createBookMarkByClone:function(bid){if(!this.editor.body.parentNode||this.editor.body.parentNode.nodeType!=1){return this}if(env.$msie&&9>env.version){return{content:this.editor.body.innerHTML,body:this.editor.body,bookmark:this.createBookMark(bid),range:this,cloneRange:this}}var rng=this,startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset,domUtil=rng.domUtil,tmpStartId,tmpEndId,tmpBody,sParent,eParent,sIndex,eIndex,id;if(startContainer.nodeType==3){sParent=startContainer.parentNode;tmpStartId=sParent.getAttribute("id");sParent.setAttribute("id","bookmark_for_clone_start");sIndex=domUtil.getIndexByChild(startContainer)}else{id=startContainer.getAttribute("id");if(id){tmpStartId=id}startContainer.setAttribute("id","bookmark_for_clone_start")}if(!rng.collapsed){if(endContainer.nodeType==3){eParent=endContainer.parentNode;id=eParent.getAttribute("id");tmpEndId=id=="bookmark_for_clone_start"?"":id;eParent.setAttribute("id","bookmark_for_clone_end");eIndex=domUtil.getIndexByChild(endContainer)}else{id=endContainer.getAttribute("id");if(id!="bookmark_for_clone_start"){tmpEndId=id}endContainer.setAttribute("id","bookmark_for_clone_end")}}tmpBody=this.editor.body.cloneNode(true);this.editor.body.parentNode.insertBefore(tmpBody,this.editor.body);domUtil.remove(this.editor.body);var tmpRng=rng.cloneRange();var tmpId=sParent||startContainer;if(tmpStartId){tmpId.id=tmpStartId}else{tmpId.removeAttribute("id")}if(!this.collapsed){tmpId=eParent||endContainer;if(tmpEndId){tmpId.id=tmpEndId}else{tmpId.removeAttribute("id")}}tmpId=null;var startClone=this.doc.getElementById("bookmark_for_clone_start");if(!this.collapsed){var endClone=this.doc.getElementById("bookmark_for_clone_end")}if(!startClone&&!this.collapsed){startClone=endClone}if(tmpStartId){startClone.setAttribute("id",tmpStartId)}else{startClone.removeAttribute("id")}if(!this.collapsed){if(tmpEndId){endClone.setAttribute("id",tmpEndId)}else{endClone.removeAttribute("id")}}if(sParent){startClone=startClone.childNodes[sIndex]}if(eParent){endClone=endClone.childNodes[eIndex]}tmpRng.setStart(startClone,startOffset);if(endClone&&!this.collapsed){tmpRng.setEnd(endClone,endOffset)}else{tmpRng.collapse(true)}var tmpBookmark=tmpRng.createBookMark(bid);var content;try{content=tmpBody.innerHTML}catch(e){}eParent=sParent=null;return{content:content,body:tmpBody,bookmark:tmpBookmark,range:rng,cloneRange:rng.cloneRange()}},removeBookMark:function(bookmark){var id,range=this;if(typeof bookmark=="string"){id=bookmark;bookmark={start:this.doc.getElementById("start_"+id),end:this.doc.getElementById("end_"+id)};if(!bookmark.start){return this}}else if(bookmark===undefined&&this.bookmarkList.length>0){bookmark=this.bookmarkList.pop()}else if(!bookmark){return this}range.setStartAfter(bookmark.start);if(bookmark.end){range.setEndBefore(bookmark.end)}else{range.collapse(true)}range.removeNode(bookmark.start);if(bookmark.end){range.removeNode(bookmark.end)}bookmark.start=bookmark.end=null;return this},moveToBookMarkByClone:function(bookmark){var range=bookmark.range,cloneRange=bookmark.cloneRange;if(env.$msie&&9>env.version){this.moveToBookMark(bookmark.bookmark);return this}bookmark.body.parentNode.insertBefore(range.editor.body,bookmark.body);range.domUtil.remove(bookmark.body);bookmark.body=null;bookmark=null;range.setStart(cloneRange.startContainer,cloneRange.startOffset);range.setEnd(cloneRange.endContainer,cloneRange.endOffset);range.select(true)},moveToBookMark:function(bookmark){this.removeBookMark(bookmark).select(true)},moveToTxtNode:function(isFixBoundary,noMerge,noSelect){var collapsed=this.collapsed;var domUtil=this.domUtil,start=this.startContainer,end=this.endContainer,sOfst=this.startOffset,eOfst=this.endOffset,prev,next;var curr=start;var rng=this;if(isFixBoundary){var _end,e=this.getEnd();var filter=function(node){return node.nodeType==3&&SinaEditor.noSpaceReg.test(node.nodeValue)&&domUtil.getNodePosition(node,e)&4||e.nodeType==3&&node==e};var _start=this.getStart();if(_start.nodeType==1&&_start==start&&sOfst==_start.nodeValue.length){var tmpStart=domUtil.getFilterTreeDom(_start,null,filter,true);if(tmpStart){start=_start=tmpStart;sOfst=0}}if(!filter(_start)||!filter(e)){if(!filter(_start)){start=_start;sOfst=0;start=domUtil.getFilterTreeDom(start,null,filter,true);if(start){sOfst=0;_end=start}else{this.collapse(true);if(!noSelect){this.select(true)}return this.__fixRange()}}if(this.collapsed){this.collapse(true)}else{_end=start;var tmpEnd=null;while(_end){tmpEnd=_end;_end=domUtil.getFilterTreeDom(_end,null,filter,true)}_end=tmpEnd;tmpEnd=null;if(_end&&e!=_end){end=_end;eOfst=end.nodeValue.length}}}_end=_start=null}while(start.nodeType!=3&&start.childNodes.length>0){if(start.childNodes[sOfst]){start=start.childNodes[sOfst];sOfst=0}else{if(start.childNodes[sOfst-1]){start=start.childNodes[sOfst-1];sOfst=start.nodeType==1?start.childNodes.length:start.nodeValue.length}else{if(start.nextSibling){start=start.nextSibling;sOfst=0}else{start=start.lastChild;if(start&&start.nodeType==3){sOfst=start.nodeValue.length}else{sOfst=start.childNodes.length}}}}}if(collapsed){if(start.nodeType==3&&!noMerge){while((prev=start.previousSibling)&&start.previousSibling.nodeType==3){sOfst+=prev.nodeValue.length;start.insertData(0,prev.nodeValue);domUtil.remove(prev)}while((next=start.nextSibling)&&start.nextSibling.nodeType==3){start.appendData(next.nodeValue);domUtil.remove(next)}}this.setStart(start,sOfst);start=null;this.collapse(true);if(!noSelect){this.select(true)}return this.__fixRange()}else{while(end.nodeType!=3&&end.childNodes.length){if(end.childNodes[eOfst]){end=end.childNodes[eOfst];eOfst=0}else{end=end.lastChild;if(end.nodeType==3){eOfst=end.nodeValue.length}else{eOfst=end.childNodes.length}}if(end.previousSibling&&eOfst==0){end=end.previousSibling;if(end.nodeType==3){eOfst=end.nodeValue.length}else{eOfst=end.childNodes.length}}}if(start.nodeType==3&&!noMerge){var hasSame=false;while((prev=start.previousSibling)&&start.previousSibling.nodeType==3){sOfst+=prev.nodeValue.length;if(start==end){eOfst+=prev.nodeValue.length}start.insertData(0,prev.nodeValue);domUtil.remove(prev)}while((next=start.nextSibling)&&start.nextSibling.nodeType==3){if(next==end&&!hasSame){end=start;eOfst+=start.nodeValue.length;hasSame=true}start.appendData(next.nodeValue);domUtil.remove(next)}}if(end.nodeType==3&&end!=start){while((prev=end.previousSibling)&&end.previousSibling.nodeType==3){eOfst+=prev.nodeValue.length;end.insertData(0,prev.nodeValue);domUtil.remove(prev)}while((next=end.nextSibling)&&end.nextSibling.nodeType==3){end.appendData(next.nodeValue);domUtil.remove(next)}}this.setStart(start,sOfst);this.setEnd(end,eOfst);if(!noSelect){this.select()}else{if(this.editor.selection.saveW3CInfo){this.editor.selection.saveW3CInfo(this)}}}start=end=prev=next=null;return this.__fixRange()},surroundContents:function(){},collapseUpdate:function(){var self=this;self.collapsed=self.startContainer&&self.endContainer&&self.startContainer===self.endContainer&&self.startOffset==self.endOffset},relovseRange:function(node,offset,toStart){var _tmpName=toStart?"start":"end",_otherName=toStart?"end":"start",self=this;self[_tmpName+"Container"]=node;self[_tmpName+"Offset"]=offset;if(!self[_otherName+"Container"]){self.collapse(toStart)}self.collapseUpdate();return self},__proccessContents:function(action){var self=this,fragment=createFragment(),start=self.startContainer,end=self.endContainer,startOffset=self.startOffset,endOffset=self.endOffset,domUtil=self.domUtil,tmpStart,tmpEnd,resetAfterStart,txt,tmpNode;if(this.collapsed){return fragment}function createFragment(){return self.doc.createDocumentFragment()}function getEndOffset(node){return 3===node.nodeType?node.nodeValue.length:node.childNodes.length}if(start.nodeType===1){tmpNode=start.childNodes[startOffset];if(!tmpNode){tmpStart=domUtil.createText("[start]");start.appendChild(tmpStart)}startOffset=0;start=tmpNode||tmpStart}if(end.nodeType===1){tmpNode=end.childNodes[endOffset-1];if(!tmpNode){tmpEnd=domUtil.createText("[end]");if(end.firstChild){end.insertBefore(tmpEnd,end.firstChild)}else{end.appendChild(tmpEnd)}}end=tmpNode||tmpEnd;endOffset=getEndOffset(end)}tmpNode=null;if(start==end){if(start.nodeType==3){txt=start.nodeValue;if(action&&0==startOffset&&txt.length==endOffset){tmpNode=start;self.setStartBefore(start)}else{txt=txt.slice(startOffset,endOffset);tmpNode=domUtil.createText(txt);if(action){start.deleteData(startOffset,endOffset-startOffset);self.setStart(start,startOffset)}}if(action){self.collapse(true)}fragment.appendChild(tmpNode);return fragment}else{tmpNode=!action?start.cloneNode(true):start;if(action){self.setStartBefore(start);self.collapse(true)}fragment.appendChild(tmpNode);return fragment}}var startParents=domUtil.parents(start,!0).reverse(),endParents=domUtil.parents(end,!0).reverse(),current,len,clone=fragment,rootNode;for(var i=0;startParents[i]==endParents[i];){i++}for(var j=i,si;si=startParents[j];j++){current=si.nextSibling;if(si==start){if(!tmpStart){if(self.startContainer.nodeType==3){txt=start.nodeValue;if(action&&0==startOffset){self.setStartBefore(start);clone.appendChild(start)}else{len=txt.length;txt=txt.slice(startOffset,len);clone.appendChild(domUtil.createText(txt));if(action){start.deleteData(startOffset,len-startOffset);self.setStart(start,startOffset)}}}else{self.setStartBefore(start);clone.appendChild(action?start:start.cloneNode(true))}}}else{rootNode=si.cloneNode(false);clone.appendChild(rootNode)}while(current){if(current===end||current===endParents[j]){break}si=current.nextSibling;clone.appendChild(action?current:current.cloneNode(true));current=si}clone=rootNode}clone=fragment;if(!startParents[i]){clone.appendChild(startParents[i-1].cloneNode(false));clone=clone.firstChild}var resetEndBefore=end.nextSibling;var resetEndBeforePn=end.parentNode;for(var j=i,ei;ei=endParents[j];j++){current=ei.previousSibling;if(ei==end){if(!tmpEnd){if(self.endContainer.nodeType==3){txt=end.nodeValue;len=txt.length;if(action&&len==endOffset){clone.appendChild(end)}else{txt=txt.slice(0,endOffset);clone.appendChild(domUtil.createText(txt));if(action){end.deleteData(0,endOffset)}}}else{clone.appendChild(action?end:end.cloneNode(true))}}}else{rootNode=ei.cloneNode(false);clone.appendChild(rootNode)}if(j!=i||!startParents[i]){while(current){if(current===start){break}ei=current.previousSibling;clone.insertBefore(action?current:current.cloneNode(true),clone.firstChild);current=ei}}clone=rootNode}if(!endParents[i]){tmpNode=endParents[i-1].cloneNode(false);tmpNode.appendChild(clone);fragment=createFragment();fragment.appendChild(tmpNode)}if(action){if(!endParents[i]){self.setEndAfter(endParents[i-1]);self.collapse()}else if(!startParents[i]){self.setStartBefore(startParents[i-1]);self.collapse(true)}else if(resetEndBefore){self.setEndBefore(resetEndBefore);self.collapse()}else{if(resetEndBeforePn===self.editor.body||3==end.nodeType){self.setEnd(resetEndBeforePn,resetEndBeforePn.childNodes.length)}else{self.setEndAfter(resetEndBeforePn)}self.collapse()}}tmpStart&&domUtil.remove(tmpStart);tmpEnd&&domUtil.remove(tmpEnd);return fragment},scrollToCursor:function(offset){var bk=this.createBookMark("getY");bk.start.style.display="inline-block";var y=this.domUtil.getPos(bk.start).top+(offset||-300);this.moveToBookMark("getY");if(y<this.doc.body.scrollTop){this.doc.body.scrollTop=y}return y},clearFillChar:function(){var curr=this.startContainer;while(curr=this.domUtil.getFilterTreeDom(curr,null,function(node){return node.nodeType==3&&!SinaEditor.noSpaceReg.test(node.nodeValue)})&&curr!=this.endContainer){range.removeNode(curr)}},__fixRange:function(rng){rng=rng||this;if($dtd.$empty[rng.startContainer.nodeName.toLowerCase()]){rng.setStartBefore(rng.startContainer)}if($dtd.$empty[rng.endContainer.nodeName.toLowerCase()]){rng.setEndAfter(rng.startContainer)}return rng}};return Range});SinaEditor.regist("Selection",function(SE){var Range=SE.Range,Util=SE.Util,DOMUtil=SE.DOMUtil;function Selection(doc,editor){var sel=this;sel.doc=doc;sel.editor=editor;sel.domUtil=editor.domUtil;sel.__cachedRange=sel.__cachedStart=null;sel.__lastRange=null}Selection.prototype={createRange:function(){var newRange=new Range(this.doc,this.editor);return newRange},getTrueRange:function(nativeRange,range){var self=this;var nativeRng;var _tmpSel=self.getNative();if(_tmpSel&&_tmpSel.rangeCount>0){nativeRng=nativeRange||_tmpSel.getRangeAt(0)}else{nativeRng=nativeRange}if(!nativeRng||!nativeRng.startContainer){return null}var range=range||new Range(self.doc,self.editor);if(nativeRng.startContainer.parentNode==nativeRng.endContainer&&!nativeRng.startOffset){nativeRng.setStart(nativeRng.endContainer,nativeRng.endoffset-1)}var commonAncestor=nativeRng.commonAncestorContainer;if(!commonAncestor&&nativeRng.getCommonAncestor){commonAncestor=nativeRng.getCommonAncestor()}var editorBody=self.editor.body;if(!commonAncestor||!self.domUtil.contains(editorBody,commonAncestor)&&commonAncestor!=editorBody){return null}range.setStart(nativeRng.startContainer,nativeRng.startOffset);range.setEnd(nativeRng.endContainer,nativeRng.endOffset);return range},getRange:function(noCache){var self=this;function convertRange(nativeRange,range){var tmp=range||new Range(self.doc,self.editor);var range=self.getTrueRange(nativeRange,range);if(!range){tmp.setStart(self.editor.body,0);tmp.collapse(true);return tmp}else{return range}}if(!self.__lastRange||noCache){return convertRange()}else{return convertRange(self.__lastRange)}},addRange:function(range){range.select();this.__historyRange=range},getNative:function(){var win=this.doc.defaultView||this.doc.parentWindow;return win.getSelection()},getNativeRange:function(){var sel=this.getNative();return sel.rangeCount>0?sel.getRangeAt(0):null},getSelection:function(){return this.getNative()},getText:function(){return this.getSelection().toString()},getContent:function(){},reset:function(){this.__cachedRange=null;this.__cachedStart=null;return this},cache:function(){var sel=this;this.__cachedRange=this.getRange(true);if(this.__cachedRange){this.__cachedStart=sel.__cachedRange.startContainer}},setCursor:function(toEnd){var range=this.getRange(true);if(!range){return false}range.collapse(!toEnd);var start=range.startContainer,offset=range.startOffset;if(start.nodeType==3){range["setStart"+(offset?"After":"Before")](start);range["setEnd"+(offset?"Before":"After")](start)}var currNode=range.startContainer.childNodes[range.startOffset]||range.startContainer.lastChild,spaceNode;if(currNode){if(currNode.nodeType==1){if(!(currNode.tagName=="BR"&&start.tagName=="P"&&start.childNodes.length===1)){spaceNode=this.doc.createTextNode(SinaEditor.spaceChar);range.setStartAfter(currNode);range.insertNode(spaceNode);range.setEnd(spaceNode,0)}}else if(currNode.nodeType==3){range.setEnd(currNode,0)}}range.collapse();range.select();return true},saveNative:function(){var self=this;self.__lastRange=self.getNativeRange()},getStartElem:function(){var range=this.getRange(true).cloneRange();range.shrinkBoundary();start=range.startContainer;if(start.nodeType==1&&start.hasChildNodes()){start=start.childNodes[Math.min(start.childNodes.length-1,range.startOffset)]}if(start.nodeType==3){return start.parentNode}return start}};return Selection});!function(SE){if(!SinaEditor.env.$belowIe9){return}var Util=SE.Util;Util.mix(SE.Range.prototype,{select:function(nofillChar){var nativeRange,collapsed=this.collapsed,startContainer=this.startContainer,fillChar=SE.spaceChar;
if(!collapsed){this.shrinkBoundary()}var bookmark=this.createBookMark(),start=bookmark.start,tmpText,end;nativeRange=this.editor.selection.getNativeRange();if(!nativeRange.duplicate){nativeRange=this.doc.body.createTextRange()}nativeRange.moveToElementText(start);if(!collapsed){var nativeRangeEnd=this.doc.body.createTextRange();end=bookmark.end;nativeRangeEnd.moveToElementText(end);nativeRange.setEndPoint("EndToEnd",nativeRangeEnd)}else{var isElementNode=startContainer.nodeType!==3;if(!nofillChar&&isElementNode){var tmp=this.doc.createElement("span");tmp.appendChild(this.doc.createTextNode(fillChar));start.parentNode.insertBefore(tmp,start);nativeRange.moveToElementText(tmp);nativeRange.moveStart("character",1);nativeRange.collapse(true)}else if(isElementNode&&startContainer.hasChildNodes()&&startContainer.childNodes.length==1&&startContainer.childNodes[0]==start){tmpText=this.doc.createTextNode(fillChar);startContainer.appendChild(tmpText);nativeRange.moveToElementText(startContainer);nativeRange.moveStart("character",1);nativeRange.collapse(true)}}this.removeBookMark(bookmark);try{nativeRange.select();if(nofillChar&&tmpText){startContainer.removeChild(tmpText)}}catch(e){}this.editor.selection.saveNative();return this}})}(SinaEditor);if(SinaEditor.env.$msie&&9>SinaEditor.env.version){!function(SE){var Util=SE.Util,$dtd=SE.dtd,Range=SE.Range;Util.mix(SE.Selection.prototype,{W3C:{},getNative:function(){return this.doc.selection},getNativeRange:function(){var selection=this.getNative(),rng;try{rng=selection.createRange()}catch(e){this.editor.focus();rng=selection.createRange()}if(!rng.duplicate){var self=this;var dom1=rng.item(0),dom2=rng.item(rng.length-1);var rng1=self.editor.doc.body.createTextRange(),rng2=rng1.duplicate();var span=self.editor.doc.createElement("span");self.domUtil.insertBefore(span,dom1);span.appendChild(self.editor.doc.createTextNode(SinaEditor.spaceChar));rng1.moveToElementText(dom1);rng1.moveStart("character",1);rng2.moveToElementText(dom2);rng2.collapse(false);rng1.setEndPoint("EndToStart",rng2);rng1.select();self.domUtil.remove(span);span=null;return rng1}return rng},saveNative:function(){var self=this;self.__lastRange=self.getNativeRange();try{self.__lastRange=self.__lastRange.duplicate()}catch(e){}self.saveW3CInfo()},saveW3CInfo:function(rng){return},getRange:function(noCache){var self=this;var getW3CInfo=function(range,isStart){if(!range.duplicate){var dom=isStart?range.item(0):range.item(range.length-1);range=self.editor.doc.body.createTextRange();range.moveToElementText(dom)}var rng1=range.duplicate();rng1.collapse(isStart);var rng2=range.duplicate(),parent=rng1.parentElement(),container=parent,offset=0,childs=parent.childNodes,i=0;while(childs[i]){var curr=childs[i];if(curr.nodeType!=3&&curr.nodeType!=9&&curr.nodeType!=11&&curr.nodeType!=8){rng2.moveToElementText(curr);var compare=rng2.compareEndPoints("StartToStart",rng1);if(compare==0){offset=self.domUtil.getIndexByChild(curr);break}}else if(curr.nodeType==3){var next=curr.nextSibling,ofst=0;while(next){if(next.nodeType==1){break}next=next.nextSibling}if(next){rng2.moveToElementText(next);rng2.collapse(true);var compare=rng2.compareEndPoints("StartToStart",rng1);if(compare==0){offset=self.domUtil.getIndexByChild(next);break}else if(compare<0){i++;continue}else{container=next.previousSibling;offset=container.nodeValue.length;while(rng2.compareEndPoints("StartToStart",rng1)>0){if(offset<=0){container=container.previousSibling;offset=container.nodeValue.length}else{rng2.moveStart("character",-1);offset--}}break}}else{rng2=rng1.duplicate();rng2.moveToElementText(parent);rng2.collapse(false);rng2.moveStart("character",-1);if(rng2.htmlText!=""){rng2.moveStart("character",1)}container=parent.lastChild;offset=container.nodeValue.length;while(rng2.compareEndPoints("StartToStart",rng1)>0){if(offset<=0){container=container.previousSibling;offset=container.nodeValue.length}else{rng2.moveStart("character",-1);rng2.collapse(true);offset--}}break}}i++}return{container:container,offset:offset}};function convertRange(nativeRange,range){var tmp=range||new Range(self.doc,self.editor);var navRng=nativeRange||self.getNativeRange(),cloneNavRng=null;var w3c=self.W3C,startContainer,startOffset,endContainer,endOffset;if(!w3c.startContainer){if(nativeRange){try{navRng.select()}catch(e){}}var startO=getW3CInfo(navRng,true);var endO=getW3CInfo(navRng,false);startContainer=startO.container;endContainer=endO.container;startOffset=startO.offset;endOffset=endO.offset}else{startContainer=w3c.startContainer;endContainer=w3c.endContainer;startOffset=w3c.startOffset;endOffset=w3c.endOffset}if(!self.domUtil.contains(self.domUtil.body,startContainer)){startContainer=self.domUtil.body;startOffset=0}if(!self.domUtil.contains(self.domUtil.body,endContainer)){endContainer=self.domUtil.body;endOffset=0}tmp.setStart(startContainer,startOffset);tmp.setEnd(endContainer,endOffset);if(tmp.startContainer.nodeType==3){if(tmp.startOffset>=tmp.startContainer.nodeValue.length){var e=tmp.getEnd(),tmpStart;var filter=function(node){return node.nodeType==3&&SinaEditor.noSpaceReg.test(node.nodeValue)&&self.domUtil.getNodePosition(node,e)&4||e.nodeType==3&&node==e};tmpStart=self.domUtil.getFilterTreeDom(tmp.startContainer,null,filter,true);if(tmpStart){tmp.setStart(tmpStart,0)}else{tmp.collapse(true)}}}return tmp}var rng;if(!self.__lastRange||noCache){self.w3crng=null;self.W3C={};rng=convertRange();self.w3crng=rng}else{self.W3C=rng=convertRange(self.__lastRange)}return rng.__fixRange()}})}(SinaEditor)}SinaEditor.regist("Quirks",function(SE){var env=SE.env,VK=SE.VK;function Quirks(editor){var domUtil=editor.domUtil;var body=editor.body;function controlselectHandler(evt){evt=domUtil.fixEvent(evt);evt.preventDefault()}domUtil.on(body,"mscontrolselect",controlselectHandler);function indicateSpan(e,nativeEvent){var spans=domUtil.$("span",editor.body);domUtil.each(spans,function(i,span){domUtil.attr(span,"se-mark","1")});var keyCode=nativeEvent.keyCode||nativeEvent.which;var isDelete=keyCode==VK.DELETE;editor.getDoc().execCommand(isDelete?"ForwardDelete":"Delete",false,null);return false}function removeSpan(e,nativeEvent){var spans=domUtil.$("span",editor.body);domUtil.each(spans,function(i,span){if(!domUtil.attr(span,"se-mark")){domUtil.each(span.childNodes,function(i,node){domUtil.insertBefore(node,span)});span.parentNode.normalize();domUtil.remove(span)}});domUtil.removeAttr(spans,"se-mark")}if(env.$webkit){editor.on("beforedelete",indicateSpan);editor.on("afterdelete",removeSpan)}if(env.$msie||env.$firefox){domUtil.on(editor.body,"keydown",function(evt){var keyCode=evt.keyCode||evt.which;var activeElement=document.activeElement;if(keyCode==VK.BACKSPACE&&domUtil.contains(editor.body,activeElement)){var pns=domUtil.parents(activeElement,true);domUtil.each(pns,function(i,node){if(domUtil.attr(node,"se-widget")){evt.preventDefault();return false}})}})}}return Quirks});SinaEditor.regist("PluginManager",function(SE){var Util=SE.Util;var PluginManager={__PLUGINS:{},register:function(name,func){var name=name.toLowerCase();if(this.__PLUGINS[name]){throw new Error("重复定义插件："+name)}this.__PLUGINS[name]=func},initPlugin:function(pluginConf,editor){var plugin=PluginManager.__PLUGINS[pluginConf.name.toLowerCase()];editor=editor||this;if(!pluginConf||!plugin){return}var name=pluginConf.name.toLowerCase();if(editor.plugins[name]instanceof plugin){return}editor.plugins[name]=new plugin(pluginConf.params||{},editor);editor.fire("plugin."+name,editor.plugins[name],pluginConf.params)},initPlugins:function(plugins,editor){var self=this,level0=[],level1=[],level2=[],count=0;for(var p=0,len=plugins.length;p<len;p++){var pluginConf=plugins[p];switch(pluginConf.level){case 0:level0.push(pluginConf);break;case 2:level2.push(pluginConf);break;default:level1.push(pluginConf)}}function init(deffered,plugins){var currentCount=0;if(!plugins.length){deffered.next()}for(var p=0,currentLength=plugins.length;p<currentLength;p++){var pluginConf=plugins[p];!function(conf){setTimeout(function(){currentCount++;count++;self.initPlugin.call(editor,conf);if(currentLength<=currentCount){deffered.next()}if(len<=count){editor.fire("pluginOnLoaded")}},15)}(pluginConf)}}Util.Deffer(function(d){init(d,level0)}).then(function(d){init(d,level1)}).then(function(d){init(d,level2)}).start()},addPlugin:function(pluginConf,editor){PluginManager.initPlugin.call(editor||this,pluginConf,editor)}};return PluginManager});SinaEditor.regist("Editor",function(SE){var Util=SE.Util,Event=SE.Event,PluginManager=SE.PluginManager,dtd=SE.dtd,Quirks=SE.Quirks;function Editor(opts){var self=this,defaultId=Util.uniqueId();self.COMMANDS={};self.event=new Event;self.plugins={};self.opts=Util.extend({root:defaultId,id:defaultId,emptyContent:"",plugins:[],holder:"se-holder"},opts);self.id=self.opts.id;self.holder=self.opts.holder||"";self.init(self.opts)}Editor.prototype={constructor:Editor,id:"",toolbars:{},getDoc:function(){return this.doc},registerCmd:function(cmd,cmdQuery){cmd=cmd.toLowerCase();if(this.COMMANDS[cmd]){throw Error("重复的命令:"+cmd)}var obj={};for(var attr in cmdQuery){if(cmdQuery.hasOwnProperty(attr)&&cmdQuery[attr]!==undefined){obj[attr]=cmdQuery[attr]}}this.COMMANDS[cmd]=obj;obj=null},exec:function(cmdName,data){var self=this,sel=self.selection,args=arguments,rng=sel.getRange(),domUtil=self.domUtil,elementPath=domUtil.getElementPath(rng);cmdName=cmdName.toLowerCase();self.fire("beforeCommand",cmdName,rng);var time=+new Date;self._callCmdFn("exec",args);var time=+new Date-time;self.fire("execCommand",{cmdName:cmdName,data:data,range:rng,time:time});var currentRange=sel.getRange(true);var currentPath=domUtil.getElementPath(currentRange);self.fire("afterCommand",cmdName,currentRange,currentPath);currentRange=sel.getRange(true);var isEquals=rng.equals(currentRange);if(!isEquals||!domUtil.isSamePath(elementPath,currentPath)){sel.saveNative();self.__selectionChange(currentRange,currentPath,"command")}},queryCommandValue:function(cmdName){return this._callCmdFn("queryCommandValue",arguments)},queryCommandState:function(cmdName){return this._callCmdFn("queryCommandState",arguments)},focus:function(){var self=this,domUtil=self.domUtil,doc=self.doc,body=self.body,opts=self.opts;if(body.ownerDocument==doc){domUtil.getWin(self.doc).focus()}if(!domUtil.hasClass(body,opts.focusCls)){domUtil.addClass(body,opts.focusCls)}},setCursor:function(opt){var self=this,rng,node=self.body[opt.position];rng=self.getRange();if(node){rng.setStart(node,0)}else{rng.setStart(self.body,0)}rng.collapse(true);rng.select(true);self.getRange(true)},init:function(opt){var self=this,pluginsLoaded,contentLoaded;var editor=self;self.on("pluginOnLoaded",function(){if(contentLoaded){editor.filter=new SinaEditor.FilterHTML(editor.domUtil);self.__callReady()}else{pluginsLoaded=!0}});self.on("contentOnLoaded",function(){editor.__initEvent();if(pluginsLoaded){self.__callReady();editor.fire("ready")}else{contentLoaded=!0}});PluginManager.initPlugins(opt.plugins,self)},ready:function(func){this.on("ready",function(e){func.call(this,e);e.undo=true})},on:function(name,func,isFirst){var f=isFirst===undefined?true:!!isFirst;return this.event.bind(name,func,f)},off:function(name,func){return this.event},fire:function(){Array.prototype.unshift.call(arguments,this);return this.event.fire.apply(this.event,arguments)},isEmptyContent:function(reg){var self=this,node=self.domUtil.body;if(node.nodeType!=1)return false;if(node.childNodes.length>1){return false}var text=self.domUtil.text(node);if(text.length>0){return false}for(var n in dtd.$isNotEmpty){if(node.getElementsByTagName(n).length){return false}}return true},setContent:function(html,isSetInnerHtml){var self=this;var content={html:html};if(!isSetInnerHtml){self.fire("beforeSetContent",content);self.body.innerHTML=content.html;self.fire("afterSetContent")}else{self.body.innerHTML=html}self.fire("tmpAfterSetContent");self.__selectionChange(null,null,"setcontent")},getContent:function(formatter,isGetInnerHtml){var html=this.body.innerHTML;var content={html:html};if(!isGetInnerHtml){this.fire("beforeGetContent",content);this.fire("afterGetContent",content)}var html=!formatter?content.html:formatter(content.html);return html},getRange:function(noCache){return this.selection.getRange(noCache)},_callCmdFn:function(fnName,args){var self=this;var cmdName=args[0].toLowerCase();var cmd=self.COMMANDS[cmdName];if(!cmd){throw new Error("命令"+cmdName+"的"+fnName+"方法未定义")}var fn=cmd[fnName];if(fn){return fn.apply(self,args)}else{return false}},__selectionChange:function(rng,path,cause){var sel=this.selection;rng=rng||sel.getRange(true);path=path||this.domUtil.getElementPath(rng);this.fire("selectionchange",rng,path,cause)},__initEvent:function(){var self=this,sel=self.selection,isInBody=false,body=self.body,checkInterval=200,domUtil=self.domUtil,lastTime=+new Date,lastRng,isIME=false,listeners="keyup keydown mouseup mousedown touchstart touchend paste cut compositionstart compositionend";function checkSelectionExec(e){var currentRng=sel.getRange(true);if(!currentRng.equals(lastRng)){self.fire("selectionchange",currentRng,null,e&&("string"===typeof e?e:e.type));lastRng=currentRng}}function checkTimer(e){var type=e.type;var timer=setTimeout(function(){if(isIME){return}var currentTime=+new Date;var intervalTime=currentTime-lastTime;if(timer&&intervalTime<checkInterval){clearTimeout(timer)}else{lastTime=+new Date;checkSelectionExec(type)}},checkInterval);sel.saveNative()}domUtil.on(body,listeners,function(e){e=domUtil.fixEvent(e||window.event);self.fire(e.type,e)});self.domUtil.on(self.doc.body,"compositionstart",function(){isIME=true});self.domUtil.on(self.doc.body,"compositionend",function(){isIME=false});self.on("mousedown",function(){self.isInBody=true});self.on("keyup touchend",function(editorEvent,nativeEvent){checkTimer(nativeEvent)});self.domUtil.on(self.doc.body,"mouseup keyup touchend",function(e){if(self.isInBody){checkTimer(e)}self.isInBody=false},false)},__render:function(opt){},addToolbar:function(toolbar){var name=toolbar.name;if(this.toolbars[name]){throw new Error("工具条<"+name+">已定义")}this.toolbars[name]=toolbar},getToolbar:function(name){return this.toolbars[name]},__callReady:function(){var self=this;if(self.isEmptyContent()){editor.setContent(self.opts.emptyContent,true)}self.opts.quirks=new Quirks(self);editor.fire("ready")}};return Editor});!function(SE){var Util=SE.Util,DOMUtil=SE.DOMUtil,dtd=SE.dtd;function Elem(doc){this.doc=doc||document;this.domUtil=new DOMUtil(this.doc)}Elem.prototype={constructor:Elem,createRoot:function(tagName,attributes){var node=new Node({nodeType:9,tagName:tagName});if(attributes){this.domUtil.setAttributes(node,attributes);if(attributes.style){node.setAttribute("style",attributes.style)}if(attributes.id){node.setAttribute("id",attributes.id)}}return node},createElement:function(tagName,attributes){var node=new Node({nodeType:1,attributes:attributes||{},tagName:tagName});if(attributes){this.domUtil.setAttributes(node,attributes);if(attributes.style){node.setAttribute("style",attributes.style)}if(attributes.id){node.setAttribute("id",attributes.id)}}return node},createTextNode:function(data){return new Node({nodeType:3,nodeValue:Util.unhtml(data)})},createComment:function(data){return new Node({nodeType:8,nodeValue:data.replace(/<!--([^(-->)]*)-->/g,"$1")})}};function Node(opts){this.nodeType=opts.nodeType||1,this.previousSibling=null;this.nextSibling=null;this.parentNode=null;this.lastChild=null;this.firstChild=null;this.attributes=[];this.attrs={};this.style={};this.style.cssText="";if(this.nodeType!=3&&!this.nodeType!=8){this.children=[];this.tagName=opts.tagName.toUpperCase();this.tagNameLower=this.tagName.toLowerCase()}else{this.nodeValue=opts.nodeValue}}Node.ErrorCode={NODE_ERR:"is not a node object",NODE_TYPE_ERR:"nodeType error"};Node.prototype={constructor:Node,appendChild:function(node){if(this.nodeType==3){throw Error(Node.ErrorCode.NODE_TYPE_ERR);return null}if(!node instanceof Node){throw Error(NODE_ERR);return null}if(this.parentNode&&this.parentNode==node||this==node){throw Error("");return null}if(node.parentNode){node.parentNode.removeChild(node)}node.parentNode=this;node.previousSibling=this.children[this.children.length-1]||null;node.nextSibling=null;if(node.previousSibling){node.previousSibling.nextSibling=node}this.children.push(node);if(this.children.length==1){this.firstChild=node}this.lastChild=node;return this},insertBefore:function(node,child){if(this.nodeType==3){throw Error(Node.ErrorCode.NODE_TYPE_ERR);return null}if(!node instanceof Node||!child instanceof Node){throw Error(NODE_ERR);return null}if(this!==child.parentNode){return false}if(node.parentNode){node.parentNode.removeChild(node)}node.parentNode=this;if(child.previousSibling){child.previousSibling.nextSibling=node}node.previousSibling=child.previousSibling;node.nextSibling=child;child.previousSibling=node;var i=0,item;do{item=this.children[i];if(item==child){this.children.unshift(node);i=null;this.firstChild=node;break}if(item.nextSibling==child){this.children.splice(i,0,node);break}}while((item=this.children[i])&&i++);return this},removeChild:function(child){if(!child instanceof Node){throw Error(NODE_ERR);return null}if(child.parentNode!=this){return null}var i=0,childs=this.children,len=childs.length;for(;i<len;i++){var item=childs[i],prev,next;if(item==child){if(prev=childs[i-1]){prev.nextSibling=childs[i+1]||null}if(next=childs[i+1]){next.previousSibling=childs[i-1]||null}child.previousSibling=child.parentNode=child.nextSibling=null;childs.splice(i,1);this.firstChild=childs[0]||null;this.lastChild=childs[childs.length-1]||null;prev=next=null;break}}return child},removeChildByIndex:function(index){var node=this.children[index];if(node){node.previousSibling&&(node.previousSibling.nextSibling=node.nextSibling);node.nextSibling&&(node.nextSibling.previousSibling=node.previousSibling);node.parentNode=node.nextSibling=node.previousSibling=null;this.children.splice(index,1);this.firstChild=this.children[0]||null;this.lastChild=this.children[this.children.length-1]||null}return node||null},hasChild:function(){return this.children.length!==0},hasAttribute:function(){return this.attributes.length!==0},getAttribute:function(attrName){return this.attrs[attrName]||null},setAttribute:function(attrName,value){if(!this.attrs[attrName]&&this.attrs[attrName]!==null&&typeof value!==undefined){this.attributes.push({nodeValue:value,value:value,nodeType:2,nodeName:attrName,name:attrName})}this.attrs[attrName]=value},getELementById:function(id){},getElementsByTagName:function(tagName){},getElementsByClass:function(className){},getElementsByAttribute:function(attribute){},isCompleteEmptyNode:function(isRemove){var parent=this.parentNode,result=true;if(this.nodeType==3||this.nodeType==8){if(this.nodeValue.replace(/[\s\n\r\t\u200B\uFEFF]/g,"").length==0){isRemove&&this.parentNode&&this.parentNode.removeChildByIndex(0);return true}return false}if(this.hasAttribute()){return false}var i=0,childs=this.children,item;for(;i<childs.length;i++){if(!childs[i].isCompleteEmptyNode()){result=false;if(!isRemove){break}}else{if(isRemove){if(this.removeChildByIndex(i)){i--}}}}if(childs.length===0&&parent&&isRemove&&this.nodeType!=9&&!dtd.$empty[this.tagName]){parent.removeChild(this)}return result},parseHtml:function(html,isPaste){var filter=new SinaEditor.FilterHTML;var rs=filter.filterHtml({html:html,root:this},false,true);return rs},html:function(){var me=this,arr=[""];function find(node,tmp,unit){if(node.nodeType==9){node=node.children[0]}if(!node){return""}var next=node.nextSibling,prev=node.previousSibling;if(node.nodeType==1&&dtd[node.tagName]){var length=node.children.length,tagName=node.tagNameLower;if(tagName!=="style"&&!node.isCompleteEmptyNode()){if(dtd[node.parentNode.tagName]&&dtd[node.parentNode.tagName][node.tagName]){tmp[unit]+="<"+tagName;if(node.hasAttribute()){var n=0,attrs=node.attributes,nl=attrs.length,curr;for(;n<nl;n++){curr=attrs[n];tmp[unit]+=" "+curr.name+'="'+curr.value+'"'}}if(!dtd.$empty[tagName]){tmp[unit]+=">";unit+=1;tmp.splice(unit,0,"","</"+tagName+">")}else{tmp[unit]+="/>"}length&&(unit=find(node.children[0],tmp,unit));unit++}}}if(node.nodeType==3){tmp[unit]+=node.nodeValue}if(node.nodeType==8){tmp[unit]+="<!--"+node.nodeValue+"-->"}if(next){unit=find(next,tmp,unit)}return unit}find(me,arr,0);return arr.join("")}};SE.Elem=Elem}(SinaEditor);SinaEditor.regist("FilterHTML",function(SE){var dtd=SE.dtd,Util=SE.Util;var FH=function(domUtil,opts){this.domUtil=domUtil;this.doc=domUtil.doc};FH.prototype={constructor:SinaEditor.FilterHTML,elem:new SinaEditor.Elem,fillChar:SinaEditor.spaceChar,browser:SinaEditor.env,isBr:function(node){return node&&node.nodeType==1&&node.tagName=="BR"},isEmptyElement:function(node){if(!node){return false}if(node.nodeType!=1){return false}if(node.childNodes.length>0){return false}var i=0,elem;while((elem=node.childNodes[i])&&i++){if(elem.nodeType==1){return false}if(elem.nodeType==3){if(Util.trim(elem.nodeValue).replace(new RegExp(fillChar,"g"),"").length==0){return true}}}return false},pasteHtml:function(pasteBinDiv){var div=pasteBinDiv,browser=this.browser,self=this;var html,domUtil=this.domUtil;if(browser.$webkit){var brs=div.querySelectorAll("div br");for(var i=0,bi;bi=brs[i++];){var pN=bi.parentNode;if(pN&&pN.tagName=="DIV"&&pN.childNodes.length==1){pN.innerHTML="<p><br/></p>";domUtil.remove(pN)}}var metas=div.querySelectorAll("meta");for(var i=0,ci;ci=metas[i++];){domUtil.remove(ci)}var brs=div.querySelectorAll("br");for(i=0;ci=brs[i++];){if(/^apple-/i.test(ci.className)){domUtil.remove(ci)}}}if(browser.$firefox){var dirtyNodes=div.querySelectorAll("[_moz_dirty]");for(i=0;ci=dirtyNodes[i++];){ci.removeAttribute("_moz_dirty")}}if(!browser.$msie){var spans=div.querySelectorAll("span.Apple-style-span");for(var i=0,ci;ci=spans[i++];){domUtil.remove(ci,true)}}html=div.innerHTML;html=this.filterWord(html);var rs=this.filterHtml({html:html},false,true,false);var root=rs.root;if(browser.$webkit){if(root.lastChild&&self.isBr(root.lastChild)){root.removeChild(root.lastChild)}self.domUtil.each(self.domUtil.body.querySelectorAll("div"),function(node){if(self.isEmptyElement(node)&&domUtil.isBlock(node)){domUtil.remove(node)}})}rs.html=root.html();root.root=null;return rs.html},filterWord:function(self){function isWordDocument(str){var re=new RegExp(/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument)/gi);return re.test(str)}function transUnit(v){v=v.replace(/[\d.]+\w+/g,function(m){return Util.unit2Pixel(m)});return v}function ensureUnits(v){v=v.replace(/([\d.]+)([\w]+)?/g,function(m,p1,p2){return(Math.round(parseFloat(p1))||1)+(p2||"px")});return v}function filterPasteWord(str){str=str.replace(/\r\n|\n|\r/gi,"");str=str.replace(/^\s*(&nbsp;)+/gi,"");str=str.replace(/(&nbsp;|<br[^>]*>)+\s*$/gi,"");str=str.replace(/<!--[\s\S]*?-->/gi,"");str=str.replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>");str=str.replace(/(lang)\s*=\s*([\'\"]?)[\w-]+\2/gi,"");str=str.replace(/(<[a-z][^>]*)\sstyle="([^"]*)"/gi,function(str,tag,style){var n=[],i=0,s=style.replace(/^\s+|\s+$/,"").replace(/&quot;/gi,"'").split(/;\s*/g);for(var i=0;i<s.length;i++){var v=s[i];var name,value,parts=v.split(":");if(parts.length==2){name=parts[0].toLowerCase();value=parts[1].toLowerCase();switch(name){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-table-layout-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":n[i++]=name.replace(/^mso-|-alt$/g,"")+":"+ensureUnits(value);continue;case"horiz-align":n[i++]="text-align:"+value;continue;case"vert-align":n[i++]="vertical-align:"+value;continue;case"font-color":case"mso-foreground":n[i++]="color:"+value;continue;case"mso-background":case"mso-highlight":n[i++]="background:"+value;continue;case"mso-default-height":n[i++]="min-height:"+ensureUnits(value);continue;case"mso-default-width":n[i++]="min-width:"+ensureUnits(value);continue;case"mso-padding-between-alt":n[i++]="border-collapse:separate;border-spacing:"+ensureUnits(value);continue;case"text-line-through":if(value=="single"||value=="double"){n[i++]="text-decoration:line-through"}continue;case"mso-zero-height":if(value=="yes"){n[i++]="display:none"}continue}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?:align|decor|indent|trans)|top-bar|version|vnd|word-break)/.test(name)){continue}n[i]=name+":"+parts[1]}}if(i>0){return tag+' style="'+n.join(";")+'"'}else{return tag}});str=str.replace(/([ ]+)<\/span>/gi,function(m,p){return new Array(p.length+1).join("&nbsp;")+"</span>"});return str}return function(html){return isWordDocument(html)?filterPasteWord(html):html}}(this),filterHtml:function(html,ignoreBlank,isDom,noPaste){var startDate=+new Date;var self=this;var htmlstr=html.html;var re_tag=/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)-->)|(?:([^\s\/<>]+)\s*((?:(?:"[^"]*")|(?:'[^']*')|[^"'<>])*)\/?>))/g,re_attr=noPaste?/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:\"([^\"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g:/(id|bookmarktag)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/gi;var allowEmptyTags={b:1,code:1,i:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,span:1,sub:1,img:1,sup:1,font:1,big:1,small:1,iframe:1,a:1,br:1,pre:1};htmlstr=htmlstr.replace(new RegExp(self.fillChar,"g"),"");if(!ignoreBlank){htmlstr=htmlstr.replace(new RegExp("[\\r\\t\\n"+(ignoreBlank?"":" ")+"]*</?(\\w+)\\s*(?:[^>]*)>[\\r\\t\\n"+(ignoreBlank?"":" ")+"]*","g"),function(a,b){if(b&&allowEmptyTags[b.toLowerCase()]){return a.replace(/(^[\n\r]+)|([\n\r]+$)/g,"")}return a.replace(new RegExp("^[\\r\\n"+(ignoreBlank?"":" ")+"]+"),"").replace(new RegExp("[\\r\\n"+(ignoreBlank?"":" ")+"]+$"),"")})}var notTransAttrs={href:1,src:1};var needParentNode={td:"tr",tr:["tbody","thead","tfoot"],tbody:"table",th:"tr",thead:"table",tfoot:"table",caption:"table",li:["ul","ol"],dt:"dl",dd:"dl",option:"select"},needChild={ol:"li",ul:"li"},skipTags={nav:1,article:1,title:1,header:1,aside:1,tbcc:1,table:1,tbody:1,input:1,iframe:1,textarea:1,form:1,script:1,link:1,html:1,xml:1,meta:1,body:1,caption:1,select:1,option:1,optgroup:1,button:1,img:noPaste?!1:1,video:1,audio:1,"w:sdt":1,"o:p":1,"w:sdtpr":1},changeTags={th:"p",tr:"p",td:"span",a:noPaste?"a":"span",div:noPaste?"div":"p"};function text(parent,data,prevParent){var _par=parent;if(prevParent){if(prevParent.isAddParent){_par=prevParent}else if(_par.nodeType==9){_par=element(_par,"p","",root,null,true)}}if(needChild[_par.tagName.toLowerCase()]){_par=element(parent,needChild[_par.tagName],null,null,true);_par=text(_par,data,parent)}else{_par.appendChild(self.elem.createTextNode(data))}return parent}function comment(parent,data){var comment=self.elem.createComment(data);parent.appendChild(comment)}function element(parent,tagName,htmlattr,root,prevParent,isAddParent){var needParentTag;if(skipTags[tagName]){return parent}if(changeTags[tagName]){tagName=changeTags[tagName]}if(!dtd[tagName]){return parent}if(needParentTag=needParentNode[tagName]){var tmpParent=parent,hasParent;while(tmpParent!=root){if(Util.isArray(needParentTag)?Util.inArray(needParentTag,tmpParent.tagName.toLowerCase()):needParentTag==tmpParent.tagName.toLowerCase()){parent=tmpParent;hasParent=true;break}tmpParent=tmpParent.parentNode}if(!hasParent){var isPrev=false;if(prevParent&&prevParent.isAddParent){isPrev=Util.isArray(needParentTag)?Util.inArray(needParentTag,prevParent.tagName.toLowerCase()):needParentTag==prevParent.tagName.toLowerCase()}if(isPrev){parent=prevParent}else{parent=element(parent,Util.isArray(needParentTag)?needParentTag[0]:needParentTag,"",root,parent.lastChild,true)}}}var elm=self.elem.createElement(tagName),elmAttrs;elm.isAddParent=!!isAddParent;if(!dtd.$block[tagName]&&parent==root){if(prevParent&&prevParent.isAddParent&&dtd[prevParent.tagName][tagName]){parent=prevParent}else{parent=element(parent,"p","",root,true)}}else{if(parent.isAddParent&&!(Util.isArray(needParentTag)?Util.inArray(needParentTag,parent.tagName.toLowerCase()):needParentTag==parent.tagName.toLowerCase())){parent=parent.parentNode}}while(parent&&!dtd[parent.tagName][tagName]&&parent!=root){parent=parent.parentNode}parent.appendChild(elm);if(htmlattr){var attrs={},match;while(match=re_attr.exec(htmlattr)){attrs[match[1].toLowerCase()]=notTransAttrs[match[1].toLowerCase()]?match[2]||match[3]||match[4]:Util.unhtml(match[2]||match[3]||match[4])}elmAttrs=attrs}if(elmAttrs&&noPaste){self.domUtil.setAttributes(elm,elmAttrs);if(elmAttrs.style){elm.setAttribute("style",elmAttrs.style)}if(elmAttrs.id){elm.setAttribute("id",elmAttrs.id)}}return dtd.$empty[tagName]?parent:elm}var match,currentIndex=0,nextIndex=0,root=html.root||self.elem.createRoot("div");var currentParent=root;while(match=re_tag.exec(htmlstr)){currentIndex=match.index;try{if(currentIndex>nextIndex){currentParent=text(currentParent,htmlstr.slice(nextIndex,currentIndex),currentParent.lastChild)}if(match[3]){if(dtd.$cdata[currentParent.tagName]){currentParent=text(currentParent,match[0],currentParent.lastChild)}else{currentParent=element(currentParent,match[3].toLowerCase(),match[4],root,currentParent.lastChild)}}else if(match[1]){if(dtd.$block[currTag]){currentParent=root}if(currentParent!=root){while(!dtd[currentParent.tagName][match[1]]&&currentParent!=root){currentParent=currentParent.parentNode}if(currentParent==root){nextIndex=re_tag.lastIndex;continue}if(dtd.$cdata[currentParent.tagName]&&!dtd.$cdata[match[1]]){currentParent=text(currentParent,match[0],currentParent.lastChild)}else{var currTag=match[1].toLowerCase();if(skipTags[currTag]){nextIndex=re_tag.lastIndex;continue}if(changeTags[currTag]){currTag=changeTags[currTag]}if(needParentNode[currTag]){currTag=needParentNode[currTag][0]||needParentNode[currTag]}while(currentParent&&!dtd[currentParent.tagName][currTag]&&currentParent!=root){currentParent=currentParent.parentNode}if(currentParent==root){nextIndex=re_tag.lastIndex;continue}var tmpParent=currentParent;while(currentParent.nodeType==1&&currentParent.tagName.toLowerCase()!=currTag){currentParent=currentParent.parentNode;if(currentParent==root){currentParent=tmpParent;break}}currentParent=currentParent.parentNode}}}else if(match[2]){}}catch(e){throw new Error(e)}nextIndex=re_tag.lastIndex}if(nextIndex<htmlstr.length){text(currentParent,htmlstr.slice(nextIndex),currentParent.lastChild)}var html=root.html();try{console.info("filterHTml time:"+(+new Date-startDate)+"ms")}catch(e){}if(!isDom){root=null;return{html:html}}else{return{html:html,root:root}}}};return FH});var THEME={};THEME["boldBtn"]={html:'<button role="" class=""></button>',icon:"",activeCls:"active",position:"relative",pos:[]};THEME["italicBtn"]={html:'<button role="" class=""></button>',icon:"",activeCls:"active",position:"relative",pos:[]};SinaEditor.regist("ui.HTMLTemplate",function(SE){var Util=SE.Util,DOMUtil=SE.DOMUtil;var HTMLTemplate=function(tmpl,opts){var self=this;if(!tmpl){throw new Error("tmpl未定义")}self.opts=Util.merge(opts,{uniqueID:Util.uniqueId("template"),pattern:/(#\{(.*?)\})/g});self.domUtil=self.opts.domUtil||new DOMUtil;self.tmpl=tmpl};HTMLTemplate.prototype={constructor:HTMLTemplate,evaluate:function(data){var self=this;return self.tmpl.replace(self.opts.pattern,function(){return data[arguments[2]]||""})},evaluateMulti:function(data,reverse){var self=this;var _buffer=[];self.domUtil.each(data,function(){});self.domUtil.each(data,Util.bind(function(i,v){i=reverse?data.length-i:i;_buffer[i]=self.evaluate(v)},self));return _buffer.join("")},getHtmlString:function(){if(!this._htmlStr){this._htmlStr=this.evaluate(this.getNodeIds())}return this._htmlStr},getNodeIds:function(){if(!this._nodes){var p=/\{[^\}]+(?=\})/g,i,nodes={},rets,r,uniqueID=this._getUniqueID();this.__templateNodesIDs=this.tmpl.match(p);
rets=this.__templateNodesIDs;if(rets){i=rets.length;while(i--){r=rets[i].replace("{","");nodes[r]=r+"_"+uniqueID}}this._nodes=nodes}return this._nodes},getNodeId:function(name){if(!this._nodes){this.getNodeIds()}return this._nodes[name]},getNode:function(name){var id=this.getNodeId(name);return!id||!id.length?null:this.domUtil.$("#"+id)[0]},_getUniqueID:function(){if(!this.opts.uniqueID){this.opts.uniqueID=Util.uniqueId("template")}return this.opts.uniqueID}};return HTMLTemplate});SinaEditor.regist("ui.Layer",function(SE){var DOMUtil=SE.DOMUtil,Event=SE.Event,Util=SE.Util,HTMLTemplate=SE.ui.HTMLTemplate;function Layer(opts){var self=this,domUtil;self.opts=Util.extend({html:'<div id="#{panel}">test</div>'},opts);domUtil=self.domUtil=new DOMUtil;self.tmpl=new HTMLTemplate(self.opts.html);var frag=domUtil.createElementByHTML(self.tmpl.getHtmlString());domUtil.doc.body.appendChild(frag);self.event=new Event;self.node=self.tmpl.getNode("panel");self.isHidden="none"===domUtil.getStyle(self.node,"display")}Layer.prototype={constructor:Layer,node:null,isHidden:true,getNode:function(name){return this.tmpl.getNode(name)},show:function(opt){var self=this;self.node.style.display="block";if(opt&&opt.left&&opt.top){self.setPos(opt.left,opt.top)}self.isHidden=false;self.fire("show")},hide:function(){var self=this;self.node.style.top="-10000px";self.isHidden=true;self.fire("hide")},setPos:function(x,y){var node=this.node;node.style.left=parseInt(x,10)+"px";node.style.top=parseInt(y,10)+"px"},fire:function(name,data){this.event.fire(this,name,data)},on:function(name,func){this.event.on(this,name,func)},off:function(name,func){this.event.off(name,func)},getRect:function(){return this.node.getBoundingClientRect()}};return Layer});SinaEditor.regist("ui.WinBox",function(SE){var Util=SE.Util,DOMUtil=SE.DOMUtil;var WinBox=function(opts,name){var dialog,self=this,$dom;if("alert"===opts.type){dialog=winDialog.alert(opts.text,opts,name)}else if("confirm"===opts.type){dialog=winDialog.confirm(opts.text,opts,name)}else{dialog=winDialog.create(opts,name)}if(dialog){dialog.getNode=this.getNode;$dom=new DOMUtil;dialog.$dom=$dom;this.$supper=dialog;return dialog}};Util.mix(WinBox.prototype,{getNode:function(name){return this.nodes[name]},destroy:function(){this.destroyed=!0;this.$supper.destroy()},__updateDialogPosition:function(dialog){if(this.destroyed){return}dialog.setMiddle()}});return WinBox});SinaEditor.regist("ui.Button",function(SE){var DOMUtil=SE.DOMUtil,Event=SE.Event,Util=SE.Util,HTMLTemplate=SE.ui.HTMLTemplate;function Button(opts){var self=this;opts=self.opts=Util.extend({id:"",name:"",html:"",icon:"",activeCls:"active",disableCls:"disable",position:"relative",entityName:"entity",tooltip:""},opts);var domUtil=self.domUtil=opts.domUtil||new DOMUtil;self.node=null;self.name=opts.name;self.id=opts.id||opts.name;self.html=opts.html;self.__bindFunc=[];self.event=new Event;if(self.id){self.node=domUtil.$("#"+self.id)[0]}if(self.node){self.node.title=opts.tooltip}}Button.prototype={constructor:Button,actived:!1,disabled:!1,destroyed:!1,node:null,getNode:function(name){var self=this;if(self.destroyed){throw new Error("按钮已被销毁")}if(!self.node){self.node=self.createNode(self.html)}return name?this.tmpl?this.tmpl.getNode(name):null:this.node},createNode:function(html){var self=this,domUtil=self.domUtil,node,frag;if(html){self.tmpl=new HTMLTemplate(html);frag=domUtil.createElementByHTML(self.tmpl.getHtmlString())}else{throw new Error("html 未定义")}self.id=self.tmpl.getNodeId(self.opts.entityName);if(!domUtil.hasClass(self.icon)){domUtil.addClass(self.icon)}if(self.tooltip){node.title=self.tooltip}return this.node=node},on:function(name,func){this.event.on(this,name,func)},off:function(name,func){this.event.off(this,name,func)},fire:function(name,data){var args=Util.toArray(arguments);args.unshift(this);this.event.fire.apply(this.event,args)},destroy:function(){var self=this,domUtil=self.domUtil;domUtil.each(self.__bindFunc,function(i,item){self.off(item.name,item.func)});domUtil.remove(self.node);self.destroyed=!0;self.node=null},setPos:function(x,y){},active:function(){var self=this;self.domUtil.addClass(self.node,self.opts.activeCls);self.actived=!0;self.disabled=!1},normal:function(){var self=this;self.domUtil.delClass(self.node,self.opts.activeCls);self.actived=!1;self.disabled=!1},disable:function(){var self=this;self.domUtil.delClass(self.node,self.opts.activeCls);self.domUtil.addClass(self.node,self.opts.disableCls);self.actived=!1;self.disabled=!0}};return Button});SinaEditor.regist("ui.GroupButton",function(SE){var DOMUtil=SE.DOMUtil,Button=SE.ui.Button,Event=SE.Event,Util=SE.Util,HTMLTemplate=SE.ui.HTMLTemplate;function GroupButton(opts){var self=this;opts=self.opts=Util.extend({name:"",icon:"",activeCls:"active",disableCls:"disable",tooltip:"",entityName:"entity",contentName:"content",buttons:[]},opts);var domUtil=self.domUtil=opts.domUtil||new DOMUtil;self.node=null;self.name=opts.name;self.id=opts.id;self.html=opts.html;self.exec=opts.exec||opts.name;self.__bindFunc=[];self.event=new Event;if(self.id){self.node=domUtil.$("#"+self.id)[0]}var buttons=self.buttons=[];domUtil.each(opts.buttons,function(i,btnCfg){var button=new Button(Util.merge(btnCfg,{icon:opts.icon,activeCls:opts.activeCls,disableCls:opts.disableCls},false,true));buttons.push(button)})}GroupButton.prototype={constructor:GroupButton,actived:!1,disabled:!1,destoried:!1,node:null,createNode:function(html){var self=this,domUtil=self.domUtil,opts=self.opts,entity;if(html){self.tmpl=new HTMLTemplate(html);domUtil.createElementByHTML(self.tmpl.getHtmlString());entity=self.tmpl.getNode(opts.entityName);self.id=entity}return entity},on:function(name,func){this.event.on(this,name,func)},off:function(name,func){this.event.off(this,name,func)},fire:function(name,data){var args=Util.toArray(arguments);args.unshift(this);this.event.fire.apply(this.event,args)},destroy:function(){var self=this,domUtil=self.domUtil;domUtil.each(self.buttons,function(i,btn){btn.destroy()});self.buttons=null},getNode:function(){var self=this;if(self.destoried){throw new Error("按钮组已被销毁")}return self.node||(self.node=self.createNode(self.html))},setPos:function(x,y){},active:function(name){var self=this;self.domUtil.each(self.buttons,function(p,btn){if(name==btn.name){btn.active()}else{btn.normal()}})},normal:function(name){var self=this;if(!name){self.domUtil.buttons[name].normal()}else{self.domUtil.each(self.buttons,function(p,btn){btn.normal()})}},disable:function(name){var self=this;if(!name){self.domUtil.buttons[name].disable()}else{self.domUtil.each(self.buttons,function(p,btn){btn.disable()})}}};return GroupButton});SinaEditor.regist("ui.ToolBar",function(SE){var DOMUtil=SE.DOMUtil,Event=SE.Event,Util=SE.Util,GroupButton=SE.ui.GroupButton,Button=SE.ui.Button;function ToolBar(opts,editor){var self=this;self.that={};self.domUtil=new DOMUtil;self.__buttons=[];self.editor=editor;self.cmds=[];self.opts=Util.extend({id:"toolbar",name:"main",renderTo:"",tpl:"",cls:"BNE_editor_color BNE_editor_color1",style:{zIndex:300},showClass:"BNE_editor_cur",buttons:[]},opts);self.name=self.opts.name;self.event=new Event;self.init();editor.addToolbar(self)}ToolBar.prototype={constructor:ToolBar,init:function(){var self=this,opts=self.opts,renderTo=opts.renderTo,domUtil=self.domUtil;if(!self.opts.id){return}if(renderTo&&"string"===typeof renderTo){renderTo=domUtil.$(renderTo)[0]}else if(!renderTo){renderTo=domUtil.doc.body}if(!(self.toolBarCon=domUtil.$("#"+self.opts.id)[0])){self.toolBarCon=domUtil.create("div",{id:self.opts.id,className:self.opts.cls});domUtil.setStyle(self.toolBarCon,this.opts.style);renderTo.appendChild(self.toolBarCon)}if(opts.tpl){self.setTpl()}self.render(opts.buttons)},render:function(buttons){var self=this,btn,btnCfg;for(var i=0,len=buttons.length;i<len;i++){btnCfg=buttons[i];if("group"==btnCfg.type){btn=new GroupButton(btnCfg);self.addGroupButton(btn)}else{btn=new Button(btnCfg);self.addButton(btn)}}},setTpl:function(){var tpl=this.opts.tpl;this.toolBarCon.innerHTML=tpl},addButton:function(btn){var self=this,domUtil=self.domUtil,node=btn.getNode();if(!domUtil.contains(self.toolBarCon,node)){self.toolBarCon.appendChild(node)}domUtil.on(node,"click",function(e){e.preventDefault();self.editor.fire("toolbar."+btn.name+".click",self)});domUtil.on(node,"mouseover",function(e){e.preventDefault();self.editor.fire("toolbar."+btn.name+".mouseover",self)});domUtil.on(node,"mouseout",function(e){e.preventDefault();self.editor.fire("toolbar."+btn.name+".mouseout",self)});if(btn.opts.exec){var execs=btn.opts.exec.toLowerCase().split(" ");domUtil.each(execs,function(i,cmd){self.cmds.push(cmd)})}else{self.cmds.push(btn.name)}btn.toobar=self;self.__buttons.push(btn);return node},addGroupButton:function(groupBtn){var self=this,domUtil=self.domUtil,opts=groupBtn.opts,content,node=groupBtn.getNode();if(node){content=groupBtn.getNode(opts.contentName)||node;domUtil.each(groupBtn.buttons,function(i,btn){var entity=btn.getNode();content.appendChild(entity);self.addButton(btn)});if(!domUtil.contains(self.toolBarCon,node)){self.toolBarCon.appendChild(node)}}else{domUtil.each(groupBtn.buttons,function(i,btn){self.addButton(btn)})}groupBtn.toolbar=self;self.__buttons.push(groupBtn);return node},getButton:function(name){var btn=null;this.domUtil.each(this.__buttons,function(i,item){if(name==item.name){btn=item;return!1}});return btn},on:function(name,func){this.event.on(this,name,func)},off:function(name,func){this.event.off(this,name,func)},fire:function(name,data){var args=Util.toArray(arguments);args.unshift(this);this.event.fire.apply(this.event,args)},remove:function(widget){var node=widget.getNode();widget.destroy();node.parentNode.removeChild(node)},setPos:function(x,y){var entity=this.toolBarCon;this.domUtil.setStyle(entity,{left:parseInt(x||0,10)+"px",top:parseInt(y||0,10)+"px",position:"absolute"})},getPos:function(){var top=this.toolBarCon.style.top,left=this.toolBarCon.style.left;return{top:top,left:left}},getRect:function(){return this.domUtil.getRect(this.toolBarCon)},show:function(func,y,useAnimate){var x,self=this;if(typeof func==="number"){x=func}else if(typeof func==="function"){x=func.call(this)}else{x=0}if(this.isHidden||!useAnimate||!SinaEditor.animate){this.setPos(x,y);this.toolBarCon.style.display="inline-block";if(this.opts.showClass){editor.domUtil.addClass(this.toolBarCon,this.opts.showClass)}this.isHidden=false}else{var old=this.getPos();var ofst={left:x-parseInt(old.left),top:y-parseInt(old.top)};SinaEditor.animate({duration:150,fps:60,func:function(args){var f=args.currFrame/args.frames;self.toolBarCon.style.left=parseInt(old.left)+f*ofst.left+"px";self.toolBarCon.style.top=parseInt(old.top)+f*ofst.top+"px"}})}this.fire("show",this)},hide:function(){this.isHidden=true;this.toolBarCon.style.display="none";if(this.opts.showClass){editor.domUtil.delClass(this.toolBarCon,this.opts.showClass)}},isShow:function(){return this.toolBarCon.style.display!="none"},destroy:function(){},setTarget:function(target){this.__target=target},getTarget:function(){return this.__target}};return ToolBar});SinaEditor.animate=function(args){var timeout=function(w,a){return w["r"+a]||w["webkitR"+a]||w["r"+a]||w["mozR"+a]||w["msR"+a]||w["oR"+a]}(window,"equestAnimationFrame");var animate=SinaEditor.animate;var duration=args.duration||1e3;var fps=args.fps||60;var cfg={fps:fps,currFrame:0,frames:Math.ceil(duration*fps/1e3)};if(animate.animating){return}animate.animating=true;var run=function(){if(cfg.currFrame>=cfg.frames){clearInterval(timer);if("function"==typeof args.callback){args.callback(cfg)}animate.animating=false;return}else{if(timeout){timeout(run)}}cfg.currFrame++;args.func(cfg)};if(!timeout){var timer=setInterval(run,1e3/cfg.fps)}else{timeout(run)}};SinaEditor.PluginManager.register("toolBar",function(opts,editor){var SE=SinaEditor,DOMUtil=SE.DOMUtil,Button=SE.ui.Button,ToolBar=SE.ui.ToolBar,GroupButton=SE.ui.GroupButton,Util=SE.Util;var mainToolbar,hasFire=false,domUtil=new DOMUtil;opts=Util.extend({id:"toolbar",tpl:"",name:"main"},opts);function onSelectionChange(e,range){var editorSelection=editor.selection,tmpRange=range.cloneRange(),typeToolBar=mainToolbar,toolbar=typeToolBar.toolBarCon,hasChange=false;function toShowToolbar(){if(onSelectionChange.timer){window.clearTimeout(onSelectionChange.timer)}var rangePos=getRangePos(tmpRange);if(!rangePos){typeToolBar.hide();editor.fire("toolbar.hidden",typeToolBar,tmpRange);return}if(editor.fire("toolbar.beforeshow",typeToolBar,tmpRange)===false){return}var left=rangePos.left,top=rangePos.top;var pos=typeToolBar.getPos();if(pos.left!=left+"px"||pos.top!=top+"px"){hasChange=true;typeToolBar.show(function(){editor.fire("toolbar.show",this);range=range.startContainer.parentNode?range:editor.getRange(true);var elementPath=editor.domUtil.getElementPath(range);editor.fire("toolbar.selectionchange",range,elementPath,this);return left},top,true)}else if(!typeToolBar.isShow()){typeToolBar.show(left,top)}editor.fire("toolbar.aftershow",typeToolBar,tmpRange)}if(tmpRange&&!tmpRange.collapsed){if(typeToolBar.isShow()){if(onSelectionChange.timer){window.clearTimeout(onSelectionChange.timer)}onSelectionChange.timer=window.setTimeout(function(){if(typeToolBar.isShow()){toShowToolbar()}},100)}else{toShowToolbar()}}else{typeToolBar.hide();editor.fire("toolbar.hidden",typeToolBar)}return hasChange}function getRangePos(range){if(range.collapsed){return}range.shrinkBoundary();var bkmk=range.createBookMarkByClone("pos"),sc=range.startContainer,so=range.startOffset,ec=range.endContainer,eo=range.endOffset,bs=bkmk.bookmark.start,be=bkmk.bookmark.end,hack=SinaEditor.env.$msie&&SinaEditor.env.version<8,topOfst=55,leftOfst=hack?0:0,domUtil=editor.domUtil,filter=function(node){return node.nodeType==3&&!domUtil.isBookMarkTag(node.parentNode)&&!!SinaEditor.noSpaceReg.test(node.nodeValue)||domUtil.isBookMarkTag(node)};var nextTxt=domUtil.getFilterTreeDom(bs,null,filter,true),lastTxt=nextTxt,tmp=nextTxt;if(!nextTxt||domUtil.isBookMarkTag(nextTxt)){range.moveToBookMarkByClone(bkmk);return false}while(tmp&&!domUtil.isBookMarkTag(tmp)){lastTxt=tmp;tmp=domUtil.getFilterTreeDom(tmp,null,filter,true)}var testNode=editor.doc.createElement("span");testNode.style.display="inline-block";testNode.innerHTML="1";nextTxt.parentNode.insertBefore(testNode,nextTxt);var bso=domUtil.getPos(testNode);testNode.innerHTML="﻿";if(lastTxt.nextSibling){lastTxt.parentNode.insertBefore(testNode,lastTxt.nextSibling)}else{lastTxt.parentNode.appendChild(testNode)}var beo=domUtil.getPos(testNode),left,top,typeToolBar=mainToolbar,toolbar=typeToolBar.toolBarCon,ofst;if(beo.top-1===bso.top){beo.top=bso.top}if(!typeToolBar.isShow()){toolbar.style.display="";ofst=toolbar.offsetWidth/2;toolbar.style.display="none"}else{ofst=toolbar.offsetWidth/2}ofst=ofst+leftOfst;range.setStart(nextTxt,1);range.collapse(true);if(beo.top===bso.top){top=beo.top-topOfst;left=bso.left+(beo.left-bso.left)/2-ofst}else{top=bso.top-topOfst;left=bkmk.body.offsetWidth/2+domUtil.getPos(bkmk.body).left-ofst}domUtil.remove(testNode);testNode=null;range.moveToBookMarkByClone(bkmk);nextTxt=null;return{left:left,top:top}}editor.on("pluginOnLoaded",function(){mainToolbar=new ToolBar(opts,editor);mainToolbar.hide();domUtil.each(editor.plugins,function(i,pluginItem){var pluginBars,btn;if(pluginItem&&(pluginBars=pluginItem.toolBars)){domUtil.each(pluginBars,function(i,btnOpt){if("group"===btnOpt.type){btn=new GroupButton(btnOpt);mainToolbar.addGroupButton(btn)}else{btn=new Button(btnOpt);mainToolbar.addButton(btn)}})}});editor.on("afterCommand",function(e,cmdName,range,elementPath){if(!cmdName||!Util.inArray(mainToolbar.cmds,cmdName)){return}if(!onSelectionChange(e,range)){editor.fire("toolbar.selectionchange",range,elementPath,mainToolbar)}});editor.on("selectionchange",function(e,range,cause){if(cause!="command"){onSelectionChange(e,range)}});domUtil.hover(editor.body,function onMouseOver(e,elem){editor.fire("toolbar.paragraphenter",elem,mainToolbar)},function onMouseOut(e,elem){editor.fire("toolbar.paragraphleave",elem,mainToolbar)},'p,div[se-img="wrapper"],h1,h2')})});SinaEditor.PluginManager.register("initDivContent",function(opt,editor){var SE=SinaEditor,Util=SE.Util,DOMUtil=SE.DOMUtil,Selection=SE.Selection,self=this,time=+new Date;opt=Util.extend({id:"SinaEditor_"+time,formId:"SinaEditor_form_"+time,clz:""},opt,editor.options);var domUtil=new DOMUtil;var box=editor.opts.root;if("string"===typeof box){box=domUtil.$(box)[0]}if(!box){return}domUtil.attr(box,"contentEditable","true");domUtil.addClass(opt.clz);editor.win=window;editor.doc=document;editor.body=box;editor.domUtil=new DOMUtil(editor.doc,editor.win,box);editor.selection=new Selection(editor.doc,editor);editor.fire("contentOnLoaded")});SinaEditor.PluginManager.register("basestyle",function(options,editor){var SE=SinaEditor,PluginManager=SE.PluginManager,Util=SE.Util;var allowExec={bold:["strong","b"],italic:["em","i"],underline:["u"]};var __execCommands=[{name:"bold",exec:"bold",activeCls:"hovered"},{name:"italic",exec:"italic",activeCls:"hovered"},{name:"underline",exec:"underline",activeCls:"hovered"}];var hashCommands={};options=Util.extend({},options);var execCommands=Util.extend(__execCommands,options&&options.execCommands);for(var i=0;i<execCommands.length;i++){var opt=execCommands[i];hashCommands[opt.name]=opt;!function(opt){PluginManager.register(opt.name,function(opts){});PluginManager.addPlugin.call(editor,{name:opt.name,params:opt});editor.on("toolbar."+opt.name+".click",function(){editor.exec(opt.exec,opt.attrs)});editor.on("toolbar.selectionchange",function(e,range,path,toolbar){var state=editor.queryCommandState(opt.exec,range,hashCommands[name]&&hashCommands[name].attrs,toolbar),func,btn=toolbar.getButton(opt.name);func={"-1":"disable",0:"normal",1:"active"}[state];if(func){btn[func]&&btn[func].call(btn)}})}(opt)}var queryState=function(cmdName,range,attrs){var tags=allowExec[cmdName]||[],i=0,range=editor.selection.getRange();if(typeof options.disabled=="function"&&options.disabled(range)){return-1}range.shrinkBoundary();var start=range.getStart();var domUtil=editor.domUtil;if(attrs){var isEmptyAttr=true;for(var a in attrs){isEmptyAttr=false;break}var parents=domUtil.parents(start);if(!parents||parents.length==0){return 0}else{var testDom=domUtil.doc.createElement(tags[0]);domUtil.setAttributes(testDom,attrs);for(var i=0;i<parents.length;i++){var curr=parents[i];if(attrs.style&&domUtil.isSameStyle(parents[i],testDom)&&domUtil.isSameElement(parents[i],testDom)){testDom=null;return 1}if(domUtil.isSameElement(parents[i],testDom)){testDom=null;return 1}}testDom=null;return 0}}else{var curr=start;while(curr&&curr!=domUtil.body){if(domUtil.isSpecificParent(curr,tags,true)){return 1}curr=curr.parentNode}return 0}};for(var cmdName in allowExec){!function(cmdName){var tags=allowExec[cmdName];editor.registerCmd(cmdName,{queryCommandState:function(tags,range,attrs,toolbar){return queryState(cmdName,range,attrs)},exec:function(cmd,attrs){var execName=allowExec[cmd];if(!execName){return}var tag=execName[0];var range=this.selection.getRange();var start=range.startContainer,end=range.endContainer;var state=queryState(cmd,null,attrs);if(range.collapsed){if(state==1){var tmpText=editor.doc.createTextNode("");range.insertNode(tmpText);range.setStartBefore(tmpText);range.setEndAfter(tmpText);range.removeInlineTag(tags,attrs,true);range.setStartBefore(tmpText)}else if(state==0){var tmpNode=editor.doc.createElement(tags[0]);var tmpTxt=editor.doc.createTextNode(SinaEditor.spaceChar);tmpNode.appendChild(tmpTxt);range.insertNode(tmpNode);range.setStart(tmpTxt,1)}else{return}range.collapse(true);range.select()}else{if(state==1){range.removeInlineTag(tags,attrs)}else if(state==0){range.insertInlineTag(tag,attrs)}else{return false}}return},queryCommandValue:function(){}})}(cmdName)}return{toolBars:execCommands}});SinaEditor.PluginManager.register("title",function(options,editor){var SE=SinaEditor,Util=SE.Util;options=Util.extend({},options);var titleFormat=function(range,tag,attrs,isReset){if(isReset===-1){return false}var domUtil=editor.domUtil;var bookmark=range.createBookMark(),filterFn=function(node){return node.nodeType==1?!node.getAttribute(editor.holder)&&node.tagName.toLowerCase()!="br"&&!domUtil.isBookMarkTag(node):!!SinaEditor.noSpaceReg.test(node.nodeValue)};range.boundaryToBlock();var bookmark2=range.createBookMark(),current=domUtil.getFilterTreeDom(bookmark2.start,false,filterFn),tmpRange=range.cloneRange(),tmpNode;while(current&&!(domUtil.getNodePosition(current,bookmark2.end)&2)){if(current.nodeType==3||!domUtil.isBlock(current)){tmpRange.setStartBefore(current);while(current&&current!==bookmark2.end&&!domUtil.isBlock(current)){tmpNode=current;current=domUtil.getFilterTreeDom(current,false,null,null,function(node){return!domUtil.isBlock(node)})}tmpRange.setEndAfter(tmpNode);var common=tmpRange.getCommonAncestor();if(domUtil.body!=common&&domUtil.isBlock(common)){if(isReset){var testDom=domUtil.create(tag);domUtil.setAttributes(testDom,attrs);if(testDom.tagName==common.tagName){var p=domUtil.create("P");domUtil.copyAttrs(common,p);domUtil.each(attrs,function(i,n){if(i=="style"){var props=n.match(/[\w\-]+(?=\s*\:\s*)/g);if(!props){return}domUtil.each(props,function(ii,nn){var regExp=new RegExp(""+nn+"\\s*\\:\\s*[^;]+(;|$)","igm");p.style.cssText=p.style.cssText.replace(regExp,"")})}});domUtil.removeToAllChilds(common,p);domUtil.insertBefore(p,common);domUtil.remove(common);current=p;testDom=null}}else{if(common.tagName.toLowerCase()!=tag.toLowerCase()){var dom=domUtil.create(tag);domUtil.removeToAllChilds(common,dom);domUtil.insertBefore(dom,common);domUtil.copyAttrs(common,dom);domUtil.remove(common);common=dom;dom=null}domUtil.setAttributes(common,attrs);current=common}}else{if(isReset){}else{var dom=range.doc.createElement(tag);domUtil.setAttributes(dom,attrs);var frag=tmpRange.extractContents();dom.appendChild(frag);tmpRange.insertNode(dom);current=dom}}current=domUtil.getFilterTreeDom(current,false,filterFn)}else{current=domUtil.getFilterTreeDom(current,false,filterFn,true)}}range.moveToBookMark(bookmark2);range.moveToBookMark(bookmark)};function queryState(range,tag,attrs){if(options&&"function"==typeof options.disabled&&options.disabled(range)){return-1}var domUtil=range.domUtil,start=range.getStart(),result=false,attrs=attrs||{},parents=domUtil.parents(start),testDom=domUtil.create(tag);domUtil.setAttributes(testDom,attrs);while(parents&&parents.length>0){var curr=parents.shift();if(curr==domUtil.body){break}if(domUtil.isBlock(curr)){if(curr.tagName.toLowerCase()==tag.toLowerCase()){if(testDom.tagName==curr.tagName){result=true}}break}}testDom=null;return result}var tags={h1:{},h2:{}};editor.registerCmd("title",{queryCommandState:function(cmdName,range,tag){var attrs=tags[tag];return queryState(range,tag,attrs)},exec:function(cmdName,tag){var attrs=tags[tag];if(attrs===undefined){return false}var range=editor.selection.getRange();titleFormat(range,tag,attrs,queryState(range,tag,attrs))}})});SinaEditor.PluginManager.register("titleBtn",function(options,editor){var toolBars=[];var tags=["h1","h2"];for(var i=0;i<tags.length;i++){var tag=tags[i];!function(al){var tag=al;editor.on("toolbar.selectionchange",function(e,rng,path,toolbar){var getBtn=function(tag){return toolbar.getButton("title_"+tag+"_btn")};var btn=getBtn(tag);var actived=!editor.queryCommandState("title",rng,tag);if(actived){btn.normal()}else{if(actived==-1){}else{btn.active()}}});editor.on("toolbar.title_"+al+"_btn.click",function(e,toolbar){var btn=toolbar.getButton("title_"+al+"_btn");editor.exec("title",al)})}(tag);toolBars.push({id:"title_"+tag+"_btn",name:"title_"+tag+"_btn",exec:"title",tooltip:"",activeCls:"hovered"})}return{toolBars:toolBars}});SinaEditor.PluginManager.register("justify",function(options,editor){var justifyFormat=function(range,align){var domUtil=editor.domUtil,bookmark=range.createBookMark(),filterFn=function(node){return node.nodeType==1?!node.getAttribute(editor.holder)&&node.tagName.toLowerCase()!="br"&&!domUtil.isBookMarkTag(node):!!SinaEditor.noSpaceReg.test(node.nodeValue)};range.boundaryToBlock();var bookmark2=range.createBookMark(),current=domUtil.getFilterTreeDom(bookmark2.start,false,filterFn),tmpRange=range.cloneRange(),tmpNode;while(current&&!(domUtil.getNodePosition(current,bookmark2.end)&2)){if(current.nodeType==3||!domUtil.isBlock(current)){tmpRange.setStartBefore(current);while(current&&current!==bookmark2.end&&!domUtil.isBlock(current)){tmpNode=current;current=domUtil.getFilterTreeDom(current,false,null,null,function(node){return!domUtil.isBlock(node)})}tmpRange.setEndAfter(tmpNode);var common=tmpRange.getCommonAncestor();if(domUtil.body!=common&&domUtil.isBlock(common)){domUtil.setAttributes(common,{style:"text-align:"+align});current=common}else{var p=range.doc.createElement("p");domUtil.setAttributes(p,{style:"text-align:"+align});var frag=tmpRange.extractContents();p.appendChild(frag);tmpRange.insertNode(p);current=p}current=domUtil.getFilterTreeDom(current,false,filterFn)}else{current=domUtil.getFilterTreeDom(current,false,filterFn,true)}}range.moveToBookMark(bookmark2);range.moveToBookMark(bookmark)};var queryState=function(cmdName,range){var range=editor.getRange(true);if(options&&typeof options.disabled=="function"&&options.disabled(range)){return-1}var start=range.getStart(),domUtil=range.domUtil,next,parents=domUtil.parents(start),value;while(next=parents.shift()){if(!next){return"left"}if(domUtil.isBlock(next)){value=next.style.cssText.match(/text\-align\s*:\s*(left|right|center)/i);value=value?value[1]?value[1]:"left":"left";break}}range=null;return value||"left"};editor.registerCmd("justify",{queryCommandState:queryState,exec:function(cmdName,align){var state=queryState("justify");if(state!==-1&&state!=align){justifyFormat(editor.selection.getRange(),align)}}})});SinaEditor.PluginManager.register("justifyBtn",function(options,editor){var toolBars=[{type:"group",name:"justify",activeCls:"hovered",buttons:[]}];var aligns=["left","center","right"];for(var i=0;i<aligns.length;i++){var align=aligns[i];!function(align){editor.on("toolbar.justify_"+align+"_btn.click",function(e,toolbar){var btn=toolbar.getButton("justify_"+align+"_btn");if(!btn.actived){editor.exec("justify",align)}})}(align);toolBars[0].buttons.push({id:"justify_"+align+"_btn",name:"justify_"+align+"_btn",exec:"justify",tooltip:"",activeCls:"hovered"})}editor.on("toolbar.selectionchange",function(e,rng,path,toolbar){var btn=toolbar.getButton("justify");var align=editor.queryCommandState("justify",rng);if(align!==-1){btn.active("justify_"+align+"_btn")}});return{toolBars:toolBars}});SinaEditor.PluginManager.register("colorPicker",function(options,editor){var SE=SinaEditor,Util=SE.Util,dtd=SE.dtd;options=Util.extend({fixTagA:""},options);editor.on("beforeCommand",function(e,cmd,range){if(options.fixTagA=="skip"&&cmd=="link"){resetColor()}});function rgb2hex(rgbColor){function apply0(hex){return hex.length==1?"0"+hex:hex}var rgbColor=rgbColor.toLowerCase();if(rgbColor.indexOf("rgb")!=0){return rgbColor}var r,g,b,match;match=rgbColor.match(/^rgb\((\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\)\s*/);if(match.length!=4){return rgbColor}r=parseInt(match[1]);g=parseInt(match[2]);b=parseInt(match[3]);return"#"+apply0(r.toString(16))+apply0(g.toString(16))+apply0(b.toString(16))}function resetColor(){var tagReg=new RegExp("^(?:"+"SPAN)$","i"),removeFormatAttributes=[],style="color",range=editor.getRange(),bookmark,node,parent,domUtil=editor.domUtil,filter=function(node){return node.nodeType==1};function isRedundantSpan(node){if(node.nodeType==3||node.tagName.toLowerCase()!="span"){return 0}if(SinaEditor.env.$msie){var attrs=node.attributes;if(attrs.length){for(var i=0,l=attrs.length;i<l;i++){if(attrs[i].specified){return 0}}return 1}if(SinaEditor.env.version<9){attrs=[];var html=node.outerHTML;html.replace(/\s+([a-z0-9]+)(=['"]?([^='"\s>]+)['"]?(?=>|\s+?))?/i,function(a,b,c,d){if(b!="bookmarkTag"&&b!="style"){attrs.push({nodeType:2,value:d,nodeName:b})}})}}return!node.attributes.length}function doRemove(range){var bookmark1=range.createBookMark();if(range.collapsed){}var aNode=domUtil.isSpecificParent(range.startContainer,"a",true);if(aNode){range.setStartBefore(aNode)}aNode=domUtil.isSpecificParent(range.endContainer,"a",true);if(aNode){range.setEndAfter(aNode)}bookmark=range.createBookMark();node=bookmark.start;while((parent=node.parentNode)&&!domUtil.isBlock(parent)){domUtil.breakParent(node,parent);domUtil.clearSpecialNode(node)}if(bookmark.end){node=bookmark.end;while((parent=node.parentNode)&&!domUtil.isBlock(parent)){domUtil.breakParent(node,parent);domUtil.clearSpecialNode(node)}var current=domUtil.getFilterTreeDom(bookmark.start,null,filter,false),next,reg=new RegExp(style+"\\s*:[^;]*(?=;|$)","gi");while(current){if(current==bookmark.end){break}next=domUtil.getFilterTreeDom(current,null,filter,true);if(!dtd.$empty[current.tagName.toLowerCase()]&&!domUtil.isBookMarkTag(current)){if(tagReg.test(current.tagName)){if(style){domUtil.setCSSText(current,current.style.cssText.replace(reg,""));if(isRedundantSpan(current)&&style.toLowerCase()!="text-decoration"){domUtil.remove(current,true)}}else{domUtil.remove(current,true)}}else{if(!dtd.$tableContent[current.tagName]&&!dtd.$list[current.tagName]){if(isRedundantSpan(current)){domUtil.remove(current,true)}}}}current=next}}range.moveToBookMark(bookmark);range.moveToBookMark(bookmark1);var node=range.startContainer,tmp,collapsed=range.collapsed;while(node.nodeType==1&&isEmptyNode(node)&&dtd.$removeEmpty[node.tagName]){tmp=node.parentNode;range.setStartBefore(node);if(range.startContainer===range.endContainer){range.endOffset--}domUtil.remove(node);node=tmp}if(!collapsed){node=range.endContainer;while(node.nodeType==1&&isEmptyNode(node)&&dtd.$removeEmpty[node.tagName]){tmp=node.parentNode;range.setEndBefore(node);domUtil.remove(node);node=tmp}}}function isEmptyNode(node){if(node.nodeType!=1){return false}var childs=0,child,i=0;while(child=node.childNodes[i]){if(child.nodeType==3&&SinaEditor.noSpaceReg.test(child.nodeValue)){childs++;break}if(child.nodeType==1){if(child.tagName=="BR"&&node.childNodes.length==1){childs++;break}else{if(!isEmptyNode(child)){childs++;break}}}i++}return childs===0}doRemove(range);range.moveToTxtNode()}editor.registerCmd("color",{queryCommandState:function(cmdName,range){var range=range||editor.getRange();var start=range.getStart(),domUtil=range.domUtil,next,parents=domUtil.parents(start),color;while(next=parents.shift()){if(!next){return""}if(next.tagName=="SPAN"){color=domUtil.getStyle(next,"color");if(color){return rgb2hex(color)}}}return""},exec:function(cmdName,color,isSave){if(this.queryCommandState("color",range)){resetColor()}var range=editor.getRange(),domUtil=editor.domUtil;if(options.fixTagA==="boundary"){var aNode=domUtil.isSpecificParent(range.startContainer,"a",true);if(aNode){range.setStart(aNode,0)}aNode=domUtil.isSpecificParent(range.endContainer,"a",true);if(aNode){range.setEnd(aNode,1)}}range.insertInlineTag("span",{style:"color:"+color+";"},function(node){if(options.fixTagA=="skip"){if(node.nodeType==1&&node.tagName=="A"||node.parentNode.tagName=="A"){return false}var nodes=domUtil.isSpecificParent(node,"a",true);return!nodes}return true})}});editor.registerCmd("resetColor",{exec:function(cmdName){resetColor()}})});!function(){var SE=SinaEditor,Util=SE.Util,DOMUtil=SE.DOMUtil;function ColorPickerBtn(options,editor){var domUtil=editor.domUtil,Layer=SE.ui.Layer,me=this,isSave=true,currToolbar,currDom;this.options=Util.extend({},this.DEFAULT,options);var html=templateToHtml(this.options.html,this.options.template,this.options.colors);var pickerLayer=new Layer({html:html});var selector=this.options.delegateSelector;editor.on("toolbar.colorPickerBtn.click",function(e,toolbar){toolbar.hide();var pos=toolbar.getPos();pickerLayer.show(pos);var color=editor.queryCommandState("color",editor.getRange())||me.options.resetColor;
var panel=pickerLayer.getNode("panel");var doms=domUtil.$("[colorValue]",panel),curr;while(doms.length){curr=doms.pop();domUtil.delClass(curr,me.options.pickerActiveCls)}var dom1=editor.doc.getElementById("color_range_"+me.options.resetColor);var dom2=editor.doc.getElementById("color_range_"+color);if(dom1){}if(dom2){domUtil.addClass(dom2,me.options.pickerActiveCls);currDom=dom2}currToolbar=toolbar});editor.on("toolbar.selectionchange",function(e,rng,path,toolbar){var color=editor.queryCommandState("color",rng);color=color==me.options.resetColor?"":color;editor.fire("plugin.colorPickerBtn.ok",toolbar.getButton("colorPickerBtn"),color)},false);editor.on("toolbar.show toolbar.hidden",function(e){pickerLayer.hide()});var panel=pickerLayer.getNode("panel");domUtil.on(panel,"mouseover",function(e){domUtil.addClass(this,me.options.pickerActiveCls)},false,selector);domUtil.on(panel,"mouseout",function(e){if(currDom!=this){domUtil.delClass(this,me.options.pickerActiveCls)}},false,selector);domUtil.on(panel,"click",function(e){pickerLayer.hide();var color=this.getAttribute("colorValue"),btn;if(me.options.resetColor==color){editor.exec("resetColor")}else{editor.exec("color",color)}if(currToolbar){btn=currToolbar.getButton("colorPickerBtn")}color=color==me.options.resetColor?"":color;if(color){var range=editor.getRange();var aNode=domUtil.isSpecificParent(range.startContainer,"a",true);if(aNode){color=editor.queryCommandState("color",range)}}editor.fire("plugin.colorPickerBtn.ok",btn,color);editor.selection.getRange().select()},false,selector);domUtil.each(this.options.events,function(i,n){editor.on(i,n)});return{toolBars:[{id:"colorPicker",name:"colorPickerBtn",exec:"color resetColor",tooltip:"字体颜色",activeCls:"hovered"}]}}ColorPickerBtn.prototype.DEFAULT={colors:["#cc0000","#d56a00","#a29900","#55a455","#3398cc","#663399","#cc0066","#cdcdce","#333333"],html:['<div id="#{panel}" style="display:none;position:absolute;z-index:301;" class="BNE_editor_color BNE_editor_color1" ><{colors}></div>'].join(""),template:'<span class="color_all" style="background-color:<{color}>" colorValue="<{color}>" id="color_range_<{color}>"></span>',activeCls:"hovered",pickerActiveCls:"clicked",delegateSelector:"span.color_all",resetColor:"#333333",events:{}};function templateToHtml(html,template,colors,resetColor){var arr=[],i=0;for(;i<colors.length;i++){arr.push(template.replace(/<\{color\}>/gi,colors[i]));if(colors[i]===resetColor){arr[arr.length-1]}}var colorHtml=arr.join("");arr=null;return html.replace(/<\{colors}\>/,colorHtml)}SinaEditor.PluginManager.register("colorPickerBtn",ColorPickerBtn)}();!function(SE){var Util=SE.Util;var VK=SE.VK;function UndoManager(options,editor){var segments=[],index=0,me=this,prevTime,hotKey,timer,isSaveRange=false,isInputting=false;me.editor=editor;me.options=Util.extend({},me.DEFAULT,options);me.editor=editor;me.getSegment=function(index){return segments[index]||null};me.getIndex=function(){return index};me.setSegment=function(index,object){if(segments[index]){Util.extend(segments[index],object)}return segments[index]};me.pushSegment=function(range,content,contentWithRange){segments=segments.slice(0,index+1);if(segments.length>me.options.maxRange){segments.shift()}index=segments.push({range:range,content:content,contentWithRange:contentWithRange})-1;if(segments.length>me.options.maxRange){segments.shift();index--}};me.getCurrentSegment=function(){return me.getSegment(index)};hotKey=me.options.hotKey;function isHotKey(evt){var hotKey=UndoManager.hotKey;if(!hotKey){return false}var execCommand=hotKey.getExecByEvent(evt);return execCommand&&execCommand.exec=="todo"}editor.on("saveUndo",function(e,saveRange,saveContent){me.save(saveRange,saveContent)});editor.on("ready",function(){var domUtil=editor.domUtil;editor.on("keydown",function(e,evt){if(VK.modifierPressed(evt)||VK.metaKeyPressed(evt)){return}var rng=editor.selection.getRange(true);if(!isHotKey(evt)){if(timer){clearTimeout(timer)}timer=window.setTimeout(function(){if(isInputting){return}me.save();timer=null},me.options.saveTimer);if(!rng.collapsed){me.save(true,false);isSaveRange=true;if(timer){clearTimeout(timer)}}}});editor.on("keyup",function(e,evt){if(isInputting){return}if(isSaveRange){me.save();isSaveRange=false}});editor.on("beforeCommand",function(e,cmdName,range){if(!editor._callCmdFn("queryNoUndoState",[cmdName,range])){me.save(true,false)}});editor.on("afterCommand",function(e,cmdName,range){if(!editor._callCmdFn("queryNoUndoState",[cmdName,range])){me.save(false,true,range)}},false);editor.on("compositionstart",function(e,evt){isInputting=true});editor.on("compositionend",function(){isInputting=false})});function checkAction(action){return action=="undo"?index>0&&segments.length>0:index<segments.length-1}editor.registerCmd("todo",{queryCommandState:function(cmdName){return checkAction(cmdName)},exec:function(cmdName,action){if(checkAction(action)){if(action=="undo"&&(!segments[index]||segments.length==1)){segments=[];index=0;return}if(action=="redo"&&!segments[index]){index=segments.length-1;return}me.todo(action=="undo"?--index:++index)}},queryNoUndoState:function(cmdName){return true}});if(hotKey){editor.on("plugin.hotkey",function(e,hotkey){UndoManager.hotKey=hotkey;hotkey.registerHotkey([{exec:"todo",params:"undo",hotkeys:hotKey.undo},{exec:"todo",params:"redo",hotkeys:hotKey.redo}])})}}UndoManager.prototype={constructor:UndoManager,DEFAULT:{maxRange:10,hotKey:{undo:["ctrl+90"],redo:["ctrl+89"]},saveTimer:500},save:function(saveRange,saveContent,range){var me=this,editor=me.editor,range=range||editor.getRange(true);try{if(!range){return}saveContent=saveContent===false?false:true;var content=editor.getContent(null,true),currentSegment=me.getCurrentSegment(),contentWithRange="";if(saveRange&&currentSegment&&currentSegment.content==content&&!range.collapsed){var cBook=range.createBookMarkByClone("undo_range");contentWithRange=cBook.content;range.moveToBookMarkByClone(cBook);if(contentWithRange!==currentSegment.contentWithRange){var index=me.getIndex();me.setSegment(index,{range:range,contentWithRange:contentWithRange})}}if(saveContent){if(!currentSegment||currentSegment.content!=content){var cBook=range.createBookMarkByClone("undo_range");contentWithRange=cBook.content;range.moveToBookMarkByClone(cBook);me.pushSegment(range,content,contentWithRange)}}}catch(e){console.log(e.message,"  ",e.stack)}},todo:function(idx){var segment=this.getSegment(idx),editor=this.editor;if(segment){editor.setContent(segment.contentWithRange,true);segment.range.moveToBookMark("undo_range")}else{}}};SE.PluginManager.register("undo",UndoManager)}(SinaEditor);SinaEditor.PluginManager.register("enterkey",function(options,editor){var SE=SinaEditor,VK=SE.VK,Util=SE.Util;var tag=options.tagName||"p",allowTags=["br","p"];function replaceEnterTag(tag){var dom=editor.domUtil,noDoList=["ul","ol","dl","p","h1","h2","h3","h4","h5","h6"];if(!Util.inArray(allowTags,tag)){return}var range=editor.selection.getRange(true);var start=range.startContainer,offset=range.startOffset;if(start.nodeType==1){start=start.childNodes[offset]}if(start&&dom.isSpecificParent(start,noDoList)){if(start.nodeType==3&&offset===start.nodeValue.length){var tmpTxt=editor.doc.createTextNode("​");start.parentNode.appendChild(tmpTxt)}return}if(start&&start.nodeType==1&&start.tagName=="BR"){}editor.doc.execCommand("formatBlock",false,"<"+tag+">");var node=range.startContainer;if(node.childNodes.length==1&&node.childNodes[0].nodeType==1&&node.childNodes[0].tagName=="BR"){var space=editor.doc.createTextNode("​");node.insertBefore(space,node.childNodes[0]);node.removeChild(node.childNodes[1])}}editor.on("keydown",function(e,evt){if(evt.keyCode==VK.ENTER){evt=editor.domUtil.fixEvent(evt);if(false!==editor.fire("beforeenter",evt)){replaceEnterTag(tag);window.setTimeout(function(){var rng=editor.getRange(true).cloneRange();rng.boundaryToBlock();var block=rng.startContainer;if(block&&block!=editor.domUtil.body){block.style.cssText="";if(/h\d/gi.test(block.tagName)){editor.doc.execCommand("formatBlock",false,"<p>")}}editor.fire("afterenter",evt);editor.fire("undosave",true,true)},0)}else{evt.preventDefault()}}})});SinaEditor.PluginManager.register("deletekey",function(options,editor){var SE=SinaEditor,VK=SE.VK,BACKSPACE=VK.BACKSPACE,DELETE=VK.DELETE,env=SE.env,spaceCharCode=SE.spaceChar.charCodeAt(0);function resoleDelete(isDelete){var range=editor.getRange(true);var start=range.startContainer;var startOffset=range.startOffset;if(startOffset==0&&start.parentNode==editor.domUtil.body&&editor.domUtil.body.firstChild==start){if(!range.collapsed){range.deleteContents()}var tmpRange=range.cloneRange();tmpRange.boundaryToBlock();if(tmpRange.startContainer!=editor.domUtil.body){tmpRange.startContainer.style.cssText="";if(tmpRange.startContainer.tagName!="p"){editor.doc.execCommand("formatBlock",false,"<p>")}var node=editor.doc.createTextNode(SinaEditor.spaceChar);tmpRange.setStart(editor.body.firstChild,0);tmpRange.insertNode(node);tmpRange.collapse(true);tmpRange.select(true)}return true}else{if(env.$belowIe9){if(!range.collapsed){range.createBookMark("tmp_ie");range.deleteContents();range.removeBookMark("tmp_ie");range.select(true);return true}else{range.createBookMark("tmp_ie");range.removeBookMark("tmp_ie");range.select(true)}}}return false}editor.on("keydown",function(e,nativeEvent){nativeEvent=editor.domUtil.fixEvent(nativeEvent);var keyCode=nativeEvent.keyCode||nativeEvent.which,result;var isDelete=keyCode==DELETE;if(keyCode==BACKSPACE||isDelete){result=editor.fire("beforedelete",nativeEvent);if(false!==result){if(resoleDelete(isDelete)){nativeEvent.preventDefault()}}else{nativeEvent.preventDefault()}}});editor.on("keyup",function(e,nativeEvent){nativeEvent=editor.domUtil.fixEvent(nativeEvent);var keyCode=nativeEvent.keyCode||nativeEvent.which;var isDelete=keyCode==DELETE;if(keyCode==BACKSPACE||isDelete){}})});SinaEditor.PluginManager.register("paste",function(options,editor){var SE=SinaEditor,Util=SE.Util,env=SE.env;options=Util.extend({getType:function(range){return"text/html"}},options);function pastebin(range,content){var div=editor.doc.createElement("div");div.style.display="inline";div.innerHTML=content;if(!div.firstChild){return}if(!range.collapsed){range.deleteContents()}if(typeof options.getType==="function"&&options.getType(range)=="text/plain"){var text=div.textContent||div.innerText;if(text){var txtNode=editor.doc.createTextNode(text);range.insertNode(txtNode);range.setStartAfter(txtNode);range.select(true)}return}range.moveToTxtNode(false,false,true);var currNode,frag,fillTxt=editor.doc.createTextNode("pastebin");frag=editor.doc.createDocumentFragment();var start=range.startContainer,offset=range.startOffset,_hasCurrNode=false;if(!SinaEditor.env.$msie&&SinaEditor.env.version<=10){var brStart=range.startContainer;if(brStart.nodeType==3&&range.startOffset>=brStart.nodeValue.length&&brStart.nextSibling&&brStart.nextSibling.nodeType==1){brStart=brStart.nextSibling}if(brStart.nodeType==1&&brStart.tagName=="BR"){while(brStart&&brStart.parentNode&&brStart.parentNode!=editor.domUtil.body){if(editor.domUtil.isBlock(brStart.parentNode)){range.setStartBefore(brStart);editor.domUtil.remove(brStart);range.collapse(true);break}brStart=brStart.parentNode}start=range.startContainer,offset=range.startOffset}}var tmpRange=range.cloneRange();tmpRange.boundaryToBlock();var _start=tmpRange.startContainer;if(tmpRange.startContainer!=editor.domUtil.body){tmpRange.setStart(start,offset);if(tmpRange.endContainer!=editor.domUtil.body){tmpRange.setEndAfter(tmpRange.endContainer)}var _frag=tmpRange.extractContents();var dom=_frag.firstChild,firstChild=div.firstChild;if(editor.domUtil.isBlock(_start)){if(firstChild){if(editor.domUtil.isBlock(firstChild)){while(firstChild.firstChild){currNode=firstChild.firstChild;_start.appendChild(firstChild.firstChild)}editor.domUtil.remove(firstChild)}else{currNode=firstChild;_start.appendChild(firstChild)}}}if(dom&&div.lastChild){if(!dom.firstChild){_frag.removeChild(dom)}else{if(div.lastChild.nodeType==3){currNode=div.lastChild;_hasCurrNode=true;dom.insertBefore(div.lastChild,dom.firstChild);div.appendChild(dom)}if(div.lastChild.nodeType==1){if(editor.domUtil.isBlock(div.lastChild)){currNode=div.lastChild.lastChild||div.lastChild}else{currNode=div.lastChild;dom.insertBefore(div.lastChild,dom.firstChild)}_hasCurrNode=true;div.appendChild(dom)}}range.setStartAfter(_start);range.collapse(true)}else{while(_frag.firstChild&&_frag.firstChild.firstChild){currNode=_frag.firstChild.firstChild;_start.appendChild(_frag.firstChild.firstChild)}}}while(div.lastChild){if(div.lastChild.nodeType==1||div.lastChild.nodeType==3){if(!_hasCurrNode){currNode=div.lastChild}var _currNode=div.lastChild;if(frag.firstChild){frag.insertBefore(_currNode,frag.firstChild)}else{frag.appendChild(_currNode)}}else{editor.domUtil.remove(div.lastChild)}}range.insertNode(frag);range.setStartAfter(currNode);range.collapse(true);range.select(true);editor.fire("afterpaste",range);editor.fire("saveUndo",!range.collapsed,true)}editor.ready(function(){var domUtil=editor.domUtil,id;var filter=new SinaEditor.FilterHTML(domUtil);editor.on("paste",function(e,evt){try{if(id){evt.preventDefault();return}var range=editor.getRange(true);var bookmark=range.createBookMark("pasteBin");var div=editor.doc.createElement("div");id="pasteBin_"+ +new Date;div.id=id;if(env.$webkit){var txt=editor.doc.createTextNode("​​");div.appendChild(txt)}domUtil.body.appendChild(div);range.setStart(div,0);bookmark.start.style.display="";div.style.cssText="position:absolute;width:1px;height:1px;overflow:hidden;left:-1000px;white-space:nowrap;z-index:-9999";if(env.$msie&&env.version<=10){var text=window.clipboardData.getData("text");var texts=text.split(/[\n|\r]/g),txt="";while(true){var txt=texts.shift();if(txt===undefined){break}txt=Util.trim(txt);if(txt==""){continue}div.innerHTML+="<p>"+txt+"</p>"}evt.preventDefault()}if(!env.$webkit){range.collapse(true)}else{range.setEnd(div,1)}range.select(true);editor.fire("beforepaste");window.setTimeout(function(){var div=editor.doc.getElementById(id);if(!div){return}domUtil.remove(div);var html=filter.pasteHtml(div);id=null;try{range.moveToBookMark("pasteBin");pastebin(range,html)}catch(e){}div=null},0)}catch(err){evt.preventDefault()}})})});!function(SE){var Util=SE.Util,VK=SE.VK;var word2num={};var word=0;for(;word<=9;word++){word2num[word]=48+word}word=97;var end=97+26;for(;word<end;word++){word2num[String.fromCharCode(65+word-97)]=65+word-97;word2num[String.fromCharCode(word)]=65+word-97}function keySort(key){var sort={ctrl:1,alt:2,shift:3};var keys=key.toLowerCase().split(/\s*\+\s*/g);keys.sort(function(a,b){if(sort[a]&&sort[b]){if(sort[a]>sort[b]){return 1}else if(sort[a]<sort[b]){return-1}else{return 0}}return 0});var keyCode=keys[keys.length-1];if(word2num[keyCode]){keys[keys.length-1]=word2num[keyCode]}return keys.join("+")}function HotkeyManager(options,editor){var me=this,keylist=[];me.hashKeys={};me.options=Util.extend({keylist:[{exec:"bold",params:null,hotkeys:["ctrl+alt+66","ctrl+66"]}]},options);keylist=me.options.keylist;me.registerHotkey(keylist);editor.on("ready",function(){me.clickInit()})}HotkeyManager.prototype.getExecByEvent=function(e){var me=this,hashKeys=me.hashKeys,key="",keyCode=e.keyCode||e.which;if(e.ctrlKey||SinaEditor.env.mac&&e.metaKey){key+="ctrl+"}if(e.altKey){key+="alt+"}if(e.shiftKey){key+="shift+"}key+=word2num[keyCode]||keyCode;return hashKeys[key]||null};HotkeyManager.prototype.clickInit=function(){var me=this;editor.on("keydown",function(evt,e){if(VK.modifierPressed(e)||VK.metaKeyPressed(e)){var execCommand=me.getExecByEvent(e);if(execCommand){e.preventDefault();var exec="function"===typeof execCommand.exec?execCommand.exec.call(editor):execCommand.exec;if(exec&&typeof exec=="string"){var params="function"===typeof execCommand.params?execCommand.params.call(editor):execCommand.params;editor.exec(exec,params)}}}})};HotkeyManager.prototype.registerHotkey=function(keylist){var me=this;if(!Util.isArray(keylist)){keylist=[keylist]}for(var key=0;key<keylist.length;key++){var hotkey=keylist[key].hotkeys;if("string"==typeof hotkey){me.hashKeys[keySort(hotkey)]=keylist[key]}else if(Util.isArray(hotkey)){for(var k=0;k<hotkey.length;k++){me.hashKeys[keySort(hotkey[k])]=keylist[key]}}}};SE.PluginManager.register("hotkey",HotkeyManager)}(SinaEditor);SinaEditor.PluginManager.register("link",function(options,editor){editor.registerCmd("link",{queryCommandState:function(cmd,rng,elementPath){var state=!1;editor.domUtil.each(elementPath,function(i,item){if("A"===item.nodeName.toUpperCase()){state=!0;return false}});return state},exec:function(cmd,opt){var rng=editor.getRange();var ancestor=rng.getCommonAncestor();if(3==ancestor.nodeType){ancestor=ancestor.parentNode}if(0!==editor.domUtil.$("a",ancestor).length){rng.removeInlineTag("a")}rng.insertInlineTag("a",{href:opt.url,target:"_blank"})}});editor.registerCmd("unlink",{exec:function(cmd){var rng=editor.getRange();rng.removeInlineTag("a")}})});!function(){SinaEditor.PluginManager.register("linkBtn",function(options,editor){var SE=SinaEditor,DOMUtil=SE.DOMUtil,ENV=SE.env,Layer=SE.ui.Layer,VK=SE.VK,Util=SE.Util;var $dom=new DOMUtil;var linkPanel=null;function unLink(){editor.exec("unlink")}function addLink(url){if(0!==url.indexOf("http://")){url="http://"+url}editor.exec("link",{url:url})}function bindInput(input,panel){var emptyTxt=$dom.attr(input,"placeholder");$dom.on(input,"keydown mousedown",function(e){e=$dom.fixEvent(e);var target=e.target;if(emptyTxt==Util.trim(target.value)){target.value=""}});$dom.on(input,"blur",function(e){e=$dom.fixEvent(e);var target=e.target;if(""==Util.trim(target.value)){target.value=emptyTxt}});$dom.on(input,"keyup",function(e){e=$dom.fixEvent(e);var target=e.target;var addBtn=panel.getNode("add");var url=Util.trim(target.value);if(url){$dom.text(addBtn,"添加");if(VK.ENTER===e.keyCode){addLink(url);target.value="";linkPanel.hide()}}else{$dom.text(addBtn,"返回")}})}function bindAddBtn(addBtn,input){$dom.on(addBtn,"click",function(e){e=$dom.fixEvent(e);var url=Util.trim(input.value);if(url){addLink(url)}linkPanel.hide();e.preventDefault()})}function link(toolbar,html){var pos=toolbar.getPos(),input=null,addBtn=null;if(!linkPanel){linkPanel=new Layer({html:html});linkPanel.show(pos);input=linkPanel.getNode("address");addBtn=linkPanel.getNode("add");bindInput(input,linkPanel);bindAddBtn(addBtn,input)}else{linkPanel.show(pos);input=linkPanel.getNode("address")}var holder=$dom.attr(input,"placeholder");if(9>ENV.version&&ENV.msie){input.value=holder}else{input.value=""}}function init(){var html=['<div id="#{panel}" class="BNE_editor_color BNE_editor_color1 BNE_editor_cur" style="z-index:301;position:absolute;">','<input placeholder="请输入链接地址" id="#{address}" class="input_link" type="text">','<a class="add_link" href="javascript:void(0)" title="" id="#{add}">返回</a>','<i class="arrow-down"></i>',"</div>"].join("");editor.on("toolbar.linkbtn.click",function(e,toolbar){var btn=toolbar.getButton("linkBtn");if(btn.actived){unLink()}else{link(toolbar,html)}});editor.on("toolbar.selectionchange",function(e,rng,path,toolbar){var state=editor.queryCommandState("link",rng,path);var btn=toolbar.getButton("linkBtn");if(state){btn.active()}else{btn.normal()}});editor.on("selectionchange",function(){if(linkPanel){linkPanel.hide()}})}init();return{toolBars:[{id:"link",name:"linkBtn",exec:"link unlink",tooltip:"加链接",activeCls:"hovered"}]}})}();!function(){var uploadHolder={checkFlashVersion:function(){var obj=deconcept.SWFObjectUtil.getPlayerVersion();if(obj.major<10){return false}return true},installTip:function(){if(!this.checkFlashVersion()){this.alert('我们的产品需要安装flashplayer 10或更高版本，请 <a href="http://get.adobe.com/flashplayer">点击此处</a> 免费下载',{width:550})}},instance:null,setUp:function(container,opts){var self=this;if(self.instance){return}self.instance=new UploadImage(container,"newFileUpload",{width:47,height:41,noMarker:true,zIndex:30,nodes:{relatedId:false},flashFile:"fileuploadv6.swf",click:opts.click,error:opts.error,selectFile:opts.selectFile,uploadFinish:opts.uploadFinish,allFinish:opts.allFinish});window.uploadImage=self.instance;window.uploadImageIsRead=function(){return self.isReady()}},isReady:function(){if(this.instance){return true}else{return false}},alert:function(text,opts){opts.type="alert";opts.text=text;return new SinaEditor.ui.WinBox(opts,"upload_image_error")}};SinaEditor.uploadHolder=uploadHolder}();SinaEditor.PluginManager.register("image",function(options,editor){var domUtil=editor.domUtil,env=SinaEditor.env;function findImageNode(el,name){var seImg;while(el&&el!==editor.body){seImg=domUtil.attr(el,"se-img");if(seImg==name){return el}el=el.parentNode}}editor.registerCmd("insertImg",{exec:function(cmd,frag,target){domUtil.insertBefore(frag,target)}});editor.registerCmd("imageAlign",{queryCommandState:function(cmd,item){var state="";if("IMG"===item.nodeName.toUpperCase()){var floatStyle=editor.domUtil.getStyle(findImageNode(item,"wrapper"),"float");if(!floatStyle||"none"==floatStyle.toLowerCase()){floatStyle="Center"}state="align"+floatStyle.replace(/^([a-z])/,function($1){return $1.toUpperCase()})}return state},exec:function(cmd,style,nodes){domUtil.each(nodes,function(p,el){domUtil.setCSSText(el,style[p])});if(env.$ie6){var img=nodes.img;var oWidth=domUtil.attr(img,"original-width");var width=domUtil.getStyle(img,"max-width");if(oWidth>width){img.width=parseInt(width)}}}})});SinaEditor.PluginManager.register("imageBtn",function(options,currentEditor){var SE=SinaEditor,DOMUtil=SE.DOMUtil,VK=SE.VK,Util=SE.Util,env=SE.env,ToolBar=SE.ui.ToolBar,Layer=SE.ui.Layer,uploadHolder=SE.uploadHolder,isBelowIe8=env.$msie&&env.version<8;var $dom=new DOMUtil;var domUtil=currentEditor.domUtil;var uploadBtn,uploadImages=[];var currentParagraph;var defaultBase64URL="http://simg.sinajs.cn/blog7style/images/blog_editor/bne_img.gif";var ALIGN_CENTER_CSS={wrapper:{"font-size":"17px","line-height":"28px","padding-top":"5px","_user-select":"none"},imgParent:{overflow:"hidden","text-align":"center",padding:"0 0 34px",".user-select":"none"},img:{"max-width":"100%",".user-select":"none"},span:{color:"#999",display:"block",padding:"5px 7px 0","font-size":"14px","line-height":"20px","text-align":"center","font-style":"italic",outline:"none",".user-select":"none"}};var ALIGN_LEFT_CSS=Util.merge({wrapper:{"float":"left","margin-top":"6px",padding:"0 24px 24px 0",width:"323px"},imgParent:{width:"323px"},img:{"max-width":"323px"}},ALIGN_CENTER_CSS,true,true);var ALIGN_RIGHT_CSS=Util.merge({wrapper:{"float":"right","margin-top":"6px;",padding:"0 0 24px 24px",width:"323px"},imgParent:{width:"323px"},img:{"max-width":"323px"}},ALIGN_CENTER_CSS,true,true);var IMG_TIPS="填写图片摘要（选填）";function findPic(name){var returnObj;domUtil.each(uploadImages,function(i,pic){if(name===pic.name){returnObj=pic;return false}});return returnObj}function findImageNode(el,name){var seImg;if(3===el.nodeType){el=el.parentNode}var returnValue,pn;while(el){seImg=domUtil.attr(el,"se-img");if(seImg==name){returnValue=el}pn=el.parentNode;if(pn==currentEditor.body){break}else{el=el.parentNode}}if(!returnValue&&el&&el!==currentEditor.body&&domUtil.contains(editor.body,el)){returnValue=domUtil.$('*[se-img="'+name+'"]',el)[0]}return returnValue}function createUploadBtn(){try{var wrapperCSSText=["position:absolute;","overflow:hidden;","display:block;","top:-300px;","cursor:pointer;","margin-bottom:30px;","_width:47px;_height:41px;"].join("");var id="se-image-upload-btn";var inputCSSText="z-index:20;font-size:100px;left:0px;top:0px;position:absolute;opacity:0;filter:alpha(opacity=0);width:35px;height:28px;";var hoverBtnHtml=['<div id="#{panel}" style="',wrapperCSSText,'">','<i id="se-image-upload-btn" class="icon i21_img" style="_positon:absolute;_left:0px;_top:0px;"></i>','<div id="uploadimgflash" style="position:absolute;top:0px;left:0px;z-index:30;"></div>',"</div>"].join("");var hoverBtn=new Layer({html:hoverBtnHtml});hoverBtn.isIn=function(){return $dom.attr(this.getNode("panel"),"hoverIn")};$dom.hover(hoverBtn.node,function(e){$dom.attr(this,"hoverIn","1");$dom.setStyle($dom.$("#"+id),{backgroundPosition:"-370px -250px"})},function(e){$dom.removeAttr(this,"hoverIn");$dom.setStyle($dom.$("#"+id),{backgroundPosition:"-320px -250px"});hideHoverLayer()});return hoverBtn}catch(e){console.error(e.stack)}}function createDeleteBtn(){return domUtil.create("a",{"se-img":"delete",href:"javascript:;",className:"icon i23_imghover",innerHTML:"&nbsp;",style:{position:"absolute",display:"none",top:"-1000px"}})}function createImg(url,filename){var extraAttr='contenteditable="false" ';var html=['<div se-img="img-parent" ',extraAttr,">",'<a se-img="link" ',extraAttr,'href="about:blank;" target="_blank">',"<img ",extraAttr,'se-img="img" src="',url,'">',"</a>",'<span se-img="span" contenteditable="true">',IMG_TIPS,"</span>","</div>"].join("");var wrapper=domUtil.create("div",{innerHTML:html,"se-img":"wrapper",contenteditable:"false"});var img=domUtil.$("img",wrapper)[0];domUtil.attr(img,"se-name",filename);var span=domUtil.$("span",wrapper)[0];var link=domUtil.$("a",wrapper);return{wrapper:wrapper,imgParent:wrapper.children[0],img:img,span:span}}function createToolbar(){var ids={left:"tb_imagealign_left",center:"tb_imagealign_center",right:"tb_imagealign_right"};var alignHtml=['<a id="',ids.left,'" class="color1_a" action="left" href="javascript:void(0);"><i class="icon i15_l_img"></i></a>','<a id="',ids.center,'" class="color1_a" action="center" href="javascript:void(0);"><i class="icon i16_c_img"></i></a>','<a id="',ids.right,'" class="color1_a" action="right" href="javascript:void(0);"><i class="icon i17_r_img"></i></a>','<i class="arrow-down"></i>'].join("");var opts={id:"image_align_toolbar",tpl:alignHtml,cls:"BNE_editor_color BNE_editor_color2",name:"imageToolBar",groupSpace:"|",pos:[100,200],buttons:[{type:"group",name:"imageAlign",activeCls:"hovered",buttons:[{id:ids.left,name:"alignLeft",tooltip:"居左"},{id:ids.center,name:"alignCenter",tooltip:"居中"},{id:ids.right,name:"alignRight",tooltip:"居右"}]}]};var toolbar=new ToolBar(opts,currentEditor);return toolbar}function renderImage(pic,img){var images=!img?domUtil.$('img[se-name="'+pic.name+'"]',domUtil.body):Util.isArray(img)?img:[img];if(0==images.length){return}var url=getImgStaticPath(pic.pid,"mw690");var linkUrl="http://album.sina.com.cn/pic/"+pic.pid;domUtil.each(images,function(i,img){var link=findImageNode(img,"link");link.href=linkUrl;var tempImage=new Image;var errorCount=0;tempImage.onload=function(){img.src=url;var css={width:"",height:""};domUtil.setStyle(img,css);domUtil.removeAttr(img,"se-name");if(env.$ie6){var maxWidth=parseInt(domUtil.getStyle(img,"max-width"));maxWidth<tempImage.width&&(img.width=maxWidth);domUtil.attr(img,"original-width",img.width)}var deleteBtn=findImageNode(img,"delete");if(deleteBtn){resetDeleteBtnPos(img,deleteBtn)}};tempImage.onerror=function(){tempImage.src=url+"?"+errorCount;errorCount++;if(0<errorCount){tempImage.onerror=null;domUtil.attr(img,"se-name","load-error");domUtil.remove(findImageNode(img,"wrapper"))}};tempImage.src=url})}function uploadFinish(fileName,result){if(result.code==="A00006"){domUtil.each(result.data.pics,function(p,pic){uploadImages.push({name:pic.name,pid:pic.pid});renderImage(pic)})}}function bindClick(layer){var codeMsgMap={};$dom.on(layer.node,"click",function(e){uploadHolder.installTip()});function selectFile(filesname){var frag=domUtil.createFragment();v7sendLog("16_01_11");domUtil.each(filesname,function(i,filename){var nodes=createImg(defaultBase64URL,filename);domUtil.each(nodes,function(p,el){domUtil.setCSSText(el,ALIGN_CENTER_CSS[p])});domUtil.setStyle(nodes.img,{});frag.appendChild(nodes.wrapper)});currentEditor.exec("insertImg",frag,insertParagraph)}function btnClick(){insertParagraph=currentParagraph}function showError(imgs,name,msg){domUtil.each(imgs,function(i,img){domUtil.text(img.nextSibling,msg)})}function uploadError(code,name,msg){name=name||"";if(code=="A00650"){uploadHolder.alert("每次最多可以上传20张图片，稍后继续上传！",{width:570})}else{var imgs=domUtil.$('img[se-name="'+name+'"]',currentEditor.body);if(imgs.length){domUtil.remove(findImageNode(imgs[0],"wrapper"))}codeMsgMap[code]=msg}}function allFinish(total,finishFiles,cancelFiles,errorFiles){var msg=[],hasOutOfLimit=false;domUtil.each(errorFiles,function(i,errorInfo){if("A06004"===errorInfo.code){hasOutOfLimit=true}else if(errorInfo.name){msg.push(errorInfo.name+":"+codeMsgMap[errorInfo.code]);domUtil.each(domUtil.$('img[se-name="'+errorInfo.name+"]"),function(i,img){var pn;if(img.src===defaultBase64URL){pn=findImageNode(img,"wrapper");domUtil.remove(pn)}})}});if(0!==msg.length||hasOutOfLimit){var msgTxt="请选择不超过"+(scope.$is_photo_vip?"10":"5")+"M 且格式为 jpg、gif、png的图片";if(!scope.$is_photo_vip){msg.unshift('<a target="_blank" href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/points_redeem.php?type=3" style="color:red">150积分开通大图上传</a>')}uploadHolder.alert(msgTxt,{width:550,subText:msg.join("<br/>")})}}function imageInfo(name,width,height){var imgs=domUtil.$('img[se-name="'+name+'"]');width=parseInt(width,10);height=parseInt(height,10);if(width>670){var ratio=height/width;width=670;height=parseInt(ratio*width,10)}domUtil.setStyle(imgs,{width:width+"px",height:height+"px"})}uploadHolder.setUp("uploadimgflash",{click:btnClick,error:uploadError,selectFile:selectFile,uploadFinish:uploadFinish,allFinish:allFinish,imageInfo:imageInfo});var input=$dom.$('input[name="pic1"]',layer.getNode("panel"))[0];var insertParagraph;if(!input){return}function onInputChange(e){var target=e.target,files=target.files,frag=domUtil.createFragment();domUtil.each(files,function(i,file){var url=URL.createObjectURL(file);var nodes=createImg(url,file.name);domUtil.each(nodes,function(p,el){domUtil.setCSSText(el,ALIGN_CENTER_CSS[p])});frag.appendChild(nodes.wrapper)});currentEditor.exec("insertImg",frag,insertParagraph)}$dom.on(input,"change",onInputChange);$dom.on(input,"click",btnClick)}function getStart(rng){var start=rng.startContainer;return 1===start.nodeType?start.childNodes.item(rng.startOffset):start}function getNodes(obj){var img;if(obj.startContainer){img=getStart(obj)}else{img=obj}if("IMG"!==img.nodeName.toUpperCase()){return}var imgParent=findImageNode(img,"img-parent");var wrapper=imgParent.parentNode;var span=domUtil.$("span",wrapper)[0];return{wrapper:wrapper,img:img,imgParent:imgParent,span:span}}function isImage(obj){var el;if(obj.startContainer){el=getStart(obj)}else{el=obj}var isImg=el&&"IMG"==el.nodeName.toUpperCase();if(isImg){domUtil.attr(el,"se-holder")&&(isImg=false)}return isImg&&domUtil.attr(el,"se-img")}function isInEditor(){return domUtil.attr(currentEditor.body,"hoverIn")}var lastTimer;function hideHoverLayer(){if(lastTimer){clearTimeout(lastTimer)}lastTimer=setTimeout(function(){if(uploadBtn.isIn()||isInEditor()){return}uploadBtn.setPos(-1e4,-1e4)},2e3)}function newLine(el){var wrapper=findImageNode(el,"wrapper");var newParag=domUtil.create("p",{innerHTML:SinaEditor.env.$webkit?'<br se-holder="1"/>':""});return domUtil.insertAfter(newParag,wrapper)}function resetSpanText(span,rng){domUtil.text(span,"");rng.setStart(span,0);rng.collapse(true);rng.select()}function resetDeleteBtnPos(target,deleteBtn){if(!deleteBtn){return}var imgParent=findImageNode(target,"img-parent");domUtil.setStyle(imgParent,{position:"relative"});var border=0,left=0;if(SinaEditor.env.$msie){border=parseInt(domUtil.getStyle(target,"border"),10);if(target.getBoundingClientRect){left=target.getBoundingClientRect().left-imgParent.getBoundingClientRect().left}else{left=target.offsetLeft}isNaN(border)&&(border=0)}else{left=target.offsetLeft}var width=target.offsetWidth;domUtil.setStyle(deleteBtn,{left:left+parseInt(width,10)+border-deleteBtn.offsetWidth+"px"})}function init(){var offsetLeft,imgToolbar,toolbarWith,toolbarHeight,isInputting;function setImageToolbarPos(target){var offset=domUtil.getPos(target);if(!toolbarWith){var rect=imgToolbar.getRect();
toolbarWith=rect.width/2+10;toolbarHeight=rect.height+10}domUtil.each(domUtil.$('img[se-img="img"]'),function(i,img){domUtil.setStyle(img,{border:"","box-sizing":""})});domUtil.setStyle(target,{border:"2px solid #0f0f0f","box-sizing":"border-box"});imgToolbar.show(offset.left+target.offsetWidth/2-toolbarWith,offset.top-toolbarHeight);imgToolbar.setTarget(target);currentEditor.fire("toolbar.imageToolBar.show",target);var deleteBtn=findImageNode(target,"delete");if(deleteBtn){resetDeleteBtnPos(target,deleteBtn)}}currentEditor.on("toolbar.paragraphenter",function(e,target,toolbar){var wrapper=findImageNode(target,"wrapper");if(wrapper){var style=domUtil.getStyle(wrapper,"float");if("right"==style){uploadBtn&&uploadBtn.setPos(-1e3,-1e3);return}}var offset=domUtil.getPos(target);if(!uploadBtn){uploadBtn=createUploadBtn();offsetLeft=uploadBtn.node.offsetWidth+10;bindClick(uploadBtn)}currentParagraph=target;offset.left=offset.left-offsetLeft;uploadBtn.setPos(offset.left,offset.top-15)});currentEditor.on("toolbar.paragraphleave",function(e,target,toolbar){if(!uploadBtn){return}hideHoverLayer()});domUtil.on(currentEditor.body,"click",function(e){var target=e.target;if(!isImage(target)){return}if(!imgToolbar){imgToolbar=createToolbar()}setImageToolbarPos(target)},false,'img[se-img="img"]');domUtil.on(currentEditor.body,"mousedown",function(e){e=domUtil.fixEvent(e);var target=e.target;var wrapper=findImageNode(target,"wrapper");var span=findImageNode(wrapper,"span");var deleteBtn=findImageNode(wrapper,"delete");if(target==span||domUtil.contains(deleteBtn,target)){return}var rng=currentEditor.getRange();rng.setStart(span,0);rng.collapse(true);rng.select(true)},false,'div[se-img="wrapper"]');domUtil.hover(currentEditor.body,function(e){e=domUtil.fixEvent(e);var target=e.target;if("IMG"!==target.nodeName.toUpperCase()){target=domUtil.$("img",e.target)[0]}if(!target){return}var deleteBtn=findImageNode(target,"delete");if(!deleteBtn){deleteBtn=createDeleteBtn();var lastDeleteFunc=Util.bind(function(){var imgDom=findImageNode(this,"wrapper");domUtil.remove(imgDom);deleteBtn=null;lastDeleteFunc=null;currentEditor.fire("saveUndo");v7sendLog("16_01_12")},target);deleteBtn.onclick=lastDeleteFunc}domUtil.setStyle(deleteBtn,{top:"0px",display:"block",zIndex:20,cursor:"pointer"});domUtil.insertAfter(deleteBtn,findImageNode(target,"link"));resetDeleteBtnPos(target,deleteBtn)},function(e){e=domUtil.fixEvent(e);var target=e.target;if("IMG"!==target.nodeName.toUpperCase()){target=domUtil.$("img",e.target)[0]}var wrapperDom=findImageNode(target,"wrapper");var deleteBtns=domUtil.$('a[se-img="delete"]',wrapperDom);domUtil.each(deleteBtns,function(i,btn){btn.onclick=null;domUtil.remove(btn)});wrapperDom.style.position=""},'div[se-img="wrapper"]');domUtil.on(currentEditor.body,"click",function(e){e=domUtil.fixEvent(e);var span=e.target;if(IMG_TIPS===domUtil.text(span)){var rng=currentEditor.getRange();resetSpanText(span,rng)}v7sendLog("16_01_13")},false,'span[se-img="span"]');domUtil.on(currentEditor.body,"keyup",function(e){e=domUtil.fixEvent(e);var span=e.target;if(!isInputting){var index=domUtil.text(span).indexOf(IMG_TIPS);if(-1!==index){span.childNodes[0].deleteData(index,IMG_TIPS.length)}}},false,'span[se-img="span"]');currentEditor.on("compositionstart",function(e,evt){isInputting=true});currentEditor.on("compositionend",function(){isInputting=false});domUtil.on(currentEditor.doc.body,"click",function(e){e=domUtil.fixEvent(e);var target=e.target,seImg=domUtil.attr(target,"se-img"),rng,start;if(seImg=="img-parent"){rng=currentEditor.getRange();start=rng.startContainer;if(IMG_TIPS==start.nodeValue){resetSpanText(start.parentNode,rng);return}}if("span"!==seImg){var spanArr=domUtil.$('span[se-img="span"]',currentEditor.body);domUtil.each(spanArr,function(i,span){if(!Util.trim(domUtil.text(span))){domUtil.text(span,IMG_TIPS)}})}});domUtil.hover(currentEditor.body,function(){domUtil.attr(this,"hoverIn","1")},function(){domUtil.removeAttr(this,"hoverIn")});currentEditor.on("toolbar.alignCenter.click",function(e,toolbar){var image=toolbar.getTarget();var nodes=getNodes(image);currentEditor.exec("imageAlign",ALIGN_CENTER_CSS,nodes);setImageToolbarPos(image);v7sendLog("16_01_15")});currentEditor.on("toolbar.alignLeft.click",function(e,toolbar){var image=toolbar.getTarget();var nodes=getNodes(image);currentEditor.exec("imageAlign",ALIGN_LEFT_CSS,nodes);setImageToolbarPos(image);v7sendLog("16_01_14")});currentEditor.on("toolbar.alignRight.click",function(e,toolbar){var image=toolbar.getTarget();var nodes=getNodes(image);currentEditor.exec("imageAlign",ALIGN_RIGHT_CSS,nodes);setImageToolbarPos(image);v7sendLog("16_01_16")});currentEditor.on("toolbar.imageToolBar.show",function(e,img){var align=currentEditor.queryCommandState("imageAlign",img);if(!align){return}var btn=imgToolbar.getButton("imageAlign");if(btn){btn.active(align)}});domUtil.on(currentEditor.body,"click",function(evt){if(imgToolbar&&!imgToolbar.isHidden&&!isImage(evt.target)){imgToolbar&&imgToolbar.hide();domUtil.each(domUtil.$('img[se-img="img"]'),function(i,img){domUtil.setStyle(img,{border:"","box-sizing":""})})}});domUtil.on(currentEditor.body,"dragstart",function(e){e.preventDefault();return false},false,"img");currentEditor.on("beforeenter",function(e,evt){var target=domUtil.fixEvent(evt).target,wrapper,newPrag,rng=currentEditor.getRange(),start=domUtil.getStart(rng),returnValue=true;if(domUtil.attr(target,"se-img")){returnValue=false;wrapper=findImageNode(target,"wrapper");newPrag=domUtil.create("p",{innerHTML:SinaEditor.env.$webkit?'<br se-holder="1"/>':""});domUtil.insertAfter(newPrag,wrapper);rng.setStart(newPrag,0);rng.collapse(true);rng.select(true)}else{if(start==currentEditor.body){return}domUtil.each(domUtil.parents(start),function(i,el){if(domUtil.attr(el,"se-img")){evt.preventDefault();returnValue=false;return false}});if(!rng.collapsed){return returnValue}if(returnValue){var end=domUtil.getEnd(rng);domUtil.each(domUtil.parents(end),function(i,el){if(domUtil.attr(el,"se-img")){evt.preventDefault();returnValue=false;return false}})}else{var startContainer=rng.startContainer,resetStart;if(3==startContainer.nodeType&&0<rng.startOffset&&rng.startOffset==startContainer.nodeValue.length||rng.endOffset==startContainer.childNodes.length){resetStart=newLine(start);rng.setStart(resetStart,0);rng.collapse(true);rng.select(true)}}}if(false===returnValue){evt.preventDefault()}return returnValue});currentEditor.on("beforedelete",function(e,evt){var target,offset=-1,wrapper,walker,resetStart,end,next,prev;var rng=currentEditor.getRange();var start=domUtil.getStart(rng);if(3==start.nodeType){start=start.parentNode;offset=rng.startOffset}var findNode=function(start,dir,nodeType){nodeType=nodeType||3;walker=domUtil.treeWalker(start,currentEditor.body,function(node){if(nodeType!==node.nodeType){return false}});return walker[dir]()};var isAtLastPragh=function(rng){if(!rng.collapsed){return false}var start=rng.startContainer;var offset=rng.startOffset;if(!domUtil.contains(currentEditor.body,start)){return false}if(1==start.nodeType&&start===currentEditor.body){return offset===start.childNodes.length}else if(3===start.nodeType){if(offset!==start.nodeValue.length){return false}else{start=start.parentNode}}var isBody;while(start&&start!==currentEditor.body){isBody=start.parentNode==currentEditor.body;if(isBody){return true}else if(!isBody&&start.nextSibling){return false}else{start=start.parentNode}}return false};if(offset==0&&VK.BACKSPACE==evt.keyCode){prev=findNode(start,"prev",1);if(prev){wrapper=findImageNode(prev,"wrapper")}}else if(VK.DELETE==evt.keyCode){if(isAtLastPragh(rng)){next=findNode(start,"next",1);if(next){wrapper=findImageNode(next,"wrapper")}}else{return}}else{wrapper=findImageNode(start,"wrapper")}if(rng.collapsed&&!wrapper){return}if(!wrapper){end=domUtil.getEnd(rng);if(3==end.nodeType){end=end.parentNode}wrapper=findImageNode(end,"wrapper")}if(!wrapper){return}target=end||start;if(rng.collapsed&&findImageNode(target,"span")){if(!domUtil.text(target)||!offset){return false}return}if(rng.collapsed){currentEditor.fire("saveUndo");if(resetStart=wrapper.previousSibling){start=findNode(resetStart,"prev");if(start&&3==start.nodeType){offset=start.nodeValue.length;resetStart=start}else{offset=start.childNodes.length}}else if(resetStart=wrapper.nextSibling){start=findNode(resetStart,"next");if(start&&3==start.nodeType){resetStart=start}offset=0}else{resetStart=domUtil.create("p",{innerHTML:SinaEditor.env.$webkit?'<br se-holder="1">':""});offset=0;currentEditor.body.appendChild(resetStart)}rng.setStart(resetStart,offset);rng.collapse(true);domUtil.remove(wrapper);rng.select(true);currentEditor.fire("saveUndo");return false}else if(end){rng.setEndAfter(wrapper)}else{rng.setStartBefore(wrapper)}});currentEditor.on("afterCommand",function(e,cmdName){if("todo"===cmdName){imgToolbar&&imgToolbar.setPos(-1e4,-1e4);var images=domUtil.$("img"),imageName,pic;domUtil.each(images,function(i,image){imageName=domUtil.attr(image,"se-name");if(imageName){pic=findPic(imageName);pic&&renderImage(pic,image)}})}});currentEditor.on("beforeGetContent",function(e,content){var html=content.html;var tmpDiv=domUtil.create("div");tmpDiv.innerHTML=html;domUtil.each(domUtil.$('span[se-img="span"]',tmpDiv),function(i,span){var wrapper=findImageNode(span,"wrapper");var textContent=Util.trim(domUtil.text(span));if(IMG_TIPS===textContent){domUtil.remove(span);domUtil.setStyle(wrapper,{marginBottom:""})}});domUtil.each(domUtil.$('img[se-img="img"]',tmpDiv),function(i,img){if(domUtil.getStyle(img,"border")){domUtil.setStyle(img,{border:""})}});html=tmpDiv.innerHTML;tmpDiv=null;var holderRegxs=[/(<[^<>]+)([ ](?:se-holder)=[^<>\s]+){1,}([^<>]*>)/gi,/(<[^<>]+)([ ](?:contenteditable)=[^<>\s]+){1,}([^<>]*>)/gi,/(<[^<>]+)([ ](?:se-name)=[^<>\s]+){1,}([^<>]*>)/gi,/(<[^<>]+)([ ](?:se-img)=[^<>\s]+){1,}([^<>]*>)/gi],regx;var spanRegx=/(<span[^<>]+se-img="span"[^<>]+>([^<>]*)<\/span>)/gi;html=html.replace(spanRegx,function(match,spanHtml,text,index){if(IMG_TIPS==text){return""}return spanHtml});for(var i=0,len=holderRegxs.length;i<len;i++){regx=holderRegxs[i];html=html.replace(regx,function(match,$1,$2,$3){return $1+$3})}content.html=html})}currentEditor.on("tmpAfterSetContent",function(){var imgs=domUtil.$("img");domUtil.each(imgs,function(i,img){try{var link=img.parentNode;var imgParent=link.parentNode;var wrapper=imgParent.parentNode;var annotation=link.nextSibling;while(annotation){if("span"==annotation.nodeName.toLowerCase()){break}else{annotation=annotation.nextSibling}}if(link&&"A"==link.nodeName.toUpperCase()&&imgParent!=currentEditor.body&&domUtil.contains(currentEditor.body,imgParent)){domUtil.attr(img,"se-img","img").attr(link,"se-img","link").attr(imgParent,"se-img","img-parent").attr(imgParent,"unselectable","on").attr(wrapper,"se-img","wrapper").attr(wrapper,"contentEditable","false");if(!annotation){annotation=domUtil.create("span",{style:ALIGN_CENTER_CSS.span,innerHTML:IMG_TIPS,unselectable:"off"})}domUtil.attr(annotation,"se-img","span").attr(annotation,"contenteditable","true");domUtil.insertAfter(annotation,link)}}catch(e){}})});currentEditor.on("toolbar.beforeshow",function(e,toolbar,rng){if(rng.collapsed){return}var start=domUtil.getStart(rng),end=domUtil.getEnd(rng);var span=findImageNode(start,"span");if(!span){span=findImageNode(end,"span")}if(!span){return}else{return false}});domUtil.on(currentEditor.body,"click",function(e){e=domUtil.fixEvent(e);e.preventDefault();return false},false,"a");if(isBelowIe8){}init()});SinaEditor.PluginManager.register("widget",function(options,editor){var SE=SinaEditor,domUtil=editor.domUtil,spaceChar=SE.spaceChar,env=SE.env,VK=SE.VK,util=SE.Util;function findTargetNode(el){var action=domUtil.attr(el,"se-widget");if(action&&!domUtil.contains(el,editor.body)){return el}return}function createNewLine(refElement){var newLine=domUtil.create("p",{},env.$webkit?"<br/>":"");domUtil.insertAfter(newLine,refElement);var rng=editor.selection.createRange();rng.setStart(newLine,0);rng.collapse(true);rng.select()}editor.on("beforeenter",function(e,evt){var nativeEvent=editor.domUtil.fixEvent(evt);var target=nativeEvent.target;var keyCode=nativeEvent.keyCode||nativeEvent.which,result;var isEnter=keyCode==VK.ENTER;var returnValue=true;if(isEnter){var pns=domUtil.parents(target,true);util.each(pns,function(i,node){if(domUtil.attr(node,"se-widget")){returnValue=false;return false}});if(false===returnValue){createNewLine(pns[pns.length-1])}}return returnValue});editor.on("beforedelete",function(e,evt){var target,offset=-1,wrapper,walker,resetStart,end,next,prev;var rng=editor.getRange();var start=domUtil.getStart(rng);if(3==start.nodeType){start=start.parentNode}offset=rng.startOffset;var findNode=function(start,dir,nodeType){nodeType=nodeType||3;walker=domUtil.treeWalker(start,editor.body,function(node){if(nodeType!==node.nodeType){return false}});return walker[dir]()};var isAtLastPragh=function(rng){if(!rng.collapsed){return false}var start=rng.startContainer;var offset=rng.startOffset;if(!domUtil.contains(editor.body,start)){return false}if(1==start.nodeType&&start===editor.body){return offset===start.childNodes.length}else if(3===start.nodeType){if(offset!==start.nodeValue.length){return false}else{start=start.parentNode}}var isBody;while(start&&start!==editor.body){isBody=start.parentNode==editor.body;if(isBody){return true}else if(!isBody&&start.nextSibling){return false}else{start=start.parentNode}}return false};if(offset==0&&VK.BACKSPACE==evt.keyCode){prev=findNode(start,"prev",1);if(prev){wrapper=findTargetNode(prev)}}else if(VK.DELETE==evt.keyCode){if(isAtLastPragh(rng)){next=findNode(start,"next",1);if(next){wrapper=findTargetNode(next)}}else{return}}else{wrapper=findTargetNode(start)}if(rng.collapsed&&!wrapper){return}if(!wrapper){end=domUtil.getEnd(rng);if(3==end.nodeType){end=end.parentNode}wrapper=findTargetNode(end)}if(!wrapper){return}target=end||start;if(rng.collapsed&&findTargetNode(target)){if(!domUtil.text(target)||!offset){return false}return}if(rng.collapsed){editor.fire("saveUndo");domUtil.remove(wrapper);editor.fire("saveUndo");return false}else if(end){rng.setEndAfter(wrapper)}else{rng.setStartBefore(wrapper)}})});SinaEditor.PluginManager.register("video",function(options,editor){var domUtil=editor.domUtil;function createDom(vid){var videoPicUrl="http://simg.sinajs.cn/blog7style/images/common/editor/insetvideo2.gif";var img=domUtil.create("img",{"se-holder":1,src:videoPicUrl,vid:vid,width:482,height:388,contenteditable:false,"user-select":"none"});var wrapper=domUtil.create("div",{"se-holder":1,"se-widget":"video",unselectable:"on",contenteditable:false,"user-select":"none",style:{overflow:"hidden",textAlign:"center",marginBottom:"42px"}});wrapper.appendChild(img);return wrapper}function createNewParagraph(){var paragraph=domUtil.create("p",{innerHTML:SinaEditor.env.$webkit?'<br se-holder="1">':""});return paragraph}editor.registerCmd("insertVideo",{queryCommandState:function(cmd,rng,elementPath){var state=!1;editor.domUtil.each(elementPath,function(i,item){if("A"===item.nodeName.toUpperCase()){state=!0;return false}});return state},exec:function(cmd,opts){if(!opts.vid){return}var videoNode=createDom(opts.vid);var rng=editor.getRange();var start=domUtil.getStart(rng);var parents=domUtil.parents(start,true);var wrapper=parents.pop();var editorBody=editor.body;if(rng.collapsed&&rng.startContainer==editorBody&&0==rng.startOffset||!wrapper||wrapper==editorBody){editorBody.appendChild(videoNode);var paragraph=createNewParagraph();domUtil.insertNode(paragraph,editorBody,"beforeend");rng.setStart(paragraph,0)}else{rng.setEndAfter(wrapper);var lastFrag=rng.extractContents();var lastFragFirstChild=lastFrag.firstChild;domUtil.insertAfter(videoNode,wrapper);if(domUtil.text(lastFragFirstChild)){domUtil.insertAfter(lastFrag,videoNode)}else{var paragraph=createNewParagraph();domUtil.insertAfter(paragraph,videoNode);lastFragFirstChild=paragraph}rng.setStart(lastFragFirstChild,0)}rng.collapse(true);rng.select(true)}})});SinaEditor.PluginManager.register("videoBtn",function(options,editor){var SE=SinaEditor,DOMUtil=SE.DOMUtil,env=SE.env,WinBox=SE.ui.WinBox;var $dom=new DOMUtil;function bindLayerEvent(win){window.insertVideoCallbackXHW=function(vid){if(!vid){return}win.hide();setTimeout(function(){win.destroy()},20);if(env.$msie&&env.version<9){editor.focus()}editor.exec("insertVideo",{vid:vid})}}function bindInsertVideoBtn(){$dom.on($dom.$("#insert_video"),"click",function(){var uploadUrl="http://weibo.com/aj/video/upload?entry=blog&r="+parseInt(Math.random()*1e4);var winContent='<div><iframe frameborder="0" id="#{uploadVideo}" scrolling="no" style="width:100%;height:505px;" src="javascript:void(0)"></iframe></div>';var win=new WinBox({content:winContent,width:680,funcClose:function(btn){setTimeout(function(){win.destroy()},20)},title:"插入视频"},"insert_video");bindLayerEvent(win);win.show();var iframe=win.getNode("uploadVideo");iframe.src=uploadUrl;win.setMiddle()},false)}function init(){bindInsertVideoBtn()}init()});SinaEditor.PluginManager.register("music",function(options,editor){var SE=SinaEditor,Util=SE.Util,domUtil=editor.domUtil;function createMusicDom(musicUrl,autoPlay){var musicPicUrl="http://simg.sinajs.cn/blog7style/images/common/editor/musicplayer.png";var img=domUtil.create("img",{"se-holder":1,src:musicPicUrl,songlist:musicUrl,autoplay:autoPlay,playerid:"musicplayer_"+Util.uniqueId(false),"user-select":"none",style:{overflow:"hidden",textAlign:"center"}});var wrapper=domUtil.create("div",{"se-holder":1,"se-widget":"music",unselectable:"on",contenteditable:false,style:{overflow:"hidden",textAlign:"center","padding-bottom":"28px"}});wrapper.appendChild(img);return wrapper}function createNewParagraph(){var paragraph=domUtil.create("p",{innerHTML:SinaEditor.env.$webkit?'<br se-holder="1">':""});return paragraph}editor.registerCmd("insertMusic",{queryCommandState:function(cmd,rng,elementPath){var state=!1;editor.domUtil.each(elementPath,function(i,item){if("A"===item.nodeName.toUpperCase()){state=!0;return false}});return state},exec:function(cmd,opts){var lastNode,url,urls=[];domUtil.each(opts.musicList,function(i,url){urls.push(decodeURIComponent(url))});url=urls.join("|");var node=createMusicDom(url,opts.autoPlay);var rng=editor.getRange();var start=domUtil.getStart(rng);var parents=domUtil.parents(start,true);var wrapper=parents.pop();var editorBody=editor.body;if(wrapper&&1!=wrapper.nodeType){wrapper=null}var startContainer=rng.startContainer;var startOffset=rng.startOffset;if(rng.collapsed&&startContainer==editorBody&&0==startOffset||!wrapper||wrapper==editorBody){editorBody.appendChild(node);var paragraph=createNewParagraph();domUtil.insertNode(paragraph,editorBody,"beforeend");rng.setStart(paragraph,0)}else{rng.setEndAfter(wrapper);var next=wrapper.nextSibling;var prev=wrapper.previousSibling;var parent=wrapper.parentNode;var lastFrag=rng.extractContents();if(1!==wrapper.parentNode){if(next){domUtil.insertBefore(node,next)}else if(prev){domUtil.insertAfter(node,prev)}else{domUtil.append(node,parent)}}else{domUtil.insertAfter(node,wrapper)}var tmpFirst=lastFrag&&lastFrag.firstChild;if(tmpFirst){domUtil.insertAfter(lastFrag,node);rng.setStart(tmpFirst,0)}else{domUtil.insertAfter(lastFrag,node);if(!tmpFirst){var paragraph=createNewParagraph();domUtil.insertAfter(paragraph,node);rng.setStart(paragraph,0)}else{domUtil.insertAfter(lastFrag,node);rng.setStart(tmpFirst,0)}}}rng.collapse(true);rng.select(true)}})});SinaEditor.PluginManager.register("musicBtn",function(options,editor){var SE=SinaEditor,VK=SE.VK,DOMUtil=SE.DOMUtil,Util=SE.Util,WinBox=SE.ui.WinBox;var $dom=new DOMUtil;var domUtil=editor.domUtil;var musicList=[];var winContent=['<div class="e_layer_cont2">','<form action="add" onsubmit="return false;" name="addWebMusic">','<dl class="e_layer_music">','<dt class="md">音乐地址：</dt>',"<dd>",'<div class="music_input">','<input id="#{mp3Address}" style="width:96%;padding-left:10px;" maxlength="255" placeholder="请输入音乐地址（http://）,支持MP3格式" class="tag_input" type="text"/>',"</div>",'<a id="#{mp3OK}" href="javascript:void(0)" class="music_btn btn_style">确定</a>',"</dd>","</dl>",'<p class="music_warn" style="display:none;" id="#{error}">音乐地址要求必须为http地址且为mp3格式，请重新输入！</p>','<dl class="e_layer_music">',"<dt>已选歌曲：</dt>","<dd>",'<ul id="#{musicSelect}" class="music_select"></ul>',"</dd>","</dl>",'<p class="mp"><input id="#{autoPlay}" type="checkbox" class="music_box"/><label for="#{autoPlay}">本博文自动音乐播放</label></p>','<a id="#{insert}" href="javascript:void(0)" class="music_btn m_btn btn_style">插入音乐</a>',"</form>","</div>"].join("");function showError(win){var warn=win.getNode("error");warn.style.display=""}function hideError(win){var warn=win.getNode("error");warn.style.display="none"}function isValidate(url){var parser=Util.urlParser(url);var pathname=parser.pathname;if(!pathname||!/\/[^\/]+\.mp3$/i.test(pathname)){return false}else{return true}}function isRepeat(url){return-1!==musicList.indexOf(url)}function addToSelect(mp3AddressInput,address,selectList,win){if(!address){showError(win);return}if(0!==address.indexOf("http://")){address="http://"+address}if(!isValidate(address)){showError(win);return}hideError(win);mp3AddressInput.value="";if(isRepeat(address)){return}musicList.push(address);var li=$dom.create("li",{address:encodeURIComponent(address)},['<span class="music_chosen">',address,"</span>",'<a class="music_close" title="关闭" href="javascript:void(0)">×</a>'].join(""));selectList.appendChild(li)}function bindLayerEvent(win){var mp3AddressInput=win.getNode("mp3Address");var mp3OKBtn=win.getNode("mp3OK");var autoPlay=win.getNode("autoPlay");var insertBtn=win.getNode("insert");var selectList=win.getNode("musicSelect");$dom.on(mp3AddressInput,"keyup",function(e){var address=Util.trim(mp3AddressInput.value);if(e.keyCode===VK.ENTER){addToSelect(mp3AddressInput,address,selectList,win)}else if(address&&!isValidate(address)){showError(win)}else{hideError(win)}});$dom.on(mp3OKBtn,"click",function(e){var address=Util.trim(mp3AddressInput.value);addToSelect(mp3AddressInput,address,selectList,win)});$dom.on(insertBtn,"click",function(e){var autoPlay=win.getNode("autoPlay").checked?1:0;if(0==musicList.length){new WinBox({type:"alert",text:"抱歉，您还没有选择音乐，请至少选择一首。"});return}win.hide();editor.exec("insertMusic",{musicList:musicList,autoPlay:autoPlay});musicList=[]});$dom.on(selectList,"click",function(e){var target=e.target;var li=target.parentNode;var url=decodeURIComponent($dom.attr(li,"address"));var index=musicList.indexOf(url);if(-1!==index){musicList.splice(index,1)}$dom.remove(li)},false,"a")}function bindInsertMusicBtn(win){function resetForm(win){var ul=win.getNode("musicSelect");ul.innerHTML=""}$dom.on($dom.$("#insert_music"),"click",function(){if(!win){win=new WinBox({content:winContent,funcClose:function(btn){musicList=[];return},width:671,title:"插入音乐"},"insert_music");bindLayerEvent(win)}resetForm(win);win.show();win.setMiddle()},false)}function init(){bindInsertMusicBtn()}init()});SinaEditor.PluginManager.register("suda",function(options,editor){var cmds=options.cmds||{bold:"16_01_01",italic:"16_01_02",underline:"16_01_03",title:{h1:"16_01_04",h2:"16_01_05"},justify:{left:"16_01_06",center:"16_01_07",right:"16_01_08"},link:"16_01_09",unlink:"16_01_09",color:"16_01_10",resetcolor:"16_01_10"};editor.ready(function(){editor.on("execcommand",function(e,data){var sudaid=cmds[data.cmdName];if(!sudaid){return}if("string"!=typeof sudaid){sudaid=sudaid[data.data]}if(!sudaid){return}if(window.v7sendLog){v7sendLog(sudaid)}})})})}(window);Utils.UserData=Core.Class.create();Utils.UserData.prototype={initialize:function(id){if(!$IE)return;trace("UserData");this.id=id||"sina_user_data";Core.Dom.addHTML(document.body,'<img style="width: 1px; display: none;" id="'+this.id+'" />');this.setDefaultProperty()},setDefaultProperty:function(){if(!$IE)return;$E(this.id).addBehavior("#default#userData")},save:function(key,data){if(!$IE)return;try{if(this[key]==false)return;if(data.length>2e4)return;var ud_ele=$E(this.id);for(var name in data){ud_ele.setAttribute(name,data[name])}ud_ele.save(key)}catch(e){traceError(e)}},load:function(key,attributes){if(!$IE)return{};try{var ud_ele=$E(this.id);var data={};$E(this.id).load(key);var len=attributes.length;for(var i=0;i<len;i++){data[attributes[i]]=ud_ele.getAttribute(attributes[i]||"")}this[key]=true;return data;trace("暂存的内容长度: "+editorStr.length);trace("暂存内容的UID: "+editorUID)}catch(e){traceError(e)}},clear:function(key,attributes){if(!$IE)return;try{trace("userData.clear");this[key]=false;var ud_ele=$E(this.id);var len=attributes.length;for(var i=0;i<len;i++){ud_ele.setAttribute(attributes[i],"")}ud_ele.save(key)}catch(e){traceError(e)}}};window.USE_NATIVE=-1!==location.href.toString().indexOf("usenative");$registJob("editor_init",function(){var _disabled=function(range){var res=false,start=range.startContainer;if(start.nodeType==3&&start.parentNode.getAttribute("se-img")=="span"){res=true}if(start.nodeType==1&&start.getAttribute("se-img")=="span"){res=true}return res};var editor=SinaEditor.create({root:"#editor",focusCls:"BNE_txtA",emptyContent:!$IE?"<p></br></p>":"<p></p>",plugins:[{name:"hotkey",params:{keylist:[{exec:"bold",params:null,hotkeys:["ctrl + b"]},{exec:"italic",params:null,hotkeys:["ctrl + i"]},{exec:"underline",params:null,hotkeys:["ctrl + u"]},{exec:"justify",params:function(){var editor=this,state=editor.queryCommandState("justify"),align={left:"center",center:"right",right:"left"};return align[state]||-1},hotkeys:"ctrl + j"}]}},{name:"basestyle",params:{disabled:_disabled}},{name:"undo"},{name:"paste",params:{getType:function(range){var res="text/html",start=range.startContainer;if(start.nodeType==3&&start.parentNode.getAttribute("se-img")=="span"){res="text/plain"}if(start.nodeType==1&&start.getAttribute("se-img")=="span"){res="text/plain"}start=start.parentNode;if(start.nodeType==1&&start.getAttribute("se-img")=="span"){res="text/plain"}return res}}},{name:"enterkey"},{name:"deletekey"},{name:"widget"},{name:"justify"},{name:"justifyBtn"},{name:"title",params:{disabled:_disabled}},{name:"titleBtn"},{name:"initDivContent",level:0},{name:"colorPicker",params:{fixTagA:"skip",disabled:_disabled}},{name:"colorPickerBtn",params:{events:{"plugin.colorPickerBtn.ok":function(e,btn,color){if(btn){var box=btn.node.childNodes[0];if(color){box.style.cssText="border-bottom:2px solid "+color}else{box.style.cssText=""}}}}}},{name:"link"},{name:"linkBtn"},{name:"image"},{name:"imageBtn"},{name:"music"},{name:"musicBtn"},{name:"video"},{name:"videoBtn"},{name:"suda"},{name:"toolBar",params:{id:"toolbar",name:"main",tpl:'<a class="color1_a" href="javascript:void(0);" id="bold" action="bold"><i class="icon i7_B"></i></a>'+'<a class="color1_a" href="javascript:void(0);" id="italic" action="italic"><i class="icon i8_I"></i></a>'+'<a class="color1_a" href="javascript:void(0);" id="underline" action="underline"><i class="icon i9_U"></i></a>'+'<a class="color1_a" href="javascript:void(0);" id="title_h1_btn" action="titleBtn"><i class="icon i19_title1"></i></a>'+'<a class="color1_a" href="javascript:void(0);" id="title_h2_btn" action="groupSpace"><i class="icon i20_title2"></i></a>'+'<a class="color1_a" href="javascript:void(0);" id="justify_left_btn" action="justifyBtn"><i class="icon i10_l_alining"></i></a>'+'<a class="color1_a" href="javascript:void(0);" id="justify_center_btn" action="groupSpace"><i class="icon i11_c_alining"></i></a>'+'<a class="color1_a" href="javascript:void(0);" id="justify_right_btn" action="groupSpace"><i class="icon i12_r_alining"></i></a>'+'<a class="color1_a" href="javascript:void(0);" id="link" action="linkBtn"><i class="icon i13_link"></i></a>'+'<a class="color1_a" href="javascript:void(0);" id="colorPicker" action="colorPickerBtn"><i class="icon i14_A"></i></a>'+'<i class="arrow-down"></i>'}}]});if($macOS){$E("editor").style.fontFamily="'STHeiti','Microsoft Yahei', 'Simsun'"}editor.ready(function(){});window.editor=editor});!function(){var toStyleAttribute=function(styleName){var arr=styleName.split("-");var cc=arr[0];for(var i=1;i<arr.length;i++){cc+=arr[i].charAt(0).toUpperCase()+arr[i].substring(1)}return cc};Core.Dom.setStyle2=function(elem,style){if(typeof elem=="string"){elem=$E(elem)}for(var name in style){styleAttr=toStyleAttribute(name);Core.Dom.setStyle(elem,styleAttr,style[name])}}}();Sina.pkg("Utils.Form");Utils.Form.limitMaxLen=function(oTextNode,nMaxLen){var nValue;var keyup=function(){nValue=oTextNode.value;var strLen=Core.String.byteLength(nValue);if(strLen>nMaxLen){oTextNode.value=Core.String.leftB(nValue,nMaxLen)}};Core.Events.addEvent(oTextNode,Core.Function.bind3(keyup,oTextNode),"keyup");Core.Events.addEvent(oTextNode,Core.Function.bind3(keyup,oTextNode),"blur");Core.Events.addEvent(oTextNode,Core.Function.bind3(keyup,oTextNode),"focus")};Utils.Form.functionlimit=function(oNode,func,noKeyUP){var keyup=function(){var ov=oNode.value;oNode.value=func(ov)};if(!noKeyUP){Core.Events.addEvent(oNode,Core.Function.bind3(keyup,oNode),"keyup")}Core.Events.addEvent(oNode,Core.Function.bind3(keyup,oNode),"blur")};Core.Events.fixEvent=function(e){if(typeof e=="undefined")e=window.event;if(!e.target){e.target=e.srcElement;e.pageX=e.x;e.pageY=e.y}if(typeof e.layerX=="undefined")e.layerX=e.offsetX;if(typeof e.layerY=="undefined")e.layerY=e.offsetY;return e};!function(){var Placeholder=function(node,config){this.node=node;this.textColor=config.color||"#ccc";this.text=config.text||node.getAttribute("placeholder")||"";this.phTag=config.phTag||"span";this.useHTML5=config.useHTML5||false;this.checkCanShowFn=config.checkCanShowFn;this.__addEvent=Core.Events.addEvent;this.__removeEvent=Core.Events.removeEvent;this.__getStyle=Core.Dom.getStyle;this.__setStyles=Core.Dom.setStyle2;this.init()};Placeholder.prototype={construct:Placeholder,init:function(){if(this.supportPlaceholder()&&this.useHTML5){this.node.setAttribute("placeholder",this.text)}else{this.buildPlaceholder();this.check()}},buildPlaceholder:function(){if(!this.label){this.label=$C(this.phTag);this.hide();this.node.parentNode.insertBefore(this.label,this.node);this.bindEvents()}this.label.innerHTML=this.text;var styles=this.getStyles();var offset=this.computeOffset();styles.marginLeft=offset.x+"px";styles.marginTop=offset.y+"px";styles.zIndex=-1;this.__setStyles(this.label,styles)},bindEvents:function(){this.__addEvent(this.node,this.checkInput.bind2(this),"input");this.__addEvent(this.node,this.checkInput.bind2(this),"propertychange");this.__addEvent(this.node,this.check.bind2(this),"blur");this.__addEvent(this.node,this.hide.bind2(this),"mousedown");this.__addEvent(this.label,this.focus.bind2(this),"mousedown");this.__addEvent(this.node,this.hide.bind2(this),"focus")},checkInput:function(){if(!this.checkCanShow()){this.hide()}},check:function(){if(this.checkCanShow()){this.show()}else{this.hide()}},checkCanShow:function(){if(typeof this.checkCanShowFn!=="function"){return this.node&&!this.node.value}else{return this.checkCanShowFn()}},focus:function(){var that=this;this.hide();setTimeout(function(){that.node.focus()})},show:function(){if(this.label&&this.checkCanShow()){this.label.style.display=""}},hide:function(){if(this.label){this.label.style.display="none"}},getStyles:function(){var styles={};styles["fontSize"]=this.__getStyle(this.node,"fontSize");styles["lineHeight"]=this.__getStyle(this.node,"lineHeight");styles["position"]="absolute";styles["color"]=this.textColor;return styles},supportPlaceholder:function(){var tempInput=$C("input");return"placeholder"in tempInput},computeOffset:function(){var pos={};var attrs=["marginTop","paddingTop","borderTopWidth","marginLeft","paddingLeft","borderLeftWidth"];for(var i=0;i<attrs.length;i++){var prop=attrs[i];pos[prop]=this.__getStyle(this.node,prop);if(pos[prop]=="auto"){pos[prop]="1px"}pos[prop]=parseInt(pos[prop],10)||0}pos.x=pos.marginLeft+pos.paddingLeft+pos.borderLeftWidth;pos.y=pos.marginTop+pos.paddingTop+pos.borderTopWidth+($IE6?1:0);
return pos},destory:function(){this.__removeEvent(this.node,this.hide.bind2(this),"focus");this.__removeEvent(this.label,this.focus.bind2(this),"mousedown");this.__removeEvent(this.node,this.check.bind2(this),"blur");if(this.label&&this.label.parentNode){this.label.parentNode.removeChild(this.label)}this.label=null}};Sina.Ui.Placeholder=Placeholder}();$registJob("editor_focus",function(){var articleTitle=$E("article_title");var DEFAULT_TITLE_TIP="请输入标题";var __setStyle=Core.Dom.setStyle2;var __getStyle=Core.Dom.getStyle;var __addEvent=Core.Events.addEvent;var __stopEvent=Core.Events.stopDefaultEvent;function process(ele){__setStyle(ele,{resize:"none",height:"","overflow-y":"hidden"});var scrollHeight=ele.scrollHeight;var lineHeight=parseInt(__getStyle(ele,"line-height"),10);if(scrollHeight<lineHeight){scrollHeight=lineHeight}__setStyle(ele,{height:scrollHeight+"px"})}if(articleTitle){process(articleTitle);if(articleTitle.getAttribute("old-value")!=""){articleTitle.value=articleTitle.getAttribute("old-value");process(articleTitle)}new Sina.Ui.Placeholder(articleTitle,{text:DEFAULT_TITLE_TIP});Utils.Form.limitMaxLen(articleTitle,96);Utils.Form.functionlimit(articleTitle,Core.String.trim,true);__addEvent(articleTitle,function(e){var val=articleTitle.value;var oldval=articleTitle.getAttribute("old-value")||"";if(oldval==""||val!=oldval){process(articleTitle)}articleTitle.setAttribute("old-value",val)},"keyup");__addEvent(articleTitle,function(e){var e=e||window.event;if(e.keyCode==13){__stopEvent(e)}},"keydown")}var editorNode=$E("editor");var DEFAULT_BODY_TIP="请输入正文";if(editorNode){var editor=SinaEditor.get(0);editor.ready(function(){window.editorPlaceHolder=new Sina.Ui.Placeholder(editorNode,{text:DEFAULT_BODY_TIP,checkCanShowFn:function(){var editor=SinaEditor.get(0);return editor.isEmptyContent()}});editor.on("afterCommand",function(e){editorPlaceHolder.hide()})})}});Core.Class.extend=function(destination,supClass,bForce){for(var property in supClass){if(bForce!=null){if(!destination[property]){destination[property]=supClass[property]}}else{destination[property]=supClass[property]}}return destination};$SYSMSG.extend({B01001:"标题必须是48个中文或96个字符以内，请重新输入。",B02001:"请输入内容。",B02002:"博文内容超过容量限制，请重新编辑。 <br/><span style='font-size: 12px; font-weight: normal;'>博文内容最多允许1万汉字，2万字符。</span>",B02003:"是否要清除格式？粘帖的内容中含有冗余的格式，会影响在博客中的排版。",B02004:"上次撰写的博文未进行保存，要恢复内容继续编辑吗？",B02005:'您提交的内容中含有广告等不适当内容，"确认"后将被清除！',B03001:"标签总字数必须是30个中文或60个字符以内，请重新输入。",B03002:"标签个数必须是5个以内，请重新输入。",B03003:"每个标签字数必须是7个中文或14个字符以内，请重新输入。",B03105:"无法提取到有效标签，请手动输入些标签：如“体育、生活”。",B03106:"博文内容必须大于20个中文或40个字符，才能提取有效标签。",B03107:"博文内容必须大于20个中文或40个字符，才能提取有效标签。",B04001:"发布时间不能超出当前时间，请重新输入。",B04002:"抱歉,请选择“我记录”活动投稿类别。",B04022:"标签总字数必须是30个中文或60个字符以内，请重新输入。",B06001:"博文已发布成功。",B06011:"博文已发布成功。",B06012:"博文已发布成功。",B06002:"博文已发布，稍后显示，请耐心等待一下。",B06003:"博文已成功保存到草稿箱。",B06004:"您的博文已经发表成功，目前已经进入后台审核中。审核时间为12小时，请耐心等候。",B07001:"博文发布失败，请梢后再试。建议先将内容拷贝到本地硬盘备份。",B07003:"博文保存失败，请梢后再试。建议先将内容拷贝到本地硬盘备份。",B07004:"博文保存失败，请梢后再试。建议先将内容拷贝到本地硬盘备份。",B07005:"您短时间发表文章过多，请稍后再试",B08001:"不能一分钟内连续发博文，请稍后再试。",B08002:"发布中，请稍候…",B08003:"保存中，请稍候…",B08004:"由于网络原因上传失败，请稍后再试。或者尝试使用<a href='http://photo.blog.sina.com.cn/upload/upload_html.php'>旧版网页上传</a>。",B08005:"由于网络原因上传失败，请稍后再试。",B36101:"文章不存在",B78001:"选择已达相关博文上限！请删除一些再勾选",B79001:'音乐地址要求是mp3格式，请重新输入！或者直接去<a onclick="scope.musicOperate.showStore();return false;" href="#">新浪乐库</a>中搜索。',B79002:'音乐地址要求以http://开始，请重新输入！或者直接去<a onclick="scope.musicOperate.showStore();return false;" href="#">新浪乐库</a>中搜索。',B79003:"是否要删除背景音乐？",B79004:"是否要删除相关博文？",B79005:"在模板中只能插入一张图片。",B79006:"每次最多只能插入20张图片。<br/>请先完成图片添加，再插入新图片",B79007:"<strong>此分类尚无博文，请选择其他分类</strong>",B79008:"<strong>尚无博文</strong>",B79009:"是否要删除推荐活动？",B89001:"请输入文章内容。",B89002:"正文内空转码失败。",B89003:"服务分析出错。",B89004:"没有找到匹配的歌曲名。",B89005:"为了保证您的博文打开速度，每篇博文最多只能插入3个音乐播放器。",B89006:"每个播放器最多只能添加20首歌",B89007:"歌曲已成功添加！<br/>但添加至上一个播放器，仅在当本博文中已有播放器时适用。",B89008:"歌曲已成功添加！<br/>但插入歌词功能仅在插入单首歌曲时可用。",B89009:"请输入搜索内容",B89011:"抱歉，您还没有选择音乐，请至少选择一首。",B89012:'博文中无可识别的歌曲名。<br/><span style="color:#999">帮助：此功能会根据您输入的博文内容，自动识别出您博文内容中出现的歌曲名，并为此歌曲名匹配相应试听链接，浏览者即可一键轻松试听您博文中的音乐。</span>',B89013:"已成功添加至上一个播放器中！",B79010:"请在图片上传完成后再进行添加。",A00200:"您输入的内容包含非法字符"});!function(argument){var Select=function(node,config){this.node=typeof node==="string"?$E(node):node;this.list="";this.config=config;this.name="";this.value="";this.length="";this.selectedIndex=-1;this.disabled=false;this.originSelect=null;this.model=[];this.addEvent=Core.Events.addEvent;this.removeEvent=Core.Events.removeEvent;this.fixEvent=Core.Events.fixEvent;this.rmvEvent=Core.Events.removeEvent;this.stopDefault=Core.Events.stopDefaultEvent;this.eventDispatcher=new Core.Events.EventDispatcher(this);this.setCss=Core.Dom.setStyle2;this.init()};Select.prototype={construct:Select,init:function(){if(this.node.tagName.toLowerCase()==="select"){this.name=node.getAttribute("name")||"";this.originSelect=this.node;var node=$C("div");if(this.config.triggerTpl){var template=new Ui.Template(this.config.triggerTpl);var result=template.evaluate({text:this.config.triggerText});node.innerHTML=result}this.node=node.children[0];this.originSelect.parentNode.appendChild(this.node);this.setCss(this.originSelect,{position:"absolute",left:"-9999px",zIndex:"-1111"});this.model=convertSelectToModel(this.originSelect)}else{if(!this.config.name||!this.config.model){throw new Error("need name & model")}this.model=this.config.model;this.name=this.config.name;var input=$C("input");input.setAttribute("name",this.name);this.setCss(input,{position:"absolute",left:"-9999px",zIndex:"-1111"});this.node.parentNode.appendChild(input);if(this.config.triggerTpl){var template=new Ui.Template(this.config.triggerTpl);var result=template.evaluate({text:this.config.triggerText});this.node.innerHTML=result}this.originSelect=input;this.model=completeModel(this.model)}for(var i=0;i<this.model.length;i++){if(this.model[i].selected==true){this.originSelect.value=this.model[i].value}}this.length=this.model.length;this.render(this.model);this.__bindEvent()},render:function(model){this.model=model;if(this.list){this.list.parentNode.removeChild(this.list)}this.list=this.__createSelectList();var val=this.getValue();this.setValue(val,false)},__createSelectList:function(){var li=$C("li");var ul=$C("ul");ul.className=this.config.triggerClassName||"menu";ul.style.display="none";var template=new Ui.Template(this.config.optionTpl);var result=template.evaluateMulti(this.model);ul.innerHTML=result;li.appendChild(ul);this.node.parentNode.appendChild(li);return ul},__bindEvent:function(){this.addEvent(this.node,this.__onNodeClick.bind2(this));this.addEvent(this.list.parentNode,this.__delegateListClick.bind2(this));this.addEvent(document.body,this.__onBodyClick.bind2(this))},__onNodeClick:function(e){var e=this.fixEvent(e);var tar=e.target;this.stopDefault(e);if(isContained(tar,this.node)){if(this.__isListShown()){this.__hideList()}else{this.__showList()}}},__onBodyClick:function(e){var e=this.fixEvent(e);var tar=e.target;if(!isContained(tar,this.node)){this.__hideList()}},addEventListener:function(type,handle){this.eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.eventDispatcher.removeEventListener(type,handle);return this},__delegateListClick:function(e){e=this.fixEvent(e);var tar=e.target;if(isContained(tar,this.list)){if(tar.tagName.toLowerCase()=="li"){this.select(tar);setTimeout(this.__hideList.bind2(this),50);return}if(tar.tagName.toLowerCase()=="span"){this.select(tar.parentNode);setTimeout(this.__hideList.bind2(this),50);return}}},select:function(tar,index){var curNode,oldNode;var selectedIndex=getOpitonIndex(index||tar,this.list);var oldSelectedIndex=this.selectedIndex;this.selectedIndex=selectedIndex;if(oldSelectedIndex>=0){this.model[oldSelectedIndex].selected=false;oldNode=this.list.children[oldSelectedIndex]}if(selectedIndex>=0){this.model[selectedIndex].selected=true;curNode=this.list.children[selectedIndex]}if(oldSelectedIndex!==selectedIndex){this.eventDispatcher.dispatchEvent("change",curNode,oldNode)}this.__syncSelect(tar)},__syncSelect:function(node){var li=getParent(node,this.list,"li");var text=li.getAttribute("data-text"),value=li.getAttribute("data-value");this.originSelect.value=value;this.__setNodeText(text)},__setNodeText:function(text){var span;if(this.node&&(span=this.node.children)){span[0].innerHTML=text}},__syncModel:function(target){},getValue:function(){return this.originSelect.value},setValue:function(value,isTriggerChange){var i=0,children=this.list.children,len=children.length,node,v;if(typeof value!=undefined){for(;i<len;i++){node=children[i];v=node.getAttribute("data-value");if(v==value){if(isTriggerChange){this.select(node,i)}else{this.__syncSelect(node)}return value}}}return value},getList:function(){return this.list},__setPosition:function(){},__isListShown:function(){return this.list.style.display!=="none"},__showList:function(){this.list.style.display="";this.eventDispatcher.dispatchEvent("show",this.list)},__hideList:function(){this.list.style.display="none";this.eventDispatcher.dispatchEvent("hide",this.list)}};function getOpitonIndex(option,options){if(typeof option=="number"){return option}else{var i=0,children=options.children,len=children.length;for(;i<len;i++){if(isContained(option,children[i])){return i}}}}Select.convertSelectToModel=function convertSelectToModel(selectNode){var i,model=[],options=selectNode.options,l=options.length,hasDefaultSelect=false;for(i=0;i<l;i++){var j,o={},option=options[i];var fields=["text","value","defaultSelected","selected","disabled"];for(j in fields){var field=fields[j];o[field]=option[field]}if(option.selected)hasDefaultSelect=true;model.push(o)}if(!hasDefaultSelect&&model.length){model[0].selected="true"}return model};function completeModel(model){var i,j,l,ll,newModel=[],selectIndexArray=[];for(i=0,l=model.length;i<l;i++){var o={};for(var x in model[i]){o[x]=model[i][x]}if(o.selected)selectIndexArray.push(i);o.selected=o.defaultSelected=!!o.selected;o.disabled=!!o.disabled;newModel.push(o)}if(selectIndexArray.length>0){selectIndexArray.pop();for(j=0,ll=selectIndexArray.length;j<ll;j++){newModel[selectIndexArray[j]].selected=false}}else{newModel[0].selected=true}return newModel}function isContained(targetNode,pNode){var node=targetNode;if(node==pNode){return true}if(pNode.compareDocumentPosition){return pNode.compareDocumentPosition(node)===20}while(node&&node!=document.body){if(node===pNode){return true}node=node.parentNode}return false}function getParent(node,parent,tag){if(node.tagName.toLowerCase()==tag){return node}while((node=node.parentNode)&&node!=parent){if(node.tagName.toLowerCase()==tag){return node}}return null}Sina.Ui.Select=Select}();Core.Events.getEventTarget=function(ev){ev=ev||Core.Events.getEvent();Core.Events.fixEvent(ev);return ev.target};var Editor={};Editor.AbstractBase=Core.Class.create();Editor.AbstractBase.prototype={_id:null,_focusElementId:"",_iframeUrl:"",iframe:null,iframeWindow:null,iframeDocument:null,rangeCache:null,initialize:function(){throw new Error("Editor.AbstractBase为抽象类不能被实例化")},blur:function(){$E(this._focusElementId).focus()},execCommand:function(cmd,value){this.iframeWindow.focus();this.iframeDocument.execCommand(cmd,"",value);this.iframeWindow.focus()},getContentHtml:function(){return this.iframeDocument.body.innerHTML},getContentText:function(){if($IE){return this.iframeDocument.body.innerText}else{return this.iframeDocument.body.textContent}},selectRange:function(){this.rangeCache.select()},getFocusElement:function(){if(!$IE){var select=this.iframeWindow.getSelection();var range=select.getRangeAt(0);var elm=range.commonAncestorContainer;if(elm.tagName){if(elm.tagName.toLowerCase()=="body"){return elm}}if(!range.collapsed){if(range.startContainer==range.endContainer||1&&range.startContainer==range.endContainer.parentNode){if(range.startOffset-range.endOffset<2||1){if(range.startContainer.hasChildNodes()){return range.startContainer.childNodes[range.startOffset]}}}return elm.parentNode}else{return elm.parentNode}}else{var range=this.iframeDocument.selection.createRange();return range.item?range.item(0):range.parentElement()}},getRangTxt:function(select){if($IE){if(select){this.selectRange()}var rang=this.iframeDocument.selection.createRange();if(rang.item){return rang.item(0).outerHTML}return rang.htmlText}else{var rang=this.iframeWindow.getSelection().getRangeAt(0);var dFragment=rang.cloneContents();var div=document.createElement("div");div.appendChild(dFragment);return div.innerHTML}},insertHTML:function(s_html,s_obj){if($IE&&this.history){this.history.add()}if($IE){try{this.selectRange();this.iframeWindow.focus();var oRang=this.iframeDocument.selection.createRange();if(this.iframeDocument.selection.type.toLowerCase()=="control"){var tempRange=this.iframeDocument.body.createTextRange();tempRange.moveToElementText(oRang.item(0));oRang=tempRange}oRang.pasteHTML(s_html);oRang.collapse(false);oRang.select();this.rangeCache.save()}catch(e){}}else{this.execCommand("insertHTML",s_html);if(s_obj){var ele=this.iframeDocument.getElementById(s_obj.id);if(ele){for(var key in s_obj.properites){ele.setAttribute(key,s_obj.properites[key])}ele.removeAttribute("id")}}}},_onLoadOperates:function(){if(this.loadOpartes){var len=this.loadOpartes.length;for(var i=0;i<len;i++){try{this.loadOpartes[i]()}catch(e){}}}},_addOperateToOnload:function(func){if(!this.loadOpartes){this.loadOpartes=[]}this.loadOpartes.push(func)},_initIframe:function(container,className){this._id=Core.Math.getUniqueId();var iframeParent=container;iframeParent.innerHTML="";this.iframe=$C("iframe");this.iframe.className=className;if(this._iframeUrl!=""){this.iframe.src=this._iframeUrl+"?"+Math.random()}this.iframe.setAttribute("frameborder","0",0);iframeParent.appendChild(this.iframe);this.iframeWindow=this.iframe.contentWindow;Core.Events.addEvent(this.iframe,function(){this.onload=true;if(arguments.callee.down){return}this.iframeDocument=this.iframeWindow.document;if($IE){this.iframeDocument.body.contentEditable=true}else{this.iframeDocument.designMode="on"}arguments.callee.down=true;this._onLoadOperates()}.bind2(this),"load");if(this._iframeUrl==""){this.iframeWindow.document.open();this.iframeWindow.document.write(this._setEditorHTML(""));this.iframeWindow.document.close()}},_setEditorHTML:function(sContent){var html="<html></head><body>"+sContent+"</body></html>";return html}};Editor.AbstractStandard=Core.Class.create();Editor.AbstractStandard.prototype={textarea:null,history:null,tools:null,operate:null,formatDoc:null,imageOperate:null,modeType:"edit",initialize:function(){throw new Error("Editor.AbstractStandard为抽象类不能被实例化")},initTextArea:function(textarea){this.textarea=textarea},swapMode:function(){this.swapShutOut(this.modeType);if(this.modeType=="edit"){if(this.iframeDocument){this.frameToArea()}this.iframe.parentNode.style.display="none";this.textarea.parentNode.style.display="block";this.textarea.style.display="block";this.modeType="code"}else{if(this.iframeDocument){this.areaToFrame()}this.textarea.parentNode.style.display="none";this.iframe.parentNode.style.display="block";this.textarea.style.display="none";this.modeType="edit"}},getContentHtml:function(){this.frameToArea();return this.textarea.value},swapShutOut:function(type){},frameToArea:function(){this.textarea.parentNode.style.display="none";this.textarea.value=this.formatCode(this.iframeDocument.body.innerHTML)},areaToFrame:function(){if(!this.iframeDocument){setTimeout(function(){this.areaToFrame()}.bind2(this),500);return}this.iframeDocument.body.innerHTML=this.textarea.value},formatCode:function(sCodeString){sCodeString=sCodeString.replace(/<(\/?)(ul|hr|table|meta|link|tbody|tr|object|body|head|html)(|[^>]+)>\s*/g,"\n<$1$2$3>\n");sCodeString=sCodeString.replace(/\s*<(p|h[1-6]|div|title|style|pre|script|td|li)(|[^>]+)>/g,"\n<$1$2>");sCodeString=sCodeString.replace(/<\/(p|h[1-6]|div|title|style|pre|script|td|li)>\s*/g,"</$1>\n");sCodeString=sCodeString.replace(/(<font)(>)/gi,"$1 size=#$2");return sCodeString}};Core.Class.extend(Editor.AbstractStandard.prototype,Editor.AbstractBase.prototype,true);if(typeof Editor.Plugins=="undefined"){Editor.Plugins={}}Core.Events.click=function(){var isMobile=/mobile/i.test(navigator.userAgent);if($IE&&$IE<9){return function(clickBtn){clickBtn.click()}}else{return function(clickBtn){var evt;if(isMobile){evt=document.createEvent("HTMLEvents")}else{evt=document.createEvent("MouseEvents")}evt.initEvent("click",true,true);clickBtn.dispatchEvent(evt)}}}();Ui.Pagination={config:{pageNode:null,nodeClassNamePrefix:"CP",curPage:1,maxPage:1,minPage:1,pageTpl:"@page@.html",type:1,showPrevNext:true,viewSize:5,dotIsPage:false,dotRate:5,showGoto:false,countTpl:"",language:"zh-cn",theme:1,showLastPage:true,showTotal:false},_list:{},_resource:{"en-us":["Pages (@data@): ","Go to First Page","Go to Previous Page (@data@)","Go to Page @data@","Go to Next Page (@data@)","Go to Last Page","Current Page in View"],"zh-cn":["共 @data@ 页","跳转至第一页","跳转至前 @data@ 页","跳转至第 @data@ 页","跳转至后 @data@ 页","跳转至最后一页","当前所在页"]},_template:'<li class="#{class}" title="#{title}">#{link}</li>',init:function(oOption){var node=$E(oOption.pageNode);if(node==null){trace("分页指定的父容器不存在");return}Ui.Pagination._list[node.id]={};var hash=Ui.Pagination._list[node.id];for(var key in this.config){hash[key]=oOption[key]===undefined?this.config[key]:oOption[key]}if(hash.type==2){hash.viewSize=4}hash.minPage=Math.min(hash.minPage,hash.maxPage)*1;hash.maxPage=Math.max(hash.minPage,hash.maxPage)*1;hash.curPage=hash.curPage>hash.maxPage?hash.minPage:hash.curPage;hash.curPage=hash.curPage*1;if(hash.curPage+hash.viewSize>=100){hash.viewSize=3}this._cache_node=hash;return this},show:function(oNode,nCurPage){nCurPage=nCurPage*1;var hash=this._cache_node;if(oNode!=null){this._cache_node=hash=Ui.Pagination._list[oNode.id];hash.curPage=nCurPage}var ambit=[];if(hash.viewSize*2+1>=hash.maxPage){ambit[1]=hash.minPage;ambit[2]=hash.maxPage}else if(hash.curPage<=hash.minPage+hash.viewSize){ambit[1]=hash.minPage;ambit[2]=hash.minPage+(hash.viewSize*2-1);ambit[3]=hash.maxPage}else if(hash.curPage>=hash.maxPage-hash.viewSize){ambit[0]=hash.minPage;ambit[1]=hash.maxPage-(hash.viewSize*2-1);ambit[2]=hash.maxPage}else{ambit[0]=hash.minPage;ambit[1]=hash.curPage-(hash.viewSize-1);ambit[2]=hash.curPage+(hash.viewSize-1);ambit[3]=hash.maxPage}var result=[];if(hash.countTpl!=null){result.push(this._createPage("","","","",hash.countTpl))}if(hash.type!=2&&hash.curPage!=hash.minPage){if(hash.type==3)result.push(this._createPage(hash.nodeClassNamePrefix+"_s_pgprev",hash.curPage-1,3,hash.curPage-1,"上页"));else result.push(this._createPage(hash.nodeClassNamePrefix+"_pgprev",hash.curPage-1,3,hash.curPage-1,"< 上一页"))}if(hash.type!=3){if(ambit[0]!=null){var str=ambit[0]==hash.curPage?this._createPage(hash.nodeClassNamePrefix+"_pgon",1,6,"",ambit[0]):this._createPage("",1,1,ambit[0],ambit[0]);result.push(str)}if(hash.type==1&&ambit[0]!=null){result.push(this._createPage(hash.nodeClassNamePrefix+"_pgelip","","","","..."))}for(var i=ambit[1];i<=ambit[2];i++){if(i==ambit[1]&&i!=hash.minPage&&hash.type==2){var LS=hash.curPage-hash.dotRate;LS=LS<hash.minPage?hash.minPage:LS;result.push(this._createPage(hash.nodeClassNamePrefix+"_pgelip",hash.viewSize+1,2,hash.curPage-hash.viewSize-1,"..."))}else if(i==ambit[2]&&i!=hash.maxPage&&hash.type==2){var RS=hash.curPage+hash.dotRate;RS=RS>hash.maxPage?hash.maxPage:RS;result.push(this._createPage(hash.nodeClassNamePrefix+"_pgelip",hash.viewSize+1,4,hash.curPage+hash.viewSize+1,"..."))}else{str=i==hash.curPage?this._createPage(hash.nodeClassNamePrefix+"_pgon",1,6,"",i):this._createPage("",i,3,i,i);result.push(str)}}if(hash.type==1&&ambit[3]!=null){result.push(this._createPage(hash.nodeClassNamePrefix+"_pgelip","","","","..."))}if(ambit[3]!=null&&hash.showLastPage){str=ambit[3]==hash.curPage?this._createPage(hash.nodeClassNamePrefix+"_pgon",hash.curPage-1,3,"",ambit[3]):this._createPage("",1,5,ambit[3],ambit[3]);result.push(str)}}else{result.push(this._createPage(hash.nodeClassNamePrefix+"_s_pgnum","","","","<strong>"+hash.curPage+"</strong>/"+hash.maxPage))}if(hash.type!=2&&hash.curPage!=hash.maxPage){if(hash.type==3)result.push(this._createPage(hash.nodeClassNamePrefix+"_s_pgnext",hash.curPage+1,3,hash.curPage+1,"下页"));else result.push(this._createPage(hash.nodeClassNamePrefix+"_pgnext",hash.curPage+1,3,hash.curPage+1,"下一页 >"))}if(hash.showTotal==true){result.push(this._createPage(hash.nodeClassNamePrefix+"_pgttl","","","","共"+hash.maxPage+"页"))}$E(hash.pageNode).innerHTML='<ul class="'+hash.nodeClassNamePrefix+'_pages">'+result.join("")+"</ul>"},_createPage:function(sClass,sTipPage,nTipIndex,nHrefPage,sHrefText){if(sHrefText==""){return""}var sTitle=sTipPage===""||nTipIndex==""?"":this._getTips(sTipPage,nTipIndex);var sLink=nHrefPage!==""?"<a "+this._getUrl(nHrefPage)+">"+sHrefText+"</a>":sHrefText;return this._template.replace(/(#\{\w+\})/g,function(a,b){switch(b){case"#{class}":return sClass;case"#{title}":return sTitle;case"#{link}":return sLink}})},showPage:function(sParentNodeID,nCurPage){this._cache_node=Ui.Pagination._list[sParentNodeID];var _autoShowPage=this._cache_node.pageTpl(nCurPage);if(_autoShowPage!=false){Ui.Pagination.show($E(sParentNodeID),nCurPage)}},_getUrl:function(idx){if(typeof this._cache_node.pageTpl=="string"){return'href="'+this._cache_node.pageTpl.replace(/@page@/,idx)+'"'}else{return"href=\"javascript:Ui.Pagination.showPage('"+this._cache_node.pageNode+"',"+idx+');"'}},_getTips:function(nPage,nIndex){return this._resource[this._cache_node.language][nIndex].replace(/@data@/g,nPage)}};Core.Dom.getChildrenByClass=function(el,clz){var rs=[];var cldr=el.childNodes||el.children;var clz=" "+clz+" ";var len=cldr.length;for(var i=0;i<len;++i){var o=cldr[i];var ecl=" "+o.className+" ";if(ecl.indexOf(clz)!=-1){rs[rs.length]=o}}return rs};Editor.Plugins.ChangeCover=Core.Class.create();Editor.Plugins.ChangeCover.prototype={ITEM_ID:"cover_view_",COVER_ID:"img_view_",COVER_IMG_ID:"cover_img_",SAVE_ID:"save_cover_",CHANGE_ID:"change_cover_",initialize:function(){},initInterface:function(){this.list_interface=new Interface("http://control.blog.sina.com.cn/riaapi/photoblog/list_blogpic.php","ajax");this.save_interface=new Interface("http://control.blog.sina.com.cn/riaapi/photoblog/set_cover.php","ajax")},save:function(aid){var param={blog_id:aid};var selected=this.getSelected(aid);if(selected){param.pic_id=selected.id.split("_")[3]}else{showError("请选择一个封片");return false}this.save_interface.request({GET:param,onSuccess:function(_data){articleAssociate.articleList[aid].imagePath=getImgStaticPath(param.pic_id,"small");this.set(aid,param.pic_id);this.swapView(aid)}.bind2(this),onError:function(_data){showError(_data.code)},onFail:function(){}})},swapTipMode:function(aid){$E("img_view_"+aid).style.display="none";$E("cc_tip_"+aid).style.display="";$E("save_cover_"+aid).style.display="none";$E("back_cover_"+aid).style.display="";$E("change_cover_"+aid).style.display="none"},loadData:function(aid){if(!this.list_interface){this.initInterface()}var param={blog_id:aid};this.list_interface.request({GET:param,onSuccess:function(_data){if(_data.length<1){this.swapTipMode(aid)}else{this.buildList(_data,aid);this.swapView(aid)}}.bind2(this),onError:function(_data){showError(_data.code)},onFail:function(){}})},renderList:function(aid){this.loadData(aid)},set:function(aid,pid){var ele=$E(this.COVER_IMG_ID+aid);ele.src=getImgStaticPath(pid,"small")},swapView:function(aid){var changeModeEle=$E(this.ITEM_ID+aid);var showModeEle=$E(this.COVER_ID+aid);var saveBtnEle=$E(this.SAVE_ID+aid);var changeBtnEle=$E(this.CHANGE_ID+aid);if(changeModeEle.style.display=="none"){showModeEle.style.display="none";changeBtnEle.style.display="none";changeModeEle.style.display="";saveBtnEle.style.display=""}else{changeModeEle.style.display="none";saveBtnEle.style.display="none";showModeEle.style.display="";changeBtnEle.style.display=""}},getPicBySrc:function(src){return src.replace(/(.*?)\/(\w{16,21})[\^?&]?/,"$2")},initTemplate:function(){if(this.template){return}tempHtml='<span class="#{cls}" id="cover_item_#{aid}_#{pic_id}">			<a href="javascript:void(0)">				<img alt="" src="#{imgPath}" id="cover_#{aid}_#{pic_id}">			</a>			<img height="18" align="absmiddle" width="18" title="选中" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon106">		</span>';this.template=new Ui.Template(tempHtml)},buildList:function(data,aid){var container=$E(this.ITEM_ID+aid);var len=data.length;var select_pid=this.getPicBySrc($E(this.COVER_IMG_ID+aid).src);container.innerHTML="";this.initTemplate();for(var i=0;i<len;i++){if(select_pid==data[i].pic_id){data[i].cls="selected"}else{data[i].cls=""}data[i].imgPath=getImgStaticPath(data[i].pic_id,"small");data[i].aid=aid;Core.Dom.addHTML(container,this.template.evaluate(data[i]));Core.Events.addEvent($E("cover_"+aid+"_"+data[i].pic_id),this.select.bind2(this))}},select:function(){var ele=Core.Events.getEventTarget();var arr=ele.id.split("_");var aid=arr[1];var pid=arr[2];var container=$E(this.ITEM_ID+aid);var selected=this.getSelected(aid);if(selected){selected.className=""}$E("cover_item_"+aid+"_"+pid).className="selected"},getSelected:function(aid){var container=$E(this.ITEM_ID+aid);var list=Core.Dom.getChildrenByClass(container,"selected");if(list[0]){return list[0]}return null}};Editor.Plugins.ArticleAssociate=Core.Class.create();Editor.Plugins.ArticleAssociate.prototype={select:[],articleList:{},tipType:"cate",showType:"txt",state:"",initialize:function(containerId,status){this.containerId=containerId;this.initHtml();if(scope.$is_photo_vip){trace("Vip");$E("showType_container").style.display="";if($E("assoc_style").value==0){this.showType="img"}this.swapShowView()}var isEdit=/article_edit.php/.test(location.pathname);this.tbhStatus=0;this.loadDataCount=0;this.initOption();this.initInterface();this.initEvent();this.setNumTip()},initSelectbyCookie:function(){var selectCookie=decodeURIComponent(Utils.Cookie.getCookie("article_associate_"+scope.$uid));if(selectCookie&&selectCookie!=""){this.select=selectCookie.split(",");this.cookieData=this.getDataFormCookie();this.setNumTip()}},initInterface:function(){this.txt_interface=new Interface("http://control.blog.sina.com.cn/riaapi/associate/get_articles.php","ajax");this.img_interface=new Interface("http://control.blog.sina.com.cn/riaapi/associate/get_articles_xrank.php","ajax")},setState:function(type){if(type=="operate"){if(this.showType=="txt"){$E("operate_list_view").style.display="none";$E("operate_list_o").parentNode.style.display="block"}else{$E("operate_img_list_view").parentNode.style.display="none";$E("operate_img_list").parentNode.style.display="block"}$E("view_operate").style.display="none";$E("operate_info").style.display="block";$E("operate_select").style.display="block";$E("add_container").style.display="block";this.state="operate"}else if(type=="view"){$E("operate_select").style.display="none";$E("operate_info").style.display="none";$E("add_container").style.display="none";if(this.showType=="txt"){$E("operate_list_view").style.display="block";$E("operate_list_o").parentNode.style.display="none"}else{$E("operate_img_list_view").parentNode.style.display="block";$E("operate_img_list").parentNode.style.display="none"}$E("view_operate").style.display="block";this.state="view"}},initEvent:function(){Core.Events.addEvent($E("unselect"),this.unselect.bind2(this),"click");Core.Events.addEvent($E("article_add"),this.add.bind2(this),"click");Core.Events.addEvent($E("modify"),this.modify.bind2(this),"click");Core.Events.addEvent($E("showType_select_options"),this.swapShowType.bind2(this),"change")},modify:function(){this.setState("operate");if(this.showType=="txt"&&!$E("operate_list_content").firstChild||this.showType=="img"&&!$E("operate_img_list").firstChild){this.initList();this.setNumTip()}$E("operate_list_view_ul").innerHTML=""},del:function(){winDialog.confirm($SYSMSG["B79004"],{funcOk:function(){this.remove()}.bind2(this),funcCancel:function(){editorTabs.showTab("article")}.bind2(this),textOk:"是",textCancel:"否",defaultButton:1,title:"提示",icon:"04"},"articleAssociateTip");var dia=winDialog.getDialog("articleAssociateTip");var closeBtn=dia.getNodes().btnClose;Core.Events.addEvent(closeBtn,function(){editorTabs.showTab("article")},"click")},remove:function(){this.select=[];this.articleList={};this.selectCate=0;this.modify();this.setNumTip();$E("cate_select_options").options[0].selected=true;this.loadDataCount=0;this.loadData()},add:function(){var len=this.select.length;if(len<1){return}var templateHtml,ele;if(this.showType=="txt"){templateHtml='<li><label>#{r}#{w}<a target="_blank" href="http://blog.sina.com.cn/s/blog_#{i}.html">#{t}</a>#{m}#{p}#{v}</label><span>#{d}</span></li>';ele=$E("operate_list_view_ul")}else{templateHtml='<div class="myPhotoblog_cell">			  <div class="myPhotoblog_view">			    <div class="myPhotoblog_area">			      <table border="0" cellspacing="0" cellpadding="0">			        <tr>			          <td><img src="#{imagePath}" /></td>			        </tr>			      </table>			    </div>			  </div>			  <div class="myPhotoblog_nm">						#{r}#{w}						<a target="_blank" href="http://blog.sina.com.cn/s/blog_#{i}.html">#{t}</a>						#{m}#{v}			  </div>			</div>';ele=$E("operate_img_list_view")}var template=new Ui.Template(templateHtml);ele.innerHTML=this.sortSelect(template);this.setState("view")},sortSelect:function(template){var html="";var len=this.select.length;var artArr=new Array(len);for(var i=0;i<len;i++){var data=this.articleList[this.select[i]];artArr[i]=data}for(var m=0;m<len;m++){for(var n=1;n<len;n++){if(comptime(artArr[n-1].d,artArr[n].d)=="bigger"){var temp=artArr[n-1];artArr[n-1]=artArr[n];artArr[n]=temp}}}var at=0;for(var q=len-1;q>=0;q--){artArr[q]=this.formatCover(artArr[q]);if(at!=0&&at%4==0){html+='<div class="clearit"></div>'}at++;html+=template.evaluate(artArr[q])}return html},compare:function(data){var s_len=this.select.length;var d_len=data.length;if(s_len==d_len){for(var i=0;i<s_len;i++){if(this.select[i]!=data[i].i){return false}}}else{return false}return true},page:function(pageNum,cate,count){var pageCount=10;if(this.showType=="img"){pageCount=8}var maxPage=Math.ceil(count/pageCount,pageCount);if(maxPage>1){Ui.Pagination.init({pageNode:"article_page",nodeClassNamePrefix:"SG",curPage:pageNum,maxPage:maxPage,pageTpl:this.loadData.bind2(this),type:1}).show()}else{$E("article_page").innerHTML=""}},unselect:function(){var len=this.select.length;for(var i=0;i<len;i++){var c;if(this.showType=="txt"){c=$E("Chb_"+this.select[i])}else{c=$E("Chb_i_"+this.select[i])}if(c){c.checked=false}}this.select=[];this.setNumTip()},waitStart:function(){$E("operate_list_o").style.display="none";$E("operate_list_loading").style.display="block"},waitEnd:function(){$E("operate_list_loading").style.display="none";$E("operate_list_o").style.display="block"},loadData:function(page){var page=page||1;var cate=this.selectCate||0;var param={uid:scope.$uid,s:10,p:page,c:cate,random:Math.random()};if(this.showType!="txt"){param.x="img";param.s=8;this._interface=this.img_interface}else{this._interface=this.txt_interface}this.waitStart();this._interface.request({GET:param,onSuccess:function(_data){var count,data;if(this.showType!="txt"){count=_data.count;data=_data.result}else{count=this.cates[cate].count;data=_data}if(count){this.setOption(count)}this.loadDataCount++;this.parseData(data);this.waitEnd();this.page(page,cate,count)}.bind2(this),onError:function(_data){showError(_data.code)},onFail:function(){}})},initList:function(){var ele=Core.Events.getEventTarget();if("select"==ele.nodeName.toLowerCase()){this.selectCate=ele.value}this.loadData(1)},setOption:function(count){if(this.showType=="img"){$E("aa_option").innerHTML="图片博文("+count+")"}else{$E("aa_option").innerHTML="全部博文("+count+")"}},initOption:function(){var data=articleEditorCFG.articleAssociate;this.cates=data.cates||{};
this.createOption("全部博文",data.total||0,"0","aa_option");for(name in this.cates){var n=this.cates[name].name;var c=this.cates[name].count;var i=this.cates[name].id;if(n&&typeof c!="undefinded"&&typeof i!="undefinded"){this.createOption(n,c,i)}}this.cates["0"]={name:"全部博文",count:data.total||0};Core.Events.addEvent($E("cate_select_options"),this.initList.bind2(this),"change")},createOption:function(name,count,value,id){var option=$C("option");if(id){option.id=id}option.innerHTML=name+"("+count+")";option.value=value;$E("cate_select_options").appendChild(option)},selectArticle:function(){var ele=Core.Events.getEventTarget();var len=10;if(this.showType=="img"){len=8}if(ele.checked){if(this.select.length>=len){Core.Events.stopEvent();showError("B78001");return}if(this.showType=="txt"){this.select.push(ele.id.split("_")[1])}else{this.select.push(ele.id.split("_")[2])}}else{if(this.showType=="txt"){this.select=Core.Array.ArrayWithout(this.select,ele.id.split("_")[1])}else{this.select=Core.Array.ArrayWithout(this.select,ele.id.split("_")[2])}}this.setNumTip()},setNumTip:function(){var countLen=10;if(this.showType=="img"){countLen=8}var len=this.select.length;if(len>0){this.showUnselect();this.disabledAddButton()}else{this.hiddenUnselect();this.disabledAddButton(true)}$E("num_s").innerHTML=this.select.length;$E("num_l").innerHTML=countLen-this.select.length},disabledAddButton:function(isTrue){var isTrue=isTrue||false;var ele=$E("article_add").parentNode;if(isTrue){ele.className="SG_aBtn SG_aBtn_dis"}else{ele.className="SG_aBtn SG_aBtnB"}},showUnselect:function(){$E("unselect_container").style.display=""},hiddenUnselect:function(){$E("unselect_container").style.display="none"},save:function(){var value=this.select.join(",");$E("assoc_article").value=value;if(this.historyData){if(this.compare(this.historyData)){return}}},getDataFormCookie:function(){var data_str=Utils.Cookie.getCookie("article_associate_data_"+scope.$uid);return Core.String.j2o(unescape(data_str))},saveDataToCookie:function(){var data={};var len=this.select.length;for(var i=0;i<len;i++){data[this.select[i]]=this.articleList[this.select[i]]}var data_str=Utils.Json.flatten(data);Utils.Cookie.setCookie("article_associate_data_"+scope.$uid,data_str,999)},saveSeleteData:function(){var len=this.select.length;var array=[];for(var i=0;i<len;i++){array.push(Utils.Json.flatten(this.articleList[this.select[i]]))}$E("assoc_article_data").value=array.join(",")},formatData:function(data){if(data.r){data.r='<img height="18" width="18" align="absmiddle" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon107"/>'}if(data.w){data.w='<a href="http://news.sina.com.cn/437/2008/0703/24.html" target="_blank"><img height="18" width="18" title="手机博文" align="absmiddle" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon105"/></a>'}if(data.p){data.p='<img height="15" width="15" align="absmiddle" title="此博文包含图片" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon18"/>'}if(data.m){data.m='<img height="15" width="15" align="absmiddle" title="此博文包含视频" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon16"/>'}if(data.v){data.v='<img height="15" width="15" align="absmiddle" title="此博文包含投票" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon33"/>'}return data},parseData:function(data){if(this.showType=="txt"){this.parseTxtData(data)}else{this.parseImgData(data)}},changeCover:function(){var ele=Core.Events.getEventTarget();var aid=ele.id.split("_")[2];if(!this.ccObj){this.ccObj=new Editor.Plugins.ChangeCover}this.ccObj.renderList(aid)},saveCover:function(){var ele=Core.Events.getEventTarget();var aid=ele.id.split("_")[2];this.ccObj.save(aid)},backCover:function(){var ele=Core.Events.getEventTarget();var aid=ele.id.split("_")[2];ele.style.display="none";$E("change_cover_"+aid).style.display="";$E("img_view_"+aid).style.display="";$E("cc_tip_"+aid).style.display="none";$E("back_cover_"+aid).style.display="none"},parseImgData:function(data){var ele=$E("operate_img_list");if(data){ele.innerHTML=""}else{ele.innerHTML="<strong>此分类尚无博文，请选择其他分类</strong>";return}var len=data.length;var tempHtml='<div class="myPhotoblog_cell">		  <div class="myPhotoblog_view">		    <div class="myPhotoblog_area" id="img_view_#{i}">		      <table border="0" cellspacing="0" cellpadding="0">		        <tr>		          <td><img id="cover_img_#{i}" src="#{imagePath}" /></td>		        </tr>		      </table>		    </div>			<div id="cc_tip_#{i}" class="myPhotoblog_txt SG_clewtxta" style="display:none">抱歉！<br>该篇博文内的所有图片来自站外，无法更换封面。</div>			<div class="myPhotoblog_coverlist" id="cover_view_#{i}" style="display:none"></div>		  </div>		  <div class="myPhotoblog_cover"><a id="change_cover_#{i}" href="javascript:void(0)">换封面</a><a id="save_cover_#{i}" href="javascript:void(0)" style="display:none">保存封面</a><a id="back_cover_#{i}" href="javascript:void(0)" style="display:none">返回</a></div>		  <div class="myPhotoblog_nm">		    <input  #{selected} type="checkbox" id="Chb_i_#{i}" />		    <label for="Chb_i_#{i}">					#{r}#{w}					<a target="_blank" href="http://blog.sina.com.cn/s/blog_#{i}.html">#{t}</a>					#{m}#{v}			</label>		  </div>		</div>';for(var i=0;i<len;i++){data[i]=this.formatData(data[i]);data[i]=this.formatCover(data[i]);if(Core.Array.findit(this.select,data[i].i)!=-1){data[i].selected="checked"}else{data[i].selected=""}var temp;var at=i+1;if(at%4==0){temp=new Ui.Template(tempHtml+'<div class="clearit"></div>')}else{temp=new Ui.Template(tempHtml)}Core.Dom.addHTML(ele,temp.evaluate(data[i]));if(!this.articleList[data[i].i]){this.articleList[data[i].i]=data[i]}Core.Events.addEvent($E("Chb_i_"+data[i].i),this.selectArticle.bind2(this),"click");Core.Events.addEvent($E("change_cover_"+data[i].i),this.changeCover.bind2(this),"click");Core.Events.addEvent($E("save_cover_"+data[i].i),this.saveCover.bind2(this),"click");Core.Events.addEvent($E("back_cover_"+data[i].i),this.backCover.bind2(this),"click")}},formatCover:function(data){if(data.imagePath){return data}if(data.cover){if(data.cover.length>30){data.imagePath=data.cover}else{data.imagePath=getImgStaticPath(data.cover,"small")}}else{data.imagePath="http://simg.sinajs.cn/blog7style/images/common/photoblog_default.gif"}return data},parseTxtData:function(data){var ele=$E("operate_list_content");var select_value=$E("cate_select_options").value;ele.innerHTML="";if(!data){if(select_value=="0"&&this.tipType!="all"){this.setTip("all")}if(select_value!="0"&&this.tipType!="cate"){this.setTip("cate")}$E("operate_list_none").style.display="block";return}$E("operate_list_none").style.display="none";var len=data.length;var __addEvent=Core.Events.addEvent;var __addHTML=Core.Dom.addHTML;var __click=Core.Events.click;var clickCount=0;for(var i=0;i<len;i++){data[i]=this.formatData(data[i]);if(Core.Array.findit(this.select,data[i].i)!=-1){data[i].selected="checked"}else{data[i].selected=""}var template='<li><input #{selected} type="checkbox" id="Chb_#{i}"/>	            <label>#{r}#{w}					<a target="_blank" href="http://blog.sina.com.cn/s/blog_#{i}.html">#{t}</a>					#{m}#{p}#{v}				</label>	            <span>#{d}</span>			</li>';var temp=new Ui.Template(template);__addHTML(ele,temp.evaluate(data[i]));if(!this.articleList[data[i].i]){this.articleList[data[i].i]=data[i]}__addEvent($E("Chb_"+data[i].i),this.selectArticle.bind2(this),"click");if(clickCount<5&&1===this.loadDataCount){__click($E("Chb_"+data[i].i));clickCount++}}},history:function(data){this.historyData=data||[];this.select=[];var len=this.historyData.length;for(var i=0;i<len;i++){this.select.push(this.historyData[i].i);this.articleList[this.historyData[i].i]=this.formatData(this.historyData[i])}this.swapShowView()},setTip:function(type){var type=type||"cate";var ele=$E("operate_list_none");switch(type){case"cate":ele.innerHTML=$SYSMSG["B79007"];break;case"all":ele.innerHTML=$SYSMSG["B79008"];break}this.tipType=type},swapShowType:function(){var ele=Core.Events.getEventTarget();trace(ele.value);if(ele.value!=this.showType){this.showType=ele.value;this.swapShowView();this.articleList={};this.select=[];this.setNumTip();this.loadData()}},swapShowView:function(){if(this.showType=="txt"){$E("operate_img_list").parentNode.style.display="none";$E("operate_list").style.display="";$E("assoc_style").value=1}else{$E("operate_list").style.display="none";$E("operate_img_list").parentNode.style.display="";$E("assoc_style").value=0}$E("showType_select_options").value=this.showType},initHtml:function(){var html='			<div class="Actit" id="operate_select">			  <div class="fL">请选择要添加的文章：</div>			   <div class="fR">			   	<span id="showType_container" style="display:none">					<span>展现方式：</span>				    <select id="showType_select_options">						<option value="img" selected="selected">图片</option>						<option value="txt">文字</option>				    </select>				</span>			 <span>分类：</span>			    <select id="cate_select_options">			    </select>				 <select id="img_cate_select_options" style="display:none">			    </select>			  </div>			</div>			<div style="display: none;" class="Actit Actit1" id="view_operate">			  <div class="fL">我的更多文章： <a href="javascript:;" onclick="return false" class="CP_a_fuc">[<cite id="modify">修改</cite>]</a><!-- <a href="javascript:;" onclick="return false"  class="CP_a_fuc">[<cite id="delete">删除</cite>]</a>--></div>			</div>			<div class="AcInfo" id="operate_list">			  <div class="AcInfoBg">			    <div style="" class="chooseCurr" id="operate_list_o">			      <ul id="operate_list_content"></ul>			    </div>			    <div style="display: none;" class="nodate SG_txtb" id="operate_list_loading">			      <div class="loading"><img title="加载中" src="http://simg.sinajs.cn/blog7style/images/common/loading.gif"/><br/>			        读取中…</div>			    </div>				<div style="display:none;" class="nodate SG_txtb" id="operate_list_none">					<strong>此分类尚无博文，请选择其他分类</strong>			    </div>			    </div>			  </div>			   <div class="myPhotoblog" style="display:none"><div class="myPhotoblog_list" id="operate_img_list"></div>			   <div class="myPhotoblog_help">                          	<p><strong>帮助：</strong></p>                            <p class="SG_dot">以图片方式添加博文，是我们为VIP用户提供的特殊服务。</p>                            <p class="SG_dot">系统默认您博文中的第一张图片为该博文的“封面”。</p>                            <p class="SG_dot">点击“换封面”可以为您的封面换一张图。</p>                            <p class="SG_dot">您只能对新浪域下的图片进行此项设置。</p>                          </div>			   </div>			  <div style="display: none;" id="operate_list_view" class="chooseOk">			    <ul id="operate_list_view_ul"></ul>			  </div>			  <div class="myPhotoblog" style="display:none"><div class="myPhotoblog_list" id="operate_img_list_view"></div></div>			  <div class="noteInfo" id="operate_info">			    <div class="fL"><span class="SG_txtc">已选<span id="num_s">0</span>篇，还可以选<span id="num_l">10</span>篇 </span><a style="display:none" id="unselect_container" href="javascript:;" onclick="return false"  class="CP_a_fuc">[<cite id="unselect">重选</cite>]</a></div>			    <div class="fR" id="article_page"></div>			  </div>			</div>			<div class="AcInfoBtn" id="add_container"><a href="javascript:;"   onclick="return false" class="SG_aBtn SG_aBtn_dis"><cite id="article_add">添加</cite></a></div>';$E(this.containerId).innerHTML=html}};function comptime(beginTime,endTime){var beginTimes=beginTime.substring(0,10).split("-");var endTimes=endTime.substring(0,10).split("-");beginTime=beginTimes[1]+"/"+beginTimes[2]+"/"+beginTimes[0]+" "+beginTime.substring(10,19);endTime=endTimes[1]+"/"+endTimes[2]+"/"+endTimes[0]+" "+endTime.substring(10,19);var a=(Date.parse(endTime)-Date.parse(beginTime))/3600/1e3;if(a<0){return"bigger"}else if(a>0){return"smaller"}else if(a==0){return"equal"}else{return"exception"}}SinaEditor.ChangeCover=Core.Class.create();SinaEditor.ChangeCover.prototype={ITEM_ID:"cover_view_",COVER_ID:"img_view_",COVER_IMG_ID:"cover_img_",SAVE_ID:"save_cover_",CHANGE_ID:"change_cover_",initialize:function(){},initInterface:function(){this.list_interface=new Interface("http://control.blog.sina.com.cn/riaapi/photoblog/list_blogpic.php","ajax");this.save_interface=new Interface("http://control.blog.sina.com.cn/riaapi/photoblog/set_cover.php","ajax")},save:function(aid){var param={blog_id:aid};var selected=this.getSelected(aid);if(selected){param.pic_id=selected.id.split("_")[3]}else{showError("请选择一个封片");return false}this.save_interface.request({GET:param,onSuccess:function(_data){articleAssociate.articleList[aid].imagePath=getImgStaticPath(param.pic_id,"small");this.set(aid,param.pic_id);this.swapView(aid,"show_cover")}.bind2(this),onError:function(_data){showError(_data.code)},onFail:function(){}})},swapTipMode:function(aid){$E("img_view_"+aid).style.display="none";$E("cc_tip_"+aid).style.display="";$E("back_cover_"+aid).style.display="";$E("change_cover_"+aid).style.display="none"},loadData:function(aid){if(!this.list_interface){this.initInterface()}var param={blog_id:aid};this.list_interface.request({GET:param,onSuccess:function(_data){if(_data.length<1){this.swapTipMode(aid)}else{this.buildList(_data,aid);this.swapView(aid,"show_list")}}.bind2(this),onError:function(_data){showError(_data.code)},onFail:function(){}})},renderList:function(aid){this.loadData(aid)},set:function(aid,pid){var ele=$E(this.COVER_IMG_ID+aid);ele.src=getImgStaticPath(pid,"small")},swapView:function(aid,type){var changeModeEle=$E(this.ITEM_ID+aid);var showModeEle=$E(this.COVER_ID+aid);var changeBtnEle=$E(this.CHANGE_ID+aid);if(type==="show_list"){showModeEle.style.display="none";changeBtnEle.style.display="none";changeModeEle.style.display=""}else{changeModeEle.style.display="none";showModeEle.style.display="";changeBtnEle.style.display=""}},getPicBySrc:function(src){return src.replace(/(.*?)\/(\w{16,21})[\^?&]?/,"$2")},initTemplate:function(){if(this.template){return}tempHtml='<a href="javascript:;" title="" class="pic_small" is_selected="#{is_selected}" id="cover_item_#{aid}_#{pic_id}">'+'<i class="icon i22_clicked" style="#{is_show}"></i>'+'<img id="cover_#{aid}_#{pic_id}" src="#{imgPath}" class="pic_img" alt="">'+"</a>";this.template=new Ui.Template(tempHtml)},buildList:function(data,aid){var container=$E(this.ITEM_ID+aid);var len=data.length;var select_pid=this.getPicBySrc($E(this.COVER_IMG_ID+aid).src);container.innerHTML="";this.initTemplate();for(var i=0;i<len;i++){if(select_pid==data[i].pic_id){data[i].cls="pic_hover";data[i].is_show="display:;";data[i].is_selected=1}else{data[i].cls="";data[i].is_show="display:none";data[i].is_selected=0}data[i].imgPath=getImgStaticPath(data[i].pic_id,"small");data[i].aid=aid;Core.Dom.addHTML(container,this.template.evaluate(data[i]));Core.Events.addEvent($E("cover_"+aid+"_"+data[i].pic_id),this.select.bind2(this))}},select:function(){var ele=Core.Events.getEventTarget();var arr=ele.id.split("_");var aid=arr[1];var pid=arr[2];var container=$E(this.ITEM_ID+aid);var selected=this.getSelected(aid);if(selected){selected.setAttribute("is_selected",0);var iNode=selected.getElementsByTagName("i")[0];if(iNode){iNode.style.display="none"}}var coverNode=$E("cover_item_"+aid+"_"+pid);coverNode.className+=" pic_hover";var iNode=coverNode.getElementsByTagName("i")[0];if(iNode){if(iNode.style.display=="none"){iNode.style.display="";coverNode.setAttribute("is_selected",1);this.save(aid)}}},getSelected:function(aid){var container=$E(this.ITEM_ID+aid);var children=container.children;for(var i=0;i<children.length;i++){var node=children[i];if(node.getAttribute("is_selected")==1){return node}}return null}};if(typeof SinaEditor==undefined){SinaEditor={}}var __addEvent=Core.Events.addEvent,__fixEvent=Core.Events.fixEvent,__removeEvent=Core.Events.removeEvent,__stopDefault=Core.Events.stopDefaultEvent;__setStyle=Core.Dom.setStyle2;SinaEditor.newArticleAssociate=Core.Class.create();SinaEditor.newArticleAssociate.prototype={initialize:function(containerId,status){this.containerId=containerId;this.initHtml();if(scope.$is_photo_vip){$E("showType_container").style.display="";if($E("assoc_style").value==0){this.showType="img"}this.swapShowView()}var isEdit=/article_edit.php/.test(location.pathname);this.tbhStatus=0;this.loadDataCount=0;this.initOption();this.initInterface();this.initEvent();this.setNumTip()},initHtml:function(){var html=['<div class="e_layer_select">','<ul class="selected sel" style="display:none;" id="showType_container">','<li class="s1" id="showType_select_options">展现方式<a href="javascript:void(0);" class="down"><i class="icon i18_down_arr"></i></a></li>',"</ul>",'<ul class="selected">','<li class="s1" id="cate_select_options">分类<a href="javascript:void(0);" class="down"><i class="icon i18_down_arr"></i></a></li>',"</ul>","</div>",'<div class="e_layer_cont1" set="1">','<div id="operate_list_o">','<ul class="e_layer_word" id="operate_list_content">',"</ul>","</div>",'<div class="e_layer_word center" id="operate_list_loading" style="display: none;">','<div class="no_blog">','<img src="http://simg.sinajs.cn/blog7style/images/blog_editor/bne_loading.gif" alt="">','<p class="loading_word">读取中...</p>',"</div>","</div>",'<div class="e_layer_word center" id="operate_list_none" style="display: none;">','<p class="no_blog">此分类尚无博文，请选择其他分类</p>',"</div>",'<div class="e_layer_pic" style="display:none;">','<ul class="pic_line" id="operate_img_list">',"</ul>","</div>",'<div class="e_layer_warn">','<p class="p">已选<span id="num_s">5</span>篇，还可以选<span id="num_l">5</span>篇<a href="javascript:;" id="unselect_container"><span id="unselect">重选</span></a></p>','<div class="e_layer_page" id="article_page">',"</div>","</div>",'<a href="javascript:;" class="e_layer_btn btn_style" id="article_add">添加</a>',"</div>"].join("");this.dialog=winDialog.createCustomsDialog({funcClose:this.hide.bind2(this),content:html,width:670,title:"请选择要添加的文章"});if(!$E("article_add_list_view")){ele=$C("div");ele.innerHTML=['<div class="BNE_insert" id="article_add_list_view" style="display:none;">','<div class="inse_tit">','<a href="javascript:;" class="lk_a del_btn" id="article_associate_delete_btn"><span class="txt">删除</span><i class="icon i9_close"></i></a>','<a href="javascript:;" class="lk_a modify_btn" id="article_associate_modify_btn"><span class="txt">编辑</span><i class="icon i8_edit"></i></a>','<span class="tit">更多博文</span>',"</div>","<!--更多博文_文字-->",'<ul class="BNE_wmore" id="operate_list_view_ul">',"</ul>","<!--/更多博文_文字-->","<!--更多博文_图片-->",'<ul class="BNE_pmore" id="operate_img_list_view">',"</ul>","<!--/更多博文_图片-->","</div>"].join("");$E("BNE_editor").appendChild(ele)}},initOption:function(){var data=articleEditorCFG.articleAssociate;this.cates=data.cates||{};var model=[],temp={};model.push({value:0,text:"全部博文",count:data.total||0});for(var i in this.cates){temp={};temp.value=this.cates[i].id;temp.text=this.cates[i].name;temp.count=this.cates[i].count;model.push(temp)}this.cates["0"]={id:0,name:"全部博文",count:data.total||0};var config={triggerTpl:'<span>#{text}</span><a href="javascript:void(0);" class="down"><i class="icon i18_down_arr"></i></a>',triggerClassName:"menu",triggerText:"全部博文",optionTpl:'<li data-value="#{value}" data-defaultselected="#{defaultSelected}" data-selected="#{selected}" data-disabled="#{disabled}" data-text="#{text}"><a href="javascript:;" title="#{text}"><span>#{text}</span></a></li>',name:"cate_select_options",model:model};var nodeCate=$E("cate_select_options");this.cateSelectOption=new Sina.Ui.Select(nodeCate,config);model=[{value:"txt",text:"文字"},{value:"img",text:"图片"}];config={triggerTpl:'<span>#{text}</span><a href="javascript:void(0);" class="down"><i class="icon i18_down_arr"></i></a>',triggerClassName:"menu sel1",triggerText:"图片",optionTpl:'<li data-value="#{value}" data-defaultselected="#{defaultSelected}" data-selected="#{selected}" data-disabled="#{disabled}" data-text="#{text}"><a href="javascript:;" title="#{text}"><span>#{text}</span></a></li>',name:"showType_select_options",model:model};var nodeType=$E("showType_select_options");this.typeSelectOption=new Sina.Ui.Select(nodeType,config);this.swapShowView()},setOption:function(){if(!this.cateSelectOption){return}var cateSelectOption=this.cateSelectOption;var node=cateSelectOption.getList().children[0];if(this.showType=="txt"){node.setAttribute("data-text","全部博文");node.innerHTML='<span title="全部博文">全部博文</span>'}else{node.setAttribute("data-text","图片博文");node.innerHTML='<span title="图片博文">图片博文</span>'}if(cateSelectOption.getValue()==0){cateSelectOption.setValue(0,false)}},disabledAddButton:function(isTrue){var isTrue=isTrue||false;var ele=$E("article_add");if(isTrue){if(ele.className.indexOf("btn_default")<0){ele.className+=" btn_default"}}else{if(ele.className.indexOf("btn_default")>=0){ele.className=ele.className.replace("btn_default","")}}},page:function(pageNum,cate,count){var pageCount=6;if(this.showType=="img"){pageCount=8}var maxPage=Math.ceil(count/pageCount,pageCount);if(maxPage>1){Ui.Pagination.init({pageNode:"article_page",nodeClassNamePrefix:"number",curPage:pageNum,maxPage:maxPage,pageTpl:this.loadData.bind2(this),type:1}).show()}else{$E("article_page").innerHTML=""}},initEvent:function(){__addEvent($E("unselect"),this.unselect.bind2(this),"click");__addEvent($E("article_add"),this.add.bind2(this),"click");__addEvent($E("article_associate_modify_btn"),this.modify.bind2(this),"click");__addEvent($E("article_associate_delete_btn"),this.del.bind2(this),"click");this.cateSelectOption.addEventListener("change",this.initList.bind2(this));this.typeSelectOption.addEventListener("change",this.swapShowType.bind2(this))},initList:function(curNode,oldNode){if(curNode){this.selectCate=curNode.getAttribute("data-value")}this.loadData(1)},loadData:function(page){var page=page||1;var cate=this.selectCate||"0";var param={uid:scope.$uid,s:6,p:page,c:cate,random:Math.random()};if(this.showType!="txt"){param.x="img";param.s=8;this._interface=this.img_interface}else{this._interface=this.txt_interface}this.showLoading();this._interface.request({GET:param,onSuccess:function(_data){var count,data;if(this.showType!="txt"){count=_data.count;data=_data.result}else{count=this.cates[cate].count;data=_data}if(count){this.setOption()}this.loadDataCount++;this.parseData(data);this.page(page,cate,count)}.bind2(this),onError:function(_data){showError(_data.code)}})},formatData:function(data){if(data.r){data.r='<i class="icon jian"></i>'}return data},parseTxtData:function(data){var ele=$E("operate_list_content");var select_value=$E("cate_select_options").value;ele.innerHTML="";if(!data){this.showNoBlog();return}this.showTxtList();var len=data.length;var __addEvent=Core.Events.addEvent;var __addHTML=Core.Dom.addHTML;var __click=Core.Events.click;var clickCount=0;for(var i=0;i<len;i++){data[i]=this.formatData(data[i]);if(Core.Array.findit(this.select,data[i].i)!=-1){data[i].selected="checked"}else{data[i].selected=""}var template='<li><input type="checkbox" #{selected} id="Chb_#{i}" class="word_box" />'+'<a href="http://blog.sina.com.cn/s/blog_#{i}.html" class="word_link" target="_blank">#{r}#{t}</a>'+"</li>";var temp=new Ui.Template(template);__addHTML(ele,temp.evaluate(data[i]));if(!this.articleList[data[i].i]){this.articleList[data[i].i]=data[i]}__addEvent($E("Chb_"+data[i].i),this.selectArticle.bind2(this),"click");var isSet=$E("article_add_list_view").getAttribute("is_set")&&$E("article_add_list_view").getAttribute("is_set")=="1";if(!isSet){if(clickCount<5&&1===this.loadDataCount){__click($E("Chb_"+data[i].i));clickCount++}}}},parseImgData:function(data){var ele=$E("operate_img_list");ele.innerHTML="";if(!data){this.showNoBlog();return}this.showImgList();var len=data.length;var tempHtml="<li>"+'<a id="img_view_#{i}" href="javascript:;" title="" class="pic_link">'+'<i id="change_cover_#{i}" class="icon i7_clicked icon_hover"></i>'+'<span><img id="cover_img_#{i}" src="#{imagePath}" class="pic_img" alt=""></span>'+"</a>"+'<p id="cc_tip_#{i}" class="pic_link pic_nofile" style="display:none;"><i id="back_cover_#{i}" class="icon i9_clicked"></i>抱歉!<br>该篇博文内的所有图片来自站外，无法更换封面。</p>'+'<div id="cover_view_#{i}" class="pic_link pic_link1" style="display:none;">'+"</div>"+"<p>"+'<input id="Chb_i_#{i}" #{selected} type="checkbox">'+'<a target="_blank" href="http://blog.sina.com.cn/s/blog_#{i}.html" title="" class="pic_tit">#{t}</a>'+"</p>"+"</li>";for(var i=0;i<len;i++){data[i]=this.formatData(data[i]);data[i]=this.formatCover(data[i]);if(Core.Array.findit(this.select,data[i].i)!=-1){data[i].selected="checked"}else{data[i].selected=""}var temp;var at=i+1;temp=new Ui.Template(tempHtml);Core.Dom.addHTML(ele,temp.evaluate(data[i]));if(!this.articleList[data[i].i]){this.articleList[data[i].i]=data[i]}__addEvent($E("Chb_i_"+data[i].i),this.selectArticle.bind2(this),"click");__addEvent($E("change_cover_"+data[i].i),this.changeCover.bind2(this),"click");__addEvent($E("back_cover_"+data[i].i),this.backCover.bind2(this),"click")}},formatCover:function(data){if(data.imagePath){return data}if(data.cover){if(data.cover.length>30&&data.cover.indexOf("photoblog_default.gif")>0){data.imagePath="http://simg.sinajs.cn/blog7style/images/blog_editor/bne_cover.gif"}else{data.imagePath=getImgStaticPath(data.cover,"small")}}else{data.imagePath="http://simg.sinajs.cn/blog7style/images/blog_editor/bne_cover.gif"}return data},showTxtList:function(){$E("operate_list_content").style.display="";$E("operate_list_o").style.display="";$E("operate_img_list").style.display="none";$E("operate_img_list").parentNode.style.display="none";$E("operate_list_none").style.display="none";$E("operate_list_loading").style.display="none"},showImgList:function(){$E("operate_img_list").style.display="";$E("operate_img_list").parentNode.style.display="";$E("operate_list_none").style.display="none";$E("operate_list_loading").style.display="none";$E("operate_list_content").style.display="none";$E("operate_list_o").style.display="none"},showNoBlog:function(){$E("operate_list_none").style.display="";$E("operate_list_loading").style.display="none";$E("operate_img_list").style.display="none";$E("operate_img_list").parentNode.style.display="none";$E("operate_list_content").style.display="none";$E("operate_list_o").style.display="none"},showLoading:function(){$E("operate_list_loading").style.display="";$E("operate_list_none").style.display="none";$E("operate_img_list").style.display="none";$E("operate_img_list").parentNode.style.display="none";$E("operate_list_content").style.display="none";$E("operate_list_o").style.display="none"},add:function(){debugger;var len=this.select.length;if(len<1){return}var templateHtml,eleTxt,eleImg;eleTxt=$E("operate_list_view_ul");eleImg=$E("operate_img_list_view");if(this.showType=="txt"){templateHtml='<li><a href="http://blog.sina.com.cn/s/blog_#{i}.html" class="wmore_link" target="_blank"><span class="dot"></span>#{r}#{t}</a></li>';var template=new Ui.Template(templateHtml);eleTxt.innerHTML=this.sortSelect(template);eleTxt.style.display="";eleImg.style.display="none"}else{templateHtml=["<li>",'<a target="_blank" href="http://blog.sina.com.cn/s/blog_#{i}.html" class="pmore_pic" title="#{t}"><img class="pmore_img" src="#{imagePath}" alt=""></a>','<a target="_blank" href="http://blog.sina.com.cn/s/blog_#{i}.html" class="pmore_tit">#{t}</a>',"</li>"].join("");var template=new Ui.Template(templateHtml);eleImg.innerHTML=this.sortSelect(template);eleImg.style.display="";eleTxt.style.display="none";eleTxt.parentNode.style.display="none"}$E("article_add_list_view").style.display="";$E("article_add_list_view").setAttribute("is_set",1);this.setState("view")},saveSeleteData:function(){var len=this.select.length;var array=[];var is_set=$E("article_add_list_view").getAttribute("is_set");if(is_set==1){for(var i=0;i<len;i++){array.push(Utils.Json.flatten(this.articleList[this.select[i]]))}$E("assoc_article_data").value=array.join(",")}},sortSelect:function(template){var html="";var len=this.select.length;var artArr=new Array(len);for(var i=0;i<len;i++){var data=this.articleList[this.select[i]];artArr[i]=data}for(var m=0;m<len;m++){for(var n=1;n<len;n++){if(comptime(artArr[n-1].d,artArr[n].d)=="bigger"){var temp=artArr[n-1];artArr[n-1]=artArr[n];artArr[n]=temp}}}var at=0;for(var q=len-1;q>=0;q--){artArr[q]=this.formatCover(artArr[q]);at++;html+=template.evaluate(artArr[q])}return html},del:function(){winDialog.confirm($SYSMSG["B79004"],{funcOk:function(){this.remove();this.hide()}.bind2(this),funcCancel:function(){}.bind2(this),textOk:"是",textCancel:"否",defaultButton:1,title:"提示",icon:"04"},"articleAssociateTip")},remove:function(){this.select=[];this.articleList={};this.selectCate=0;this.loadDataCount=0;this.setNumTip();$E("article_add_list_view").style.display="none";$E("article_add_list_view").setAttribute("is_set",0);$E("operate_list_view_ul").innerHTML="";$E("operate_img_list_view").innerHTML=""},modify:function(){this.setState("operate")},swapShowType:function(curNode,oldNode){if(curNode!=oldNode){var v=curNode.getAttribute("data-value");this.showType=v;this.swapShowView();this.articleList={};this.select=[];this.setNumTip();this.loadData()}},swapShowView:function(){if(this.showType=="txt"){$E("assoc_style").value=1;$E("operate_img_list").parentNode.style.display="none";$E("operate_list_content").style.display=""}else{$E("assoc_style").value=0;$E("operate_img_list").parentNode.style.display="";$E("operate_list_content").style.display="none"}if(this.typeSelectOption){this.typeSelectOption.setValue(this.showType,false)}},setState:function(type){if(type=="operate"){if(this.showType=="txt"){$E("operate_list_o").style.display=""}else{$E("operate_img_list").parentNode.style.display=""}this.state="operate";this.show()}else if(type=="view"){this.state="view";this.hide()}},show:function(){if(this.dialog){var eleTxt=$E("operate_list_content");var eleImg=$E("operate_img_list");this.loadData();this.setNumTip();this.dialog.show();this.dialog.setMiddle()}},hide:function(){if(this.dialog){try{this.dialog.hide()}catch(e){}}},changeCover:function(){var ele=Core.Events.getEventTarget();var aid=ele.id.split("_")[2];if(!this.ccObj){this.ccObj=new SinaEditor.ChangeCover}this.ccObj.renderList(aid)}};Core.Class.extend(SinaEditor.newArticleAssociate.prototype,Editor.Plugins.ArticleAssociate.prototype,true);Ui.Pagination.show=function(oNode,nCurPage){nCurPage=nCurPage*1;var hash=this._cache_node;if(oNode!=null){this._cache_node=hash=Ui.Pagination._list[oNode.id];hash.curPage=nCurPage}var ambit=[];if(hash.viewSize*2+1>=hash.maxPage){ambit[1]=hash.minPage;ambit[2]=hash.maxPage}else if(hash.curPage<=hash.minPage+hash.viewSize){ambit[1]=hash.minPage;ambit[2]=hash.minPage+(hash.viewSize*2-1);ambit[3]=hash.maxPage}else if(hash.curPage>=hash.maxPage-hash.viewSize){ambit[0]=hash.minPage;ambit[1]=hash.maxPage-(hash.viewSize*2-1);ambit[2]=hash.maxPage}else{ambit[0]=hash.minPage;ambit[1]=hash.curPage-(hash.viewSize-1);ambit[2]=hash.curPage+(hash.viewSize-1);ambit[3]=hash.maxPage}var result=[];if(hash.countTpl!=null){result.push(this._createPage("","","","",hash.countTpl))}if(hash.type!=2&&hash.curPage!=hash.minPage){if(hash.type==3)result.push(this._createPage("prev_next",hash.curPage-1,3,hash.curPage-1,"<"));else result.push(this._createPage("prev_next",hash.curPage-1,3,hash.curPage-1,"<"))}if(hash.type!=3){if(ambit[0]!=null){var str=ambit[0]==hash.curPage?this._createPage(hash.nodeClassNamePrefix+" a_hover",1,6,hash.curPage,ambit[0]):this._createPage(hash.nodeClassNamePrefix,1,1,ambit[0],ambit[0]);result.push(str)}if(hash.type==1&&ambit[0]!=null){result.push(this._createPage(hash.nodeClassNamePrefix,"","","","..."))}for(var i=ambit[1];i<=ambit[2];i++){if(i==ambit[1]&&i!=hash.minPage&&hash.type==2){var LS=hash.curPage-hash.dotRate;LS=LS<hash.minPage?hash.minPage:LS;result.push(this._createPage(hash.nodeClassNamePrefix,hash.viewSize+1,2,hash.curPage-hash.viewSize-1,"..."))}else if(i==ambit[2]&&i!=hash.maxPage&&hash.type==2){var RS=hash.curPage+hash.dotRate;RS=RS>hash.maxPage?hash.maxPage:RS;result.push(this._createPage(hash.nodeClassNamePrefix,hash.viewSize+1,4,hash.curPage+hash.viewSize+1,"..."))
}else{str=i==hash.curPage?this._createPage(hash.nodeClassNamePrefix+" a_hover",1,6,hash.curPage,i):this._createPage(hash.nodeClassNamePrefix,i,3,i,i);result.push(str)}}if(hash.type==1&&ambit[3]!=null){result.push(this._createPage(hash.nodeClassNamePrefix,"","","","..."))}if(ambit[3]!=null&&hash.showLastPage){str=ambit[3]==hash.curPage?this._createPage(hash.nodeClassNamePrefix+" a_hover",hash.curPage-1,3,hash.curPage,ambit[3]):this._createPage(hash.nodeClassNamePrefix,1,5,ambit[3],ambit[3]);result.push(str)}}else{result.push(this._createPage(hash.nodeClassNamePrefix,"","","",hash.curPage+hash.maxPage))}if(hash.type!=2&&hash.curPage!=hash.maxPage){if(hash.type==3)result.push(this._createPage("prev_next",hash.curPage+1,3,hash.curPage+1,">"));else result.push(this._createPage("prev_next",hash.curPage+1,3,hash.curPage+1,">"))}if(hash.showTotal==true){result.push(this._createPage(hash.nodeClassNamePrefix,"","","","共"+hash.maxPage+"页"))}$E(hash.pageNode).innerHTML=result.join("")};Ui.Pagination._createPage=function(sClass,sTipPage,nTipIndex,nHrefPage,sHrefText){if(sHrefText==""){return""}var sTitle=sTipPage===""||nTipIndex==""?"":this._getTips(sTipPage,nTipIndex);var sLink='<a title="'+sTitle+'" class="'+sClass+'" '+this._getUrl(nHrefPage)+">"+sHrefText+"</a>";return sLink};$registJob("article_associate",function(){var __addEvent=Core.Events.addEvent,__fixEvent=Core.Events.fixEvent,__removeEvent=Core.Events.removeEvent,__stopDefault=Core.Events.stopDefaultEvent,__setStyle=Core.Dom.setStyle2;var articleAssociateNode=$E("article_associate");var bneEditor=$E("BNE_editor");if(!window.articleAssociate){window.articleAssociate=new SinaEditor.newArticleAssociate(articleAssociateNode,articleEditorCFG.articleStatus);window.articleAssociate.initSelectbyCookie();function showArticleAssociate(){window.articleAssociate.show()}__addEvent(articleAssociateNode,showArticleAssociate)}});Lib.classUtils=function(){};Lib.classUtils.prototype.addClass=function(dom,clz){if(!dom){return false}if(!this.hasClass(dom,clz)){dom.className=Core.String.trim(dom.className.concat(" "+clz))}};Lib.classUtils.prototype.delClass=function(dom,clz){if(!dom){return false}var reg=new RegExp("( +|^)"+clz+"(?=( |$))","ig");dom.className=Core.String.trim(dom.className.replace(reg,""))};Lib.classUtils.prototype.hasClass=function(dom,clz){if(!dom){return false}var reg=new RegExp("( +|^)"+clz+"(?=( |$))","ig");return reg.test(dom.className)};Lib.pkg("util");Lib.util.hoverJq=function(conf){var _default={elm:document.body,mouseenter:function(evt,el,index){},mouseleave:function(evt,el,index){},delay:0};conf=Lib.apply(_default,conf);var enterType=$IE?"mouseenter":"mouseover",leaveType=$IE?"mouseleave":"mouseout";if(!("length"in conf.elm)){conf.elm=[conf.elm]}else{try{conf.elm=Array.prototype.slice.call(conf.elm,0)}catch(e){var tmpArr=[];for(var i=0,len=conf.elm.length;i<len;i++){tmpArr.push(conf.elm[i])}conf.elm=tmpArr}}Core.Array.foreach(conf.elm,function(one,index){Core.Events.removeEvent(one,enterType);Core.Events.removeEvent(one,leaveType);Core.Events.addEvent(one,function(el,func,i){return function(evt){evt=evt||window.event;if($IE){func.apply(el,[evt,el,i])}else{withinElement(evt,"mouseenter",el,i)}}}(one,conf[enterType],index),enterType);Core.Events.addEvent(one,function(el,func,i){return function(event){if($IE){func.apply(el,[event,el,i])}else{withinElement(event,"mouseleave",el,i)}}}(one,conf[leaveType],index),leaveType)});var withinElement=function(event,mouseType,elm,i){var parent=event.relatedTarget;try{if(parent&&parent!==document&&!parent.parentNode){return}while(parent&&parent!==elm){parent=parent.parentNode}if(parent!==elm){conf[mouseType].apply(elm,[event,elm,i])}}catch(e){}return false}};$registJob("article_cate",function(){var __addEvent=Core.Events.addEvent,__fixEvent=Core.Events.fixEvent,__stopDefault=Core.Events.stopDefaultEvent,__classUtil=new Lib.classUtils;var blogCateSelect=$E("blog_cate_select"),blogCateList=$E("blog_cate_list"),blogCateSelectedList=$E("blog_cate_selected_list"),componentSelect=$E("componentSelect");if(!blogCateSelect||!blogCateList||!blogCateSelectedList){return}__addEvent(blogCateSelect,function(e){v7sendLog("16_01_21");var iNode=blogCateSelect.getElementsByTagName("i")[0];if(blogCateList.style.display=="none"){blogCateList.style.display="";blogCateSelectedList.style.display="none";__classUtil.delClass(iNode,"i2_darr");__classUtil.addClass(iNode,"i3_uarr")}else{blogCateList.style.display="none";blogCateSelectedList.style.display="";__classUtil.delClass(iNode,"i3_uarr");__classUtil.addClass(iNode,"i2_darr")}__stopDefault(e)});__addEvent(blogCateList,function(e){e=__fixEvent(e);var iNode=blogCateSelect.getElementsByTagName("i")[0];var elem=findTarget(blogCateList,e.target,"li");if(elem){var cateValue=elem.getAttribute("cate_value");if(cateValue=="0"){__classUtil.addClass($E("is_private_blog"),"btn_cur");$E("xRankRadio").checked="checked"}else{__classUtil.delClass($E("is_private_blog"),"btn_cur");$E("xRankRadio").checked=""}componentSelect.value=cateValue;var cateText=elem.getElementsByTagName("a")[0];cateText=cateText.innerText||cateText.textContent;var newLi=$C("li");newLi.setAttribute("cate_value",cateValue);newLi.innerHTML='<span class="dot"></span><a class="sort_by" href="javascript:;return false;"><span class="dot_cont">'+cateText+'<i class="dot_hover2" onclick="deleteArticleCate();" ></i></span></a>';blogCateSelectedList.innerHTML="";blogCateSelectedList.appendChild(newLi);if($IE6){var hoverElem=blogCateSelectedList.getElementsByTagName("li")[0];Lib.util.hoverJq({elm:hoverElem,mouseenter:function(evt,el,index){var a=el.getElementsByTagName("a")[0];__classUtil.addClass(a,"sort_close")},mouseleave:function(evt,el,index){var a=el.getElementsByTagName("a")[0];__classUtil.delClass(a,"sort_close")}})}blogCateSelectedList.style.display="";blogCateList.style.display="none";__classUtil.delClass(iNode,"i3_uarr");__classUtil.addClass(iNode,"i2_darr")}});function findTarget(parent,target,tag){while(target!==parent){if(target.tagName.toLowerCase()==tag){return target}target=target.parentNode}}window.deleteArticleCate=function(){var __classUtil=new Lib.classUtils;var cateList=$E("blog_cate_selected_list"),componentSelect=$E("componentSelect"),isPrivateBlog=$E("is_private_blog"),xRankRadio=$E("xRankRadio");__classUtil.delClass(isPrivateBlog,"btn_cur");xRankRadio.checked="";cateList.innerHTML="";cateList.style.display="none";componentSelect.value="00";return false}});if(document.documentElement.contains){Core.Dom.contains=function(oParentNode,oNode){return oParentNode.contains?oParentNode.contains(oNode):true}}else if(document.documentElement.compareDocumentPosition){Core.Dom.contains=function(oParentNode,oNode){return oParentNode===oNode||!!(oParentNode.compareDocumentPosition(oNode)&16)}}else{Core.Dom.contains=function(oParentNode,oNode){while(oNode){if(oParentNode===oNode){return true}oNode=oNode.parentNode}return false}}Core.Events.fireEvent=function(oElement,sEvent){var evt;oElement=$E(oElement);if(oElement.fireEvent){oElement.fireEvent("on"+sEvent)}else{if($MOBILE){evt=document.createEvent("HTMLEvents")}else{evt=document.createEvent("MouseEvents")}evt.initEvent(sEvent,true,true);oElement.dispatchEvent(evt)}};Core.String.encodeHTML=function(str){var div=document.createElement("div");div.appendChild(document.createTextNode(str));return div.innerHTML.replace(/\s/g,"&nbsp;")};Core.String.decodeHTML=function(str){var div=document.createElement("div");div.innerHTML=str;return div.innerText==undefined?div.textContent:div.innerText};function TagsAddNew(tInputContiner,tInput,tTags){var __addEvent=Core.Events.addEvent;var returnObject={};var splitChar=[",","，"];var rBLANK=/\s/,rNOTAZ=/[^a-z]$/;function createTag(str,opt){str=str.replace(/[,，\s]/g,"");if(str===""){return}str=Core.String.encodeHTML(str);str=substr(str,20);var spans=tInputContiner.getElementsByTagName("div");if(spans.length>4){tInput.value="";tInput.blur();(!opt||!opt.notip)&&winDialog.alert("最多输入5个标签",{icon:"01"});return}if((","+tTags.value+",").indexOf(","+Core.String.decodeHTML(str)+",")>-1){tInput.value="";return}opt=opt||{};opt.deleteAble=typeof opt.deleteAble=="boolean"?opt.deleteAble:true;str="<span>"+str+"</span>";var sp=document.createElement("div"),deleteBtn="";deleteBtn=opt.deleteAble!=false?'<a class="close" onclick="return false" href="javascript:;" title="删除">×</a>':"";if(opt.deleteAble!==false)sp.setAttribute("deleteAble","true");else sp.setAttribute("deleteAble","false");sp.innerHTML=str+deleteBtn;sp.className=opt.className||"tag1";var tagsElArray=$T(tInputContiner,"div");if(null!=opt.insertIndex&&tagsElArray.length-1>opt.insertIndex){tInputContiner.insertBefore(sp,tagsElArray[opt.insertIndex])}else{tInputContiner.insertBefore(sp,tInput);var firstChild=tInputContiner.children[0];if(firstChild&&"EM"==firstChild.nodeName.toUpperCase()){tInputContiner.removeChild(firstChild)}}setTagInputValue();return true}function removeTag(tagName,deleteAble){var tagEls=tInputContiner.getElementsByTagName("div");var removeEl,i=0,len=tagEls.length,txt,tag;var reg=/([^×]+)(×)*$/;if(deleteAble){reg=/([^×]+)$/}for(;i<len;i++){txt=tagEls[i].innerText||tagEls[i].textContent;tag=txt.replace(reg,"$1");if(tagName==tag){removeEl=tagEls[i];break}}if(removeEl){removeEl.parentNode.removeChild(removeEl)}setTagInputValue()}function setTagInputValue(){tInput.value="";var spans=tInputContiner.getElementsByTagName("div");var a=[],i=0,len=spans.length,txt;for(;i<len;i++){txt=spans[i].innerText||spans[i].textContent;a.push(txt.replace(/×$/,""))}tTags.value=a.join(splitChar[0]);if(len>5){tInput.style.display="none"}else if(len===0){tInput.style.display=""}}function substr(str,len){if(!str||!len){return""}var a=0;var i=0;var temp="";for(i=0;i<str.length;i++){if(str.charCodeAt(i)>255){a+=2}else{a++}if(a>len){return temp}temp+=str.charAt(i)}return str}function byteLen(str){var aMatch=str.match(/[^\x00-\x80]/g);return str.length+(!aMatch?0:aMatch.length)}__addEvent(tInputContiner,function(e){e=e||window.event;var t=e.target||e.srcElement;if(t.tagName.toUpperCase()==="A"){setTimeout(function(){t.parentNode.parentNode.removeChild(t.parentNode);setTagInputValue()},10)}else{if(tInput.style.display==="none"){tInput.style.display=""}tInput.focus()}tInputContiner.scrollTop=0});__addEvent(tInput,function(){createTag(tInput.value)},"blur");__addEvent(tInput,function(e){e=e||window.event;var c=e.keyCode||e.charCode;if(c===8){var oldVal=tInput.value;setTimeout(function(){var newVal=tInput.value;if(oldVal===""&&newVal===""){var tagEl=tInput.previousSibling;if(tagEl){var deleteAble="false"==tagEl.getAttribute("deleteAble")?false:true;deleteAble&&tInputContiner.removeChild(tInput.previousSibling);deleteAble&&setTagInputValue()}}else{tInput.value=newVal.replace(/^,/,"")}},25)}},"keydown");__addEvent(tInput,function(){var v=tInput.value,vl=v.length,lc=v.substr(vl-1);if($CHROME&&/\w/.test(lc)){return}if(vl===1){if(lc===splitChar[0]||lc===splitChar[1]||rBLANK.test(lc)){tInput.value=""}}else if(vl>1){if(lc===splitChar[0]||lc===splitChar[1]||rBLANK.test(lc)||byteLen(v)>19){createTag(v)}}},"keyup");__addEvent(tInput,function(){setTimeout(function(){var str=tInput.value;if(str){createTag(str)}},25)},"paste");returnObject.addTag=createTag;returnObject.removeTag=removeTag;return returnObject}$registJob("editor_mjtag",function(){var __addEvent=Core.Events.addEvent,__fixEvent=Core.Events.fixEvent,__stopEvent=Core.Events.stopDefaultEvent,__classUtil=new Lib.classUtils;var addBlogTag=$E("add_blog_tag"),blogTagList=$E("blog_tag_list");if(!addBlogTag||!blogTagList){return}var html="",i,len;var userTags=articleEditorCFG.articleAllTagList.user;for(i=0,len=Math.min(userTags.length,5);i<len;i++){html+='<a href="javascript:;" class="tag2">'+userTags[i]+"</a>"}$E("blog_tag_hot").innerHTML=html;html="";var hotTags=articleEditorCFG.articleAllTagList.hotTagNick;for(var i=0;i<hotTags.length;i++){html+='<a href="javascript:;" class="tag2">'+hotTags[i]+"</a>"}$E("blog_tag_recommended").innerHTML=html;var hiddenTag=$E("article_tag_input"),tInput=$E("t_input"),tInputCon=$E("t_input_container");var tagval=hiddenTag.value;var tagsMng=TagsAddNew(tInputCon,tInput,hiddenTag);scope._tagsMng=tagsMng;if(tagval){tagval=tagval.split(" ").slice(0,5);hiddenTag.value=tagval.join(",");html="";for(i=0,len=tagval.length;i<len;i++){if(location.href.indexOf("tag365")>0){html+='<div deleteable="false" class="tag1"><span>'+Core.String.encodeHTML(tagval[i])+"</span></div>"}else{html+='<div deleteable="true" class="tag1"><span>'+Core.String.encodeHTML(tagval[i])+'</span><a class="close" title="删除" href="javascript:;">×</a></div>'}}var em=tInput.parentNode.children[0];if(em&&em.nodeName.toUpperCase()==="EM"){em.parentNode.removeChild(em)}Core.Dom.insertHTML(tInput,html,"BeforeBegin")}__addEvent(addBlogTag,function(e){v7sendLog("16_01_22");var iNode=addBlogTag.getElementsByTagName("i")[0],blogTagList=$E("blog_tag_list");if(blogTagList.style.display=="none"){blogTagList.style.display="";__classUtil.delClass(iNode,"i2_darr");__classUtil.addClass(iNode,"i3_uarr")}else{blogTagList.style.display="none";__classUtil.delClass(iNode,"i3_uarr");__classUtil.addClass(iNode,"i2_darr")}});__addEvent(blogTagList,function(event){event=event||window.event;var t=event.srcElement||event.target,tclz=t.className||"";if(tclz.indexOf("tag2")>-1){tagsMng.addTag(Core.String.decodeHTML(t.innerHTML))}});var _first=true;__addEvent(tInput,function(){v7sendLog("16_01_22");var el=$E("blog_tag_list");if(el.style.display==="none"||_first){el.style.display="";__addEvent(document.body,checkHide);_first=false}var em=$E("t_input").parentNode.children[0];if(em&&em.nodeName.toUpperCase()==="EM"){setTimeout(function(){em.parentNode.removeChild(em)},10)}},"focus");__addEvent(tInput,function(e){var e=__fixEvent(e);if(e.keyCode=="13"){__stopEvent(e)}},"keydown");function checkHide(event){event=event||window.event;var t=event.srcElement||event.target,el=$E("blog_tag_list");if(Core.Dom.contains(el,t)||Core.Dom.contains($E("t_input_container"),t)){return}if($E("article_tag_input").value){$E("t_input").style.display="none"}el.style.display="none";Core.Events.removeEvent(document.body,checkHide)}});$registJob("article_permission",function(){var __addEvent=Core.Events.addEvent,__removeEvent=Core.Events.removeEvent,__stopDefault=Core.Events.stopEvent,__classUtil=new Lib.classUtils;var isCommentAllow=$E("is_comment_allow"),isPrivateBlog=$E("is_private_blog"),canReprint=$E("can_reprint"),commentRadio1=$E("commentRadio1"),commentRadio2=$E("commentRadio2"),commentRadio3=$E("commentRadio3"),xRankRadio=$E("xRankRadio"),QuoteRadio=$E("QuoteRadio");__addEvent(isCommentAllow,commentAllow,"click");__addEvent(isPrivateBlog,privateBlog,"click");__addEvent(canReprint,print,"click");if(commentRadio1&&commentRadio1.checked){isCommentAllow&&__classUtil.addClass(isCommentAllow,"btn_cur")}if(commentRadio2&&commentRadio2.checked){commentRadio1.checked="checked";commentRadio2.checked="";isCommentAllow&&__classUtil.addClass(isCommentAllow,"btn_cur")}if(commentRadio3&&commentRadio3.checked){isCommentAllow&&__classUtil.delClass(isCommentAllow,"btn_cur")}if(xRankRadio&&xRankRadio.checked){isPrivateBlog&&__classUtil.addClass(isPrivateBlog,"btn_cur")}if(QuoteRadio&&QuoteRadio.checked){canReprint&&__classUtil.addClass(canReprint,"btn_cur")}if(commentRadio3.disabled){__classUtil.delClass(isCommentAllow,"btn_cur");__classUtil.addClass(isCommentAllow,"btn_noclick");__removeEvent(isCommentAllow,commentAllow,"click");isCommentAllow.onclick=function(){winDialog.alert("您已设置了不允许评论",{textOk:"确定",title:"提示",subText:'<a href="http://control.blog.sina.com.cn/blogprofile/profilepower.php" target="_blank">可以去个人中心修改权限设置</a>',width:430,icon:"01"});return false}}if(QuoteRadio.disabled){__classUtil.delClass(canReprint,"btn_cur");__classUtil.addClass(canReprint,"btn_noclick");var iNode=canReprint.getElementsByTagName("i")[0];__classUtil.addClass(iNode,"i1_yes1");__removeEvent(canReprint,print,"click");canReprint.onclick=function(){winDialog.alert("您已设置了禁止转载",{textOk:"确定",title:"提示",width:430,subText:'<a href="http://control.blog.sina.com.cn/blogprofile/profilepower.php" target="_blank">可以去个人中心修改权限设置</a>',icon:"01"});return false}}function commentAllow(e){v7sendLog("16_01_23");if(__classUtil.hasClass(isCommentAllow,"btn_cur")){__classUtil.delClass(isCommentAllow,"btn_cur");commentRadio1.checked="";commentRadio3.checked="checked"}else{__classUtil.addClass(isCommentAllow,"btn_cur");commentRadio1.checked="checked";commentRadio3.checked=""}__stopDefault(e)}function privateBlog(e){v7sendLog("16_01_24");var cateList=$E("blog_cate_selected_list"),blogCateList=$E("blog_cate_list"),componentSelect=$E("componentSelect"),catePrivate='<li cate_value="0"><span class="dot"></span><a class="sort_by" href="javascript:; return false;"><span class="dot_cont">私密博文<i class="dot_hover2" onclick="deleteArticleCate();"></i></span></a></li>';if(__classUtil.hasClass(isPrivateBlog,"btn_cur")){__classUtil.delClass(isPrivateBlog,"btn_cur");xRankRadio.checked="";cateList.innerHTML="";cateList.style.display="none";componentSelect.value="00"}else{__classUtil.addClass(isPrivateBlog,"btn_cur");xRankRadio.checked="checked";cateList.innerHTML=catePrivate;cateList.style.display="";if($IE6){var hoverElem=cateList.getElementsByTagName("li")[0];Lib.util.hoverJq({elm:hoverElem,mouseenter:function(evt,el,index){var a=el.getElementsByTagName("a")[0];__classUtil.addClass(a,"sort_close")},mouseleave:function(evt,el,index){var a=el.getElementsByTagName("a")[0];__classUtil.delClass(a,"sort_close")}})}blogCateList.style.display="none";var cateValue=cateList.children[0].getAttribute("cate_value");componentSelect.value=cateValue}__stopDefault(e)}function print(e){v7sendLog("16_01_25");if(__classUtil.hasClass(canReprint,"btn_cur")){__classUtil.delClass(canReprint,"btn_cur");QuoteRadio.checked=""}else{__classUtil.addClass(canReprint,"btn_cur");QuoteRadio.checked="checked"}__stopDefault(e)}});$SYSMSG.extend({B00007:"跳转到自动开通页",B00008:"自动开通用户(跳转到假页)",B00009:"跳转到自动开通页",B00010:"无权限。 ",B00011:"抱歉，Blog ID 错误，操作无法完成。",B00012:"抱歉，可能因为重复操作而无法执行，请刷新本页再试。",B00013:"用户ID被封杀",B00014:"很抱歉，您输入的验证码不正确。",B04101:"请输入您的昵称！",B04102:"请正确输入您的邮件地址！",B04103:"请选择您举报信息的位置！",B04104:"请选择您举报的不良信息的类型！",B04105:"简单描述最多只能输入500个字符！",B04106:"再次感谢您帮助我们进行不良信息的验证工作，我们将认真仔细地处理您提交的内容。",B07006:"您已发的博文正在审查中，请稍后再发文"});Core.System.winSize=function(_target){var w,h;if(_target){target=_target.document}else{target=document}if(self.innerHeight){if(_target){target=_target.self}else{target=self}w=target.innerWidth;h=target.innerHeight}else if(target.documentElement&&target.documentElement.clientHeight){w=target.documentElement.clientWidth;h=target.documentElement.clientHeight}else if(target.body){w=target.body.clientWidth;h=target.body.clientHeight}return{width:w,height:h}};var Layer=function(template){this.entity=null;this.ifm=null;var _this=this;var Property={width:0,height:0,x:0,y:0,isFixed:false,uniqueID:"",entityID:"",contentID:"",template:template,templateString:"",nodes:{}};this.getProperty=function(){return Property};!function initialize(){var p=_this.getProperty();p.uniqueID="_"+_this.getUniqueID();p.entityID=p.uniqueID+"_entity";p.contentID=p.uniqueID+"_content";_this.setTemplate(p.template);p.width=parseInt(_this.entity.style.width);if($IE6){_this.addIframe()}document.body.appendChild(_this.entity);_this.hidden()}();this._ie6Fixed=function(){_this.entity.style.left=document.documentElement.scrollLeft+_this.getProperty().x+"px";_this.entity.style.top=document.documentElement.scrollTop+_this.getProperty().y+"px";if(_this.ifm){_this.ifm.style.left=document.documentElement.scrollLeft+_this.getProperty().x+"px";_this.ifm.style.top=document.documentElement.scrollTop+_this.getProperty().y+"px"}}};Layer.prototype={setTemplate:function(template){var p=this.getProperty();if(this.entity){this.entity.parentNode.removeChild(this.entity);this.entity=null}if(typeof template=="object"){p.nodes=template;if(this.entity){this.entity.parentNode.removeChild(this.entity);this.entity=null}this.entity=p.nodes.entity;document.body.appendChild(this.entity);if(!p.nodes.entity||!p.nodes.content){throw new Error("[layer.js] missing entity or content in layer nodes")}else{this.entity.style.position="absolute";this.entity.style.zIndex="1024";this.entity.style.left=p.x+"px";this.entity.style.top=p.y+"px"}return}var pattern=/[^\{\}]+(?=\})/g;p.template=template;p.templateString=p.template.match(pattern);this.entity=$C("div");var tempEntity=$C("div");var tmp=new Ui.Template(p.template);tempEntity.innerHTML=tmp.evaluate(this.getNodes("i"));document.body.appendChild(tempEntity);if(!$E(p.entityID)||!$E(p.contentID)){throw new Error("[layer.js] there missing #{entityID} or #{contentID} in layer template")}else{this.entity=$E(p.entityID);this.entity.style.position="absolute";this.entity.style.zIndex="1024";this.entity.style.left=p.x+"px";this.entity.style.top=p.y+"px";document.body.replaceChild(this.entity,tempEntity);tempEntity=null}p.nodes=this.getNodes()},setSize:function(opts){var p=this.getProperty();Core.System.parseParam(p,opts);if(opts.width){p.nodes.content.style.width=p.width+"px"}if(opts.height){p.nodes.content.style.height=p.height+"px"}this.updateIfmSize()},setPosition:function(opts){var p=this.getProperty();Core.System.parseParam(p,opts);this.entity.style.left=p.x+"px";this.entity.style.top=p.y+"px";if($IE6&&p.isFixed){this.entity.style.left=p.x+document.documentElement.scrollLeft+"px";this.entity.style.top=p.y+document.documentElement.scrollTop+"px"}if(this.ifm){this.ifm.style.left=this.entity.style.left;this.ifm.style.top=this.entity.style.top}},getWidth:function(){var ld=this.entity.style.display;var lv=this.entity.style.visibility;this.entity.style.visibility="hidden";this.entity.style.display="";w=this.entity.offsetWidth;this.entity.style.display=ld;this.entity.style.visibility=lv;return w},getHeight:function(){var ld=this.entity.style.display;var lv=this.entity.style.visibility;this.entity.style.visibility="hidden";this.entity.style.display="";h=this.entity.offsetHeight;this.entity.style.display=ld;this.entity.style.visibility=lv;return h},getX:function(){return parseInt(this.entity.style.left)},getY:function(){return parseInt(this.entity.style.top)},updateIfmSize:function(){if(this.ifm){var _this=this;_this.ifm.style.width=_this.entity.offsetWidth+"px";_this.ifm.style.height=_this.entity.offsetHeight+"px"}},setFixed:function(isFixed){var p=this.getProperty();p.isFixed=isFixed;var _this=this;if($IE6){_this.entity.style.position="absolute";if(p.isFixed){_this._ie6Fixed();Core.Events.addEvent(window,_this._ie6Fixed,"scroll")}else{Core.Events.removeEvent(window,_this._ie6Fixed,"scroll")}return}if(p.isFixed&&$FF2){_this.updateFixed();return}this.entity.style.position=p.isFixed?"fixed":"absolute"},updateFixed:function(){var p=this.getProperty();if(p.isFixed&&$FF2){var _this=this;var lastX=p.x,lastY=p.y;_this.entity.style.position="absolute";_this.setPosition({x:p.x+document.documentElement.scrollLeft,y:p.y+document.documentElement.scrollTop});_this.entity.style.position="fixed";_this.setPosition({x:lastX,y:lastY})}},show:function(){this.entity.style.display="";if(this.ifm){this.ifm.style.display="";this.updateIfmSize()}},hidden:function(){this.entity.style.display="none";if(this.ifm){this.ifm.style.display="none"}},addIframe:function(){this.ifm=$C("iframe");this.ifm.style.position="absolute";this.ifm.style.zIndex="1024";this.ifm.style.left=this.entity.style.left;this.ifm.style.top=this.entity.style.top;document.body.appendChild(this.ifm);Core.Dom.setStyle(this.ifm,"opacity",0)},getNodes:function(mode){var p=this.getProperty();var m=mode||"o";var i;var nodes={};var result=p.templateString;if(result){for(i=0;i<result.length;i++){var r=result[i];switch(m){case"o":nodes[r]=$E(p.uniqueID+"_"+r);break;case"i":nodes[r]=p.uniqueID+"_"+r;break}}}return"entity"in nodes?nodes:p.nodes},getUniqueID:function(){return parseInt(Math.random()*1e4).toString()+(new Date).getTime().toString()},setContent:function(sHTML){var p=this.getProperty();if(sHTML){p.nodes.content.innerHTML=sHTML}}};!function(){var transitions={simple:function(time,startValue,changeValue,duration){return changeValue*time/duration+startValue},backEaseIn:function(t,b,c,d){var s=1.70158;return c*(t/=d)*t*((s+1)*t-s)+b},backEaseOut:function(t,b,c,d,a,p){var s=1.70158;return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b},backEaseInOut:function(t,b,c,d,a,p){var s=1.70158;if((t/=d/2)<1){return c/2*t*t*(((s*=1.525)+1)*t-s)+b}return c/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+b},bounceEaseOut:function(t,b,c,d){if((t/=d)<1/2.75){return c*7.5625*t*t+b}else if(t<2/2.75){return c*(7.5625*(t-=1.5/2.75)*t+.75)+b}else if(t<2.5/2.75){return c*(7.5625*(t-=2.25/2.75)*t+.9375)+b}else{return c*(7.5625*(t-=2.625/2.75)*t+.984375)+b}},bounceEaseIn:function(t,b,c,d){return c-transitions.bounceEaseOut(d-t,0,c,d)+b},bounceEaseInOut:function(t,b,c,d){if(t<d/2){return transitions.bounceEaseIn(t*2,0,c,d)*.5+b}else{return transitions.bounceEaseOut(t*2-d,0,c,d)*.5+c*.5+b}},strongEaseInOut:function(t,b,c,d){return c*(t/=d)*t*t*t*t+b},regularEaseIn:function(t,b,c,d){return c*(t/=d)*t+b},regularEaseOut:function(t,b,c,d){return-c*(t/=d)*(t-2)+b},regularEaseInOut:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t+b}return-c/2*(--t*(t-2)-1)+b},strongEaseIn:function(t,b,c,d){return c*(t/=d)*t*t*t*t+b},strongEaseOut:function(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b},strongEaseInOut:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t*t*t+b}return c/2*((t-=2)*t*t*t*t+2)+b},elasticEaseIn:function(t,b,c,d,a,p){if(t==0){return b}if((t/=d)==1){return b+c}if(!p){p=d*.3}if(!a||a<Math.abs(c)){a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*2*Math.PI/p))+b},elasticEaseOut:function(t,b,c,d,a,p){if(t==0){return b}if((t/=d)==1){return b+c}if(!p){p=d*.3}if(!a||a<Math.abs(c)){a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*2*Math.PI/p)+c+b},elasticEaseInOut:function(t,b,c,d,a,p){if(t==0){return b}if((t/=d/2)==2){return b+c}if(!p){var p=d*.3*1.5}if(!a||a<Math.abs(c)){var a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}if(t<1){return-.5*a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*2*Math.PI/p)+b}return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*2*Math.PI/p)*.5+c+b}};var getUniqueID=function(oNode){return oNode.uniqueID};if(!$IE){getUniqueID=function(oNode){try{var rnd_ID;if(oNode.getAttribute("uniqueID")==null){rnd_ID="moz__id"+parseInt(Math.random()*100)+"_"+(new Date).getTime();oNode.setAttribute("uniqueID",rnd_ID);return rnd_ID}return oNode.getAttribute("uniqueID")}finally{rnd_ID=null}}}function getType(oObject){try{var s=oObject.constructor.toString().toLowerCase();return s.slice(s.indexOf("function")+9,s.indexOf("()"))}finally{s=null}}function getStartValue(oNode,aProperty){var i,_len,_arr=[];_len=aProperty.length;for(i=0;i<_len;i++){_arr[_arr.length]=parseFloat(Core.Dom.getStyle(oNode,aProperty[i]))}return _arr}function formatProperty(oProperty){return getType(oProperty)!="array"?[oProperty]:oProperty}function formatValue(oEndingValue,aProperty){try{var _type=getType(oEndingValue);var _valuearray=[],_suffixarray=[],i,_len,_suffix;if(_type!="array"){_suffix=getSuffix(oEndingValue);_suffix[1]=aProperty=="opacity"?"":_suffix[1];_valuearray=[_suffix[0]];_suffixarray=[_suffix[1]]}else{_len=oEndingValue.length;for(i=0;i<_len;i++){_suffix=getSuffix(oEndingValue[i]);_suffix[1]=aProperty[i]=="opacity"?"":_suffix[1];_valuearray[_valuearray.length]=_suffix[0];_suffixarray[_suffixarray.length]=_suffix[1]}}return[_valuearray,_suffixarray]}finally{_type=_valuearray=_suffixarray=i=_len=_suffix=null}}function getSuffix(sValue){try{var charCase=/(-?\d.?\d*)([a-z%]*)/i.exec(sValue);return[charCase[1],charCase[2]?charCase[2]:"px"]}finally{charCase=null}}var runList={};var saveList={};function getInstance(oNode){try{var uID=getUniqueID(oNode);var runFunc;if(runList[uID]!=true){runFunc=new ancestor;saveList[uID]={node:oNode,func:runFunc};runList[uID]=true;return runFunc}else{return saveList[uID].func}}finally{uID=runFunc=null}}function ancestor(){this._timer=null}ancestor.prototype.start=function(oNode,oProperty,oEndingValue,nSeconds,sAnimation,oFunc){this.reset();oFunc=oFunc||{};if(oFunc.before){this._func.before=oFunc.before}if(oFunc.end){this._func.end=oFunc.end}if(oFunc.tween){this._func.tween=oFunc.tween}var _propertyArr=formatProperty(oProperty);var _startValueArr=getStartValue(oNode,_propertyArr);var _endValueArr=formatValue(oEndingValue,_propertyArr);this._node=oNode;this._property=_propertyArr;this._endingvalue=_endValueArr[0];this._suffixvalue=_endValueArr[1];this._startvalue=_startValueArr;this._end=false;this._fps=0;if(nSeconds!=null){this._seconds=nSeconds}if(transitions[sAnimation]!=null){this._animation=transitions[sAnimation]}this._starttime=(new Date).getTime();this._func.before();this._timer=setInterval(Core.Function.bind3(this.play,this),10)};ancestor.prototype.play=function(){var nTime=((new Date).getTime()-this._starttime)/1e3;var i,ani,_len=this._property.length;if(nTime>this._seconds){nTime=this._seconds}for(i=0;i<_len;i++){ani=this._animation(nTime,this._startvalue[i],this._endingvalue[i]-this._startvalue[i],this._seconds);Core.Dom.setStyle(this._node,this._property[i],ani+this._suffixvalue[i])}this._fps++;this._func.tween();if(nTime==this._seconds){this.stop()}};ancestor.prototype.stop=function(){clearInterval(this._timer);this._end=true;this._func.end()};ancestor.prototype.reset=function(){clearInterval(this._timer);this._end=false;this._node=null;this._property=[];this._startvalue=[];this._endingvalue=[];this._suffixvalue=[];this._fps=0;this._seconds=.5;this._animation=transitions.simple;this._func={end:function(){},tween:function(){},before:function(){}}};function tween(oNode,oProperty,oEndingValue,nSeconds,sAnimation,oFunc){var instance=getInstance(oNode);instance.start.apply(instance,arguments)}tween.stop=function(oNode){getInstance(oNode).stop()};tween.isTween=function(oNode){return!getInstance(oNode)._end};Ui.tween=tween}();var DialogDisplaySet={alpha1:{show:function(dom,offsetY,callBack){var v=0,deltaY=0,startY=parseInt(dom.style.top)-offsetY;dom.style.top=startY;Core.Dom.setStyle(dom,"opacity",v);dom.style.display="";var itvId=window.setInterval(function(){if(v<=1){Core.Dom.setStyle(dom,"opacity",v)}if(deltaY<=startY+offsetY){dom.style.top=startY+deltaY+"px"}deltaY+=1.5;v+=.05;if(v>.9&&parseInt(dom.style.top)>=startY+offsetY){window.clearInterval(itvId);if(callBack){callBack()}}},10)},hidden:function(dom,offsetY,callBack){var v=1;var startY=parseInt(dom.style.top);var endY=startY-offsetY;var currentY=startY;var itvId=window.setInterval(function(){if(v>=0){Core.Dom.setStyle(dom,"opacity",v)}if(currentY>=endY){dom.style.top=currentY+"px"}currentY-=1.5;v-=.05;if(v<=0&&currentY<endY){window.clearInterval(itvId);if(callBack){callBack()}}},10)}},alpha:{show:function(dom,offsetY,callBack){Core.Dom.setStyle(dom,"opacity",.3);dom.style.display="";dom.style.top=parseInt(dom.style.top)-offsetY+"px";var y1=parseInt(dom.style.top)+offsetY;Ui.tween(dom,["top","opacity"],[y1,.9],.4,"simple",{end:callBack})},hidden:function(dom,offsetY,callBack){var y1=parseInt(dom.style.top)-offsetY;Ui.tween(dom,["top","opacity"],[y1,0],.2,"simple",{end:callBack})}},fallDown:{show:function(dom,y0,y1,callBack){dom.style.display="";dom.style.top=y0+"px";Ui.tween(dom,"top",y1,.6,"bounceEaseOut",{end:callBack})},hidden:function(dom,y0,y1,callBack){dom.style.display="";dom.style.top=y0+"px";Ui.tween(dom,"top",y1,.6,"strongEaseIn",{end:callBack})}}};var Drag3=function(beDragObj,movedObjs,dragMode){var _this=this;this.beDragObj=beDragObj;this.movedObjs=movedObjs||this.beDragObj;this.dragMode=dragMode||"normal";this.canDrag=true;this.isLock=false;this.lockArea={left:0,right:0,top:0,bottom:0};this.dragSet={normal:function(){_this.normalDrag()},border:function(){_this.borderDrag()},opacity:function(){_this.opacityDrag()}};this.dragObjsFunc=function(){_this.onDrag();_this.dragObjs()};!function initialize(){_this.beDragObj.style.MozUserSelect="none";
Core.Events.addEvent(_this.beDragObj,function(){return false},"selectstart");Core.Events.addEvent(_this.beDragObj,function(){return false},"drag");for(var i=0;i<_this.movedObjs.length;i++){if(_this.movedObjs[i]!=_this.beDragObj){_this.movedObjs[i].style.position="absolute";if(!_this.movedObjs[i].style.left){_this.movedObjs[i].style.left=_this.movedObjs[i].offsetLeft+"px"}if(!_this.movedObjs[i].style.top){_this.movedObjs[i].style.top=_this.movedObjs[i].offsetTop+"px"}}}Core.Events.addEvent(_this.beDragObj,_this.dragSet[_this.dragMode],"mousedown");if($IE){Core.Events.addEvent(_this.beDragObj,function(){Core.Events.removeEvent(_this.beDragObj,_this.dragObjsFunc,"mousemove");_this.beDragObj.releaseCapture();_this.onDragEnd()},"mouseup")}else{Core.Events.addEvent(document,function(){Core.Events.removeEvent(document,_this.dragObjsFunc,"mousemove");_this.onDragEnd()},"mouseup")}}()};Drag3.prototype={capture:function(){this.canDrag=true},release:function(){this.canDrag=false},onDragStart:function(){},onDrag:function(){},onDragEnd:function(){},dragObjs:function(){e=Core.Events.getEvent();for(var i=0;i<this.movedObjs.length;i++){if(this.isLock){if(e.clientX-this.movedObjs[i].deltaX<this.lockArea.left){this.movedObjs[i].style.left=this.lockArea.left+"px"}else{if(e.clientX-this.movedObjs[i].deltaX>this.lockArea.right-this.movedObjs[i].offsetWidth){this.movedObjs[i].style.left=this.lockArea.right-this.movedObjs[i].offsetWidth+"px"}else{this.movedObjs[i].style.left=e.clientX-this.movedObjs[i].deltaX+"px"}}if(e.clientY-this.movedObjs[i].deltaY<this.lockArea.top){this.movedObjs[i].style.top=this.lockArea.top+"px"}else{if(e.clientY-this.movedObjs[i].deltaY>this.lockArea.bottom-this.movedObjs[i].offsetHeight){this.movedObjs[i].style.top=this.lockArea.bottom-this.movedObjs[i].offsetHeight+"px"}else{this.movedObjs[i].style.top=e.clientY-this.movedObjs[i].deltaY+"px"}}}else{this.movedObjs[i].style.left=e.clientX-this.movedObjs[i].deltaX+"px";this.movedObjs[i].style.top=e.clientY-this.movedObjs[i].deltaY+"px"}}},normalDrag:function(){var _this=this;e=Core.Events.getEvent();for(var i=0;i<_this.movedObjs.length;i++){_this.movedObjs[i].deltaX=e.clientX-parseInt(_this.movedObjs[i].style.left);_this.movedObjs[i].deltaY=e.clientY-parseInt(_this.movedObjs[i].style.top)}if(_this.canDrag){if($IE){_this.beDragObj.setCapture();Core.Events.addEvent(_this.beDragObj,_this.dragObjsFunc,"mousemove")}else{Core.Events.addEvent(document,_this.dragObjsFunc,"mousemove")}}_this.onDragStart()},borderDrag:function(obj,borderWidth){},opacityDrag:function(obj,opacityValue){}};Ui.Drag3=Drag3;var Dialog=function(template){var _this=this;_this.entity=null;_this.ifm=null;var Property={id:"",x:0,y:0,width:0,height:0,isFixed:false,layer:new Layer(template),template:template,canDrag:false,dragEntity:null,name:"",uniqueID:"",isShow:false,nodes:{},focusNode:null,displayMode:"normal",_modeDisplayRuning:false,enabled:true};this.getProperty=function(){return Property};!function initialize(){var p=_this.getProperty();var i;p.uniqueID=p.layer.getProperty().uniqueID;p.id=p.uniqueID+"_dialog";p.nodes=_this.getNodes();_this.entity=p.layer.entity;_this.ifm=p.layer.ifm;p.width=parseInt(_this.entity.style.width);if(p.nodes.titleBar){p.dragEntity=new Ui.Drag3(p.nodes.titleBar,_this.ifm?[_this.ifm,_this.entity]:[_this.entity]);p.nodes.titleBar.style.cursor="move";Core.Events.addEvent(p.nodes.titleBar,function(){return false},"selectstart");p.dragEntity.onDrag=function(){_this.onDrag()}}Core.Events.addEvent(window,function(){if(p.isShow&&p.isFixed){var win=Core.System.winSize();var _x=win.width/2-_this.getWidth()/2;var _y=win.height/2-_this.getHeight()/2;_x=_x<0?0:_x;_y=_y<0?0:_y;_this.setPosition({x:_x,y:_y})}},"resize")}()};Dialog.prototype={setPosition:function(opts){var p=this.getProperty();Core.System.parseParam(p,opts);this.getProperty().layer.setPosition(opts)},setSize:function(opts){var p=this.getProperty();Core.System.parseParam(p,opts);p.layer.setSize(opts)},setFixed:function(isFixed){var p=this.getProperty();p.isFixed=isFixed;this.getProperty().layer.setFixed(p.isFixed)},setContent:function(sHTML){var p=this.getProperty();this.getProperty().layer.setContent(sHTML)},setTemplate:function(template){var p=this.getProperty();p.template=template;p.layer.setTemplate(p.template)},setDrag:function(canDrag){var p=this.getProperty();p.canDrag=canDrag;if(p.canDrag){p.dragEntity.capture()}else{p.dragEntity.release()}},getWidth:function(){return this.getProperty().layer.getWidth()},getHeight:function(){return this.getProperty().layer.getHeight()},getX:function(){return this.getProperty().layer.getX()},getY:function(){return this.getProperty().layer.getY()},show:function(mode){var p=this.getProperty();var _this=this;p.isShow=true;if(this.ifm){this.ifm.style.display=""}this.onShow();if(p.displayMode=="normal"||mode=="normal"){this.entity.style.display=""}else{p._modeDisplayRuning=true;p.enabled=false;this._showWithMode(function(){p._modeDisplayRuning=false;p.enabled=true;if(_this.onDisplaied){_this.onDisplaied()}})}},close:function(mode){var _this=this;var p=this.getProperty();if(p.displayMode=="normal"||mode=="normal"){p.isShow=false;p.layer.hidden();this.destroy();this.onClose();if(_this.onDisplayFinished){_this.onDisplayFinished()}}else if(!p._modeDisplayRuning){p._modeDisplayRuning=true;p.enabled=false;this._hiddenWithMode(function(){p.isShow=false;p.layer.hidden();p._modeDisplayRuning=false;p.enabled=true;_this.destroy();_this.onClose();if(_this.onDisplayFinished){_this.onDisplayFinished()}})}},hidden:function(mode){var _this=this;var p=this.getProperty();if(p.displayMode=="normal"||mode=="normal"){p.isShow=false;p.layer.hidden();this.onHidden();if(_this.onDisplayFinished){_this.onDisplayFinished()}}else if(!p._modeDisplayRuning){p._modeDisplayRuning=true;p.enabled=false;this._hiddenWithMode(function(){p.isShow=false;p.layer.hidden();_this.onHidden();p._modeDisplayRuning=false;p.enabled=true;if(_this.onDisplayFinished){_this.onDisplayFinished()}})}},_showWithMode:function(callBack){var p=this.getProperty();var win=Core.System.winSize();var _this=this;switch(p.displayMode){case"alpha":DialogDisplaySet["alpha"].show(this.entity,20,callBack);break}},_hiddenWithMode:function(callBack){var p=this.getProperty();var _this=this;var win=Core.System.winSize();switch(p.displayMode){case"alpha":DialogDisplaySet["alpha"].hidden(this.entity,20,callBack);break}},destroy:function(){try{if(this.getProperty().nodes.iframe){this.getProperty().nodes.iframe.src=""}}catch(ex){}this.entity&&this.entity.parentNode.removeChild(this.entity);this.entity=null;if(this.ifm){this.ifm.parentNode.removeChild(this.ifm);this.ifm=null}},onShow:function(){},onClose:function(){},onHidden:function(){},onDrag:function(){},onDisplaied:function(){},onDisplayFinished:function(){},setAreaLocked:function(state){var p=this.getProperty();p.dragEntity.isLock=state;var _this=this;if(state){_this._updateLockArea();Core.Events.addEvent(window,function(){_this._updateLockArea()},"resize")}},_updateLockArea:function(){var p=this.getProperty();var win=Core.System.winSize();if(p.isFixed){if($IE6){p.dragEntity.lockArea={left:document.documentElement.scrollLeft,right:document.documentElement.scrollLeft+win.width,top:document.documentElement.scrollTop,bottom:document.documentElement.scrollTop+win.height};Core.Events.addEvent(window,function(){p.dragEntity.lockArea={left:document.documentElement.scrollLeft,right:document.documentElement.scrollLeft+win.width,top:document.documentElement.scrollTop,bottom:document.documentElement.scrollTop+win.height}},"scroll");Core.Events.addEvent(window,function(){p.dragEntity.lockArea={left:document.documentElement.scrollLeft,right:document.documentElement.scrollLeft+win.width,top:document.documentElement.scrollTop,bottom:document.documentElement.scrollTop+win.height}},"resize")}else{p.dragEntity.lockArea={left:0,right:win.width,top:0,bottom:win.height}}}else{p.dragEntity.lockArea={left:0,right:document.documentElement.scrollWidth,top:0,bottom:document.documentElement.scrollHeight}}},updateFixed:function(){this.getProperty().layer.updateFixed()},getNodes:function(mode){return this.getProperty().layer.getNodes(mode)},setFocus:function(){var p=this.getProperty();if(p.focusNode&&p.focusNode.style.display!="none"){try{p.focusNode.focus()}catch(ex){}}else if(this.entity.style.display!="none"){this.entity.focus()}},getUniqueID:function(){return this.getProperty().layer.getUniqueID()}};var DialogManager={dialogs:[],activeDialog:{},backShadow:null,create:function(tpl,name){var _this=this;var dialog=new Dialog(tpl);this.dialogs.push(dialog);this.activeDialog=dialog;dialog.name=name||dialog.getUniqueID();dialog.entity.style.zIndex=1024;dialog.onDrag=function(){if($IE6){if(this.getProperty().isFixed){this.setPosition({x:parseInt(this.entity.style.left)-document.documentElement.scrollLeft,y:parseInt(this.entity.style.top)-document.documentElement.scrollTop})}}else{if(this.getProperty().isFixed){this.setPosition({x:parseInt(this.entity.style.left),y:parseInt(this.entity.style.top)})}}};dialog.onClose=function(){_this.removeDialog(this.name);_this.updateActiveDialog();_this.updateShadow();if(_this.activeDialog){_this.activeDialog.setFocus()}};dialog.onHidden=function(){this.isHidden=true;if(this==_this.activeDialog){_this.activeDialog=null}_this.updateActiveDialog();_this.updateShadow();if(_this.activeDialog){_this.activeDialog.setFocus()}};dialog.onShow=function(){if(this.isHidden){this.isHidden=false;var i,len=_this.dialogs.length;for(i=0;i<len;i++){if(_this.dialogs[i]==this){document.body.appendChild(_this.dialogs[i].entity);_this.dialogs.push(_this.dialogs[i]);_this.dialogs.splice(i,1)}}_this.activeDialog=this;_this.backShadow.show();_this.updateShadow()}};if(this.backShadow.isShow){this.updateShadow()}else{this.backShadow.show()}dialog.hidden();return dialog},getDialog:function(name){var i=0,len=this.dialogs.length;for(i=0;i<len;i++){if(this.dialogs[i].name==name){return this.dialogs[i]}}},removeDialog:function(name){var i=0,len=this.dialogs.length;for(i=len-1;i>=0;i--){if(this.dialogs[i].name==name){this.dialogs.splice(i,1);this.activeDialog=this.dialogs[this.dialogs.length-1];break}}},updateActiveDialog:function(){var i,len=this.dialogs.length;for(i=len-1;i>=0;i--){if(!this.dialogs[i].isHidden){this.activeDialog=this.dialogs[i];break}}},updateShadow:function(){if(this.activeDialog&&!this.activeDialog.isHidden){this.backShadow.insertBefore(this.activeDialog.entity);this.activeDialog.updateFixed()}else{this.backShadow.hidden()}},close:function(name){if(!name){if(this.activeDialog){this.activeDialog.close()}return}var i,len=this.dialogs.length;for(i=len-1;i>=0;i--){if(this.dialogs[i].name==name){this.dialogs[i].close();break}}}};var BackShadow=function(opacity){this.entity=null;this.isShow=false;this._ie6Fixed=function(){if(_this.entity){_this.entity.style.top=document.documentElement.scrollTop+"px";_this.entity.style.left=document.documentElement.scrollLeft+"px";if(_this.ifm){_this.ifm.style.top=_this.entity.style.top;_this.ifm.style.left=_this.entity.style.left}_this.updateSize()}};var _this=this;!function initialize(){_this.entity=$C("div");_this.entity.style.position="absolute";_this.entity.style.width=_this.getAreaWidth()+"px";_this.entity.style.height=_this.getAreaHeight()+"px";_this.entity.style.left="0px";_this.entity.style.top="0px";_this.entity.style.zIndex=1024;_this.entity.style.backgroundColor="black";document.body.appendChild(_this.entity);_this._setOpacity(_this.entity,isNaN(opacity)?.5:opacity);if($IE6){_this.entity.style.top=document.documentElement.scrollTop+"px";_this.addIframe()}Core.Events.addEvent(window,function(){if(_this.entity){if($IE6&&_this.isShow){document.documentElement.scrollLeft=0;_this._ie6Fixed()}setTimeout(function(){_this.updateSize()},1)}},"resize");_this.setFixed(true);_this.hidden()}()};BackShadow.prototype={show:function(){this.entity.style.display="";if(this.ifm){this.ifm.style.display=""}this.isShow=true;this.onShow()},hidden:function(){this.entity.style.display="none";if(this.ifm){this.ifm.style.display="none"}this.isShow=false;this.onHidden()},close:function(){this.hidden();this.destroy()},destroy:function(){Core.Events.removeEvent(window,this._ie6Fixed,"scroll");this.entity.parentNode.removeChild(this.entity);this.entity=null;if(this.ifm){this.ifm.parentNode.removeChild(this.ifm);this.ifm=null}},addIframe:function(){this.ifm=$C("iframe");this._setOpacity(this.ifm,0);this.ifm.style.position="absolute";this.ifm.style.zIndex=this.entity.style.zIndex;this.ifm.style.left=this.entity.style.left;this.ifm.style.top=this.entity.style.top;this.ifm.style.width=this.entity.style.width;this.ifm.style.height=this.entity.style.height;document.body.insertBefore(this.ifm,this.entity)},insertBefore:function(obj){document.body.insertBefore(this.entity,obj);if(this.ifm){document.body.insertBefore(this.ifm,this.entity)}},updateSize:function(){this.entity.style.width=this.getAreaWidth()+"px";this.entity.style.height=this.getAreaHeight()+"px";if(this.ifm){this.ifm.style.width=this.getAreaWidth()+"px";this.ifm.style.height=this.getAreaHeight()+"px"}},getAreaHeight:function(){return document.documentElement.clientHeight},getAreaWidth:function(){return document.documentElement.clientWidth},setFixed:function(state){if($IE6){var _this=this;if(state){_this._ie6Fixed();Core.Events.addEvent(window,_this._ie6Fixed,"scroll")}else{Core.Events.removeEvent(window,_this._ie6Fixed,"scroll")}}else{this.entity.style.position=state?"fixed":"absolute"}},_setOpacity:function(obj,v){if($IE&&$IE<=9){obj.style.filter="alpha(opacity="+v*100+")"}else{obj.style.opacity=v}},onShow:function(){},onHidden:function(){}};function CustomsDialog(tpl,name){this.nodesPattern=/[^\{\}]+(?=\})/g;this._dialog=DialogManager.create(tpl,name);this.entity=this._dialog.entity;this.templateString="";this.nodes={};var _this=this;!function initialize(){_this._dialog.onDrag=function(){if($IE6){if(this.getProperty().isFixed){this.setPosition({x:parseInt(this.entity.style.left)-document.documentElement.scrollLeft,y:parseInt(this.entity.style.top)-document.documentElement.scrollTop})}}else{if(this.getProperty().isFixed){this.setPosition({x:parseInt(this.entity.style.left),y:parseInt(this.entity.style.top)})}}_this.onDrag()};_this.updateNodes();if(_this.nodes.btnClose){Core.Events.addEvent(_this.nodes.btnClose,function(){var e=Core.Events.getEvent();if(e){e.cancelBubble=true}},"mousedown")}}();this._hiddenDialog=function(){_this.hidden()};this._closeDialog=function(){_this.close()}}CustomsDialog.prototype={isSetMiddle:false,setContent:function(tpl){var _contentTemplate=tpl;this.templateString=_contentTemplate.match(this.nodesPattern);var tmp=new Ui.Template(_contentTemplate);this.nodes.content.innerHTML=tmp.evaluate(this.getContentNodes("i"));this.updateNodes()},setTitle:function(title){if(this.nodes.titleName){this.nodes.titleName.innerHTML=title}},setHelp:function(helpLink){if(this.nodes.btnHelp){if(helpLink){this.nodes.btnHelp.href=helpLink}else{this.nodes.btnHelp.innerHTML=""}}},setClose:function(mode){var _this=this;if(_this.nodes.btnClose){mode=mode||"hidden";switch(mode){case"hidden":Core.Events.addEvent(_this.nodes.btnClose,_this._hiddenDialog,"click");break;case"close":Core.Events.addEvent(_this.nodes.btnClose,_this._closeDialog,"click");break}}},setPosition:function(x,y){this._dialog.setPosition({x:x,y:y})},setMiddle:function(){var win=Core.System.winSize();var _x,_y;var displayState=this._dialog.entity.style.display;this._dialog.setPosition({x:-1e4});this._dialog.entity.style.display="";var titleBarOffsetHeight=this.nodes.titleBar?this.nodes.titleBar.offsetHeight:0;var areaHeight=win.height-this.nodes.content.offsetHeight-titleBarOffsetHeight;var goldenSection=(Math.sqrt(5)-1)/2;var totalSection=1;var goldenSectionY=areaHeight*goldenSection/(goldenSection+totalSection);_x=win.width/2-this.nodes.content.offsetWidth/2;_x=_x<0?0:_x;_y=goldenSectionY<0?0:goldenSectionY;if(!this._dialog.getProperty().isFixed){_x=_x+Math.max(document.documentElement.scrollLeft,document.body.scrollLeft);_y=_y+Math.max(document.documentElement.scrollTop,document.body.scrollTop)}this._dialog.entity.style.display=displayState;this._dialog.setPosition({x:_x,y:_y});this.isSetMiddle=true},setSize:function(width,height){this._dialog.setSize({width:width,height:height})},setFixed:function(state){this._dialog.setFixed(state)},setAreaLocked:function(state){this._dialog.setAreaLocked(state)},setFocusNode:function(focusNode){this._dialog.getProperty().focusNode=focusNode},setDisplayMode:function(mode){this._dialog.getProperty().displayMode=mode||"normal"},getWidth:function(){return this._dialog.getProperty().width},getHeight:function(){return this._dialog.getProperty().height},getX:function(){return this._dialog.getProperty().x},getY:function(){return this._dialog.getProperty().y},show:function(){if(this.isSetMiddle){this.setMiddle()}this._dialog.show();this.onShow()},hidden:function(){this._dialog.hidden();this.onHidden()},close:function(){var _this=this;_this._dialog.close();_this.onClose();if(_this.nodes.btnClose){Core.Events.removeEvent(_this.nodes.btnClose,_this._hiddenDialog,"click");Core.Events.removeEvent(_this.nodes.btnClose,_this._CloseDialog,"click")}},updateNodes:function(){this.nodes=this._dialog.getNodes();var contentNodes=this.getContentNodes();for(k in contentNodes){this.nodes[k]=contentNodes[k]}},getContentNodes:function(mode){var m=mode||"o";var i;var nodes={};var result=this.templateString;if(result){for(i=0;i<result.length;i++){var r=result[i];switch(m){case"o":nodes[r]=$E(this.nodes.content.id+"_"+r);break;case"i":nodes[r]=this.nodes.content.id+"_"+r;break}}}return nodes},setOnDisplaied:function(func){this._dialog.onDisplaied=func},setOnDisplayFinished:function(func){this._dialog.onDisplayFinished=func},onDrag:function(){},onShow:function(){},onHidden:function(){},onClose:function(){}};var LayerTemplate={alert:'<table id="#{entity}"  class="gModLy">'+'<thead id="#{titleBar}">'+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"><div class="gModLyHeader"><div class="gFl"><div class="gML_tit"><strong id="#{titleName}"></strong></div></div>'+'<div class="gFr"><ul><li><a href="javascript:;" id="#{btnClose}" class="iconClose"></a></li><li><a href="#" class="help" >帮助</a></li></ul></div></div></td>'+'<td class="tbgright"><div></div></td>'+"</tr>"+"</thead>"+"<tfoot>"+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"></td>'+'<td class="tbgright"><div></div></td>'+"</tr>"+"</tfoot>"+"<tbody>"+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain" id="layer_2">'+'<div id="#{content}" class="gModLyCont">'+"<!-- 内容区域 -->"+'<div class="gDialogDoc">'+'<div class="diaBd">'+'<div class="gDiaC1"><img id="#{icon}" width="50" height="50" class="" src="http://simg.sinajs.cn/tiezi/images/icon/icon.gif" alt=""/></div>'+'<div class="gDiaC2">'+'<h5 id="#{text}"></h5>'+'<div id="#{subText}"></div>'+"<p/>"+"</div>"+"</div>"+'<div class="btnRow"><a class="gBtnb gBtnbClr" id="#{linkOk}" href="javascript:;"><cite id="#{btnOk}"><em id="#{ok}"></em></cite></a></div>'+"</div>"+"<!-- 内容区域 -->"+"</div>"+"</td>"+'<td class="tbgright"><div></div></td>'+"</tr>"+"</tbody>"+"</table>",confirm:'<table id="#{entity}"  class="gModLy">'+'<thead id="#{titleBar}">'+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"><div class="gModLyHeader"><div class="gFl"><div class="gML_tit"><strong id="#{titleName}"></strong></div></div>'+'<div class="gFr"><ul><li><a href="javascript:;" id="#{btnClose}" class="iconClose"></a></li><li><a href="#" class="help" >帮助</a></li></ul></div></div></td>'+'<td class="tbgright"><div></div></td>'+"</tr>"+"</thead>"+"<tfoot>"+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"></td>'+'<td class="tbgright"><div></div></td>'+"</tr>"+"</tfoot>"+"<tbody>"+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain" id="layer_2">'+'<div id="#{content}" class="gModLyCont">'+"<!-- 内容开始 -->"+'<div class="gDialogDoc">'+'<div class="diaBd">'+'<div class="gDiaC1"><img id="#{icon}" width="50" height="50" class="" src="http://simg.sinajs.cn/tiezi/images/icon/icon.gif" alt=""/></div>'+'<div class="gDiaC2">'+'<h5 id="#{text}"></h5>'+'<div id="#{subText}"></div>'+"<p/>"+"</div>"+"</div>"+'<div class="btnRow">'+'<a class="gBtnb gBtnbClr" id="#{linkOk}" href="javascript:;"><cite id="#{btnOk}"><em id="#{ok}"></em></cite></a>'+'<a class="gBtnb gBtnbClr" id="#{linkCancel}" href="javascript:;"><cite id="#{btnCancel}"><em id="#{cancel}"></em></cite></a>'+"</div>"+"</div>"+"<!-- 内容结束 -->"+"</div>"+"</td>"+'<td class="tbgright"><div></div></td>'+"</tr>"+"</tbody>"+"</table>",iframe:'<table id="#{entity}"  class="gModLy">'+'<thead id="#{titleBar}">'+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"><div class="gModLyHeader"><div class="gFl"><div class="gML_tit"><strong id="#{titleName}"></strong></div></div>'+'<div class="gFr"><ul><li><a href="javascript:;" id="#{btnClose}" class="iconClose"></a></li><li><a href="#" class="help" >帮助</a></li></ul></div></div></td>'+'<td class="tbgright"><div></div></td>'+"</tr>"+"</thead>"+"<tfoot>"+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"></td>'+'<td class="tbgright"><div></div></td>'+"</tr>"+"</tfoot>"+"<tbody>"+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain" id="layer_2">'+'<div id="#{content}" class="gModLyCont">'+'<div id="#{loadState}">Loading...</div>'+'<iframe style="width:100%;height:500px;" id="#{iframe}" src="#{iframeURL}"></iframe>'+"</div>"+"</td>"+'<td class="tbgright"><div></div></td>'+"</tr>"+"</tbody>"+"</table>",customs:'<table id="#{entity}"  class="gModLy">'+'<thead id="#{titleBar}">'+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"><div class="gModLyHeader"><div class="gFl"><div class="gML_tit"><strong id="#{titleName}"></strong></div></div>'+'<div class="gFr"><ul><li><a href="javascript:;" id="#{btnClose}" class="iconClose"></a></li><li><a href="#" class="help" >帮助</a></li></ul></div></div></td>'+'<td class="tbgright"><div></div></td>'+"</tr>"+"</thead>"+"<tfoot>"+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"></td>'+'<td class="tbgright"><div></div></td>'+"</tr>"+"</tfoot>"+"<tbody>"+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain" id="layer_2">'+'<div id="#{content}" class="gModLyCont">'+"<!-- 内容区域 -->"+"<!-- 内容区域 -->"+"</div>"+"</td>"+'<td class="tbgright"><div></div></td>'+"</tr>"+"</tbody>"+"</table>"};!function(){var WindowDialog=function(backShadow,objTemplate){this.template=objTemplate||{};DialogManager.backShadow=backShadow};WindowDialog.prototype={iconSet:{"01":{"class":"SG_icon SG_icon201",alt:"警告"},"02":{"class":"SG_icon SG_icon202",alt:"失败"},"03":{"class":"SG_icon SG_icon203",alt:"成功"},"04":{"class":"SG_icon SG_icon204",alt:"询问"},"06":{"class":"SG_icon SG_icon148",alt:"警告"}},alert:function(text,cfg,name){cfg=cfg||{};var dialog=DialogManager.create(cfg.template||this.template.alert||LayerTemplate.alert,name);var win=Core.System.winSize();var nodes=dialog.getNodes();dialog.onDisplaied=cfg["funcDisplaied"];dialog.onDisplayFinished=cfg["funcDisplayFinished"];dialog.setSize({width:cfg["width"],height:cfg["height"]});dialog.setFixed(true);this._setDialogMiddle(dialog);dialog.show();dialog.setAreaLocked(true);nodes.linkOk.focus();nodes.text.innerHTML=text;if(nodes.titleName){nodes.titleName.innerHTML=cfg["title"]||"提示"}if(nodes.icon){nodes.icon.className=cfg["icon"]?this.iconSet[cfg["icon"]]["class"]:this.iconSet["01"]["class"];nodes.icon.alt=cfg["icon"]?this.iconSet[cfg["icon"]]["alt"]:this.iconSet["01"]["alt"]}nodes.ok.innerHTML=cfg["textOk"]||"确定";if(nodes.subText){nodes.subText.innerHTML=cfg["subText"]||""}dialog.getProperty().focusNode=nodes.linkOk;Core.Events.addEvent(nodes.btnOk,function(){if(cfg["funcOk"]&&dialog.getProperty().enabled){cfg["funcOk"]();Core.Events.stopEvent()}dialog.close();return false},"click");Core.Events.addEvent(nodes.linkOk,function(){var e=Core.Events.getEvent();if(e.keyCode=="13"){if(cfg["funcOk"]&&dialog.getProperty().enabled){cfg["funcOk"]()}dialog.close()}},"keydown");Core.Events.addEvent(nodes.btnClose,function(){if(cfg["funcClose"]&&dialog.getProperty().enabled){cfg["funcClose"]()}dialog.close()},"click");Core.Events.addEvent(nodes.btnClose,function(){var e=Core.Events.getEvent();e.cancelBubble=true},"mousedown")},newAlert:function(text,cfg,name){cfg.template=this.template.newAlert;this.alert(text,cfg,name)},confirm:function(text,cfg,name){cfg=cfg||{};var dialog=DialogManager.create(cfg.template||this.template.confirm||LayerTemplate.confirm,name);var win=Core.System.winSize();var nodes=dialog.getNodes();dialog.onDisplaied=cfg["funcDisplaied"];dialog.onDisplayFinished=cfg["funcDisplayFinished"];dialog.setSize({width:cfg["width"],height:cfg["height"]});dialog.setFixed(true);this._setDialogMiddle(dialog);dialog.show();dialog.setAreaLocked(true);if(cfg["defaultButton"]==0){nodes.linkCancel.focus();dialog.getProperty().focusNode=nodes.linkCancel}else{nodes.linkOk.focus();dialog.getProperty().focusNode=nodes.linkOk}nodes.text.innerHTML=text;if(nodes.titleName){nodes.titleName.innerHTML=cfg["title"]||"提示"}if(nodes.icon){nodes.icon.className=cfg["icon"]?this.iconSet[cfg["icon"]]["class"]:this.iconSet["04"]["class"];nodes.icon.alt=cfg["icon"]?this.iconSet[cfg["icon"]]["alt"]:this.iconSet["04"]["alt"]}nodes.ok.innerHTML=cfg["textOk"]||"确定";nodes.cancel.innerHTML=cfg["textCancel"]||"取消";if(nodes.subText){nodes.subText.innerHTML=cfg["subText"]||""}Core.Events.addEvent(nodes.btnOk,function(){if(cfg["funcOk"]&&dialog.getProperty().enabled){cfg["funcOk"]();Core.Events.stopEvent()}dialog.close();return false},"click");Core.Events.addEvent(nodes.linkOk,function(){var e=Core.Events.getEvent();if(e.keyCode=="13"){if(cfg["funcOk"]&&dialog.getProperty().enabled){cfg["funcOk"]()}dialog.close()}},"keydown");Core.Events.addEvent(nodes.btnCancel,function(){if(cfg["funcCancel"]&&dialog.getProperty().enabled){cfg["funcCancel"]();Core.Events.stopEvent()}dialog.close();return false},"click");Core.Events.addEvent(nodes.linkCancel,function(){var e=Core.Events.getEvent();if(e.keyCode=="13"){if(cfg["funcCancel"]&&dialog.getProperty().enabled){cfg["funcCancel"]()}dialog.close()}},"keydown");Core.Events.addEvent(nodes.btnClose,function(){if(cfg["funcClose"]&&dialog.getProperty().enabled){cfg["funcClose"]();Core.Events.stopEvent()}dialog.close();return false},"click");Core.Events.addEvent(nodes.btnClose,function(){var e=Core.Events.getEvent();e.cancelBubble=true},"mousedown")},newConform:function(text,cfg,name){cfg.template=this.template.newConfirm;this.confirm(text,cfg,name)},showIframe:function(cfg,name){cfg=cfg||{};var dialog=DialogManager.create(this.template.iframe||LayerTemplate.iframe,name);var win=Core.System.winSize();var nodes=dialog.getNodes();dialog.setSize({width:cfg["width"]||320,height:cfg["height"]||150});var _x=win.width/2-dialog.getProperty().width/2<0?0:win.width/2-dialog.getProperty().width/2;var _y=win.height/2-dialog.getProperty().height/2<0?0:win.height/2-dialog.getProperty().height/2;if(cfg["fixed"]){dialog.setPosition({x:_x,y:_y})}else{dialog.setPosition({x:_x+document.documentElement.scrollLeft,y:_y+document.documentElement.scrollTop})}if(!$IE6){dialog.getProperty().displayMode="alpha"}dialog.setFixed(!!cfg.fixed);dialog.show();dialog.setAreaLocked(true);nodes.titleName.innerHTML=cfg["title"]||"";nodes.iframe.src=cfg["url"]||"about:blank";Core.Events.addEvent(nodes.iframe,function(){nodes.iframe.style.display="";nodes.loadState.style.display="none"},"load");Core.Events.addEvent(nodes.btnClose,function(){dialog.close()},"click");Core.Events.addEvent(nodes.btnClose,function(){var e=Core.Events.getEvent();e.cancelBubble=true},"mousedown")},createCustomsDialog:function(cfg,name){cfg=cfg||{};var customsDialog=new CustomsDialog(cfg.tpl||this.template.customs||LayerTemplate.customs,name);cfg.content&&customsDialog.setContent(cfg.content);customsDialog.setTitle(cfg.title||"提示");customsDialog.setHelp(cfg.help||"");customsDialog.setClose("hidden");customsDialog.setOnDisplaied(cfg["funcDisplaied"]);customsDialog.setOnDisplayFinished(cfg["funcDisplayFinished"]);return customsDialog},getDialog:function(name){return DialogManager.getDialog(name)},close:function(name){DialogManager.close(name)},_setDialogMiddle:function(dialog){var win=Core.System.winSize();var nodes=dialog.getNodes();var _x,_y;var displayState=dialog.entity.style.display;dialog.setPosition({x:-1e4});dialog.entity.style.display="";var titleBarOffsetHeight=nodes.titleBar?nodes.titleBar.offsetHeight:0;var areaHeight=win.height-nodes.content.offsetHeight-titleBarOffsetHeight;var goldenSection=(Math.sqrt(5)-1)/2;var totalSection=1;var goldenSectionY=areaHeight*goldenSection/(goldenSection+totalSection);_x=win.width/2-nodes.content.offsetWidth/2;_x=_x<0?0:_x;_y=goldenSectionY<0?0:goldenSectionY;if(!dialog.getProperty().isFixed){_x=_x+document.documentElement.scrollLeft;_y=_y+document.documentElement.scrollTop}dialog.entity.style.display=displayState;dialog.setPosition({x:_x,y:_y})}};Sina.Ui.WindowDialog=WindowDialog}();$SYSMSG.extend({A00001:"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电4006900000。",A00002:"很抱歉，您的IP出现异常，请稍后再试",A00003:"无权限进行此操作，请重新登录。",A00004:"无权限进行此操作，请重新登录。",A00005:"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电4006900000。",A00006:"操作成功",A00007:"无权限进行此操作，请重新登录。",A00009:"网络繁忙，请稍后再试",A00010:"无升级权限",A11007:"你还未开通新浪博客，请先<a href='https://login.sina.com.cn/hd/reg_sec.php?entry=blog'> 开通博客</a>",A00800:"对不起，您短时间点击喜欢过多，请多休息，注意身体！感谢您对新浪博客的支持和关注！",A00039:"对不起，该文章为私密文章，禁止评论！",A00038:"抱歉，您评论的文章不存在！",A00111:"抱歉，该文章禁止评论！",A00110:"用户设置为不允许评论！",P00001:"抱歉，您还没有认证实名，<br>请点击确认认证后，继续转载文章！"});$SYSMSG.extend({1103:"抱歉您所在的IP已经被封了，请稍后再试！",1104:"抱歉您的账号异常，请稍后再试！",1105:"抱歉您的账户昵称不合符规范，<br>请修改后再试！",1106:"发表成功，稍后显示。",1107:"网络繁忙！",2000:"评论内容不能重复！",2004:"涉政地区频次限制",2005:"涉政uid频次限制",2006:"留言板关闭",2100:"发送频率过高，请稍后再试！",4001:"发表成功，稍后显示。",A00111:"抱歉，该文章禁止评论！",A00110:"抱歉，该文章禁止评论！",A00103:"抱歉，您已被对方加入黑名单！"});function showError(code,ico){var msg=$SYSMSG[code]||code;winDialog.alert(msg,{icon:ico||"01"})}Core.String.StringBuffer=function(){this.buffer=[]};Core.String.StringBuffer.prototype.append=function(str){this.buffer.push(str);return this};Core.String.StringBuffer.prototype.toString=function(){return this.buffer.join("")};var voteDom={build:"  "+'<div class="state1" id="newStatus">'+'<div class="voteBox1">'+'<table border="0" cellspacing="0" cellpadding="0">'+"<tr>"+"<th><span>投票主题：</span></th>"+'<td><input type="hidden" id="voteId" name="voteId" value="" /><input type="hidden" name="blogVote" value="yes" /> <input type="hidden" name="voteType" id="voteType" value="1" />'+'<input type="text" id="voteTitle" name="voteTitle" class="Fm_input2" style="width:365px;" tabindex="500" /></td>'+"</tr>"+"<tr>"+'<th><span>投票选项：</span><ul id="chooseIndex" class="ul2"></ul></th>'+'<td><span class="SG_txtc note1">每行填写一个选项，最多可填写15个选项。</span>'+'<ul class="ul1" id="voteItems">'+"<li>"+'<input type="text" name="voteData[]" tabindex="501" class="Fm_input2" style="width:345px;" />'+'<a class="del" id="delItem1" href="javascript:void(0);" onclick="return false;"><img width="15" height="15" align="absmiddle" title="删除" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon43"/></a></li>'+"<li>"+'<input type="text" name="voteData[]" tabindex="501" class="Fm_input2" style="width:345px;" />'+'<a class="del" id="delItem2" href="javascript:void(0);" onclick="return false;"><img width="15" height="15" align="absmiddle" title="删除" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon43"/></a></li>'+"<li>"+'<input type="text" name="voteData[]" tabindex="501"  class="Fm_input2" style="width:345px;" />'+'<a class="del" id="delItem3" href="javascript:void(0);" onclick="return false;"><img width="15" height="15" align="absmiddle" title="删除" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon43"/></a></li>'+"</ul>"+'<div class="addbtn"><a href="javascript:void(0)" onclick="return false;" id="newOne" tabindex="502">+ 增加选项</a></div></td>'+"</tr>"+"<tr>"+"<th>&nbsp;</th>"+'<td><a class="SG_aBtn SG_aBtnB" href="#" onclick="return false;" id="saveBtn" tabindex="509"><cite>保存</cite></a></td>'+"</tr>"+"</table>"+"</div>"+'<div class="voteBox2">'+'<table border="0" cellspacing="0" cellpadding="0">'+"<tr>"+"<th><span>投票方式：</span></th>"+'<td><div class="voteMethod"> <span>'+'<input type="radio" name="rad" id="rad1" tabIndex="503" onclick="changeType(false);" checked/>'+'<label for="rad1">单选</label>'+"</span> <span>"+'<input type="radio" name="rad" id="rad2" tabIndex="503" onclick="changeType(true);"/>'+'<label for="rad2">多选</label>'+'<select id="mutiple" style="display:none;" tabIndex="504" onchange="document.getElementById(\'voteType\').value=this.value">'+"<option value='2'>最多选2项</option>"+"<option value='3'>最多选3项</option>"+"<option value='4'>最多选4项</option>"+"<option value='5'>最多选5项</option>"+"<option value='6'>最多选6项</option>"+"<option value='7'>最多选7项</option>"+"</select>"+"</span> </div></td>"+"</tr>"+"<tr>"+"<th><span>投票位置：</span></th>"+'<td><div class="voteMethod">'+'<span><input type="radio" tabIndex="504" id="votePos1" name="votePos" value="1"/><label for="votePos1">在博文开始</label></span>'+'<span><input type="radio" tabIndex="504" id="votePos2" name="votePos" checked="true" value="0"/><label for="votePos2">在博文末尾</label></span>'+"</div></td>"+"</tr>"+"<tr>"+"<th><span>截止日期：</span></th>"+'<td class="td1"><div class="time">'+'<select id="year" name="voteYear" tabIndex="505">'+"</select>"+"<em>年</em>"+'<select id="month" name="voteMonth" tabIndex="506">'+"</select>"+"<em>月</em>"+'<select id="day" name="voteDay" tabIndex="507">'+"</select>"+"<em>日</em>"+'<select id="hh" name="voteHour" tabIndex="508">'+" </select>"+" <em>时</em></div></td>"+"</tr>"+"</table>"+"</div>"+"</div>"+'<div class="state2" id="saveStatus" style="display:none;">'+"</div>"+'<div class="clearit"></div>'+"",newItem:'<input type="text" tabIndex="501" class="Fm_input2" style="width:365px;" name="voteData[]"/><a href="javascript:;" onclick="return false;" class="del" id={0}><img class="SG_icon SG_icon43" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="删除" align="absmiddle" tabIndex="449" /></a>',saveItem:'<dl><dt><span id="vote_expired">{0}</span><a href="javascript:void(0);" onclick="return false;" id="editBtn" class="CP_a_fuc">[<cite>修改</cite>]</a></dt><dd id="voteArea"></dd></dl>'};
window.dayArray=[31,28,31,30,31,30,31,31,30,31,30,31];var DateSelector=function(cfg){window.startTime={};window.endTime={};if(typeof cfg.from!="undefined"){window.startTime={year:parseInt(cfg.from.substring(0,4),10),month:parseInt(trimHeadZero(cfg.from.substring(5,7)),10),day:parseInt(trimHeadZero(cfg.from.substring(8,10)),10),hh:parseInt(trimHeadZero(cfg.from.substring(11,13)),10),timeobj:null}}else{var nowTime=new Date;window.startTime={year:parseInt(nowTime.getYear(),10),month:parseInt(nowTime.getMonth(),10),day:parseInt(nowTime.getDate(),10),hh:parseInt(nowTime.getHours(),10),timeobj:null}}var timeobj=new Date;timeobj.setFullYear(window.startTime.year);timeobj.setMonth(window.startTime.month-1);timeobj.setDate(window.startTime.day);timeobj.setHours(window.startTime.hh);window.startTime.timeobj=timeobj;var nextTime=new Date(window.startTime.timeobj);if(articleEditorCFG.articlevData==null){if(typeof cfg.to!="undefined"){var dtype=cfg.to.split("-")[0];if(dtype=="y"){nextTime.setFullYear(nextTime.getYear()+parseInt(cfg.to.split("-")[1]),10)}else if(dtype=="m"){nextTime.getMonth();var tempMonth=nextTime.getMonth()+parseInt(cfg.to.split("-")[1],10);nextTime.setMonth(tempMonth)}else if(dtype=="d"){nextTime.setDate(nextTime.getDate()+parseInt(cfg.to.split("-")[1],10))}else if(dtype=="h"){nextTime.setHours(nextTime.getHours()+parseInt(cfg.to.split("-")[1],10))}}else{nextTime.setMonth(nextTime.getMonth()+2)}}else{var tempExpire=articleEditorCFG.articlevData.expireTime;nextTime.setFullYear(parseInt(tempExpire.substring(0,4),10));nextTime.setMonth(parseInt(trimHeadZero(tempExpire.substring(5,7)),10)-1);nextTime.setDate(parseInt(trimHeadZero(tempExpire.substring(8,10)),10));nextTime.setHours(parseInt(trimHeadZero(tempExpire.substring(11,13)),10),0,0)}window.endTime={year:parseInt(nextTime.getFullYear(),10),month:parseInt(nextTime.getMonth(),10),day:parseInt(nextTime.getDate(),10),hh:parseInt(nextTime.getHours(),10),timeobj:nextTime};$E("year").onchange=function(){valueChange("year")};$E("month").onchange=function(){valueChange("month")};$E("day").onchange=function(){valueChange("day")};$E("hh").onchange=function(){valueChange("hh")};rederDateItems()};var valueChange=function(stype){var d_e_obj=window.endTime;var month=$E("month").value;var days=window.dayArray[month-1];if(month==2&&(stype=="month"||stype=="year")){if(isSpecialYear(parseInt($E("year").value,10))){days=29;$E("day").options.length=0;for(var m=1;m<=days;m++){var opt=new Option(m,m);if(opt.value==d_e_obj.day)opt.selected=true;$E("day").options.add(opt)}}else{$E("day").options.length=0;for(var m=1;m<=days;m++){var opt=new Option(m,m);if(opt.value==d_e_obj.day)opt.selected=true;$E("day").options.add(opt)}}}if(stype=="month"){$E("day").options.length=0;for(var m=1;m<=days;m++){var opt=new Option(m,m);if(opt.value==d_e_obj.day)opt.selected=true;$E("day").options.add(opt)}}var selectDate=new Date(parseInt($E("year").value,10),parseInt($E("month").value,10),parseInt($E("day").value,10),parseInt($E("hh").value,10))};var rederDateItems=function(){var d_s_obj=window.startTime;var d_e_obj=window.endTime;var currentMonth=0;$E("year").options.length=0;for(var y=0;y<=2;y++){var opt=new Option(d_s_obj.year+y,d_s_obj.year+y);$E("year").options.add(opt);if(opt.value==d_e_obj.year)opt.selected=true}$E("month").options.length=0;for(var m=0;m<=11;m++){var opt=new Option(m+1,m+1);$E("month").options.add(opt);if(parseInt(d_e_obj.month,10)+1==parseInt(opt.value+"",10)){currentMonth=m;opt.selected=true}}$E("day").options.length=0;for(var d=1;d<=window.dayArray[currentMonth];d++){var opt=new Option(d,d);$E("day").options.add(opt);if(opt.value==d_e_obj.day)opt.selected=true}$E("hh").options.length=0;for(var h=0;h<=23;h++){var opt=new Option(h,h);$E("hh").options.add(opt);if(opt.value==d_e_obj.hh)opt.selected=true}};function trimHeadZero(str){return str.replace(/^0/,"")}function dateCompare(date1,date2){return date1.getTime()<date2.getTime()}function isSpecialYear(year){return new Date(year,2,0).getDate()==29}Lib.register("blogv.getVHTML",function(){return function(wtype,isLinked){var title,className;if(isNaN(wtype)){wtype=-1}else{wtype=parseInt(wtype,10)}if(0==wtype){title="新浪个人认证";className=" SG_icon146"}else if(0<wtype&&8>wtype){title="新浪机构认证";className=" SG_icon147"}var str;if(!1!==isLinked){isLinked=!0}if(title){str='<img class="SG_icon '+className+'" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="'+title+'" alt="'+title+'" align="absmiddle" />'}else{str=""}if(str&&isLinked){str='<a target="_blank" href="http://blog.sina.com.cn/v/verify">'+str+"</a>"}return str}});$SYSMSG.extend({B00901:"投票不存在。",B00902:"投票已截止。",B00903:"超出允许投票个数。",B00904:"你已投过票了!<br/>重复投票是没有意义的。",B00905:"投票主题过短<br/>至少要5个汉字或10个字符！",B00906:"投票选项至少要填写2项",B00907:"投票的截止时间不能小于当前时间，请重新选择 ",B00908:"投票选项最多可填写7项",B00909:"投票主题不能为空"});Core.Dom.getElementsByAttr=function(node,attname,attvalue){var nodes=[];for(var i=0,l=node.childNodes.length;i<l;i++){if(node.childNodes[i].nodeType==1){if(node.childNodes[i].getAttribute(attname)==attvalue){nodes.push(node.childNodes[i])}if(node.childNodes[i].childNodes.length>0){nodes=nodes.concat(arguments.callee.call(null,node.childNodes[i],attname,attvalue))}}}return nodes};Core.Dom.insertAfter=function(newElement,targetElement){if(!targetElement)return;var parent=targetElement.parentNode;if(parent.lastChild==targetElement){parent.appendChild(newElement)}else{parent.insertBefore(newElement,targetElement.nextSibling)}return newElement};Core.Dom.removeParentNode=function(node){node=$E(node);var parentNode=node.parentNode;Core.Dom.insertAfter(node,parentNode);parentNode.parentNode.removeChild(parentNode)};if(typeof infosoftglobal=="undefined")var infosoftglobal=new Object;if(typeof infosoftglobal.FusionChartsUtil=="undefined")infosoftglobal.FusionChartsUtil=new Object;infosoftglobal.FusionCharts=function(swf,id,w,h,debugMode,registerWithJS,c,scaleMode,lang,detectFlashVersion,autoInstallRedirect){if(!document.getElementById){return}this.initialDataSet=false;this.params=new Object;this.variables=new Object;this.attributes=new Array;if(swf){this.setAttribute("swf",swf)}if(id){this.setAttribute("id",id)}debugMode=debugMode?debugMode:0;this.addVariable("debugMode",debugMode);w=w.toString().replace(/\%$/,"%25");if(w){this.setAttribute("width",w)}h=h.toString().replace(/\%$/,"%25");if(h){this.setAttribute("height",h)}if(c){this.addParam("bgcolor",c)}this.addParam("quality","high");this.addParam("allowScriptAccess","always");this.addVariable("chartWidth",w);this.addVariable("chartHeight",h);this.addVariable("DOMId",id);registerWithJS=registerWithJS?registerWithJS:0;this.addVariable("registerWithJS",registerWithJS);scaleMode=scaleMode?scaleMode:"noScale";this.addVariable("scaleMode",scaleMode);lang=lang?lang:"EN";this.addVariable("lang",lang);this.detectFlashVersion=detectFlashVersion?detectFlashVersion:1;this.autoInstallRedirect=autoInstallRedirect?autoInstallRedirect:1;this.installedVer=infosoftglobal.FusionChartsUtil.getPlayerVersion();if(!window.opera&&document.all&&this.installedVer.major>7){infosoftglobal.FusionCharts.doPrepUnload=true}};infosoftglobal.FusionCharts.prototype={setAttribute:function(name,value){this.attributes[name]=value},getAttribute:function(name){return this.attributes[name]},addParam:function(name,value){this.params[name]=value},getParams:function(){return this.params},addVariable:function(name,value){this.variables[name]=value},getVariable:function(name){return this.variables[name]},getVariables:function(){return this.variables},getVariablePairs:function(){var variablePairs=new Array;var key;var variables=this.getVariables();for(key in variables){variablePairs.push(key+"="+variables[key])}return variablePairs},getSWFHTML:function(){var swfNode="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){swfNode='<embed type="application/x-shockwave-flash" src="'+this.getAttribute("swf")+'" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'"  ';swfNode+=' id="'+this.getAttribute("id")+'" name="'+this.getAttribute("id")+'" ';var params=this.getParams();for(var key in params){swfNode+=[key]+'="'+params[key]+'" '}var pairs=this.getVariablePairs().join("&");if(pairs.length>0){swfNode+='flashvars="'+pairs+'"'}swfNode+="/>"}else{swfNode='<object id="'+this.getAttribute("id")+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'">';swfNode+='<param name="movie" value="'+this.getAttribute("swf")+'" />';var params=this.getParams();for(var key in params){swfNode+='<param name="'+key+'" value="'+params[key]+'" />'}var pairs=this.getVariablePairs().join("&");if(pairs.length>0){swfNode+='<param name="flashvars" value="'+pairs+'" />'}swfNode+="</object>"}return swfNode},setDataURL:function(strDataURL){if(this.initialDataSet==false){this.addVariable("dataURL",strDataURL);this.initialDataSet=true}else{var chartObj=infosoftglobal.FusionChartsUtil.getChartObject(this.getAttribute("id"));if(!chartObj.setDataURL){__flash__addCallback(chartObj,"setDataURL")}chartObj.setDataURL(strDataURL)}},encodeDataXML:function(strDataXML){var regExpReservedCharacters=["\\$","\\+"];var arrDQAtt=strDataXML.match(/=\s*\".*?\"/g);if(arrDQAtt){for(var i=0;i<arrDQAtt.length;i++){var repStr=arrDQAtt[i].replace(/^=\s*\"|\"$/g,"");repStr=repStr.replace(/\'/g,"%26apos;");var strTo=strDataXML.indexOf(arrDQAtt[i]);var repStrr="='"+repStr+"'";var strStart=strDataXML.substring(0,strTo);var strEnd=strDataXML.substring(strTo+arrDQAtt[i].length);var strDataXML=strStart+repStrr+strEnd}}strDataXML=strDataXML.replace(/\"/g,"%26quot;");strDataXML=strDataXML.replace(/%(?![\da-f]{2}|[\da-f]{4})/gi,"%25");strDataXML=strDataXML.replace(/\&/g,"%26");return strDataXML},setDataXML:function(strDataXML){if(this.initialDataSet==false){this.addVariable("dataXML",this.encodeDataXML(strDataXML));this.initialDataSet=true}else{var chartObj=infosoftglobal.FusionChartsUtil.getChartObject(this.getAttribute("id"));chartObj.setDataXML(strDataXML)}},setTransparent:function(isTransparent){if(typeof isTransparent=="undefined"){isTransparent=true}if(isTransparent)this.addParam("WMode","transparent");else this.addParam("WMode","Opaque")},render:function(elementId){if(this.detectFlashVersion==1&&this.installedVer.major<8){if(this.autoInstallRedirect==1){var installationConfirm=window.confirm("You need Adobe Flash Player 8 (or above) to view the charts. It is a free and lightweight installation from Adobe.com. Please click on Ok to install the same.");if(installationConfirm){window.location="http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash"}else{return false}}else{return false}}else{var n=typeof elementId=="string"?document.getElementById(elementId):elementId;if(this.getVariable("scaleMode").search(/noscale/i)>=0&&(this.getAttribute("width").search("%")>0||this.getAttribute("height").search("%")>0)){var obj=this;if(window.addEventListener){window.addEventListener("load",function(){n.innerHTML=obj.getSWFHTML()},false)}else if(window.attachEvent){window.attachEvent("onload",function(){n.innerHTML=obj.getSWFHTML()})}else{n.innerHTML=this.getSWFHTML()}}else{n.innerHTML=this.getSWFHTML()}if(!document.embeds[this.getAttribute("id")]&&!window[this.getAttribute("id")])window[this.getAttribute("id")]=document.getElementById(this.getAttribute("id"));return true}}};infosoftglobal.FusionChartsUtil.getPlayerVersion=function(){var PlayerVersion=new infosoftglobal.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var x=navigator.plugins["Shockwave Flash"];if(x&&x.description){PlayerVersion=new infosoftglobal.PlayerVersion(x.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split("."))}}else if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var axo=1;var counter=3;while(axo){try{counter++;axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+counter);PlayerVersion=new infosoftglobal.PlayerVersion([counter,0,0])}catch(e){axo=null}}}else{try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7")}catch(e){try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");PlayerVersion=new infosoftglobal.PlayerVersion([6,0,21]);axo.AllowScriptAccess="always"}catch(e){if(PlayerVersion.major==6){return PlayerVersion}}try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(e){}}if(axo!=null){PlayerVersion=new infosoftglobal.PlayerVersion(axo.GetVariable("$version").split(" ")[1].split(","))}}return PlayerVersion};infosoftglobal.PlayerVersion=function(arrVersion){this.major=arrVersion[0]!=null?parseInt(arrVersion[0]):0;this.minor=arrVersion[1]!=null?parseInt(arrVersion[1]):0;this.rev=arrVersion[2]!=null?parseInt(arrVersion[2]):0};infosoftglobal.FusionChartsUtil.cleanupSWFs=function(){var objects=document.getElementsByTagName("OBJECT");for(var i=objects.length-1;i>=0;i--){objects[i].style.display="none";for(var x in objects[i]){if(typeof objects[i][x]=="function"){objects[i][x]=function(){}}}}};if(infosoftglobal.FusionCharts.doPrepUnload){if(!infosoftglobal.unloadSet){infosoftglobal.FusionChartsUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",infosoftglobal.FusionChartsUtil.cleanupSWFs)};window.attachEvent("onbeforeunload",infosoftglobal.FusionChartsUtil.prepUnload);infosoftglobal.unloadSet=true}}if(!document.getElementById&&document.all){document.getElementById=function(id){return document.all[id]}}if(Array.prototype.push==null){Array.prototype.push=function(item){this[this.length]=item;return this.length}}infosoftglobal.FusionChartsUtil.getChartObject=function(id){var chartRef=null;if(navigator.appName.indexOf("Microsoft Internet")==-1){if(document.embeds&&document.embeds[id])chartRef=document.embeds[id];else chartRef=window.document[id]}else{chartRef=window[id]}if(!chartRef)chartRef=document.getElementById(id);return chartRef};var getChartFromId=infosoftglobal.FusionChartsUtil.getChartObject;var FusionCharts=infosoftglobal.FusionCharts;var voteValues=[];RenderFlash=Core.Class.create();RenderFlash.prototype={flashId:null,data:null,current:null,eventDom:null,_labels:null,selected:[],initialize:function(){this.eventDom={tab:$E("tabDiv")?$E("tabDiv"):null,line:$E("lineView")?$E("lineView"):null,pie:$E("pieView")?$E("pieView"):null,column:$E("columnView")?$E("columnView"):null,content:$E("voteViewContent")?$E("voteViewContent"):null};this._refreshFlashId();this._addClickEvent(this.eventDom.line);this._addClickEvent(this.eventDom.pie);this._addClickEvent(this.eventDom.column);this.combineData()},showTab:function(flashType,flashId,parentId){if(this.current==flashType)return;var flashBar=Core.Dom.getElementsByClass($E("voter"),"div","vShape")[0];if(flashBar){flashBar.style.display=""}window.clearAllInterval();if(flashType=="line"){this.current="line";$E("voteViewContent").innerHTML=window.vote_cache_content_html;window.renderVoteNum();var items=document.getElementsByName("chb1");for(var j=0;j<items.length;j++){items[j].disabled="true";try{items[j].parentNode.childNodes[3].style.cursor="default"}catch(error){}}}else if(flashType=="Pie3D.swf"){this.current="Pie3D.swf";var html=this._tabTemplate.chooses.join("");var uls="";for(var i=0;i<this._labels.length;i++){var itemTpl=this._tabTemplate.item.join("");itemTpl=itemTpl.replace("#{type}",window.vote_rc_type+"");itemTpl=itemTpl.replace(/([#][{]index[}])/gi,i+1);itemTpl=itemTpl.replace("#{text}",this._labels[i]);uls+=itemTpl}html=html.replace("#{uls}",uls);html+=this._tabTemplate.flash.join("");this.eventDom["content"].innerHTML=html;var height=this._labels.length*30;if(height<150)height=150;var xml="<chart baseFontSize='12' baseFontColor='888888' numberSuffix='%25' showAboutMenuItem='0' decimals='2' chartTopMargin='0' chartBottomMargin='0' caption='' showValues='0' formatNumberScale='0' bgColor='99CCFF,FFFFFF' bgAlpha='0,0' startingAngle='60'>";for(var i=0;i<this.data.length;i++){var item=this.data[i];if(this.selected[i]!=null){xml+="<set label='"+(i+1)+"' value='"+voteValues[i].replace("%","")+"' displayValue='"+Core.String.shorten(this._labels[i],7,"…")+"' toolText='"+this._labels[i]+"("+voteValues[i]+")' isSliced='1' />"}else{xml+="<set label='"+(i+1)+"' value='"+voteValues[i].replace("%","")+"' displayValue='"+Core.String.shorten(this._labels[i],7,"…")+"' toolText='"+this._labels[i]+"("+voteValues[i]+")' />"}}xml+="</chart>";var chart=new FusionCharts($_GLOBAL.flashBasicURL+"Pie3D.swf",flashId,"360",height,"0","0");chart.setDataXML(xml);chart.setTransparent(true);chart.render(parentId)}else if(flashType=="Column3D.swf"){this.current="Column3D.swf";var html=this._tabTemplate.chooses.join("");var uls="";for(var i=0;i<this._labels.length;i++){var itemTpl=this._tabTemplate.item.join("");itemTpl=itemTpl.replace("#{type}",window.vote_rc_type+"");itemTpl=itemTpl.replace(/([#][{]index[}])/gi,i+1);itemTpl=itemTpl.replace("#{text}",this._labels[i]);uls+=itemTpl}html=html.replace("#{uls}",uls);html+=this._tabTemplate.flash.join("");this.eventDom["content"].innerHTML=html;var height=this._labels.length*30;if(height<150)height=150;var xml="<chart baseFontSize='12' baseFontColor='888888' showValues='1' outCnvBaseFontColor='999999' outCnvBaseFontSize='12' numberSuffix='%25' showAboutMenuItem='0' decimals='2' yAxisMaxValue='100' palette='2' enableRotation='1' canvasBgColor='ffffff' canvasBgAlpha='0' canvasBgDepth='3' canvasBaseColor='ffffff' divLineColor='d8d8d8' numDivLines='4' bgAlpha='0' divLineColor='d8d8d8' canvasPadding='8' chartLeftMargin='0' chartRightMargin='5' chartTopMargin='5' chartBottomMargin='0' maxColWidth='70' showValues='0'><styles><definition><style name='myToolTip' type='font' size='12' color='666666' /></definition><application><apply toObject='ToolTip' styles='myToolTip' /></application></styles>";for(var i=0;i<this.data.length;i++){var item=this.data[i];xml+="<set label='"+(i+1)+"' value='"+voteValues[i].replace("%","")+"' toolText='"+this._labels[i]+"("+voteValues[i]+")' />"}xml+="</chart>";var chart=new FusionCharts($_GLOBAL.flashBasicURL+"Column3D.swf",flashId,"360",height,"0","0");chart.setDataXML(xml);chart.setTransparent(true);chart.render(parentId)}if($E("flashContent"))$E("flashContent").style.padding="13px 0 0 "},_refreshFlashId:function(){this.flashId=Core.Math.getUniqueId()},_addClickEvent:function(dom){var _this=this;if(dom){dom.onclick=function(){_this._onClickHandler(this)}}},_onClickHandler:function(dom){var _this=this;function updateTabStatus(type){_this.eventDom["line"].parentNode.className="";_this.eventDom["pie"].parentNode.className="";_this.eventDom["column"].parentNode.className="";_this.eventDom[type].parentNode.className="cur SG_txtb"}if(dom!=null){var id=dom.id;if(id=="lineView"){this.showTab("line","lineId","voteViewContent");updateTabStatus("line")}else if(id=="pieView"){this.showTab("Pie3D.swf","Pie3D_"+this.flashId,"flashContent");updateTabStatus("pie")}else if(id=="columnView"){this.showTab("Column3D.swf","Column3D_"+this.flashId,"flashContent");updateTabStatus("column")}}},combineData:function(changeData){this.data=[];var labels=this._getLabel();for(var i=0;i<labels.length;i++){this.data[this.data.length]={label:labels[i],num:window.vote_count.detail[i]}}},_getLabel:function(){var labels=[];var spans=Core.Dom.getElementsByClass($E("voteViewContent"),"span","");var length=spans.length;for(var i=0;i<length;i++){labels[labels.length]=spans[i].innerHTML}this._labels=labels;return labels},_tabTemplate:{chooses:['<div class="vContentRe">',"<ul>","#{uls}","</ul>","</div>"],item:['<li class="clearfix">','<div class="choosed">','<input type="#{type}" disabled="disabled" id="chb#{index}"/><label for="chb#{index}" style="cursor:default"><em>#{index}.</em><span>#{text}</span></label>',"</div>","</li>"],flash:['<div id="flashContent" class="vContentPic">',"</div>"]}};!function(_){_.rf=null;_.changeType=function(flag){$E("mutiple").style.display=flag?"":"none";$E("voteType").value=flag?$E("mutiple").value:1};_.checkNum=function(self,mutipleNum){var chks=document.getElementsByName("chb1");var chkedNum=0;for(var i=0;i<chks.length;i++){var chk=chks[i];if(chk.checked){chkedNum++}}if(chkedNum>mutipleNum){winDialog.alert("最多只能选"+mutipleNum+"项！",{icon:"01"});self.checked=false}};_.isExpired=function(sDate){return sDate.replace(/(-)|\s/g,"")<getTimestamp("yyyy-MM-dd hh").replace(/(-)|\s/g,"")};_.getTimestamp=function(format){var currentTime=new Date;var thisYear=currentTime.getFullYear();var thisMonth=currentTime.getMonth()+1;thisMonth=thisMonth>9?thisMonth:"0"+thisMonth;var today=currentTime.getDate()>9?currentTime.getDate():"0"+currentTime.getDate();var hh=currentTime.getHours();var mm=currentTime.getMinutes()>9?currentTime.getMinutes():"0"+currentTime.getMinutes();var ss=currentTime.getSeconds()>9?currentTime.getSeconds():"0"+currentTime.getSeconds();return format.replace(/(y{2,4})/,thisYear).replace("MM",thisMonth).replace("dd",today).replace("hh",hh).replace("mm",mm).replace("ss",ss)};_.readyFun=function(){var uid;var isVoted=false;var _this=this;Lib.checkAuthor(function(){if($isLogin)uid=$UID;else uid="0";var mycookie=swfAPI.getC(uid);if(mycookie){var cookielist=mycookie.split("|");for(var i=0;i<cookielist.length;i++){var onecookie=cookielist[i];if(onecookie==scope.$articleid){isVoted=true;break}}}if(!isVoted){Core.Events.addEvent("voteBtn",function(){var items=$T($E("voteViewContent"),"input");var selectedItems=[];for(var i=0;i<items.length;i++){var item=items[i];if(item.checked&&item.name&&item.name=="chb1"){selectedItems.push(i+1)}}if(selectedItems.length<1){winDialog.alert("请选择要投票的项！",{icon:"01"});return false}Lib.checkAuthor(function(){if($isLogin)uid=$UID;else uid="0";function setFlashCookie(){try{var flashBar=Core.Dom.getElementsByClass($E("voter"),"div","vShape")[0];if(flashBar){flashBar.style.display=""}if(mycookie){if(cookielist.length>99){swfAPI.clearK(uid)}else mycookie=scope.$articleid+"|"+mycookie}else{mycookie=scope.$articleid}swfAPI.setC(uid,mycookie.toString())}catch(e){Debug.error("投票种flash cookie失败！错误原因："+e)}}_this.flag=true;var selectedLen=selectedItems.length;new Interface("http://control.blog.sina.com.cn/admin/vote/shot_vote.php?version=7","ijax").request({POST:{blog_id:scope.$articleid,vote_checklist:selectedItems.join(",")},onSuccess:function(res){setFlashCookie();try{var btn=Core.Dom.getElementsByClass(document,"div","vBtn")[0];Core.Dom.removeParentNode($E("voteBtn"));btn.innerHTML='<span class="voteState">已投票</span>';clearAllInterval()}catch(error){}window.vote_count.total+=1;var spans=Core.Dom.getElementsByClass($E("voteViewContent"),"span","");var tempArr=[];for(var m=0;m<selectedLen;m++){var item=selectedItems[m];window.vote_count.detail[item-1]+=1;tempArr.push(spans[item-1].innerHTML)}var newItem={};newItem.uid=$UID;var time=(new Date).getTime();time/=1e3;time=Math.ceil(time);newItem.time=time;newItem.vote=tempArr;var tempResult=window.vote_interface_result;var tempRArr=[];for(var i=0;i<tempResult.length;i++){tempRArr[i+1]=tempResult[i]}tempRArr[0]=newItem;window.vote_interface_result=tempRArr;renderVoteNum();initLoginBar()},onError:function(res){try{winDialog.alert($SYSMSG[res.code]);if(res.code=="B00902"){var btn=Core.Dom.getElementsByClass(document,"div","vBtn")[0];Core.Dom.removeParentNode($E("voteBtn"));btn.innerHTML='<span class="voteState">投票已截止</span>';var voteItems=$N("chb1");for(var i=0;i<voteItems.length;i++){voteItems[i].disabled=true;try{voteItems[i].parentNode.childNodes[3].style.cursor="default"}catch(error){}}var flashBar=Core.Dom.getElementsByClass($E("voter"),"div","vShape")[0];if(flashBar){flashBar.style.display=""}}else if(res.code=="B00904"){if(!isVoted){setFlashCookie()}var btn=Core.Dom.getElementsByClass(document,"div","vBtn")[0];Core.Dom.removeParentNode($E("voteBtn"));btn.innerHTML='<span class="voteState">已投票</span>';var voteItems=$N("chb1");for(var i=0;i<voteItems.length;i++){voteItems[i].disabled=true;try{voteItems[i].parentNode.childNodes[3].style.cursor="default"}catch(error){}}}}catch(error){}}})},"domEventreadyFun"+(new Date).getTime())},"click",false)}else{var btn=Core.Dom.getElementsByClass(document,"div","vBtn")[0];Core.Dom.removeParentNode($E("voteBtn"));btn.innerHTML='<span class="voteState">已投票</span>';var items=document.getElementsByName("chb1");for(var j=0;j<items.length;j++){items[j].disabled="true";try{if($IE){items[j].parentNode.childNodes[2].style.cursor="default"}else{items[j].parentNode.childNodes[3].style.cursor="default"}}catch(error){}}var flashBar=Core.Dom.getElementsByClass($E("voter"),"div","vShape")[0];if(flashBar){flashBar.style.display=""}}},"domEventreadyFun"+(new Date).getTime())};_.swfAPI={setC:function(key,value){$E("swfId").setC(key,value)},getC:function(key){return $E("swfId").getC(key)},clearK:function(key){$E("swfId").clearK(key)},clearC:function(){$E("swfId").clearC()}};_.insertList=function(oResult){function getLocTime(nS){var date=new Date(nS*1e3);return date.getFullYear()+"-"+(date.getMonth()+1<10?"0"+(date.getMonth()+1):date.getMonth()+1)+"-"+date.getDate()+" "+date.getHours()+":"+(date.getMinutes()<10?"0"+date.getMinutes():date.getMinutes())}var tpl='<li><span class="SG_dot"></span><span class="txt"><a target="_blank" href="#{url}">#{nick}</a>#{userV}&nbsp;<span class="SG_txtb">投票给 #{vote}</span><em class="SG_txtc">#{time}</em></span></li>';var list="";var getVHTML=Lib.blogv.getVHTML;if(this.vote_interface_result){for(var i=0;i<vote_interface_result.length;i++){var item=vote_interface_result[i];var html=tpl;html=html.replace("#{url}","http://blog.sina.com.cn/u/"+item["uid"]);html=html.replace("#{nick}",oResult[item["uid"]]);html=html.replace("#{userV}",getVHTML(item["wtype"]));html=html.replace("#{time}",getLocTime(item["time"]));var con="";for(var j=0;j<item["vote"].length;j++){con+='"'+item["vote"][j]+'" '}html=html.replace("#{vote}",con);list+=html;if(i==10){break}}if($E("voterlist")){$E("voterlist").innerHTML=list}}};_.initLoginBar=function(){Lib.checkAuthor(function(){if($E("vote_login_txt")){if($isLogin){$E("vote_login_txt").style.display="none"}else{$E("vote_login_txt").style.display="";$E("vote_login").onclick=function(){var trayLogin=new Lib.Login.Ui;trayLogin.login()}}}},"domEvent"+(new Date).getTime())};_.initNewVote=function(){Lib.checkAuthor();if($E("voteAD")){$E("voteAD").innerHTML='<a class="SG_linka"><img height="15" align="top" width="15" class="SG_icon SG_icon33" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" title="投票"></a>&nbsp;<a target="_blank" href="http://control.blog.sina.com.cn/admin/article/article_add.php#voteadd">发起新投票</a>&nbsp;&nbsp;&nbsp;<a class="SG_linka"><img height="18" align="top" width="18" title="" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon110"></a>&nbsp;<a href="#" id="shareVote">分享此投票</a>';$E("shareVote").onclick=function(){var title=encodeURIComponent("分享投票："+$T($E("voter"),"span")[0].innerHTML+"——来自"+scope.owenerNickName+"的博文："+Core.Dom.byClz(document.body,"h2","titName")[0].innerHTML||""),r="新浪-博客",l="http://blog.sina.com.cn",u="http://v.t.sina.com.cn/share/share.php?searchPic=false&title="+title+"&url="+encodeURIComponent(document.location)+"&source="+r+"&sourceUrl="+encodeURIComponent(l)+"&content=utf-8&appkey=1617465124";window.open(u,"mb","toolbar=0,status=0,resizable=1,width=440,height=430,left="+(screen.width-440)/2+",top="+(screen.height-430)/2);return false}}var morevotediv=$E("cc_morevote");if(!morevotediv){morevotediv=$C("div");morevotediv.id="cc_morevote";morevotediv.className="voteapp_btnMore";morevotediv.innerHTML='<a href="http://control.blog.sina.com.cn/blogprofile/profilevote.php?type=1" target="blank" title="查看更多投票">查看更多投票&gt;&gt;</a><img class="SG_icon SG_icon11" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="新" align="absmiddle" />';$E("voterlist").parentNode.parentNode.appendChild(morevotediv)}};_.renderVoteNum=function(){var uidList=[];var result=window.vote_interface_result;for(var i=0;i<result.length;i++){var item=result[i];uidList[uidList.length]=item["uid"]}Lib.Uic.getNickName(uidList,insertList);this.initNewVote();var temp=$E("chb1");if(temp!=null&&temp.type=="radio"){window.vote_rc_type="radio"}else{window.vote_rc_type="checkbox"}this.valueContents=Core.Dom.getElementsByClass($E("voter"),"div","num");var total=0;voteValues=[];var k;var counts=window.vote_count.detail;var total=window.vote_count.total;$E("total").innerHTML=total+"人";var totalTickets=0;for(var j=0;j<counts.length;j++){totalTickets+=counts[j]}for(k=0;k<valueContents.length;k++){var itemVote=counts[k];if(totalTickets==0){var percent="0%"}else{if(Math.round(itemVote/totalTickets*100)>100){var percent="100%"}else{var percent=Math.round(itemVote/totalTickets*100)+"%"}}voteValues.push(percent);valueContents[k].innerHTML=itemVote+'<span class="SG_txtc">('+percent+")</span>"}renderProgress(voteValues)};_.renderProgress=function(voteValues){window.itvIds=[];var i;var valueBars=Core.Dom.getElementsByAttr($E("voter"),"name","voteResult");var valueContents=Core.Dom.getElementsByClass($E("voter"),"div","num");var percentW=[];for(i=0;i<valueContents.length;i++){/\((.*)\)/.test(valueContents[i].innerHTML);percentW[i]=RegExp.$1}for(i=0;i<valueBars.length;i++){valueBars[i].className="color c"+(i+1);valueBars[i].style.fontSize="8px";valueBars[i].style.width="0px";window.itvIds[i]=window.setInterval(function(idx){return function(){if(parseInt(valueBars[idx].style.width)<parseInt(percentW[idx])){valueBars[idx].style.width=parseInt(valueBars[idx].style.width,10)+1+"%"}else{window.clearInterval(itvIds[idx])}}}(i),10)}if(!this.rf)_.rf=new RenderFlash};_.clearAllInterval=function(){if(window.itvIds){for(var i=0;i<window.itvIds.length;i++){window.clearInterval(itvIds[i])}}}}(window);var voteNums=15,_CFG_ASTATUS=articleEditorCFG.articleStatus;if(_CFG_ASTATUS=="7"){_CFG_ASTATUS="3"}inputListen=function(el,nLen,oOption){el=$E(el);if(typeof nLen!="undefined"){nLen=isNaN(nLen)?null:nLen*1}if(el==null||nLen==null||el.nodeType!=1){return false}oOption=oOption||{};var limitRe=oOption.limitRe;var doubleByte=oOption.doubleByte;doubleByte=doubleByte==null?true:doubleByte;var userinput=function(){try{var evt=Core.Events.getEvent();if(evt){var keyCode=evt.which||evt.keyCode;if(keyCode==37||keyCode==39){return false}}}catch(e){}var nLength=el.max;while(limitRe!=null&&limitRe.test(el.value)){el.value=el.value.replace(limitRe,"")}if(doubleByte==true){if(Core.String.byteLength(el.value)>nLength){var str=el.value.substr(0,nLength);while(Core.String.byteLength(str)>nLength){str=str.replace(/.$/,"")}el.value=str;el.maxLength=str.length}else{el.maxLength=nLength-el.value.replace(/[\x00-\xff]/g,"").length}}else{el.maxLength=nLength}if(nLength<el.value){el.value=el.value.substr(0,nLength)}};var Blur=function(){if(limitRe!=null&&limitRe.test(el.value)){el.value=el.value.replace(limitRe,"")}};el.max=nLen;el.maxLength=nLen;userinput();if(el.beWatched==null){el.beWatched=true;if(!$IE){Core.Events.addEvent(el,userinput,"input")}else{Core.Events.addEvent(el,userinput,"keyup")}Core.Events.addEvent(el,Blur,"blur")}};var Vote=function(vData){if(typeof window.vote_modify=="undefined")window.vote_modify=false;window.itemNum;this.state="edit";if(typeof vData!="undefined"){window.itemNum=vData.items.length}else window.itemNum=5;$E("addVote").innerHTML=voteDom["build"];if(typeof vData=="undefined"){this._build()}else{this._save(vData)}return this};Vote.prototype._build=function(vData){this.setBlogVote("yes");window.vote_modify=true;var items=$N("voteData[]");var itemLen=items.length;this._panel=$E("voteItems");var _this=this;inputListen($E("voteTitle"),50);Core.Events.addEvent($E("voteTitle"),function(){$E("voteTitle").value=Core.String.trim($E("voteTitle").value.replace(/(<|>|\\|\/|&|'|")/g,""))},"blur");$E("voteItems").innerHTML="";if(typeof vData=="undefined"){window.itemNum=5;for(var i=0;i<5;i++){this._addItem()}$E("newOne").onclick=function(){for(var i=0;i<5;i++){if(window.itemNum>voteNums-1)return false;
window.itemNum++;_this._addItem();if(window.itemNum>=voteNums)$E("newOne").style.display="none";_this.updateIndex()}return false};window.built=true;_this.initDate()}else{_this.setValue(vData);_this.setItems(vData);if((_CFG_ASTATUS=="2"||_CFG_ASTATUS=="3")&&!window.built){if(window.itemNum>=voteNums)$E("newOne").style.display="none";$E("newOne").onclick=function(){for(var i=0;i<5;i++){if(window.itemNum>voteNums-1)return false;window.itemNum++;_this._addItem();if(window.itemNum>=voteNums)$E("newOne").style.display="none";_this.updateIndex()}return false};window.built=true}}_this.updateIndex();$E("saveBtn").onclick=function(){if(Core.String.byteLength($E("voteTitle").value)==0){winDialog.alert($SYSMSG["B00909"],{icon:"01"});return false}if(Core.String.byteLength($E("voteTitle").value)<10){winDialog.alert($SYSMSG["B00905"],{icon:"01"});return false}var selectedDate=new Date($E("year").value,$E("month").value-1,$E("day").value,$E("hh").value,0,0);if(_this.expired(selectedDate,new Date)){winDialog.alert($SYSMSG["B00907"],{icon:"01"});return false}var _counter=0,_itemlist=[];for(var k=0;k<document.getElementsByName("voteData[]").length;k++){var item=document.getElementsByName("voteData[]")[k];if(item.value!=""){_itemlist.push(item.value);_counter++}}window.itemNum=_counter;if(_counter<2){winDialog.alert($SYSMSG["B00906"],{funcOk:function(){var inputs=$T($E("voteItems"),"input");for(var i=0;i<inputs.length;i++)if(inputs[i].value=="")inputs[i].focus()},icon:"01"});return false}var tempTitle=$E("voteTitle").value;trace(tempTitle+"----REPLACE TITLE TEMP");var et=$E("year").value+"-"+$E("month").value+"-"+$E("day").value+"-"+$E("hh").value;var vData={title:tempTitle,items:_itemlist,expireTime:et,type:$E("rad1").checked?1:$E("mutiple").value};_this.setBlogVote("yes");_this._save(vData);return false}};Vote.prototype.updateIndex=function(){if($E("chooseIndex")){var length=window.itemNum;var list="";for(var i=1;i<=length;i++){list+="<li>选项"+i+"</li>"}$E("chooseIndex").innerHTML=list}};Vote.prototype.initDate=function(){window.date=new DateSelector({dict:["year","month","day","hh"],to:"m-2",from:$E("timestamp").value})};Vote.prototype.setValue=function(vData){if(!window.vote_modify){window.vote_modify=true}$E("voteTitle").value=vData.title;if(_CFG_ASTATUS==2){$E("voteTitle").style.color="#999999"}var _t=vData["type"];if(_t>=2){$E("rad2").checked=true}else{$E("rad1").checked=true;$E("mutiple").style.display="none";$E("voteType").value=1}if(_CFG_ASTATUS=="2"&&articleEditorCFG.articlevData!=null){$E("voteTitle").readOnly="true";$E("voteTitle").readOnly="true";$E("voteTitle").style.backgroundAttachment="scroll";$E("voteTitle").style.backgroundColor="#E7E7E7";$E("voteTitle").style.backgroundImage="none";$E("voteTitle").style.backgroundPosition="0";$E("voteTitle").style.backgroundRepeat="repeat";$E("voteTitle").onkeydown=function(){if(event.keyCode==8)return false};$E("rad2").disabled=true;$E("rad1").disabled=true}if(_t>1){$E("mutiple").style.display="";$E("mutiple").options[_t-2].selected=true;if(_CFG_ASTATUS=="2")$E("mutiple").disabled=true;else if(_CFG_ASTATUS=="3")$E("mutiple").disabled=false;$E("voteType").value=$E("mutiple").value}if(_CFG_ASTATUS=="2"&&articleEditorCFG.articlevData!=null){var value=vData.votePos;if(value==1){$E("votePos1").checked=true;$E("votePos2").checked=false}else{$E("votePos1").checked=false;$E("votePos2").checked=true}}if(typeof date=="undefined"){window.date=new DateSelector({dict:["year","month","day","hh"],from:vData.startTime,to:"m-2"})}};Vote.prototype.setItems=function(vData){window.itemNum=vData.items.length;window.current=window.itemNum-1;if(window.itemNum<=5&&_CFG_ASTATUS==3){window.itemNum=5}for(var j=0;j<window.itemNum;j++){this._addItem(vData.items[j],"edit")}};Vote.prototype.toData=function(){var data={};var title=$E("voteTitle").value;if(!title||title==""){return null}data.title=title;var dateArray=[];dateArray.push($E("year").value);dateArray.push($E("month").value);dateArray.push($E("day").value);data.expireTime=dateArray.join("-")+" "+$E("hh").value;data.items=[];var itemsEle=$E("voteItems");var items=itemsEle.getElementsByTagName("input");var len=items.length;for(var i=0;i<len;i++){if(items[i].type=="text"){data.items.push(items[i].value)}}return data};Vote.prototype.compare=function(odata,eData){var eleData=eData||this.toData();if(window.vote_status!="new"){if(odata.expireTime==eleData.expireTime){if(odata.items.length==eleData.items.length){return true}}}return false};Vote.prototype.setBlogVote=function(value){var value=value||"yes";if($E("editorForm").blogVote){$E("editorForm").blogVote.value=value}};Vote.prototype.getBlogVote=function(){if($E("editorForm").blogVote){return $E("editorForm").blogVote.value}return false};Vote.prototype._addItem=function(itemValue,type){var lis=this._panel.getElementsByTagName("li");var _this=this;var oneItem=$C("li");this._panel.appendChild(oneItem);oneItem.innerHTML=voteDom["newItem"].format("delItem-"+parseInt(Math.random()*899999+1e5));var oneInput=oneItem.getElementsByTagName("input")[0];var oneDel=oneItem.getElementsByTagName("a")[0];inputListen(oneInput,40);if(typeof itemValue!="undefined"){oneInput.value=itemValue}if(type=="edit"){oneInput.style.color="#999999"}oneInput.onblur=function(){this.value=this.value.replace(/(<|>|\\|\/|&|'|")/gi,"")};if(_CFG_ASTATUS=="2"&&articleEditorCFG.articlevData!=null){var oldNum=articleEditorCFG.articlevData?articleEditorCFG.articlevData.items.length:2;trace("window.current "+window.current);if(typeof window.current=="undefined"){window.current=0}if(window.itemNum-window.current>oldNum){Core.Events.addEvent(oneDel,function(){if(window.itemNum<=2){return false}window.itemNum--;if(window.itemNum<voteNums){trace(window.itemNum);$E("newOne").style.display=""}Core.Dom.removeNode(this.parentNode);_this.updateIndex()}.bind2(oneDel),"click")}else{if(articleEditorCFG.articlevData!=null){oneInput.readOnly="true";oneInput.style.backgroundAttachment="scroll";oneInput.style.backgroundColor="#E7E7E7";oneInput.style.backgroundImage="none";oneInput.style.backgroundPosition="0";oneInput.style.backgroundRepeat="repeat";oneInput.onkeydown=function(){if(event.keyCode==8)return false};oneDel.style.display="none"}}window.current--}else{Core.Events.addEvent(oneDel,function(){if(window.itemNum<=2){try{this.parentNode.childNodes[0].value=""}catch(error){}return false}window.itemNum--;if(window.itemNum<voteNums){$E("newOne").style.display=""}Core.Dom.removeNode(this.parentNode);_this.updateIndex()}.bind2(oneDel),"click")}return false};Vote.prototype._save=function(vData){if(!window.vote_modify){trace("----ACCESS IN NOEDIT----");this.setBlogVote("noedit")}trace("393 rows:"+this.getBlogVote());$E("newStatus").style.display="none";$E("saveStatus").style.display="block";$E("saveStatus").innerHTML=voteDom["saveItem"].format("投票："+vData.title);var str=new Core.String.StringBuffer;trace(vData.items.length+"----ITEM SAVE");var tempData=[];for(var index=0;index<vData.items.length;index++){if(vData.items[index]!=""){tempData.push(vData.items[index])}}vData.items=[];vData.items=tempData;trace(vData.items.length+"----OPER LENGTH");if($E("newStatus").style.display!="none"&&$E("rad1").checked||vData.type<2){for(var j=0;j<vData.items.length;j++){if(j<2){str.append("<span><input type='radio' id='rdx_"+j+"' name='rdxs' disabled/>");str.append("<label for='rdx_"+j+"'>"+Core.String.leftB(vData.items[j],20)+(Core.String.byteLength(vData.items[j])>20?"...":"")+"</label>");str.append("</span>")}else{str.append("<span>");str.append("&nbsp;...");str.append("</span>");break}}}else{var mutipleNum=vData.type;for(var j=0;j<vData.items.length;j++){if(j<2){str.append("<span><input type='checkbox' id='rdx_"+j+"' name='rdxs' disabled/>");str.append("<label for='rdx_"+j+"'>"+Core.String.leftB(vData.items[j],20)+(vData.items[j].length>20?"...":"")+"</label>");str.append("</span>")}else{str.append("<span>");str.append("&nbsp;...");str.append("</span>");break}}}$E("voteArea").innerHTML=str.toString();this.state="saved";Core.Events.addEvent("editBtn",function(){this._edit(vData);if(window.itemNum<voteNums){$E("saveBtn").style.display=""}}.bind2(this),"click",false);var isBefore=false;if(articleEditorCFG.articlevData!=null){var tArr=articleEditorCFG.articlevData.expireTime.split(" ");var dateArr=tArr[0].split("-");var expireFlag=new Date(dateArr[0],parseInt(trimHeadZero(dateArr[1]))-1,dateArr[2],tArr[1],0,0);isBefore=this.expired(expireFlag,new Date)}if(_CFG_ASTATUS=="3"&&!window.built){trace("----FIRE EVENT----");Core.Events.fireEvent("editBtn","click")}else if(isBefore&&_CFG_ASTATUS!="3"){$E("editBtn").style.display="none";$E("vote_expired").innerHTML+="(已过期)"}return false};Vote.prototype._edit=function(vData){this.setBlogVote("yes");this.state="edit";$E("newStatus").style.display="";$E("saveStatus").style.display="none";if(articleEditorCFG.articlevData!=null){$E("voteId").value=1}if(typeof vData!="undefined")this._build(vData)};Vote.prototype.show=function(){if($E("addVote").style.display=="none")$E("addVote").style.display=""};Vote.prototype.expired=function(date1,date2){trace(date1+" "+date2);return date1.getTime()-date2.getTime()<0};window.changeType=function(flag){if(flag){$E("voteType").value=2;$E("mutiple").style.display="inline"}else{$E("voteType").value=1;$E("mutiple").style.display="none"}};window.removeVote=function(){winDialog.confirm("是否确定删除投票？",{funcOk:function(){if(articleEditorCFG.articleStatus.match(/(2|3)/g)){new Interface("http://control.blog.sina.com.cn/admin/vote/del_vote_from_article.php","ajax").request({POST:{blog_id:$E("blog_id").value},onSuccess:function(res){$E("editorForm").blogVote.value="no";window.vote_status="remove";$E("saveStatus").style.display="none";$E("newStatus").style.display="";articleEditorCFG.articlevData=null;window.insertVote=null},onError:function(res){winDialog.alert($SYSMSG[res.code],{icon:"01"})}})}else{$E("editorForm").blogVote.value="no";window.insertVote=null;window.vote_status="remove"}}.bind2(this),funcCancel:function(){editorTabs.showTab("vote")}.bind2(this),textOk:"是",textCancel:"否",defaultButton:1,title:"提示",icon:"03"},"insertVoteTip");var dia=winDialog.getDialog("insertVoteTip");var closeBtn=dia.getNodes().btnClose;Core.Events.addEvent(closeBtn,function(){editorTabs.showTab("vote")},"click")};window.showVote=function(){if($E("editorForm").blogVote){$E("editorForm").blogVote.value="yes"}};var Comment={};Comment.formatTime=function(time){var s=new Date;if(time){s.setTime(s)}var month=s.getMonth()+1>=10?s.getMonth()+1:"0"+(s.getMonth()+1);var date=s.getDate()>=10?s.getDate():"0"+s.getDate();var time=(new Date).toTimeString().split(" ")[0];var t=s.getFullYear()+"-"+month+"-"+date+" "+time;return t};$registJob("send_article_page_init",function(){var _CFG=articleEditorCFG;var _EditorCase=SinaEditor.get(0);function forbiddenArticleTips(){var sucdlg=winDialog.alert("新浪博客正在维护中。对由此给您造成的不便，深表歉意。",{funcOk:function(){},textOk:"确定",title:"提示",width:430,icon:"01"},"sendKillDialog");window.onbeforeunload=function(){}}function auditArticleTips(){var sucdlg=winDialog.alert("文明办网文明上网。请您不要发布淫秽色情等违法信息。<br/>您的博文已发布，稍后显示，请耐心等待。",{funcOk:function(){location.href="http://blog.sina.com.cn/u/"+scope.$uid},textOk:"确定",title:"提示",width:430,icon:"01"},"sendAuditDialog");window.onbeforeunload=function(){}}function serverErrorArticleTips(){var sucdlg=winDialog.alert("服务器临时遇见问题，发博文功能暂时不可用。工程师正在恢复中，请稍后再试。",{funcOk:function(){}.bind2(this),textOk:"确定",title:"提示",icon:"02"},"sendArticleProblemDialog")}var isPAP=0;function isPrivacyArticle(){return $E("xRankRadio").checked||$E("componentSelect").value==="0"}function privacyArticleCheck(cb){var itf=new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/points/check_vip.php","ajax");itf.request({POST:{type:4},onSuccess:function(data){isPAP=1;cb()},onError:function(result){if(result&&result.code=="A00001"){privacyArticleTips(cb)}},onFail:function(){}})}function privacyArticleTips(cb){var interfacePrivacy=new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/points/points_redeem.php","ajax");var sucdlg=winDialog.alert("你尚未开通私密博文功能!",{funcOk:function(){interfacePrivacy.request({POST:{user:scope.$uid||$UID,type:4},onSuccess:function(data){isPAP=1;cb()},onError:function(result){if(result&&result.code=="A00001"){winDialog.alert(result.data)}},onFail:function(){}})},textOk:"兑换并发表",subText:"私密博文一个月(30天)功能仅需30积分"},"privacyArticleDialog");window.onbeforeunload=function(){}}window.editor_Timer=0;if(_CFG.articleStatus!=1){if(_CFG.articleAssociateHistory&&_CFG.articleAssociateHistory.length>0){if(!window.articleAssociate){window.articleAssociate=new SinaEditor.newArticleAssociate("article_associate",_CFG.articleStatus)}window.articleAssociate.history(_CFG.articleAssociateHistory);window.articleAssociate.add()}var editor=SinaEditor.get(0);editor.ready(function(){if(window.editorPlaceHolder){window.editorPlaceHolder.hide()}var content=$E("SinaEditorTextarea")&&$E("SinaEditorTextarea").value;editor.setContent(content,true)})}var getFrameValue=function(FrameNode){var jsonStrList=FrameNode.contentWindow.document.body.innerHTML.match(/\{.*?\}/);var jsonStr="";if(jsonStrList&&jsonStrList.length){jsonStr=jsonStrList[0]}return Core.String.j2o(Core.String.trim(jsonStr))};var cIFM=function(sFrameName){if($E(sFrameName))Core.Dom.removeNode($E(sFrameName));Core.Dom.addHTML(document.body,"<iframe name='"+sFrameName+"' id='"+sFrameName+"' style='display: none;'></iframe>")};function tagFunc(FrameNode,oFunc){try{var frmJosn=getFrameValue(FrameNode);if(frmJosn==null)frmJosn={code:"A00001",data:[]};if(frmJosn.code!=null){if(oFunc){oFunc(frmJosn)}else{showError(frmJosn.code,{close:false})}}}catch(e){$E("articlePostBtn")&&($E("articlePostBtn").disabled=false);$E("articlePosTempBtn")&&($E("articlePosTempBtn").disabled=false);$E("articleTagAutoSub")&&($E("articleTagAutoSub").disabled=false)}}function getMediaTag(){var imgs=$E("editor").getElementsByTagName("img");var lens=imgs.length;var facepath="http://simg.sinajs.cn/blog/images/face/";var d_face="sina.com.cn/myshow/blog/misc/gif/";var worldcup="simg.sinajs.cn/blog7style/images/common/worldcup";var sg_trans="simg.sinajs.cn/blog7style/images/common/sg_trans.gif";var facepathlen=facepath.length;var isIMG=0;var isMedia=0;for(var i=0;i<lens&&isIMG==false;i++){if(imgs[i].src.indexOf(worldcup)==-1&&imgs[i].src.indexOf(d_face)==-1&&imgs[i].src.substr(0,facepathlen)!=facepath&&imgs[i].src!="http://simg.sinajs.cn/blog7style/images/common/editor/insetvideo.gif"&&imgs[i].src.indexOf(sg_trans)==-1){if(!imgs[i].getAttribute("type")&&imgs[i].getAttribute("type")!="face"){isIMG=1}}if(imgs[i].src=="http://simg.sinajs.cn/blog7style/images/common/editor/insetvideo.gif"){isMedia=1}}var objs=$E("editor").getElementsByTagName("object");if(objs.length>0)isMedia=1;var objs=$E("editor").getElementsByTagName("embed");if(objs.length>0)isMedia=1;return[isIMG,isMedia]}function checkMedia(){var checkValue=getMediaTag();$E("is_album").value=checkValue[0];if($E("is_media").value!="1"){$E("is_media").value=checkValue[1]}}function checkCateTag(){var tags=$E("article_tag_input")&&$E("article_tag_input").value,i=0,len,editorForm,hotTagNum;editorForm=$E("editorForm");if(!editorForm){return}tags=tags.split(" ");len=tags.length;var tag,sortitem,defaultFlag=false;hotTagNum=articleEditorCFG.articleAllTagList.hotTagNum;for(i;i<len;i++){tag=tags[i];if(hotTagNum[tag]&&!defaultFlag){sortitem=$C("input");sortitem.type="hidden";sortitem.name="sina_sort_id";sortitem.value=hotTagNum[tag];defaultFlag=true;break}}if(!defaultFlag){sortitem=$C("input");sortitem.type="hidden";sortitem.name="sina_sort_id";sortitem.value="117"}editorForm.appendChild(sortitem);return}function setSourceValue(){var editor=SinaEditor.get(0);var html=editor.getContent(null,false);var fixDiv=document.createElement("div");fixDiv.innerHTML=html;html=fixDiv.innerHTML;$E("SinaEditorTextarea").value=html;return html}$E("articlePreviewBtn").onclick=articlePreviewHandler;function articlePreviewHandler(e){v7sendLog("16_01_26");if($E("article_tag_input").value==_CFG.dftTagValue)$E("article_tag_input").value="";var html=setSourceValue();var isEmpty=_EditorCase.isEmptyContent();if(isEmpty){winDialog.alert("博文内容不能为空",{icon:"01"});return}if(window.articleAssociate){window.articleAssociate.saveSeleteData()}$E("editorForm").target="_blank";$E("editorForm").action=_CFG.articlePreviewURL;$E("editorForm").submit();return false}Core.Events.addEvent($E("articleSaveBtn"),tempArticleSave);function tempArticleSave(){v7sendLog("16_01_29");if(isPrivacyArticle()&&!isPAP){privacyArticleCheck(tempArticleSave);return}if(_EditorCase.editSaveing){return}var isEmpty=_EditorCase.isEmptyContent();if(isEmpty){winDialog.alert("博文内容不能为空",{icon:"01"});return}_EditorCase.editSaveing=true;cIFM("fileFrame");setSourceValue();checkMedia();checkCateTag();if(window.articleAssociate){window.articleAssociate.save()}$E("editorForm").target="fileFrame";$E("editorForm").action=_CFG.articlePostURL;if($E("article_tag_input").value==_CFG.dftTagValue)$E("article_tag_input").value="";var contentLen=$E("conlen");if(contentLen){contentLen.value=$E("SinaEditorTextarea").value.length}Core.Events.addEvent($E("fileFrame"),Core.Function.bind3(tagFunc,this,[$E("fileFrame"),function(frmJson){if(typeof frmJson.ycon_length!==undefined){var len=$E("SinaEditorTextarea").value.length;new Interface("http://control.blog.sina.com.cn/admin/article/ria_debug.php","jsload").request({GET:{type:"js_err_log",desc:"num_"+len+"_ynum_"+frmJson.ycon_length+"_hnum_"+frmJson.hcon_length+"_uid_"+scope.$uid+"_bid_"+frmJson.data},onSuccess:function(){},onError:function(){},onFail:function(){}})}_EditorCase.editSaveing=false;switch(frmJson.code){case"B00111":auditArticleTips();break;case"B00110":forbiddenArticleTips();break;case"B66666":serverErrorArticleTips();break;case"B06001":window.editor.editSaveing=true;$E("articleSaveBtn").disabled=true;window.onbeforeunload=function(){};setTimeout(function(){_EditorCase.editSaveing=false;$E("articleSaveBtn").disabled=false;location.href="http://blog.sina.com.cn/s/blog_"+frmJson.data+".html"},1e3);break;case"B02005":var sucdlg=winDialog.confirm($SYSMSG["B02005"],{funcOk:function(){var inp=$C("input");inp.id="feifa";inp.name="check";inp.value="no";inp.type="hidden";$E("editorForm").appendChild(inp);articlePostBtnFunc()},funcCancel:function(){var inp=$E("feifa");if(inp){$E("editorForm").removeChild(inp)}},textOk:"确定",textCancel:"取消",title:"提示",icon:"02"});break;case"A00004":(new Lib.Login.Ui).login(tempArticleSave,true);break;case"B00905":case"B00907":case"B00908":case"B00909":case"B00906":showError(frmJson.code);break;case"B06013":needSafeCode(frmJson);break;case"B06014":safeCodeErr(frmJson);break;default:showError(frmJson.code)}}]),"load");$E("editorForm").submit()}window.articlePosTempBtnFunc=function(){v7sendLog("16_01_27");if(_EditorCase.tempSaveing){return}var isEmpty=_EditorCase.isEmptyContent();if(isEmpty){winDialog.alert("博文内容不能为空",{icon:"01"});return}_EditorCase.tempSaveing=true;var tempBtn=$E("articlePosTempBtn");tempBtn.disabled=true;cIFM("fileFrame");setSourceValue();checkMedia();checkCateTag();if(window.articleAssociate){window.articleAssociate.save()}$E("editorForm").target="fileFrame";if(_CFG.articleStatus=="3"){$E("editorForm").action=_CFG.articleEditPostTempURL}else if(_CFG.articleStatus=="7"){$E("isTimed").value=7;$E("editorForm").action=_CFG.articleEditPostURL}else{$E("editorForm").action=_CFG.articlePostTempURL}if($E("article_tag_input").value==_CFG.dftTagValue)$E("article_tag_input").value="";var hiddenTip;if(arguments[0]&&arguments[0].hiddenTip){hiddenTip=arguments[0].hiddenTip}else{hiddenTip=function(){}}var callback;if(arguments[0]&&arguments[0].callback){callback=arguments[0].callback}else{callback=function(){showError("B06003")}}var contentLen=$E("conlen");if(contentLen){contentLen.value=$E("SinaEditorTextarea").value.length}Core.Events.addEvent($E("fileFrame"),Core.Function.bind3(tagFunc,this,[$E("fileFrame"),function(frmJson){if(typeof frmJson.ycon_length!==undefined){var len=$E("SinaEditorTextarea").value.length;new Interface("http://control.blog.sina.com.cn/admin/article/ria_debug.php","jsload").request({GET:{type:"js_err_log",desc:"num_"+len+"_ynum_"+frmJson.ycon_length+"_hnum_"+frmJson.hcon_length+"_uid_"+scope.$uid+"_bid_"+frmJson.data},onSuccess:function(){},onError:function(){},onFail:function(){}})}trace("新发保存草稿,返回状态码:=== "+frmJson.code);_EditorCase.tempSaveing=false;$E("articlePosTempBtn").disabled=false;hiddenTip();switch(frmJson.code){case"B06003":_CFG.articleStatus="3";$E("blog_id").value=frmJson.data;callback(frmJson.code);break;case"B06006":winDialog.alert("已保存到定时列表",{subText:"将于"+$E("date_pub").value+" "+$E("articleTime").value+"发布",funcOk:function(){window.onbeforeunload=function(){};window.location.href="http://control.blog.sina.com.cn/blog_rebuild/blog/controllers/articlelist.php?p=1&status=7&uid="+scope.$uid},funcClose:function(){window.onbeforeunload=function(){};window.location.href="http://control.blog.sina.com.cn/blog_rebuild/blog/controllers/articlelist.php?p=1&status=7&uid="+scope.$uid},icon:"03"});break;case"B06001":window.onbeforeunload=function(){};window.location.href="http://blog.sina.com.cn/s/blog_"+frmJson.data+".html";break;case"B40001":winDialog.alert("定时列表中文章数已达上限，请立即发布",{icon:"01"});break;case"B40002":winDialog.alert("此时间已被设置过定时发布，请您修改定时设置后再发布",{icon:"01"});break;case"B07003":winDialog.confirm($SYSMSG["B07003"],{ico:"03",btn:[{label:"是",focus:true,func:function(){articlePosTempBtnFunc()}},{label:"否"}]});break;case"A00004":(new Lib.Login.Ui).login(articlePosTempBtnFunc,true);break;case"B06013":needSafeCode(frmJson);break;case"B06014":safeCodeErr(frmJson);break;case"B00905":case"B00907":case"B00908":case"B00909":case"B00906":showError(frmJson.code);break;default:showError(frmJson.code);break}}]),"load");$E("editorForm").submit()};Core.Events.addEvent($E("articlePosTempBtn"),function(){var st=scope.$server_time,pt=scope.$pub_time;if(_CFG.articleStatus=="7"&&st&&pt&&st>pt){var tobj=Core.Date.getTimeObj(pt);winDialog.confirm("博文将立即发布",{subText:"发布时间："+tobj.yy+"-"+tobj.MM+"-"+tobj.dd+" "+tobj.hh+":"+tobj.mm+":"+tobj.ss,funcOk:function(){articlePosTempBtnFunc()},icon:"04"})}else{articlePosTempBtnFunc()}});window.articlePostBtnFunc=function(){v7sendLog("16_01_28");var isEmpty=_EditorCase.isEmptyContent();if(isEmpty){winDialog.alert("博文内容不能为空",{icon:"01"});return}if(_EditorCase.articleSaveing){return}_EditorCase.articleSaveing=true;$E("articlePostBtn").disabled=true;cIFM("fileFrame");setSourceValue();checkMedia();checkCateTag();var hiddenTip;if(arguments[0]&&arguments[0].hiddenTip){hiddenTip=arguments[0].hiddenTip}else{hiddenTip=function(){}}var callback;if(arguments[0]&&arguments[0].callback){callback=arguments[0].callback}else{callback=function(frmJson){var isPrivateBlog=scope.$private.isprivate=="1";var isPrivateArticle=$E("componentSelect").value==="0";var wl_internalState_cid;try{var wl_internalState=new Function("return "+decodeURIComponent(Utils.Cookie.getCookie("wl_internalState")))();wl_internalState_cid=wl_internalState.wl_cid}catch(e){}if(scope.$private.msnfeed&&parseInt(scope.$private.msnfeed)>=100){wl_internalState_cid=true}else{}if(wl_internalState_cid&&!isPrivateBlog&&!isPrivateArticle){new Interface("http://control.blog.sina.com.cn/riaapi/feed/msn_feed.php","jsload").request({GET:{uid:scope.$uid,title:encodeURIComponent($E("article_title").value),link:encodeURIComponent("http://blog.sina.com.cn/s/blog_"+frmJson.data+".html")},onSuccess:function(){}})}else{}var nomarlFuncOk=function(){setTimeout(function(){window.onbeforeunload=function(){};window.location.href="http://blog.sina.com.cn/s/blog_"+frmJson.data+".html"},1)};var blog365FuncOk=function(){winDialog.alert("感谢参加365活动",{funcOk:function(){nomarlFuncOk()},textOk:"确定",title:"提示",subText:'<a href="//control.blog.sina.com.cn/blog_rebuild/blog/controllers/setpage.php?uid='+scope.$uid+'&status=pageset" target="_blank">使用365专属配套博客模板</a>',icon:"03"})};var sucdlg=winDialog.alert("博文已发布成功",{funcOk:function(){if($E("article_tag_input")&&$E("article_tag_input").value.indexOf("365")>=0&&!Utils.Cookie.getCookie("blog365tpltips")){Utils.Cookie.setCookie("blog365tpltips","true",1*24*365);blog365FuncOk()}else{nomarlFuncOk()}},funcClose:function(){nomarlFuncOk()},textOk:"确定",title:"提示",subText:'<a href="http://control.blog.sina.com.cn/admin/article/changWeiBo.php?url='+encodeURIComponent("http://blog.sina.com.cn/s/blog_"+frmJson.data+".html")+'" target="_blank">去发一篇长微博</a>',icon:"03"},"sendArticleSucsessDialog")}}if(window.articleAssociate){window.articleAssociate.save()}$E("editorForm").target="fileFrame";if(_CFG.articleStatus=="3"){$E("editorForm").action=_CFG.articleEditPostURL}else if(_CFG.articleStatus=="7"){$E("isTimed").value=0;$E("immediatepub").value=1;$E("editorForm").action=_CFG.articleEditPostURL}else{$E("editorForm").action=_CFG.articlePostURL}if(!scope.$user_channel){if((new Date).valueOf()-editor_Timer<1e3*60){showError("B08001");$E("articlePostBtn").disabled=false;$E("articlePosTempBtn").disabled=false;_EditorCase.articleSaveing=false;hiddenTip();return false}}if($E("article_tag_input").value==_CFG.dftTagValue){$E("article_tag_input").value=""}var contentLen=$E("conlen");if(contentLen){contentLen.value=$E("SinaEditorTextarea").value.length}Core.Events.addEvent($E("fileFrame"),Core.Function.bind3(tagFunc,this,[$E("fileFrame"),function(frmJson){if(typeof frmJson.ycon_length!==undefined){var len=$E("SinaEditorTextarea").value.length;new Interface("http://control.blog.sina.com.cn/admin/article/ria_debug.php","jsload").request({GET:{type:"js_err_log",desc:"num_"+len+"_ynum_"+frmJson.ycon_length+"_hnum_"+frmJson.hcon_length+"_uid_"+scope.$uid+"_bid_"+frmJson.data},onSuccess:function(){},onError:function(){},onFail:function(){}})}_EditorCase.articleSaveing=false;$E("articlePostBtn").disabled=false;hiddenTip();switch(frmJson.code){case"B00111":auditArticleTips();break;case"B00110":forbiddenArticleTips();break;case"B66666":serverErrorArticleTips();break;case"B06006":winDialog.alert("博文已加入定时发布列表",{subText:"将于"+$E("date_pub").value+" "+$E("articleTime").value+"发布",funcOk:function(){window.onbeforeunload=function(){};window.location.href="http://control.blog.sina.com.cn/blog_rebuild/blog/controllers/articlelist.php?p=1&status=7&uid="+scope.$uid},funcClose:function(){window.onbeforeunload=function(){};window.location.href="http://control.blog.sina.com.cn/blog_rebuild/blog/controllers/articlelist.php?p=1&status=7&uid="+scope.$uid},icon:"03"});break;case"B40001":winDialog.alert("定时列表中文章数已达上限，请立即发布",{icon:"01"});break;case"B40002":winDialog.alert("此时间已被设置过定时发布，请您修改定时设置后再发布",{icon:"01"});break;case"B07006":var sucdlg=winDialog.alert("您所发表的相似内容过多，请稍后再试~",{textOk:"确定",title:"提示",icon:"03"},"sendArticleSucsessDialog");break;case"B06001":editor_Timer=(new Date).valueOf();succ_code="B06001";callback(frmJson);break;case"B02005":var sucdlg=winDialog.confirm($SYSMSG["B02005"],{funcOk:function(){var inp=$C("input");inp.id="feifa";inp.name="check";inp.value="no";inp.type="hidden";$E("editorForm").appendChild(inp);articlePostBtnFunc()},funcCancel:function(){var inp=$E("feifa");if(inp){$E("editorForm").removeChild(inp)}},textOk:"确定",textCancel:"取消",title:"提示",icon:"02"});break;case"B06002":if((new Date).valueOf()-editor_Timer<1e3*60){showError("B08001");return}editor_Timer=(new Date).valueOf();showError(frmJson.code);break;case"B06004":if((new Date).valueOf()-editor_Timer<1e3*60){showError("B08001");return}editor_Timer=(new Date).valueOf();showError(frmJson.code);break;case"B06011":sendContextToKfc(frmJson);break;case"B06013":needSafeCode(frmJson);break;case"B06014":safeCodeErr(frmJson);break;case"B07001":winDialog.confirm($SYSMSG["B07001"],{ico:"03",btn:[{label:"是",focus:true,func:function(){articlePostBtnFunc();$E("editorForm").submit()}},{label:"否"}],close:false});break;case"A00004":(new Lib.Login.Ui).login(articlePostBtnFunc,true);break;case"B00905":case"B00907":case"B00908":case"B00909":case"B00906":showError(frmJson.code);break;default:showError(frmJson.code);break}}]),"load");$E("editorForm").submit()};Core.Events.addEvent($E("articlePostBtn"),window.articlePostBtnFunc);function safeCodeErr(frmJson){scope.xssSafeCodeDiag.hidden();winDialog.alert("验证码错误，请重新输入。",{textOk:"确定",icon:"01",funcOk:function(){needSafeCode()},funcClose:function(){needSafeCode()}})}function needSafeCode(frmJson){scope.xssSafeCodeDiag.show();scope.xssSafeCodeDiag.setMiddle();scope.xssSafeCodeDiag.changeSafeCode()}});$registJob("newEditorGuideLayer",function(){var noCookie=Utils.Cookie.getCookie("new_editor_guide_"+scope.$uid)!=1;if(noCookie&&articleEditorCFG&&articleEditorCFG.articleStatus==1){var articleTitle=$E("article_title");if(articleTitle){articleTitle.style.visibility="hidden";var pNode=articleTitle.parentNode;var spanTit=pNode.children[0];spanTit&&(spanTit.style.visibility="hidden")}var editor=$E("editor");if(editor){var pNode=editor.parentNode;var spanEdt=pNode.children[0];pNode.style.height="700px";spanEdt&&(spanEdt.style.visibility="hidden")}var myPanel=new Ui.Panel,template='<div id=#{container} class="guide_img"><a id="#{close}" href="javascript:void(0);" class="guide_btn" title="关闭"></a></div>';var myShadow=new BackShadow(.6);myPanel.setTemplate('<div id="#{panel}">'+template+"</div>");myPanel.entity.style.zIndex=1025;myPanel.entity.style.marginLeft="-500px";myPanel.entity.style.width="1000px";var img=new Image;img.onload=function(){myPanel.nodes.container.insertBefore(img,myPanel.nodes.close);myShadow.show();myPanel.show();myPanel.entity.style.left="50%";myPanel.entity.style.top="52px";if(myPanel.nodes.close){Core.Events.addEvent(myPanel.nodes.close,function(){pNode.style.height="";myPanel.hidden();myShadow.hidden();articleTitle&&(articleTitle.style.visibility="visible");spanTit&&(spanTit.style.visibility="visible");spanEdt&&(spanEdt.style.visibility="visible");Utils.Cookie.setCookie("new_editor_guide_"+scope.$uid,1,24*365*5);return false})}};if($IE6){img.src="http://simg.sinajs.cn/blog7style/images/blog_editor/guide_img.gif"}else{img.src="http://simg.sinajs.cn/blog7style/images/blog_editor/guide_img.png"}}});Lib.register("Listener",function(){var _this={};_this.listeners={};return{add:function(name){if(_this.listeners[name]){throw new Error("listener '"+name+"' has registed!")}_this.listeners[name]=[]},remove:function(name){if(_this.listeners[name]){_this.listeners[name]=null;return true}return false},notify:function(name,data){var listeners=_this.listeners[name],handle=null;if(!listeners){return}for(var i=0,len=listeners.length;i<len;i++){handle=listeners[i];handle.callBack.call(handle.scope,data)}},on:function(o){var args=arguments,handle=null;for(var i=0,len=args.length;i<len;i++){handle=args[i];if(!this.isListen(handle)){if(!_this.listeners[handle.name]){_this.listeners[handle.name]=[]}_this.listeners[handle.name].push(handle)}}},off:function(o){var handlers=_this.listeners[o.name];if(!handlers){return true}var handle=null;for(var i=0,len=handlers.length;i<len;i++){handle=handlers[i];if(handle.callBack==o.callBack&&handle.scope==o.scope){handlers.splice(i,1)}}},isListen:function(listener){var handlers=_this.listeners[listener.name];var handle=null;if(!handlers){return false}for(var i=0,len=handlers.length;i<len;i++){handle=handlers[i];if(handle.callBack==listener.callBack&&handle.scope==listener.scope){return true}}return false}}});$registJob("adNoticeChannel",function(){var __addEvent=Core.Events.addEvent;var listener=Lib.Listener,pageId=scope.$pageid;var istj=window.location.href.indexOf("tj=1")>-1;var refer=document.referrer;if(refer){var host=refer.match(/(\:\/\/)(.*?)(\/)/g);refer=host&&host[0].replace(/(\:\/\/){0,}(\/){0,}/g,"")}else{refer=""}Lib.checkAuthor(function(){var url="http://comet.blog.sina.com.cn/api?maintype=load_channel";Utils.Io.JsLoad.request(url,{GET:{uid:$UID,bloguid:scope.$uid,refer:refer},onComplete:function(result){if(result&&result.code==="A00006"){scope.$channel=result.data;if(pageId=="article_new"||pageId=="articleM_new"||pageId==="article"||pageId==="articleM"||pageId==="index"||pageId==="indexM"||pageId==="articlelist"||pageId==="articlelistM"||pageId==="wanwan_index"||pageId==="articlepreview_new"){listener.notify("notice_ad_layer",scope.$channel||{})
}listener.notify("ad_show_hide_conditions",scope.$channel||{})}}})},"adNoticeChannel"+(new Date).getTime())});Utils.insertTemplate=function(el,template,where){var ids=[],nodes={},idreg=/#{(\w+)}/g,rndNum="_"+(new Date).getTime().toString().slice(-5)+Math.floor(Math.random()*1e5);template=template.replace(idreg,function(match,id){ids.push(id);return id+rndNum});Core.Dom.insertHTML(el,template,where);for(var i=ids.length,id;i--;){id=ids[i];nodes[id]=$E(id+rndNum)}return nodes};Utils.Io.loadExternalCSS=function(url,callback){if(typeof url!=="string"){return}var linkObj,styleObj,head=document.getElementsByTagName("head")[0];if($FF){styleObj=$C("style");styleObj.type="text/css";styleObj.innerHTML="@import url("+url+")";head.appendChild(styleObj);!function(){try{styleObj.sheet.cssRules;typeof callback==="function"&&callback()}catch(e){setTimeout(arguments.callee,50)}}()}else{linkObj=$C("link");linkObj.href=url;linkObj.type="text/css";linkObj.rel="stylesheet";linkObj.media="all";head.appendChild(linkObj);if($SAFARI||$CHROME){!function(){try{linkObj.sheet.cssRules;typeof callback==="function"&&callback()}catch(e){setTimeout(arguments.callee,50)}}()}else{linkObj.onload=function(){linkObj.onload=null;typeof callback==="function"&&callback()}}}};$registJob("blogNotice",function(){var $logo=$E("login_bar_logo_link_350");var __addEvent=Core.Events.addEvent,__removeEvent=Core.Events.removeEvent,__setCookie=Utils.Cookie.setCookie,__getCookie=Utils.Cookie.getCookie,_setStyle=Core.Dom.setStyle,listener=Lib.Listener,logFlag,showFlag;var flagUid=__getCookie("closeNotice_fzp");Lib.checkAuthor(function(){if(flagUid&&flagUid===$UID){return}var pageid=scope.$pageid,uid=scope.$uid,isTj=window.location.href.indexOf("tj=1")>-1;if($logo&&"ntopbar_main"===$logo.parentNode.className){listener.on({name:"notice_ad_layer",callBack:function(json){listener.notify("tray-announce-loaed",json)}});return}else{var _guide;var dd=document.documentElement;var template={guideLayer:'<div class="l_hornbg" id="#{guideLayer}" style="display:none;">'+'<div class="l_horn">'+'<span class="close" title="关闭" id="#{close}">&times;</span>'+'<div class="horn1" id="#{noticeLayer}" style="display:none;">'+'<div class="horn_left">'+'<span class="horn_icon" id="#{noticeIcon}"></span>'+"</div>"+'<div class="horn_right" id="#{noticeAdLayer}">推荐：'+'<a href="" target="blank" id="#{noticeAdCon1}" onclick="v7sendLog(\'48_01_12\');"></a>'+'<a href="" target="blank" id="#{noticeAdCon2}" onclick="v7sendLog(\'48_01_13\');"></a>'+"</div>"+"</div>"+'<div class="horn2" id="#{adLayer}">推荐：'+'<a href="" target="blank" id="#{adContent1}" onclick="v7sendLog(\'48_01_12\');"></a>'+'<a href="" target="blank" id="#{adContent2}" onclick="v7sendLog(\'48_01_13\');"></a>'+"</div>"+"</div>"+"</div>"};var option={mid:{"z-index":"500",position:$IE6?"absolute":"fixed"}};var noticeCSSUrl=$_GLOBAL.cssBasicURL+"module/layer/layer24.css";Utils.Io.loadExternalCSS(noticeCSSUrl);var loadNoticeLayer=function(json){_guide=Utils.insertTemplate($E("sinabloga"),template.guideLayer,"BeforeBegin");setMiddle(_guide.guideLayer);if($IE6){_guide.guideLayer.style.position="absolute";dd.style.backgroundImage="url(ablout:blank)";dd.style.backgroundAttachment="fixed";__addEvent(window,ie6Fixed,"scroll")}__addEvent(window,funcShowNotice,"scroll");showNoticeTpl(json)};listener.on({name:"notice_ad_layer",callBack:loadNoticeLayer});function showNoticeTpl(result){if($isLogin&&result.announce.result&&(pageid==="indexM"||pageid==="articleM"||pageid==="articlelistM")){_guide.noticeLayer.style.display="";_guide.adLayer.style.display="none";var info=result.announce;Core.Dom.insertHTML(_guide.noticeIcon,info.announce_con,"AfterEnd")}else{_guide.adLayer.style.display=""}if(result.advertise){var adInfo=result.advertise;var adCon1=decodeURIComponent(adInfo.advertise_con1.content),adCon2=decodeURIComponent(adInfo.advertise_con2.content),adHref1=decodeURIComponent(adInfo.advertise_con1.link),adHref2=decodeURIComponent(adInfo.advertise_con2.link);_guide.noticeAdCon1.innerHTML=adCon1;_guide.noticeAdCon1.href=adHref1;_guide.noticeAdCon2.innerHTML=adCon2;_guide.noticeAdCon2.href=adHref2;_guide.adContent1.innerHTML=adCon1;_guide.adContent1.href=adHref1;_guide.adContent2.innerHTML=adCon2;_guide.adContent2.href=adHref2;if(_guide.close){__addEvent(_guide.close,function(){__setCookie("closeNotice_fzp",$UID,24,"/",".blog.sina.com.cn");delNoticeLayer()})}}}function funcShowNotice(){var scrolltop=document.body.scrollTop+document.documentElement.scrollTop;if(scrolltop>height){showNoticeLayer(_guide.guideLayer);if(!$IE6){_guide.guideLayer.style.top="0"}if(!logFlag){logFlag=1;v7sendLog("48_01_11_"+scope.$pageid)}}else{hideNoticeLayer(_guide.guideLayer)}}function delNoticeLayer(){Core.Dom.removeNode(_guide.guideLayer);__removeEvent(window,funcShowNotice,"scroll");__removeEvent(window,ie6Fixed,"scroll");scope.$channel=null}function setMiddle(obj){Core.Dom.setStyle2(obj,option.mid)}function ie6Fixed(){_guide.guideLayer.style.top=document.documentElement.scrollTop+"px";_guide.guideLayer.style.left=0+"px"}function showNoticeLayer(el){if(!showFlag){showFlag=1;var tween=new Ui.TweenStrategy(0,1,.6,function(t,b,c,d){return-c*(t/=d)*(t-2)+b});tween.onTween=function(val){_setStyle(el,"opacity",val)};tween.onEnd=function(){if(!$IE){_setStyle(el,"opacity","none")}else{el.style.filter="none"}};_setStyle(el,"opacity",0);el.style.display="block";tween.start()}}function hideNoticeLayer(el){if(showFlag){showFlag=0;var tween=new Ui.TweenStrategy(1,0,.6,function(t,b,c,d){return-c*(t/=d)*(t-2)+b});tween.onTween=function(val){_setStyle(el,"opacity",val)};tween.onEnd=function(){if(!$IE){_setStyle(el,"opacity","none")}else{el.style.filter="none"}el.style.display="none"};tween.start()}}}},"blogNotice"+(new Date).getTime())});Lib.HtmlTemplate=function(tmpl,uniqueID){this.uniqueID=uniqueID}.$extends(Ui.Template).$define({getHtmlString:function(){if(!this._htmlStr){this._htmlStr=this.evaluate(this.getNodeIds())}return this._htmlStr},getNodeIds:function(){if(!this._nodes){var p=/\{[^\}]+(?=\})/g,i,nodes={},rets,r,uniqueID=this._getUniqueID();this.__templateNodesIDs=this.tmpl.match(p);rets=this.__templateNodesIDs;if(rets){i=rets.length;while(i--){r=rets[i].replace("{","");nodes[r]="_"+uniqueID+"_"+r}}this._nodes=nodes}return this._nodes},getNodeId:function(name){if(!this._nodes){this.getNodeIds()}return this._nodes[name]},getNode:function(name){var id=this.getNodeId(name);return!id?null:$E(id)},_getUniqueID:function(){if(!this.uniqueID){this.uniqueID=parseInt(Math.random()*1e3).toString()+(new Date).getTime().toString()}return this.uniqueID}});Lib.Panel=Core.Class.create();Lib.Panel.prototype={noIframe:!1,isPostion:!0,appendTo:null,entity:null,backIframe:null,uniqueID:null,isFixed:false,isShow:!1,isHidden:!0,x:0,y:0,template:"",initialize:function(cfg){Lib.apply(this,cfg);var _this=this;this.uniqueID=this._getUniqueID();this._ie6Fixed=function(){if(_this.entity){_this.entity.style.left=document.documentElement.scrollLeft+_this.x+"px";_this.entity.style.top=document.documentElement.scrollTop+_this.y+"px"}if(_this.backIframe){_this.backIframe.style.left=_this.entity.style.left;_this.backIframe.style.top=_this.entity.style.top}}},getNode:function(name){return this.tpl.getNode(name)},setTemplate:function(template){this.template=template;if(this.entity&&this.entity.parentNode){this.entity.parentNode.removeChild(this.entity);this.backIframe&&this.backIframe.parentNode.removeChild(this.backIframe)}this.entity=$C("div");var tempEntity=$C("div");var tmp=new Lib.HtmlTemplate(this.template,this.uniqueID);this.tpl=tmp;tempEntity.innerHTML=tmp.getHtmlString();tempEntity.style.display="none";if(this.appendTo){$E(this.appendTo).appendChild(tempEntity)}else{document.body.appendChild(tempEntity)}this.entity=$E("_"+this.uniqueID+"_panel");if(this.isPostion){this.entity.style.position="absolute"}this.entity.style.display="none";if(this.appendTo){$E(this.appendTo).replaceChild(this.entity,tempEntity)}else{document.body.replaceChild(this.entity,tempEntity)}tempEntity=null;if(!this.noIframe){this.backIframe=$C("iframe");this.backIframe.style.display="none";this.backIframe.style.border="none";this.backIframe.style.zIndex=this.entity.style.zIndex-1;document.body.appendChild(this.backIframe);this._updateBackIframe()}},setPosition:function(x,y){this.x=x;this.y=y;this.entity.style.left=x+"px";this.entity.style.top=y+"px";if($IE6&&this.isFixed){this.entity.style.left=x+document.documentElement.scrollLeft+"px";this.entity.style.top=y+document.documentElement.scrollTop+"px"}if(this.backIframe){this.backIframe.style.left=this.entity.style.left;this.backIframe.style.top=this.entity.style.top}},setFixed:function(state){this.isFixed=state;if($IE6){var _this=this;this.entity.style.position="absolute";if(this.isFixed){_this._ie6Fixed();Core.Events.addEvent(window,_this._ie6Fixed,"scroll")}else{Core.Events.removeEvent(window,_this._ie6Fixed,"scroll")}return}this.entity.style.position=this.isFixed?"fixed":"absolute";if(this.backIframe){this.backIframe.style.position=this.entity.style.position}},show:function(){this.entity.style.display="";this.isHidden=!1;this.isShow=!0;if(this.backIframe){this._updateBackIframe();this.backIframe.style.display=""}},hidden:function(){this.hide()},hide:function(){this.entity.style.display="none";this.isHidden=!0;this.isShow=!1;if(this.backIframe){this.backIframe.style.display="none"}},close:function(){this.hidden();this.destroy()},destroy:function(){Core.Events.removeEvent(window,this._ie6Fixed,"scroll");this.entity.parentNode.removeChild(this.entity);this.entity=null;if(this.backIframe){this.backIframe.parentNode.removeChild(this.backIframe);this.backIframe=null}},showWithDom:function(dom,offsetLeft,offsetTop){var x=Core.Dom.getLeft(dom)+dom.offsetWidth+offsetLeft;var y=Core.Dom.getTop(dom)+dom.offsetHeight+offsetTop;if($IE6&&this.isFixed){x=x-document.documentElement.scrollLeft;y=y-document.documentElement.scrollTop}this.setPosition(x,y);this.show()},getWidth:function(){var ld=this.entity.style.display;var lv=this.entity.style.visibility;this.entity.style.visibility="hidden";this.entity.style.display="";w=this.entity.offsetWidth;this.entity.style.display=ld;this.entity.style.visibility=lv;return w},getHeight:function(){var ld=this.entity.style.display;var lv=this.entity.style.visibility;this.entity.style.visibility="hidden";this.entity.style.display="";h=this.entity.offsetHeight;this.entity.style.display=ld;this.entity.style.visibility=lv;return h},getX:function(){return parseInt(this.entity.style.left)},getY:function(){return parseInt(this.entity.style.top)},getNodes:function(mode){var m=mode||"o";var pattern=/[^\{\}]+(?=\})/g;var i;var nodes={};var result=this.template.match(pattern);if(result){for(i=0;i<result.length;i++){var r=result[i];switch(m){case"o":nodes[r]=$E("_"+this.uniqueID+"_"+r);break;case"i":nodes[r]="_"+this.uniqueID+"_"+r;break}}}return nodes},_updateBackIframe:function(){Core.Dom.setStyle(this.backIframe,"opacity",0);this.backIframe.style.display="";this.backIframe.style.position=this.entity.style.position;this.backIframe.style.width=this.entity.offsetWidth+"px";this.backIframe.style.height=this.entity.offsetHeight+"px";this.backIframe.style.left=this.entity.style.left;this.backIframe.style.top=this.entity.style.top},_getUniqueID:function(){return parseInt(Math.random()*1e3).toString()+(new Date).getTime().toString()}};Lib.register("util.JSON",function(lib){var json=function(wnd,undefined){if(wnd.JSON)return wnd.JSON;var json={parse:function(sJSON){return new Function("return "+sJSON)()},stringify:function(vContent){if(vContent instanceof Object){var sOutput="";if(vContent.constructor===Array){for(var nId=0;nId<vContent.length;sOutput+=this.stringify(vContent[nId])+",",nId++);return"["+sOutput.substr(0,sOutput.length-1)+"]"}if(vContent.toString!==Object.prototype.toString){return'"'+vContent.toString().replace(/"/g,"\\$&")+'"'}for(var sProp in vContent){sOutput+='"'+sProp.replace(/"/g,"\\$&")+'":'+this.stringify(vContent[sProp])+","}return"{"+sOutput.substr(0,sOutput.length-1)+"}"}return typeof vContent==="string"?'"'+vContent.replace(/"/g,"\\$&")+'"':String(vContent)}};return json}(window);return json});Lib.register("tray.tpl.loginMemu",function(){var tpl=['<div class="ntopbar_menu" id="#{panel}">','<div id="#{openBlog}" style="display:none;">','<span class="link"><a href="http://www.sina.com.cn" target="_blank" suda-uatrack="key=sinahome_from_blog&value=sinahome_from_blogpage"><i class="SG_bkhome"></i>新浪首页</a></span>','<span class="link" id="#{userMenu}"><a id="#{userNick}" onclick="v7sendLog(\'40_01_21\');return false;" href="###">读取中...</a><a href="javascript:;" class="link_arrow" title=""></a></span>','<span id="#{msnHolder}" class="ico_msn" style="display:none"><a id="#{msnLink}" href="http://control.blog.sina.com.cn/blogprofile/msnbind.php?c=" target="_blank"><img height="18" width="18" align="absmiddle" class="SG_icon SG_icon136" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif"></a></span>','<span class="line_s"></span>','<span class="link"><a onclick="v7sendLog(\'40_01_27\')" href="http://i.blog.sina.com.cn/blogprofile/index.php?com=1">个人中心</a></span>','<span class="line_s"></span>','<em id="#{newFeed}" class="mtip" style="left:341px;display:none;cursor:pointer;"></em>','<span class="link" id="#{blogMenu}"><a target="_blank" onclick="v7sendLog(\'40_01_24\')" href="http://control.blog.sina.com.cn/admin/article/article_add.php">发博文</a><a id="#{addArticle}" onclick="v7sendLog(\'40_01_25\');return false;" href="###" class="link_arrow"></a></span>','<span class="line_s"></span>','<span class="link" id="#{trayMsg}" msg-panel-show-state="0"><a onclick="v7sendLog(\'40_01_30\');return false;" href="###">消息</a><a href="javascript:return false;" class="link_arrow" title=""></a></span>','<em id="#{newTips}" onclick="v7sendLog(\'40_01_29\')" class="mtip" style="left:341px;display:none;cursor:pointer;"></em>',"</div>",'<div id="#{noOpenBlog}" style="display:none;">','<span class="link"><a id="#{ssoNick}" onclick="v7sendLog(\'40_01_40\');return false;" href="###">读取中...</a></span>','<span class="line_s"></span>','<span class="link"><a id="#{ssoLoginOut}" onclick="v7sendLog(\'40_01_41\');return false;" href="###">退出</a></span>','<div class="ntopbar_login" style="float:left;"><a id="#{openBlogBtn}" onclick="v7sendLog(\'40_01_42\')" class="login" href="###"><span>立即拥有一个新博客</span></a></div>',"</div>","</div>"].join("");return tpl});Lib.register("tray.tpl.loginOutMemu",function(){var uid=scope.$uid||"";var regLink="https://login.sina.com.cn/signup/signupmail.php?entry=blog&srcuid="+uid+"&src=";if(scope.$channel==2){regLink+="baby"}else{regLink+="blogicp"}var tpl=['<div id="#{panel}" class="ntopbar_login">','<span class="link bk_home"><a href="http://www.sina.com.cn" target="_blank" suda-uatrack="key=sinahome_from_blog&value=sinahome_from_blogpage"><i class="SG_bkhome"></i>新浪首页</a></span>','<a class="login" onclick="v7sendLog(\'40_01_38\');return false;" href="###" action-type="tray-login-btn"><span>登录</span></a>','<a class="register" onclick="v7sendLog(\'40_01_39\')" target="_blank" href="',regLink,'">注册</a></div>'].join("");return tpl});Core.Class.define=function(init,superClz,methods){if(init&&init.__isClass&&init.__isClass()){throw new Error("class cnt be used as another class' constructor : "+init)}superClz=superClz||Object;methods=methods||{};methods.initialize=init||methods.initialize||superClz.prototype.initialize||function(){};if(typeof methods.initialize!="function"){throw new Error("only function can be used as constructor")}methods.__isClass=function(){return true};var clz=Core.Class.create();clz.__isClass=methods.__isClass;var proto=superClz==Object?{}:new superClz(Core.Class.AsPrototype);clz.prototype=Core.Class.extend(proto,methods);return clz};Lib.register("tray.tpl.userMenu",function(){var tpl=['<div id="#{panel}" class="mUserMenu">',"<ul>","<li>",'<span class="tb_ps_nm"><a id="#{linkBlog}" onclick="v7sendLog(\'40_01_22\')" href="###"><img class="SG_icon SG_icon15" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="博客" align="absmiddle">博客</a></span>','<span class="rlink"><a target="_blank" onclick="v7sendLog(\'40_01_22\')" id="#{linkPostBlog}" href="http://control.blog.sina.com.cn/admin/article/article_add.php">发博文</a></span>',"</li>",'<li> <span class="tb_ps_nm"><a id="#{linkPhoto}" onclick="v7sendLog(\'40_01_22\')" href="###"><img class="SG_icon SG_icon18" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="相册" align="absmiddle">相册</a></span> <span class="rlink"><a target="_blank" id="#{linkPostPhoto}" onclick="v7sendLog(\'40_01_22\')" href="http://photo.blog.sina.com.cn/upload/upload.php">发图片</a></span> </li>','<li> <span class="tb_ps_nm"><a id="#{miniblog}" onclick="v7sendLog(\'40_01_22\')" href="###" target="_blank"><img class="SG_icon SG_icon110" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="17" title="微博" align="absmiddle">微博</a></span> </li>','<li style="display:none;" id="#{mail}"> <span class="tb_ps_nm"><a id="#{bindEmail}" target="_blank" href="http://mail.sina.com.cn/?s=2" onclick="v7sendLog(\'40_01_22\')"><img class="SG_icon SG_icon212" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="13" title="邮件" align="absmiddle">邮件</a></span> </li>','<li> <span class="tb_ps_nm"><a id="#{mySpace}" onclick="v7sendLog(\'40_01_22\')" href="###"><img class="SG_icon SG_icon41" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="关于我" align="absmiddle">关于我</a></span> </li>',"</ul>",'<div class="links">','<p><a target="_blank" id="#{linkChangeFace}" onclick="v7sendLog(\'40_01_22\')" href="###">修改头像昵称&gt;&gt;</a></p>','<p><a target="_blank" id="#{linkChangePassword}" onclick="v7sendLog(\'40_01_22\')" href="###">修改登录密码&gt;&gt;</a></p>','<p><a target="_blank" id="#{linkAccountSetup}" onclick="v7sendLog(\'40_01_22\')" href="###">帐号安全设置&gt;&gt;</a></p>','<p><a id="#{loginOut}" onclick="v7sendLog(\'40_01_23\');return false;" href="#">退出&gt;&gt;</a></p>',"</div>","</div>"].join("");return tpl});Lib.register("tray.loginOut",function(lib){var ls=lib.Listener;return function(cb,reload){var _curHref=encodeURIComponent(window.location.href);var res={code:"A00006",data:""};ls.notify("global-login-out",res);cb&&cb(res);if(reload){window.location.href="https://login.sina.com.cn/cgi/login/logout.php?r="+_curHref}}});Lib.register("tray.UserMenuPanel",function(lib){var userMenu=Core.Class.define(function(){lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(lib.tray.tpl.userMenu)},lib.Panel,{initUserInfo:function(uid){var nodes=this.getNodes();nodes["linkBlog"].href="http://blog.sina.com.cn/u/"+uid;nodes["linkPhoto"].href="http://photo.blog.sina.com.cn/u/"+uid;nodes["miniblog"].href="http://control.blog.sina.com.cn/t_sina_blog/tb.php?uname="+uid;nodes["mySpace"].href="http://blog.sina.com.cn/s/profile_"+uid+".html";nodes["linkChangeFace"].href="http://control.blog.sina.com.cn/blogprofile/nick.php";nodes["linkChangePassword"].href="https://security.sina.com.cn/account/security?option=chgpwd&entry=blog";nodes["linkAccountSetup"].href="https://security.sina.com.cn/account/security";this.initLoginOut(nodes["loginOut"])},initLoginOut:function(outBtn){outBtn.onclick=function(){return false};Core.Events.addEvent(outBtn,function(){lib.tray.loginOut(null,!0)})}});return userMenu});Lib.register("tray.tpl.blogMenu",function(){var tpl=['<div id="#{panel}" class="wrtBlog_sub">','<div class="wrtBlog_sub3">','<p><a target="_blank" onclick="v7sendLog(\'40_01_26\')" href="http://control.blog.sina.com.cn/admin/article/article_add.php?tag365">写365</a></p>','<p><a target="_blank" onclick="v7sendLog(\'40_01_26\')" href="http://control.blog.sina.com.cn/admin/article/changWeiBo.php">长微博</a></p>','<p><a target="_blank" onclick="v7sendLog(\'40_01_26\')" href="http://photo.blog.sina.com.cn/upload/upload.php">发照片</a></p>',"</div>","</div>"].join("");return tpl});Lib.register("tray.BlogMenuPanel",function(lib){var blogMenu=Core.Class.define(function(){lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(lib.tray.tpl.blogMenu)},lib.Panel,{});return blogMenu});Lib.register("tray.tpl.searchForm",function(){var tpl=['<div class="ntopbar_input" id="#{panel}">','<form id="#{searchForm}" method="get" target="_blank" action="http://search.sina.com.cn">','<input id="#{queryTxt}" class="ntopbar_txt" type="text" name="q" autocomplete="off"/>','<input id="#{submit}" type="submit" onclick="v7sendLog(\'40_01_44\')" class="ntopbar_searchBtn" value=""/>','<input type="hidden" name="ie" value="utf-8"/>','<input type="hidden" name="e" value="utf-8"/>','<input id="#{range}" type="hidden" name="range" value="article"/>','<input id="#{t}" type="hidden" name="t" value=""/>','<input id="#{s}" type="hidden" name="s" value="sup"/>','<input id="#{by}" type="hidden" name="by" value="all"/>','<input id="#{type}" type="hidden" name="type" value=""/>','<input id="#{stype}" type="hidden" name="stype" value="1"/>','<input id="#{c}" type="hidden" name="c" value="blog"/>',"</form>","</div>"].join("");return tpl});Core.Dom.addClass=function(obj,className){var _trim=Core.String.trim;className=_trim(className);if(!className){return obj}obj=$E(obj);var oldClz=_trim(obj.className||"");var tmpOldClz=" "+oldClz+" ";if(!oldClz){obj.className=_trim(className);return obj}var uClzs=className.split(" ");var uClz,newClzs=[];for(var i=0;i<uClzs.length;i++){uClz=uClzs[i];if(uClz&&-1===tmpOldClz.indexOf(" "+uClz+" ")){newClzs.push(uClz)}}obj.className=oldClz+" "+newClzs.join(" ");return obj};Core.Dom.removeClass=function(obj,className){obj=$E(obj);obj.className=obj.className.replace(new RegExp("\\s*\\b"+className+"\\b"),"")};Lib.util.getActionData=function(evt,actionType,typeAttrName,dataAttrName){if(!actionType){throw"[Lib.util.getActionData] param actionType is undefined!"}evt=evt||window.event;var _getTarget=Core.Events.getEventTarget,tEl,delegateEl,typeStr,types,type,data,typeAttrName=typeAttrName||"action-type",dataAttrName=dataAttrName||"action-data";tEl=_getTarget(evt);delegateEl=evt.currentTarget||document.documentElement||document.body;while(tEl&&tEl!=delegateEl){typeStr=tEl.getAttribute(typeAttrName)||"";types=typeStr.split(",");for(var i=0,len=types.length;i<len;i++){type=types[i];if(actionType===type){data=tEl.getAttribute(dataAttrName);return{actionType:actionType,targetEl:tEl,data:data}}}tEl=tEl.parentNode}return null};Lib.register("tray.tpl.cateSearch",function(){var tpl=['<div id="#{panel}" class="mCatSearch">',"<ul>",'<li action-type="tray-search" onclick="v7sendLog(\'40_01_43\')" action-data="article" class="current">含“<span id="#{article}"></span>”的博文</li>','<li action-type="tray-search" onclick="v7sendLog(\'40_01_43\')" action-data="bloger">含“<span id="#{bloger}"></span>”的博主</li>','<li action-type="tray-search" onclick="v7sendLog(\'40_01_43\')" action-data="music">含“<span id="#{music}"></span>”的音乐</li>','<li action-type="tray-search" onclick="v7sendLog(\'40_01_43\')" action-data="video">含“<span id="#{video}"></span>”的视频</li>',"</ul>","</div>"].join("");return tpl});Lib.register("tray.CateSearchPanel",function(lib){var _addEvt=Core.Events.addEvent;var leftB=Core.String.leftB;var byteLength=Core.String.byteLength;var catePanel=Core.Class.define(function(){lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(lib.tray.tpl.cateSearch);this.initEvt()},lib.Panel,{initEvt:function(){var nodes=this.getNodes();var $lis=$T(nodes["panel"],"li");lib.util.hoverJq({elm:$lis,mouseenter:function(evt,el,index){Core.Dom.addClass(el,"current")},mouseleave:function(evt,el,index){Core.Dom.removeClass(el,"current")},delay:50});_addEvt(nodes["panel"],function(evt){evt=evt||window.event;var searchData=lib.util.getActionData(evt,"tray-search");if(searchData){lib.Listener.notify("tray-categroy-search",searchData.data)}})},updateSearch:function(v){if(5<byteLength(v)){v=leftB(v,4)+"..."}var value=v.replace(/(<|>)/g,function($1){if("<"===$1){return"&lt;"}else{return"&gt;"}});var nodes=this.getNodes();nodes["article"].innerHTML=value;nodes["bloger"].innerHTML=value;nodes["music"].innerHTML=value;nodes["video"].innerHTML=value}});return catePanel});Lib.register("tray.SearchFormPanel",function(lib){var _addEvt=Core.Events.addEvent;var _trim=Core.String.trim;var searchForm=Core.Class.define(function(cfg){lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(lib.tray.tpl.searchForm);this.initEvt();this.catePanel=new lib.tray.CateSearchPanel;this.catePanel.entity.style.zIndex=512;lib.Listener.on({name:"tray-categroy-search",callBack:this.search,scope:this})},lib.Panel,{initEvt:function(){var me=this;var $queryTxt=this.getNode("queryTxt");_addEvt($queryTxt,function(evt){evt=evt||window.event;var target=evt.target||evt.srcElement;var offset=target.offsetWidth;me.showCateSearch(target,offset,target.value)},"input");_addEvt($queryTxt,function(evt){evt=evt||window.event;if("value"!==evt.propertyName){return}var target=evt.target||evt.srcElement;var offset=target.offsetWidth;me.showCateSearch(target,offset,target.value)},"propertychange");_addEvt($queryTxt,function(evt){evt=evt||window.event;var target=evt.target||evt.srcElement;var offset=target.offsetWidth;me.showCateSearch(target,offset,target.value)},"focus");_addEvt(this.getNode("searchForm"),function(evt){evt=evt||window.event;var form=evt.target||evt.srcElement;if(!me.checkValidate(form)){Core.Events.stopEvent(evt)}else{setTimeout(function(){me.hideCateSearch();me.resetForm()},100)}},"submit");_addEvt(window,function(){if(me.catePanel.isShow){var offset=$queryTxt.offsetWidth;me.catePanel.showWithDom($queryTxt,-offset,4)}},"resize")},checkValidate:function(form){if("q"in form&&!_trim(form["q"].value))return false;else if("k"in form&&!_trim(form["k"].value))return false;else return true},setForm:function(url,cfg){var defaultValue={queryTxt:"q",ie:"utf-8",range:"",t:"",s:"",by:"",type:"",stype:"",e:"utf-8",c:""};var $searchForm=this.getNode("searchForm");$searchForm.action=url;lib.apply(defaultValue,cfg);var $queryTxt=this.getNode("queryTxt");$queryTxt.name=defaultValue["queryTxt"];delete defaultValue["queryTxt"];var attr,$query;for(var p in defaultValue){attr=defaultValue[p];if(typeof attr==="string"&&($query=this.getNode(p))){$query.value=attr}}},resetForm:function(){this.setForm("http://search.sina.com.cn",{queryTxt:"q",range:"article",s:"sup",by:"all",stype:"1",c:"blog"})},search:function(type){var $searchForm=this.getNode("searchForm");var blogSearchUrl="http://search.sina.com.cn";var videoSearchUrl="http://video.sina.com.cn/search/index.php";var musicSearchUrl="http://music.sina.com.cn/yueku/search/s.php";switch(type){case"video":this.setForm(videoSearchUrl,{queryTxt:"k",s:"sup",type:"boke",stype:"1"});break;case"bloger":this.setForm(blogSearchUrl,{queryTxt:"q",range:"author",s:"sup",by:"all",stype:"1",c:"blog"});break;case"music":this.setForm(musicSearchUrl,{queryTxt:"k",t:"song"});break;default:this.setForm(blogSearchUrl,{queryTxt:"q",range:"article",s:"sup",by:"all",stype:"1",c:"blog"})}if($IE){this.getNode("submit").click()}else{Core.Events.fireEvent(this.getNode("submit"),"click")}},showCateSearch:function($withEl,offset,v){var catePanel=this.catePanel;if(v&&catePanel.isHidden){catePanel.showWithDom($withEl,-offset,4)}else if(!v){this.hideCateSearch()}catePanel.updateSearch(v)},hideCateSearch:function(){var catePanel=this.catePanel;catePanel.hide();catePanel.updateSearch("")}});return searchForm});Lib.register("util.LS",function(lib){var ls;var Storage=function(wnd,undefined){var localStorageName="data-sina-blog-storage",localStorageKeys="data-sina-blog-storage-keys",doc=wnd.document,storageContainer=doc.createElement("input"),length,keys,removeArray=Core.Array.ArrayWithout,mark=function(key,isRemove,temp,reg){storageContainer.load(localStorageName);temp=storageContainer.getAttribute(localStorageKeys)||"";reg=RegExp("\\b"+key+"\\b,?","i");var hasKey=reg.test(temp)?1:0;temp=isRemove?temp.replace(reg,""):hasKey?temp:temp===""?key:temp.split(",").concat(key).join(",");storageContainer.setAttribute(localStorageKeys,temp);storageContainer.save(localStorageName)};var box=document.body||document.getElementsByTagName("head")[0]||document.documentElement;storageContainer.id="____storage_container_box";storageContainer.type="hidden";box.appendChild(storageContainer);storageContainer.addBehavior("#default#userData");storageContainer.load(localStorageName);var keyStr=storageContainer.getAttribute(localStorageKeys);keys=keyStr?keyStr.split(","):[];length=keys.length;return{key:function(index){if(isNaN(index)){index=0}return keys[parseInt(index,10)]},getItem:function(key){storageContainer.load(localStorageName);return storageContainer.getAttribute(key)},setItem:function(key,value){storageContainer.setAttribute(key,value);storageContainer.save(localStorageName);this.length++;keys.push(key);mark(key)},removeItem:function(key){storageContainer.removeAttribute(key);storageContainer.save(localStorageName);this.length--;removeArray(keys,key);mark(key,1)},clear:function(){storageContainer.load(localStorageName);var attrs=storageContainer.getAttribute(localStorageKeys).split(","),len=attrs.length;if(attrs[0]==="")return;for(var i=0;i<len;i++){storageContainer.removeAttribute(attrs[i]);storageContainer.save(localStorageName)}storageContainer.setAttribute(localStorageKeys,"");storageContainer.save(localStorageName);this.length=0},length:length}};var getStorage=function(wnd){if(wnd.localStorage){return wnd.localStorage}else if(wnd.sessionStorage){return wnd.sessionStorage}else if(wnd.globalStorage){return wnd.globalStorage}else{return Storage(wnd)}};var getLS=function(){if(!ls){ls=getStorage(window)}return ls};return{key:function(index){return getLS().key(index)},getItem:function(key){return getLS().getItem(key)},setItem:function(key,value){try{getLS().setItem(key,value);return true}catch(e){return false}},removeItem:function(key){return getLS().removeItem(key)},clear:function(){return getLS().clear()}}});Lib.register("tray.loadUserInfo",function(lib){var LS=lib.util.LS;var JSON=lib.util.JSON;var sendSever=function(uid,cb){var url="http://interface.blog.sina.com.cn/riaapi/profile/getNickName.php";Utils.Io.JsLoad.request(url,{GET:{uid:uid},onComplete:function(r){if(r&&"A00006"===r.code){var n=r.data.nickname;if(!r.data.full_nickname){r.data.full_nickname="用户"+r.data.uid}if(!r.data.nickname){r.data.nickname="用户"+r.data.uid}var saveObj={time:(new Date).getTime()/1e3};lib.apply(saveObj,r.data);LS.setItem("uid"+uid,JSON.stringify(saveObj));cb(saveObj)}},onException:function(){},timeout:1e4})};return function(uid,cb,froceSever){var nickInfo=LS.getItem("uid"+uid);if(!froceSever&&nickInfo){nickInfo=JSON.parse(nickInfo);var currentTime=(new Date).getTime()/1e3;var waitTime=currentTime-nickInfo.time;if(waitTime<4*60&&nickInfo.nickname){cb(nickInfo);return}}sendSever(uid,cb)}});Lib.register("tray.MsgLoader",function(lib){var addFlash=function($flash){var $wrapper=$C("div");$wrapper.style.cssText="position:absolute;top:-1000px;left:-1000px;";document.body.appendChild($wrapper);$flash.write($wrapper)};var random="",FlaDom;if(window.$Maxthon||window.$360||window.$TT){random="?t="+Core.Math.getUniqueId()}var msgLoader=function(cfg){lib.apply(this,cfg);if(!FlaDom){try{var FlashPlayer=new Utils.Flash.swfObject($_GLOBAL.flashBasicURL+"blogMessageReminding.swf"+random,"__msgTipsPlayer","1px","1px","9","#00ff00");FlashPlayer.addParam("quality","high");FlashPlayer.addParam("wmode","transparent");FlashPlayer.addParam("allowScriptAccess","always");FlashPlayer.addParam("freeTime",27*1e3);if("complete"===document.readyState){addFlash(FlashPlayer);FlaDom=$E("__msgTipsPlayer")}else{_addEvt(window,function(){addFlash(FlashPlayer);FlaDom=$E("__msgTipsPlayer")},"load")}}catch(e){}}}.$define({time:30,url:"http://comet.blog.sina.com.cn/api?maintype=notice",getFlaDom:function(){return FlaDom
},play:function(){if($_GLOBAL.msgPlaySound&&FlaDom&&FlaDom.PlaySound){try{FlaDom.PlaySound()}catch(e){}}},load:function(uid,cb){var $this=this;var blogid=scope.$articleid||"";if(!uid){return}Utils.Io.JsLoad.request(this.url,{GET:{uid:uid||"",blogid:blogid},onComplete:function(r){if(r&&"A00006"==r.code){var d,articleMsg;if(uid&&(d=r.data[uid])){var userMsg={};userMsg.sum=0;for(var k in d){userMsg[k]=d[k];userMsg.sum+=d[k]}userMsg.blogrecomment=userMsg.blogrecomment?userMsg.blogrecomment:0;lib.Listener.notify("tray-newmsg-loaded",userMsg)}if(blogid&&(articleMsg=r.data[blogid])){lib.Listener.notify("article-msg-loaded",articleMsg)}}},onException:function(){},timeout:1e4})}});return msgLoader});Lib.register("tray.tpl.notice",function(){var tpl=['<div id="#{panel}" class="horn">','<div id="#{tj}" class="horn_con" style="display:none;">推荐：<a id="#{noticeAd1}" target="_blank" href="#"></a><a id="#{noticeAd2}" target="_blank" href="#"></a></div>','<div id="#{announce}" class="horn_con" style="display:none;"><p id="#{announceCon}">公告：<em>请您及时更换请请请您正在使用的模版将于2周后被下线，请您及时更换</em></p></div>','<a class="close" title="关闭" id="#{close}" style="float:none;">×</a>',"</div>"].join("");return tpl});Lib.register("tray.BlogNotice",function(lib){var _addEvt=Core.Events.addEvent,setCookie=Utils.Cookie.setCookie,pageId=scope.$pageid;var notice=Core.Class.define(function(){lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(lib.tray.tpl.notice);this.initEvt()},lib.Panel,{initEvt:function(){var $this=this;_addEvt(this.getNode("close"),function(evt){evt=evt||window.event;setCookie("closeNotice_fzp",$UID,24,"/",".blog.sina.com.cn");lib.Listener.notify("tray-announce-close",{});$this.destroy()})},update:function(json){var $tj=this.getNode("tj"),$announce=this.getNode("announce");var slotres="";var sourceArr=["SLOT_58","SLOT_59","SLOT_98","SLOT_99","SLOT_100","SLOT_101","SLOT_102"];var sloturl="http://comet.blog.sina.com.cn/api?maintype=pageslot";var reqdata={id:sourceArr};if(typeof scope!="undefined"){reqdata.blogeruid=scope.$uid}if($UID){reqdata.loginuid=$UID}if($isLogin&&json.announce.result&&(pageId==="indexM"||pageId==="articleM"||pageId==="articlelistM")){$announce.innerHTML=json.announce.announce_con;$announce.style.display=""}else{var noticeAd1=this.getNode("noticeAd1");var noticeAd2=this.getNode("noticeAd2");var complete=function(res){var randomIndex=0;var adcon1=res[sourceArr[0]].res;var adcon2=res[sourceArr[1]].res;if(adcon1||adcon2){if(adcon1){randomIndex=0;if(adcon1.length>1){randomIndex=Math.floor((adcon1.length+1)*Math.random())}noticeAd1.innerHTML=adcon1[randomIndex].words;noticeAd1.href=adcon1[randomIndex].a_href;noticeAd1.title=adcon1[randomIndex].a_title;noticeAd1.setAttribute("suda-uatrack",adcon1[randomIndex].a_c_suda.replace("suda-uatrack=","").replace('"',"").replace('"',""));if(typeof SUDA!=="undefined"){SUDA.uaTrack(adcon1[randomIndex].a_v_suda_key,adcon1[randomIndex].a_v_suda_value)}}if(adcon2){randomIndex=0;if(adcon2.length>1){randomIndex=Math.floor((adcon2.length+1)*Math.random())}noticeAd2.innerHTML=adcon2[randomIndex].words;noticeAd2.href=adcon2[randomIndex].a_href;noticeAd2.title=adcon2[randomIndex].a_title;noticeAd2.setAttribute("suda-uatrack",adcon2[randomIndex].a_c_suda.replace("suda-uatrack=","").replace('"',"").replace('"',""));if(typeof SUDA!=="undefined"){SUDA.uaTrack(adcon2[randomIndex].a_v_suda_key,adcon2[randomIndex].a_v_suda_value)}}$tj.style.display=""}};if(scope.__subscribeSlot==="waitting"){scope.__subscribeSlotFunc=complete}else if(typeof scope.__subscribeSlot==="object"){complete(scope.__subscribeSlot)}else{scope.__subscribeSlot="waitting";Utils.Io.JsLoad.request(sloturl,{GET:reqdata,onComplete:function(res){complete(res);scope.__subscribeSlot=res;if("function"==typeof scope.__subscribeSlotFunc){scope.__subscribeSlotFunc(res)}},onException:function(){}})}}},setTemplate:function(template){this.template=template;var tmp=new Lib.HtmlTemplate(this.template,this.uniqueID);this.tpl=tmp;Core.Dom.insertHTML($E(this.appendTo),tmp.getHtmlString(),"afterbegin");this.entity=$E("_"+this.uniqueID+"_panel");this.entity.style.display="none";tempEntity=null}});return notice});Lib.register("tray.unReadMsgPanel",function(lib){var unReadMsgPanel=Core.Class.define(function(ele){lib.Panel.prototype.initialize();if(scope.$pageid=="editor"){return}this._lockstate=0;this._scrolling=0;this._srcPot=ele;var template=['<div class="cor"></div>','<div class="bd">','<a href="#" id="j-unread-msg-close" class="close" title="关闭">×</a>','<ul id="j-unre-list">',"</ul>","</div>"].join("");this.setTemplate('<div class="messageTips" id="#{panel}" style="left:850px; top:10px;">'+template+"</div>");this.entity.style.zIndex=500;this._bindEvent()},lib.Panel,{show:function(){if(this.isShow){return}v7sendLog("40_02_01");this.entity.style.display="";this._srcPot&&this._srcPot.setAttribute("unread-show-state",1);this.isHidden=!1;this.isShow=!0;if(this.backIframe){this._updateBackIframe();this.backIframe.style.display=""}lib.Listener.notify("tray-unread-panel-show",{})},hide:function(){lib.Panel.prototype.hide.call(this);this._srcPot&&this._srcPot.setAttribute("unread-show-state",0);lib.Listener.notify("tray-unread-panel-hide",{})},_updatePanelIframe:function(){if(this.backIframe){this._updateBackIframe()}},_updateCont:function(data){var _list=[];if(data.comment+data.message+data.notice+data.gbook==0){this.hide();return}if(data.comment>0){_list.push("<li>"+data.comment+'条新评论，<a onclick="v7sendLog(\'40_02_02\')" href="http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=1">查看评论</a></li>')}if(data.message>0){_list.push("<li>"+data.message+'条新纸条，<a onclick="v7sendLog(\'40_02_03\')" href="http://control.blog.sina.com.cn/blogprofile/profilepaperlist.php?type=1">查看纸条</a></li>')}if(data.gbook>0){_list.push("<li>"+data.gbook+'条新留言，<a onclick="v7sendLog(\'40_02_04\')" href="http://i.blog.sina.com.cn/blogprofile/wall.php">查看留言</a></li>')}if(data.notice>0){var sysurl={notice:"http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote",like:"http://i.blog.sina.com.cn/profilelist/profilelikelist.php",notice_favourite:"http://i.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilenotice",notice_quote:"http://i.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilenotice",invite:"http://control.blog.sina.com.cn/blogprofile/profileinvitelist.php",unreadnotices:"http://i.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilenotice",point:"http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/points_note.php"};var url=sysurl.notice;for(var key in data.notices){if(data.notices[key]>0){url=sysurl[key]||url;break}}_list.push("<li>"+data.notice+'条新通知，<a onclick="v7sendLog(\'40_02_05\')" href="'+url+'">查看通知</a></li>')}$E("j-unre-list").innerHTML=_list.join("");this.show();this._setThePos()},_setThePos:function(){var pop=Core.Dom.getXY(this._srcPot);var sv=this._srcPot.className=="link"?-2:0;var width=$IE7||$IE6?this.entity.offsetWidth:this.entity.clientWidth;if(pop[0]){var x=pop[0]+this._srcPot.clientWidth-width+sv;var _y=0;if(this._srcPot.getAttribute("adshow")==1&&this._scrolling==0){_y=pop[1]}var y=this._srcPot.clientHeight+_y+10;this.setPosition(x,y)}},_bindEvent:function(){var _this=this;Lib.Listener.on({name:"tray-newmsg-loaded",callBack:function(data){if(_this._lockstate){return}_this._eventHandle(data);_this._setThePos()}});Lib.Listener.on({name:"tray-scrolling-fix",callBack:function(data){_this._scrolling=1;if(_this._lockstate){return}_this.setFixed(1);_this._setThePos()}});Lib.Listener.on({name:"tray-scrolling-nofix",callBack:function(data){_this._scrolling=0;if(_this._lockstate){return}_this.setFixed(0);_this._setThePos()}});Lib.Listener.on({name:"topad680-show-end",callBack:function(data){_this._srcPot.setAttribute("adshow",1);if(_this.isShow){_this._setThePos()}}});Core.Events.addEvent($E("j-unread-msg-close"),function(e){var evt=e||window.event;if(evt.preventDefault){evt.preventDefault()}else{evt.returnValue=false}_this.hide();_this._lockstate=1},"click");Core.Events.addEvent(window,function(){if(_this.isShow){_this._setThePos()}},"resize")},_eventHandle:function(data){var _data={};_data.comment=data.blogcomment-0+(data.photocomment-0)+data.blogrecomment;_data.notice=data.notice+data.like+data.notice_favourite+data.notice_quote+data.invite+data.unreadnotices+data.point;_data.notices={notice:data.notice,like:data.like,notice_favourite:data.notice_favourite,notice_quote:data.notice_quote,invite:data.invite,unreadnotices:data.unreadnotices,point:data.point};_data.message=data.message;_data.gbook=data.gbook;this._updateCont(_data)}});return unReadMsgPanel});Lib.register("tray.msgSummaryPanel",function(lib){var JSON=lib.util.JSON;var nolist=['<li><a onclick="v7sendLog(\'40_02_12\')" href="http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=1"><span class="icoms_comment"></span>查看评论</a></li>','<li><a onclick="v7sendLog(\'40_02_13\')" href="http://control.blog.sina.com.cn/blogprofile/profilepaperlist.php?type=1"><span class="icoms_tips"></span>查看纸条</a></li>','<li><a onclick="v7sendLog(\'40_02_14\')" href="http://i.blog.sina.com.cn/blogprofile/wall.php"><span class="icoms_message"></span>查看留言</a></li>','<li><a onclick="v7sendLog(\'40_02_15\')" href="http://i.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilenotice"><span class="icoms_notice"></span>查看通知</a></li>'];var msgSummaryPanel=Core.Class.define(function(ele){lib.Panel.prototype.initialize();this._srcPot=ele;this._lock=1;this._scrolling=0;this._requirestate=1;this._nums={};var template=['<div class="bd">','<ul id="j-summary-list">',nolist.join(""),"</ul>","</div>"].join("");this.setTemplate('<div class="messageBox" id="#{panel}">'+template+"</div>");this.entity.style.zIndex=500;this._bindEvent();this._initNums()},lib.Panel,{show:function(){var _this=this;if(this._checkNumChange()){this._updateCont()}else{this._showAction()}},_showAction:function(){if(this.isHidden){this._srcPot&&this._srcPot.setAttribute("msg-panel-show-state",1);this.entity.style.display="";this.isHidden=!1;this.isShow=!0;if(this.backIframe){this._updateBackIframe();this.backIframe.style.display=""}this._setThePos()}else{this._setThePos()}},_checkNumChange:function(){var oldnum=this._srcPot.getAttribute("msg-count");var newnum=this._srcPot.getAttribute("old-msg-count");if(oldnum==newnum){return false}else{return true}},hide:function(){lib.Panel.prototype.hide.call(this);this._srcPot&&this._srcPot.setAttribute("msg-panel-show-state",0);lib.Listener.notify("tray-msg-panel-hide",{})},_initNums:function(){var data=JSON.parse(this._srcPot.getAttribute("msg-count"));this._formatData(data)},_setThePos:function(){if($IE6||$IE7||$IE8){this.entity.style.width="auto"}var pop=Core.Dom.getXY(this._srcPot);var sv=this._srcPot.className=="link"?-2:0;var width=$IE7||$IE6?this.entity.offsetWidth:this.entity.clientWidth;var x=pop[0]+this._srcPot.clientWidth-width+sv;var _y=0;if(this._srcPot.getAttribute("adshow")==1&&this._scrolling==0){if($IE6||$IE7||$IE8){_y=pop[1]-2}else{_y=pop[1]}}var y=this._srcPot.clientHeight+_y+1;if($IE6||$IE7||$IE8){this.entity.style.width=this.entity.clientWidth+1+"px";this.entity.style.width=this.entity.clientWidth-1+"px"}this.setPosition(x,y)},_updatePanelIframe:function(){if(this.backIframe){this._updateBackIframe()}},_updateCont:function(fun){var _list=[];var _this=this;this._lock=0;if(this._requirestate){this._getDate({},function(_data){_list.push(_this._getComment(_data));_list.push(_this._getMessage(_data));_list.push(_this._getGbook(_data));_list.push(_this._getNotice(_data));$E("j-summary-list").innerHTML=_list.join("");_this._srcPot.setAttribute("old-msg-count",_this._srcPot.getAttribute("msg-count"));if($IE6){$E("j-summary-list").style.width="270px"}_this._showAction()},function(_data){});this._requirestate=0}},_getDate:function(opt,funsuc,funerr){funsuc=funsuc||function(){};funerr=funerr||function(){};var _this=this;Lib.checkAuthor(function(){var inter=new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/profile/note/notelist.php","jsload");inter.request({GET:{uid:$UID},onSuccess:function(result){funsuc(result)}.bind2(_this),onError:function(result){funerr({num:0})}.bind2(_this),onFail:function(){funerr({num:0})}.bind2(_this)})},"msgSummaryPanel"+(new Date).getTime())},_getUserPicUrl:function(uid,size){var size=size||50;var n=parseInt(uid)%8+1;return"http://portrait"+n+".sinaimg.cn/"+uid+"/blog/"+size},getLen:function(a){if(!a){return 0}var b=a.match(/[^\x00-\xff]/g);return a.length+(b?b.length:0)},strTruncate:function(str,len,suffix){str=str||"";if(typeof suffix=="undefined"){suffix="..."}return this.getLen(str)>len?this.truncete(str,len)+suffix:str},truncete:function(b,c){var d=b.replace(/\*/g," ").replace(/[^\x00-\xff]/g,"**");b=b.slice(0,d.slice(0,c).replace(/\*\*/g," ").replace(/\*/g,"").length);this.getLen(b)>c&&c>0&&(b=b.slice(0,b.length-1));return b},getVipIcon:function(index){if(!index){return""}var vipicon={1:{icon:"SG_icon146",info:"新浪个人认证"},2:{icon:"SG_icon147",info:"新浪机构认证"}};var index=index||1;var pic='<img class="SG_icon '+vipicon[index].icon+'" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="13" title="'+vipicon[index].info+'" alt="'+vipicon[index].info+'" align="absmiddle" />';return pic},_setNameforIE6:function(name){if($IE6){return this.strTruncate(name,4)}else{return name}},_getComment:function(_data){var str="";if(this._nums._comment>0){var data=_data.msg.cms;if(data.length>0){var typemsg={1:"评论了你的博文",2:"评论了你的图片",6:"回复了你的评论"};var typeurl={1:"http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=1",2:"http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=2",6:"http://i.blog.sina.com.cn/blogprofile/profilereplylist.php"};var types=[];for(var i=0,len=data.length;i<len;i++){var item=data[i];var name=item.nick_name||item.name;name=this._setNameforIE6(name);var img=this._getUserPicUrl(item.uid,30);var type=item.msg_type;types.push(type);var index=item.user_type||0;var time=item.time;str+='<li><a onclick="v7sendLog(\'40_02_06\')" href="'+typeurl[type]+'"><img src="'+img+'"><em class="nl">'+name+"</em>"+this.getVipIcon(index)+'<em class="tm">'+time+"</em>"+typemsg[type]+"</a></li>"}types.sort();if(this._nums._comment>3){str+='<li class="lcount"><a onclick="v7sendLog(\'40_02_07\')" href="'+typeurl[types[0]]+'">总共'+this._nums._comment+"条新评论</a></li>"}else{}}else{str=nolist[0]}}else{str=nolist[0]}return str},_getMessage:function(_data){var str="";if(this._nums._message>0){var data=_data.msg.note[0];var name=data.name||data.nick_name;name=this._setNameforIE6(name);var numstr=this._nums._message>1?"等"+this._nums._message+"人":"";var index=data.user_type||0;str+='<li class="bgc"><a onclick="v7sendLog(\'40_02_08\')" href="http://control.blog.sina.com.cn/blogprofile/profilepaperlist.php?type=1"><span class="icoms_tips"></span><em class="nl">'+name+"</em>"+this.getVipIcon(index)+numstr+'发来纸条<em class="nr">查看纸条</em></a></li>'}else{str=nolist[1]}return str},_getGbook:function(_data){var str="";if(this._nums._gbook>0){var data=_data.msg.note[1];var name=data.name||data.nick_name;if(name){name=this._setNameforIE6(name);var numstr=this._nums._gbook>1?"等"+this._nums._gbook+"人":"给你";var index=data.user_type||0;str+='<li class="bgc"><a onclick="v7sendLog(\'40_02_09\')" href="http://i.blog.sina.com.cn/blogprofile/wall.php"><span class="icoms_message"></span><em class="nl">'+name+"</em>"+this.getVipIcon(index)+numstr+'留言<em class="nr">查看留言</em></a></li>'}}else{str=nolist[2]}return str},_getNotice:function(_data){var str="";var _pronotice="http://i.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilenotice";var _sysnotice="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote";var typeurl={3:"http://control.blog.sina.com.cn/blogprofile/profileinvitelist.php",7:_pronotice,8:_pronotice,9:_pronotice,23:_pronotice,55:"http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/points_note.php",13:"http://i.blog.sina.com.cn/profilelist/profilelikelist.php",100:_sysnotice,101:_sysnotice,102:_sysnotice,103:_sysnotice,104:_sysnotice,105:_sysnotice,106:_sysnotice,107:_sysnotice,108:_sysnotice,109:_sysnotice,110:_sysnotice,111:_sysnotice,112:_sysnotice};if(this._nums._notice>0){var data=_data.msg.note[2];var type=data.msg_type||23;str+='<li class="bgc last"><a onclick="v7sendLog(\'40_02_10\')" href="'+typeurl[type]+'"><span class="icoms_notice"></span>'+this._nums._notice+'条新通知<em class="nr">查看通知</em></a></li>'}else{str=nolist[3]}return str},_bindEvent:function(){var _this=this;Lib.Listener.on({name:"tray-newmsg-loaded",callBack:function(data){_this._requirestate=1;_this._eventHandle(data)}});Lib.Listener.on({name:"tray-scrolling-nofix",callBack:function(data){_this._scrolling=0;if(_this._lockstate){return}_this.setFixed(0);_this._setThePos()}});Lib.Listener.on({name:"tray-scrolling-fix",callBack:function(data){_this._scrolling=1;if(_this._lockstate){return}_this.setFixed(1);_this._setThePos()}});Lib.Listener.on({name:"topad680-show-end",callBack:function(data){if(_this.isShow){_this._setThePos()}}})},_eventHandle:function(data){this._formatData(data);if(this.isShow){this._updateCont()}},_formatData:function(data){var _data={};_data._comment=data.blogcomment-0+(data.photocomment-0)+data.blogrecomment;_data._notice=data.notice+data.like+data.notice_favourite+data.notice_quote+data.invite+data.unreadnotices+data.point;_data._message=data.message;_data._gbook=data.gbook;this._cacheNums(data,_data)},_cacheNums:function(data,_data){for(var k in data){this._nums[k]=data[k]}for(var key in _data){this._nums[key]=_data[key]}}});return msgSummaryPanel});Core.System.pageSize=function(_target){if(_target){target=_target.document}else{target=document}var _rootEl=target.compatMode=="CSS1Compat"?target.documentElement:target.body;var xScroll,yScroll;if(window.innerHeight&&window.scrollMaxY){xScroll=_rootEl.scrollWidth;yScroll=window.innerHeight+window.scrollMaxY}else if(_rootEl.scrollHeight>_rootEl.offsetHeight){xScroll=_rootEl.scrollWidth;yScroll=_rootEl.scrollHeight}else{xScroll=_rootEl.offsetWidth;yScroll=_rootEl.offsetHeight}var win_s=Core.System.winSize(_target);if(yScroll<win_s.height){pageHeight=win_s.height}else{pageHeight=yScroll}if(xScroll<win_s.width){pageWidth=win_s.width}else{pageWidth=xScroll}return[pageWidth,pageHeight,win_s.width,win_s.height]};!function(){function LazyLoad(oObjects,oOptions){this.node=oObjects;this.config=oOptions;for(var key in this.defaultConfig){this.config[key]=this.defaultConfig[key]}this.initialize();return this}LazyLoad.prototype={defaultConfig:{preloadPixel:500},initialize:function(){this.viewableHeight=LazyLoadListener.getViewableHeight();LazyLoadListener.enrol(this)},callback:function(nHeight){if(this.node.length==0){return}this.viewableHeight=nHeight||this.viewableHeight;var remanent=[];for(var i=0,len=this.node.length;i<len;i++){if(this.node[i]&&this.node[i].dom==null&&Core.Dom.getXY(this.node[i])[1]<this.viewableHeight+this.config.preloadPixel){this.config.callback(this.node[i]);this.node[i]=null}else if(this.node[i]&&this.node[i].dom&&Core.Dom.getXY(this.node[i].dom)[1]<this.viewableHeight+this.config.preloadPixel){this.node[i].callback(this.node[i].dom);this.node[i]=null}else{remanent.push(this.node[i])}}this.node=remanent}};var LazyLoadListener={_isInit:null,_binder:null,_isWindow:null,_member:[],initialize:function(){var container=window,isWindow=container==window||container==document||!container.tagName||/^(?:body|html)$/i.test(container.tagName);if(isWindow){var doc=container.document;container=doc.compatMode=="CSS1Compat"&&($IE||$FF||$OPERA)?doc.documentElement:doc.body;try{if($CHROME&&navigator.userAgent.match(/chrome\/(\d+)/i)[1]>60){container=doc.documentElement}}catch(e){}}this._container=container;this._binder=isWindow?window:container;this._isWindow=isWindow;this._isInit=true;this.delayResize();this.bindEvent()},getViewableHeight:function(){var eyeableHeight=LazyLoadListener._container.scrollTop+Core.System.winSize().height;this.eyeableHeight=eyeableHeight;return eyeableHeight},bindEvent:function(){if(!this._isInit){this.initialize();return}Core.Events.addEvent(this._binder,LazyLoadListener.delayLoad,"scroll");if(this._isWindow){Core.Events.addEvent(this._binder,LazyLoadListener.delayResize,"resize")}this.binded=true},unbindEvent:function(){Core.Events.removeEvent(LazyLoadListener._binder,LazyLoadListener.delayLoad,"scroll");if(this._isWindow){Core.Events.removeEvent(LazyLoadListener._binder,LazyLoadListener.delayResize,"resize")}this.binded=false},delayLoad:function(){if(LazyLoadListener.scrollWatch){clearTimeout(LazyLoadListener.scrollWatch)}LazyLoadListener.scrollWatch=setTimeout(function(){LazyLoadListener.callback();clearTimeout(LazyLoadListener.scrollWatch);LazyLoadListener.scrollWatch=null},100)},delayResize:function(){if(LazyLoadListener.resizeWatch){clearTimeout(LazyLoadListener.resizeWatch)}LazyLoadListener.resizeWatch=setTimeout(function(){LazyLoadListener.callback();clearTimeout(LazyLoadListener.resizeWatch);LazyLoadListener.resizeWatch=null},100)},enrol:function(oLazy){LazyLoadListener._member.push(oLazy)},callback:function(){LazyLoadListener.getViewableHeight();if(LazyLoadListener._member.length>0){for(var i=0,len=LazyLoadListener._member.length;i<len;i++){LazyLoadListener._member[i].callback(LazyLoadListener.eyeableHeight)}}if(LazyLoadListener.eyeableHeight==Core.System.pageSize()[1]){LazyLoadListener.unbindEvent()}}};Lib.LazyLoad=function(oObjects,oOptions){if(LazyLoadListener.binded!=true){LazyLoadListener.bindEvent(oObjects,oOptions)}new LazyLoad(oObjects,oOptions)}}();$SYSMSG.extend({A00001:"系统繁忙，请稍候再试。",A00007:"未登录。",A00112:"博客名称超长。",A00113:"您已开通博客，请点击<a href='http://control.blog.sina.com.cn/blogprofile/index.php'>个人中心</a>进入。",A00116:"不能包含 sina 等有特殊含义的字符。",A11003:"此账户已完成博客快速设置，点击确定，直接进入博客。",A44001:"博客个性地址不能为空。",A44002:"地址格式不对。",A44003:"抱歉，此地址已被占用。",A44005:"抱歉，请按照正确格式填写博客地址。"});!function(){if(scope.blogOpener){scope.addBlogOpenerEvent=function(){};return}var openURL="http://control.blog.sina.com.cn/riaapi/reg/open_blog.php";var openBlog=function(){this._hasInit=false};openBlog.prototype={getCon:function(){var checkcodeHTML=['<div class="boxA" style="margin: 20px 0; overflow: hidden; zoom: 1;">','<div id="checkCodeBox_open_msg" class="check-code-box clearfix" > </div>',"</div>"].join("");return['<div class="CP_layercon8">'+'<div class="nowOpenBlog">'+"<strong>您的博客尚未开通,仅一步操作就能开通您的个人博客</strong>"+'<div class="boxA">'+"<label>博客名称：</label>"+'<input id="blogNameInput_t" type="text" class="ipt" />'+'<img style="display:none" id="blogNameIcon_t" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" class="SG_icon SG_icon49 tips">'+'<p id="blogNameError_t" class="tip">名称不能为空</p>'+"</div>"+'<div  class="boxA"> '+"<p>隐私设置："+'<input type="radio" name="isPrivate_t" checked id="openAll1_t" class="rd" /><label for="openAll1_t">对所有人开放</label>'+'<input type="radio" name="isPrivate_t" id="openMe1_t" class="rd" /><label for="openMe1_t">仅对自己开放，私密博客</label>'+"</p>"+"</div>"+checkcodeHTML+'<div id="ErrTips_t" class="ErrTips">系统繁忙，请稍后再试</div>'+'<div class="boxB">'+'<p><a id="openBlogOkBtn_t" class="btn" href="javascript:void(0)">完成开通</a><a id="openBlogCancel" href="javascript:void(0)">取消</a></p>'+"</div>"+"</div>"+"</div>"].join("")},_initDialog:function(){var _this=this;Lib.checkAuthor(function(){_this.key=getKeyName();_this._dialog=winDialog.createCustomsDialog({content:_this.getCon()},"openblog");var checkCodeBox_open_msg={id:"#checkCodeBox_open_msg"};checkManager_open_msg=new Lib.checkManager(checkCodeBox_open_msg);_this.bindEvent();blogNameEvent($E("blogNameInput_t"),$E("blogNameError_t"),[],$E("blogNameIcon_t"))},"openblog"+(new Date).getTime())},showDialog:function(callBack,needToOpen,forceOpen){needToOpen=needToOpen||false;if(!this._hasInit){this._initDialog();this._hasInit=true}var me=this;scope.whenOpenBlogCallback=callBack;if(!scope.hasOpenBlog){trace("这是一位后登陆的用户");var t=0;var timmer=setInterval(function(){trace("呀，怎么还没有出结果啊--"+t);if(scope.hasOpenBlog){clearInterval(timmer);if(scope.hasOpenBlog=="open"){trace("并且他开通的博客");if(scope.whenOpenBlogCallback){scope.whenOpenBlogCallback()}}else{trace("他们没有开通博客");me._showDialog(needToOpen)}}t++;if(t==10){Lib.checkAuthor(function(){trace("等不及了，自己发吧。。。");clearInterval(timmer);new Interface("http://control.blog.sina.com.cn/riaapi/profile/unread.php","jsload").request({GET:{uid:$UID,product:"blog"},onSuccess:function(data){scope.hasOpenBlog=data.isbloguser==1?"open":"no";trace("~~~~~~~~~~~~~~~~~~~"+scope.hasOpenBlog);if(scope.hasOpenBlog=="open"){trace("并且他开通的博客");if(scope.whenOpenBlogCallback){scope.whenOpenBlogCallback()}}else{if(!$E("openblogcss")){Utils.Io.loadCss({id:"openblogcss",url:$_GLOBAL.cssBasicURL+"module/layer/re_nowopen.css"})}trace("他们没有开通博客");me._showDialog(needToOpen)}}})},"openblogshowDialog"+(new Date).getTime())}},10)}else{trace("这是已登陆的用户");if(scope.hasOpenBlog=="open"){trace("并且他开通的博客");if(scope.whenOpenBlogCallback){scope.whenOpenBlogCallback()}}else{if(!$E("openblogcss")){Utils.Io.loadCss({id:"openblogcss",url:$_GLOBAL.cssBasicURL+"module/layer/re_nowopen.css"})}trace("他们没有开通博客");this._showDialog(needToOpen)}}if(forceOpen){$E("openBlogCancel").style.display="none";this._dialog.getNodes().btnClose.style.display="none"}},_showDialog:function(needToOpen){$E("blogNameInput_t").value=getShotName();hiddenError($E("blogNameError_t"),$E("blogNameIcon_t"));$E("ErrTips_t").style.visibility="hidden";$E("blogNameIcon_t").style.display="none";this._dialog.show();this._dialog.setAreaLocked(true);this._dialog.setMiddle()},bindEvent:function(){var me=this;Core.Events.addEvent($E("openBlogCancel"),function(){me.closeDialog();return false});Core.Events.addEvent($E("openBlogOkBtn_t"),function(){if(!checkManager_open_msg.validate()){if(!$E("comment_check_img")){winDialog.alert("请拖动滑块儿开始验证")}else{winDialog("验证码不能为空")}return}whenOpenBlog({nameErrorEle:$E("blogNameError_t"),nameOkIcon:$E("blogNameIcon_t"),openName:$E("blogNameInput_t").value||getShotName(),isprivate:$E("openAll1_t").checked?0:1,errorEle:$E("ErrTips_t"),from:"floatingLayer",okCallback:function(res,blogInfo){if(scope.whenOpenBlogCallback){scope.whenOpenBlogCallback(res,blogInfo)}if($E("openedBlogTray")&&$E("openedBlogTray").style.display=="none"){$E("outOfOpenBlogTray").style.display="none";$E("noOpenedBlogTray").style.display="none";$E("openedBlogTray").style.display=""}if($E("noOpendBlogSearchTip")&&$E("noOpendBlogSearchTip").style.display=="block"){$E("noOpendBlogSearchTip").style.display="none";$E("opendBlogSearchTip").style.display="block"}scope.hasOpenBlog="open";me.closeDialog();scope.whenOpenBlogCallback=function(){}}});return false})},closeDialog:function(){var me=this;this._dialog.hidden()}};function getShotName(){var val=$nick;var nameLen=Core.String.byteLength(val);while(nameLen>18){val=val.substring(0,val.length-1);nameLen=Core.String.byteLength(val)}return val+"的博客"}scope.openBlogGetShotName=getShotName;function blogNameEvent(inputEle,errEle,optArr,icon){inputEle.onfocus=function(){inputEle.className="ipt focus";styleThey(optArr,"");icon.style.display=""};inputEle.onblur=function(){inputEle.className="ipt";checkBlogName(inputEle,errEle,icon);styleThey(optArr,"none")};inputEle.onkeyup=function(){checkBlogName(inputEle,errEle,icon)}}scope.openBlogNameEvent=blogNameEvent;function whenOpenBlog(opt){if(whenOpenBlog.requestComplete===false){return}if(opt.nameErrorEle.innerHTML){changeTextBgC(opt.nameErrorEle.parentNode);setTimeout(function(){changeTextBgC(opt.nameErrorEle.parentNode)},442);return}var targetButtonId=opt.from==="floatingLayer"?"openBlogOkBtn_t":"openBlogOkBtn";$E(targetButtonId).className="loading";var blogInfo={loginName:getKeyName(),blogName:opt.openName};var my_data={uid:$UID,loginname:blogInfo.loginName,blogname:blogInfo.blogName,version:7,src:"layer",isprivate:opt.isprivate};var data_my=checkManager_open_msg.getPostData(my_data);new Interface(openURL,"jsload").request({GET:data_my,onSuccess:function(res){whenOpenBlog.requestComplete=true;$E(targetButtonId).className="btn";opt.okCallback(res,blogInfo);blogInfo=null},onError:function(res){var nameErr=$E("blogNameError"),nameIcon=$E("blogNameIcon"),layerNameErr=$E("blogNameError_t"),layerNameIcon=$E("blogNameIcon_t");switch(res.code){case"A11008":if(nameErr&&nameIcon){showError(nameErr,"输入内容有误，请修改",nameIcon)};if(layerNameErr&&layerNameIcon){showError(layerNameErr,"输入内容有误，请修改",layerNameIcon)};break;case"A11010":if(nameErr&&nameIcon){showError(nameErr,"输入内容有误，请修改",nameIcon)};if(layerNameErr&&layerNameIcon){showError(layerNameErr,"输入内容有误，请修改",layerNameIcon)};break;case"B36002":winDialog.alert("验证码错误，请修改。");break;default:showError(opt.errorEle,"系统繁忙，请稍后再试。");break}whenOpenBlog.requestComplete=true;$E(targetButtonId).className="btn"}})}scope.openBlogWhenOpenBlog=whenOpenBlog;function changeTextBgC(ele){for(var i=1;i<=55;i++){!function(val){setTimeout(function(){ele.style.backgroundColor="rgb(255, "+ +(200+val)+", "+(200+val)+")"},val*8)}(i)}}function getKeyName(){var SUBPCookie=Utils.Cookie.getCookie("SUBP");var arrSubp=sinaSSOEncoder.getSUBPCookie.decode(SUBPCookie);var key=arrSubp.ln;return key}function styleThey(eleArr,str){for(var i=0;eleArr[i];i++){eleArr[i].style.display=str}}function checkBlogName(inputEle,errEle,icon){var val=inputEle.value;if(/^(?:\s|[　])+|(?:\s|[　])+$/.test(val)){inputEle.value=Core.String.trim(val);val=inputEle.value}if(val){var nameLen=Core.String.byteLength(val);if(nameLen>24){showError(errEle,"博客名称超长",icon)}else{hiddenError(errEle,icon)}}else{showError(errEle,"博客名称不能为空",icon)}}function showError(ele,str,icon){ele.innerHTML=str;ele.style.display="block";if(ele.id.indexOf("ErrTips")>=0){ele.style.visibility="visible"}if(icon){icon.className="SG_icon SG_icon48 tips"}}function hiddenError(ele,icon){ele.innerHTML="";ele.style.display="none";if(icon){icon.className="SG_icon SG_icon49 tips"}}scope.blogOpener=new openBlog;scope.addBlogOpenerEvent=function(el){Core.Events.addEvent(el,function(e){scope.blogOpener.showDialog(function(res,blogInfo){Lib.LocalDB.clearCache(1,"uid_"+$UID+"unread");Lib.util.LS.removeItem("uid"+$UID);if(scope.$pageid=="fakeIndex"){window.location.href="http://i.blog.sina.com.cn/blogprofile/index.php?atten=1";return}if($E("openedBlogTray")){$E("openedBlogTray").style.display="";$E("noOpenedBlogTray").style.display="none";$E("outOfOpenBlogTray").style.display="none";if(blogInfo){$E("loginBarAppMenuLabel").innerHTML=blogInfo.loginNick}}else{var wnd=window;wnd.$tray&&wnd.$tray.renderLogin()}var successOpenFun=function(){if(scope.___importV){scope.___importV();scope.___openBlogFlag=1}};var alertConf={subText:!scope.___importV?['<div class="CP_w_cnt SG_txtb">欢迎您在新浪博客安家！除了写博客，看博客外，您还可以进入个人中心完善您的个人资料，更有很多有趣的应用等着您哦。</div>','<ul class="CP_w_part CP_w_aLine">','<li><a href="http://control.blog.sina.com.cn/blogprofile/index.php" onclick="winDialog.getDialog(\'unregister\').hidden();" target="_blank">到博客个人中心&gt;&gt;</a></li>',"</ul>"].join(""):"",icon:"03",funcOk:successOpenFun,funcClose:successOpenFun,width:300};winDialog.alert("开通博客成功",alertConf,"unregister");var commentNickEl=$E("commentNick");if(commentNickEl){var child=commentNickEl.firstChild;while(child){commentNickEl.removeChild(child);child=commentNickEl.firstChild}commentNickEl.innerHTML=blogInfo.loginNick+":"}},true)},"click")}}();Lib.register("TrayPanel",function(lib){var _addEvt=Core.Events.addEvent;var _removeEvt=Core.Events.removeEvent;var _getCookie=Utils.Cookie.getCookie;var _contains=Core.Dom.contains;var JSON=lib.util.JSON;var byClass=Core.Dom.getChildrenByClass;var logoId="login_bar_logo_link_350";var _trayHolder="______noticeTrayHolder";var loadCount=0;var tray=null;var renderLogin=!1;var attr=function(el,attr,v){if(typeof v!=="string"){return el.getAttribute(attr)}else{el.setAttribute(attr,v)}};var TrayPanel=Core.Class.define(function(){var $topBaner=byClass(document.body,"nsinatopbar")[0];
var $main=this.$main=byClass($topBaner,"ntopbar_main")[0];this.newTipsLog=0;lib.Panel.prototype.initialize.call(this,{appendTo:$main,isPostion:!1,noIframe:!0});lib.Listener.on({name:"tray-data-loaded",callBack:this.showPublishWare,scope:this},{name:"tray-newmsg-loaded",callBack:this.showNewMsgTips,scope:this},{name:"global-login-out",callBack:function(){clearInterval(this._msgTimer)},scope:this},{name:"tray-announce-loaed",callBack:function(json){var args=arguments;var $this=this;if(this.notice){this.notice.update(json);return}setTimeout(function(){args.callee.call($this,json)},200)},scope:this},{name:"tray-unread-panel-hide",callBack:function(){var $trayMsg=this.getNode("trayMsg");var data=JSON.parse($trayMsg.getAttribute("msg-count"));this.showNewMsgTips(data,1)},scope:this},{name:"tray-unread-panel-show",callBack:function(){var $tips=this.getNode("newTips");$tips.style.display="none"},scope:this},{name:"tray-msg-panel-hide",callBack:function(){var $trayMsg=this.getNode("trayMsg");var data=JSON.parse($trayMsg.getAttribute("msg-count"));this.showNewMsgTips(data,1)},scope:this},{name:"tray-announce-close",callBack:function(json){this.setTrayPosition()},scope:this},{name:"topad680-show-start",callBack:function(data){this._hideActiveSub()},scope:this});if(loadCount){loadCount++}},lib.Panel,{subPanels:[],hoverTimeout:"",hoverTime:400,load:function(loginState){if(!loadCount){var $logo=$E(logoId);if($logo&&$_GLOBAL&&$_GLOBAL.platformTrayLogo){if(!$IE6&&$_GLOBAL.platformTrayLogo.imgForOtherBrs){$logo.children[0].src=$_GLOBAL.platformTrayLogo.imgForOtherBrs}else if($_GLOBAL.platformTrayLogo.imgForIE6){$logo.children[0].src=$_GLOBAL.platformTrayLogo.imgForIE6}}this.initSearch()}switch(loginState){case"login":if(/ipad/i.test(navigator.userAgent)){v7sendLog("48_01_02")}var start_time=new Date;var $this=this;lib.tray.loadUserInfo($UID,function(info){scope.unreadMsg=info;scope.nickname=info["full_nickname"];scope.loginUserWtype=info["login_wtype"];if(!$this._isRenderUser){$this.renderRight(lib.tray.tpl.loginMemu);$this._isRenderUser=!0}var $nick,$userInfo,$msnHolder;if(info.isbloguser){var $noOpenBlog=$this.getNode("noOpenBlog");$noOpenBlog.style.display="none";$this.initUserMenu();$this.initBlogMenu(info);$this.initNewMsgEvt();$this.initMsg();$this.initMsgLoder();$this.initHideSub();$this.initunReadMsgPanel();$nick=$this.getNode("userNick");$userInfo=$this.getNode("openBlog")}else{$nick=$this.getNode("ssoNick");$nick.href="http://control.blog.sina.com.cn/myblog/htmlsource/blog_notopen.php?uid="+$UID+"&version=7";$this.initOpenBlog();$this.initLogout();$userInfo=$this.getNode("noOpenBlog")}$nick.innerHTML="";var $nickTxt=document.createTextNode(info.nickname);$nick.appendChild($nickTxt);$userInfo.style.display="block";var isMsnLogin=Utils.Cookie.getCookie("loginFromMsn");if(isMsnLogin&&$nick){$msnHolder=$this.getNode("msnHolder");$msnHolder.style.display="block";var $msnLink=$this.getNode("msnLink");$msnLink.href+=$UID}if($msnHolder){Core.Dom.insertAfter($msnHolder,$nick.parentNode)}$this.initNotice()});break;case"logout":if(!this.trayLogin){this.trayLogin=new lib.Login.Ui;this.renderRight(lib.tray.tpl.loginOutMemu)}this.initLogin();this.initNotice();break;case"oncelogedon":break}loadCount++},initMsgLoder:function(){if(!this.msgLoader){this.msgLoader=new lib.tray.MsgLoader;this.msgLoader.load($UID);var $this=this;this._msgTimer=setInterval(function(){$this.msgLoader.load($UID)},30*1e3)}},initLogin:function(){var $this=this;var isInit=attr(this._el,"login");if(!isInit){attr(this._el,"login","1");_addEvt(this._el,function(evt){var data=lib.util.getActionData(evt,"tray-login-btn");if(!data){return}if(typeof sinaSSOController!="undefined")sinaSSOController.loginExtraQuery={};$this.trayLogin.login(function(){Lib.checkAuthor(function(){var str=$UID==scope.$uid?"02":"01";v7sendLog("87_01_"+str+"_"+$UID,scope.$pageid)},"tray"+(new Date).getTime());setTimeout(function(){window.location=window.location.toString().replace(/#.*/,"")},100)},false,"referer:"+location.hostname+location.pathname+",func:0007")},"click")}},initLogout:function(){var $loginOut=this.getNode("ssoLoginOut");var isInit=attr($loginOut,"loginout");if(!isInit){attr(this._el,"login","1");_addEvt($loginOut,function(){lib.tray.loginOut(null,!0)})}$loginOut=null},initHideSub:function(){var $this=this;_addEvt(document.body,function(evt){if(!$this._activeTab){return}var target=evt.target||evt.srcElement;var panels=$this.subPanels;var item;for(var i=panels.length-1;i>=0;i--){item=panels[i];if(item.tab===target||_contains(item.tab,target)){return}if(item.panel.entity===target||_contains(item.panel.entity,target)){return}}$this._hideActiveSub()},"click");_addEvt(window,function(){var activeTab=$this._activeTab;if(!activeTab){return}var $tabEl=activeTab.tab;var panel=activeTab.panel;var offsetLeft=activeTab.left;var offsetTop=activeTab.top;var x=Core.Dom.getLeft($tabEl)+$tabEl.offsetWidth+offsetLeft;var y=Core.Dom.getTop($tabEl)+$tabEl.offsetHeight+offsetTop;if($IE6&&this.isFixed){x=x-document.documentElement.scrollLeft;y=y-document.documentElement.scrollTop}panel.setPosition(x,y)},"resize")},_hideActiveSub:function(){var $this=this;if($this._activeTab){var tabEl=$this._activeTab.tab;var panel=$this._activeTab.panel;$this._activeTab=null;panel.hidden();tabEl.className=tabEl.className.replace(/(?:[ ]*)\bcurrent\b/g,"")}},initUserMenu:function(){var $bindEl=this.getNode("userMenu");var isInit=attr($bindEl,"init");if(!isInit){attr($bindEl,"init","1");var $this=this;var hasEmail;var $tabEl=$this.getNode("userMenu");var userMenu=$this._findSub("userMenu");var flag=0;Lib.util.hoverJq({elm:$bindEl,mouseenter:function(e,el,i){clearTimeout($this.hoverTimeout);if(!flag){flag=1;var panel;if(!userMenu){panel=new lib.tray.UserMenuPanel;$this.addSubPanel("userMenu",panel,$bindEl,$tabEl)}else{panel=userMenu.panel}var $userPanelNode=panel.getNode("panel");panel.initUserInfo($UID);Lib.util.hoverJq({elm:$userPanelNode,mouseenter:function(e,el,i){clearTimeout($this.hoverTimeout);$this._showPanel("userMenu",-160,0)},mouseleave:function(e,el,i){$this.hoverTimeout=setTimeout(function(){$this._hideActiveSub()},$this.hoverTime)}});getEmail(function(hasEmail){if(hasEmail){panel.getNode("mail").style.display=""}})}$this._showPanel("userMenu",-160,0)},mouseleave:function(e,el,i){$this.hoverTimeout=setTimeout(function(){$this._hideActiveSub()},$this.hoverTime)}});var getEmail=function(cb){if(typeof hasEmail==="boolean"){cb(hasEmail)}else{Utils.Io.JsLoad.request("http://service.mail.sina.com.cn/mailproxy/mail.php",{onComplete:function(){var email=sinamailinfo.email;if(email!=""){hasEmail=!0}else{hasEmail=!1}cb(hasEmail)},onException:function(){}})}}}},initBlogMenu:function(info){var $bindEl=this.getNode("addArticle");var isInit=attr($bindEl,"init");if(!isInit){attr($bindEl,"init","1");var $this=this;var $tabEl=$this.getNode("blogMenu");var flag=0;Lib.util.hoverJq({elm:$tabEl,mouseenter:function(e,el,i){clearTimeout($this.hoverTimeout);if(!flag){flag=1;var blogMenu=$this._findSub("blogMenu");var panel;if(!blogMenu){panel=new lib.tray.BlogMenuPanel;$this.addSubPanel("blogMenu",panel,$bindEl,$tabEl);if(info["tbh_status"]===1){panel.getNode("tbh_status").style.display=""}}var $blogMenuPanel=panel.getNode("panel");Lib.util.hoverJq({elm:$blogMenuPanel,mouseenter:function(e,el,i){clearTimeout($this.hoverTimeout);$this._showPanel("blogMenu",-74,0)},mouseleave:function(e,el,i){$this.hoverTimeout=setTimeout(function(){$this._hideActiveSub()},$this.hoverTime)}})}$this._showPanel("blogMenu",-74,0)},mouseleave:function(e,el,i){$this.hoverTimeout=setTimeout(function(){$this._hideActiveSub()},$this.hoverTime)}})}},initNotice:function(){var productName=scope.$PRODUCT_NAME;var pageId=scope.$pageid;if("blog7"!==productName){this.noNotice=!0;return}if(-1===pageId.indexOf("article")&&-1===pageId.indexOf("index")){this.noNotice=!0;return}var flagUid=_getCookie("closeNotice_fzp");var $blogBody=$E("sinablogHead");var _this=this;Lib.checkAuthor(function(){if(flagUid&&flagUid===$UID||!$blogBody){_this.noNotice=!0;return}if(!_this.notice){var notice=new lib.tray.BlogNotice({appendTo:$E(logoId).parentNode,isPostion:!1,noIframe:!0});_this.notice=notice;var $this=_this;var height=$blogBody.offsetHeight+30;var logFlag;var onshow=function(){var doc=document;var scrolltop=doc.body.scrollTop+doc.documentElement.scrollTop;if(scrolltop>height){$this.hideActive();$this.setTrayFixed();if(!logFlag){logFlag=1;v7sendLog("48_01_11_"+scope.$pageid)}}else{setTimeout(function(){$this.setTrayPosition();notice.hide()})}};_addEvt(window,onshow,"scroll");lib.Listener.on({name:"tray-announce-close",callBack:function(){_removeEvt(window,onshow,"scroll")}})}},"tray1"+(new Date).getTime())},initNewMsgEvt:function(){var tpl=this.tpl;var $newTips=this.getNode("newTips");var isInit=attr($newTips,"init");if(!isInit){attr($newTips,"init","1");var $this=this;_addEvt($newTips,function(evt){evt=evt||window.event;var $target=evt.target||evt.srcElement;Core.Events.stopEvent(evt);$target.style.display="none";$target.innerHTML="";var $msgTab=$this.getNode("trayMsg");Core.Events.fireEvent($msgTab,"click")},"click");$newTips=null}},initMsg:function(){var $bindEl=this.getNode("trayMsg");var isInit=attr($bindEl,"init");if(!isInit){attr($bindEl,"init","1");var $this=this;var flag=0;Lib.util.hoverJq({elm:$bindEl,mouseenter:function(e,el,i){clearTimeout($this.hoverTimeout);if(!flag){flag=1;var ev=window.event||e;if(ev.preventDefault){ev.preventDefault()}else{ev.returnValue=false}var $bindEl=$this.getNode("trayMsg");var msgPanel=$this._findSub("msgPanel");var panel;if(!msgPanel){panel=new Lib.tray.msgSummaryPanel($bindEl);$this.addSubPanel("msgPanel",panel,$bindEl,$bindEl)}var $msgPanel=panel.getNode("panel");Lib.util.hoverJq({elm:$msgPanel,mouseenter:function(e,el,i){clearTimeout($this.hoverTimeout);$this._showPanel("msgPanel",-400,0)},mouseleave:function(e,el,i){$this.hoverTimeout=setTimeout(function(){$this._hideActiveSub()},$this.hoverTime)}})}$this._showPanel("msgPanel",-400,0)},mouseleave:function(e,el,i){$this.hoverTimeout=setTimeout(function(){$this._hideActiveSub()},$this.hoverTime)}})}},initunReadMsgPanel:function(){var $bindEl=this.getNode("trayMsg");var isInit=attr($bindEl,"init-unre");if(!isInit){attr($bindEl,"init-unre","1");new lib.tray.unReadMsgPanel($bindEl)}},initSearch:function(){if(!loadCount){var panel=new lib.tray.SearchFormPanel({isPostion:!1,appendTo:"traySearchBar",noIframe:!0});panel.show();_addEvt(document.body,function(evt){evt=evt||window.event;var target=evt.target||evt.srcElement;var $query=panel.getNode("queryTxt");if($query!==target&&panel.entity!==target&&!_contains(target,panel.entity)){panel.catePanel.hide()}},"click")}},initOpenBlog:function(){var $openblogcss=$E("openblogcss");if(!$openblogcss){Utils.Io.loadCss({id:"openblogcss",url:$_GLOBAL.cssBasicURL+"module/layer/re_nowopen.css"});var $openBlog=this.getNode("openBlogBtn");scope.addBlogOpenerEvent($openBlog)}},notifyMsgPanel:function($msgTab){var newMsg=$msgTab.getAttribute("msg-count");if(newMsg){try{newMsg=JSON.parse(newMsg)}catch(e){newMsg={}}}else{newMsg=-1}},renderRight:function(tpl){this.setTemplate(tpl);this._el=this.entity;var $loading=byClass(this.$main,"ntopbar_loading")[0];$loading.style.display="none";this.show()},addSubPanel:function(name,panel,bindEl,tabEl){var $this=this;this.subPanels.push({name:name,tab:tabEl,bind:bindEl,panel:panel})},_showPanel:function(name,offsetLeft,offsetTop){var subBar=this._findSub(name);if(!subBar){return}var panel=subBar.panel;var $tabEl=subBar.tab;panel.entity.style.zIndex=512;if("msgPanel"===name){var $newTips=this.getNode("newTips");this.notifyMsgPanel($tabEl);$newTips.style.display="none"}var i,item,$tab;item=this._activeTab;if(item){$tab=item["tab"];if($tab===$tabEl){return}item["panel"].hide();$tab.className=$tab.className.replace(/(?:[ ]*)\bcurrent\b/g,"")}var className=$tabEl.className;if(!/\bcurrent\b/.test(className)){$tabEl.className+=" current"}this._activeTab={name:name,tab:$tabEl,panel:panel,left:offsetLeft,top:offsetTop};var $entity=panel.entity;if(this.isFixed&&(!$IE||$IE>6)){$entity.style.position="fixed"}else{$entity.style.position="absolute"}panel.showWithDom($tabEl,offsetLeft,offsetTop)},_findSub:function(name){var item;for(var i=this.subPanels.length-1;i>=0;i--){item=this.subPanels[i];if(name===item.name){return item}}return null},showNewMsgTips:function(data,sign){var sum=data.sum-data.feed;var $tips=this.getNode("newTips");var $trayMsg=this.getNode("trayMsg");if(sum){if($trayMsg.getAttribute("unread-show-state")==0&&$trayMsg.getAttribute("msg-panel-show-state")==0){$tips.style.display="block"}if(scope.$pageid=="editor"){$tips.style.display="block"}var offsetWidth=this.entity.offsetWidth;$tips.style.left=offsetWidth-$tips.offsetWidth-10+"px";if(sum<10){$tips.innerHTML=sum}else{$tips.innerHTML="•••"}if(!this.newTipsLog){v7sendLog("40_01_49_"+$UID);this.newTipsLog=1}$trayMsg.setAttribute("msg-count",JSON.stringify(data));this.startTitleTips(sum)}else{$trayMsg.setAttribute("msg-count",JSON.stringify(data));this.stopTitleTips()}var feed=data.feed;if(feed){var $feed=this.getNode("newFeed");$feed.style.display="block";var offsetWidth=this.entity.offsetWidth;$feed.style.left=offsetWidth-$feed.offsetWidth-197+"px";feed=feed<10?feed:"•••";$feed.innerHTML=feed;if(!$feed.addEvt){$feed.addEvt=1;_addEvt($feed,function(){location.href="http://i.blog.sina.com.cn/blogprofile/index.php?com=1";$feed.style.display="none";$feed.innerHTML=""})}}},stopTitleTips:function(){if(scope.$pageid=="editor"){return}var title=document.title.replace(/\(\d+\+*\)/,"");document.title=title},startTitleTips:function(sum){if(scope.$pageid=="editor"){return}var title;if(sum){sum=sum>=1e5?"99999+":sum;if(/\(\d+\+*\)/.test(document.title)){title=document.title.replace(/\(\d+\+*\)/,"("+sum+")")}else{title="("+sum+")"+document.title}}document.title=title},hideActive:function(){var item,$tab;if(item=this._activeTab){item["panel"].hide();$tab=item["tab"];$tab.className=$tab.className.replace(/(?:[ ]*)\bcurrent\b/g,"");this._activeTab=null}},setTrayFixed:function(){var $logo=$E(logoId);this.notice.show();var $this=this;setTimeout(function(){$E("traySearchBar").parentNode.style.display="none";$logo.style.display="none";var $tray=$logo.parentNode.parentNode;if(!$IE||$IE>6){lib.Listener.notify("tray-scrolling-fix",{});$tray.style.position="fixed";$tray.style.top="0px"}else if($IE===6){if(!$this.__isFixie6){_addEvt(window,function(evt){if(!$this.isFixed){return}var oldScrollTop=document.documentElement.scrollTop;setTimeout(function(){var current=document.documentElement.scrollTop;if(oldScrollTop===current){$tray.style.display="block";$this._ie6fix(evt)}else if($this.isFixed){$tray.style.display="none"}},50)},"scroll");$this.__isFixie6=!0}}$tray.style.width="100%";if(!$E(_trayHolder)){var height=$tray.offsetHeight;var $holder=$C("div");$holder.style.height=height+"px";$holder.id=_trayHolder;Core.Dom.insertAfter($holder,$tray)}$this.isFixed=!0})},_ie6fix:function(evt){if(this.isFixed){var $logo=$E(logoId);var $tray=$logo.parentNode.parentNode;$tray.style.position="absolute";$tray.style.top=document.documentElement.scrollTop+"px";var trayMsg=this.getNode("trayMsg");if(trayMsg){trayMsg.style.display="none";trayMsg.style.display=""}lib.Listener.notify("tray-scrolling-fix",{})}},setTrayPosition:function(){if($IE6){var trayMsg=this.getNode("trayMsg");if(trayMsg){trayMsg.style.display="none";trayMsg.style.display=""}}lib.Listener.notify("tray-scrolling-nofix",{});var $logo=$E(logoId);var $tray=$logo.parentNode.parentNode;if($E(_trayHolder)){$tray.parentNode.removeChild($E(_trayHolder))}$tray.style.position="";var $search=$E("traySearchBar");$search.style.position="";$search.style.top="";this.notice.hide();$tray.style.display="block";$logo.style.display="block";$E("traySearchBar").parentNode.style.display="block";this.isFixed=!1}});Lib.tray.TrayPanel=TrayPanel;return function(){if(!tray){tray=new TrayPanel}return tray}});Core.System.htmlFilter=function(content){var codeHash={"&":"&#038;","<":"&#060;",">":"&#062;"};var k;for(k in codeHash){content=content.replace(new RegExp(k,"g"),codeHash[k])}return content};Core.Dom.removeClassName=Core.Dom.removeClass;scope.trayPlusTemplayLogout=['<div class="topbar_menu">','<span class="link"><a target="_blank" href="http://blog.sina.com.cn">博客首页</a></span>','<span class="line_s"></span>',"</div>",'<div class="topbar_login"><a id="linkTrayLogin" class="login" href="javascript:;">登录</a><a id="linkReg" target="_blank" class="register" href="">注册</a></div>','<div id="divPopularize" class="topbar_ad"></div>','<div id="loginBarActivity" class="topbar_activity"></div>'].join("");scope.trayPlusTemplayLogin=['<div class="topbar_menu" id="openedBlogTray">','<span id="loginBarOptApp" class="link"><a id="loginBarAppMenuLabel" href="javascript:;">读取中...</a><a href="javascript:;" class="link_arrow" title=""></a></span>','<span class="line_s"></span>','<span style="display:none;" id="loginBarMail" class="link imfor blog_to_mail"><a target="_blank" href="http://mail.sina.com.cn/?s=2">邮件</a><div id="mailpiaohong" style="display:none;" class="imforbox"></div></span>','<span class="line_s" style="display:none;" id="line"></span>','<span id="loginBarCenter" class="link"><a target="_self" href="http://i.blog.sina.com.cn/blogprofile/index.php?com=1">个人中心</a></span>','<span class="line_s"></span>','<span id="loginBarFriend" class="link"><a target="_blank" href="http://control.blog.sina.com.cn/blogprofile/profilefriendlist.php">好友</a></span>','<span class="line_s"></span>','<span id="loginBarInbox" class="link imfor"><img id="imgNewMessage" style="display:none;" class="topbar_msg" src="http://simg.sinajs.cn/blog7style/images/common/topbar/topbar_msg.gif"/><a href="#" onclick="return false;">消息</a><a href="#" onclick="return false;" class="link_arrow" title=""></a><div id="ccnotepiaohong" style="display:none;" class="imforbox"></div></span>','<span class="line_s"></span>','<span class="link" id="logOut"><a href="#">退出</a></span>',"</div>",'<div style="display:none" class="topbar_menu" id="noOpenedBlogTray">','<span class="link" style="cursor:default;"><a id="noOpenBlogName">读取中...</a></span>','<span class="line_s"></span>','<span class="link"><a href="#">退出</a></span>',"</div>",'<div class="topbar_noopen" style="display:none" id="outOfOpenBlogTray">','<a id="openBlogBtnTray" title="立即开通博客" class="nowopen" href="javascript:void(0)" onclick="return false;"></a>',"</div>",'<div id="loginBarActivity" class="topbar_activity"></div>'].join("");scope.trayPlusTemplayOnceLoged=['<div class="topbar_menu" id="openedBlogTray">','<span id="loginBarOptApp" class="link"><a id="loginBarAppMenuLabel" href="javascript:;">读取中...</a></span>','<span class="line_s"></span>','<span id="loginBarMail" class="link imfor blog_to_mail"><a target="_blank" href="http://mail.sina.com.cn/?s=2">邮件</a><div id="mailpiaohong" style="display:none;" class="imforbox"></div></span>','<span class="line_s" id="line"></span>','<span id="loginBarCenter" class="link"><a target="_self" href="http://i.blog.sina.com.cn/blogprofile/index.php?com=1">个人中心</a></span>','<span class="line_s"></span>','<span id="loginBarFriend" class="link"><a target="_blank" href="http://control.blog.sina.com.cn/blogprofile/profilefriendlist.php">好友</a></span>','<span class="line_s"></span>','<span id="loginBarInbox" class="link imfor"><img id="imgNewMessage" style="display:none;" class="topbar_msg" src="http://simg.sinajs.cn/blog7style/images/common/topbar/topbar_msg.gif"/><a href="#" onclick="return false;">消息</a><div id="ccnotepiaohong" style="display:none;" class="imforbox"></div></span>',"</div>",'<div style="display:none" class="topbar_menu" id="noOpenedBlogTray">','<span class="link" style="cursor:default;"><a id="noOpenBlogName">读取中...</a></span>','<span class="line_s"></span>','<span class="link"><a href="#">退出</a></span>',"</div>",'<div class="topbar_noopen" style="display:none" id="outOfOpenBlogTray">','<a id="openBlogBtnTray" title="立即开通博客" class="nowopen" href="javascript:void(0)" onclick="return false;"></a>',"</div>",'<div id="divPopularize" class="topbar_ad"></div>','<div id="loginBarActivity" class="topbar_activity"></div>'].join("");scope.newStatusTipTemplay=['<div class="tb_layer_arrow"></div>','<div class="tb_layer_Y_main tip_ps" style="width:130px;text-align:left;padding:5px 0 2px 5px;color:#000000">','<a onclick="$E(\'newStatusTip\').style.display=\'none\';return false" href="#" class="tb_friend_inputDel" title="关闭" style="margin-top: 5px;"></a>','<a href="http://i.blog.sina.com.cn/blogprofile/index.php?type=3&from=newstatus&com=2"><span id="nstFeed" style="padding:2px 2px;display:none;">你有<span style="color:red">新动态</span>可查看</span></a>','<a href="http://control.blog.sina.com.cn/blogprofile/profileremind.php?com=2"><span id="nstFavorite" style="padding:3px 2px;display:none;">你有博文被<span style="color:red">转载/收藏</span></span></a>','<img id="gbimg" class="SG_icon SG_icon83" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="17" height="15" align="absmiddle" style="display:none"/><a style="display:none" href="http://i.blog.sina.com.cn/blogprofile/index.php?com=g" id="gbmsg">官博<em>新动态</em></a>',"</div>"].join("");scope.onceLogedStatusTipTemplay=['<div class="tb_layer_arrow"></div>','<div class="tb_layer_Y_main tip_ps" style="width:130px;text-align:left;padding:5px 0 2px 5px;color:#000000">','<a onclick="$E(\'newStatusTip\').style.display=\'none\';return false" href="#" class="tb_friend_inputDel" title="关闭" style="margin-top: 5px;"></a>','<a href="javascript:void(0);return false;"><span id="nstUnread" style="padding:3px 2px;display:none;">你有<span style="color:red">未读消息</span>可查看</span></a>','<a href="javascript:void(0);return false;"><span id="nstFeed" style="padding:2px 2px;display:none;">你有<span style="color:red">新动态</span>可查看</span></a>','<a href="javascript:void(0);return false;"><span id="nstUpdate" style="padding:3px 2px;display:none;">你最近浏览的博主<span style="color:red">有更新</span></span></a>','<a href="javascript:void(0);return false;"><span id="nstUnpub" style="padding:2px 2px;display:none;">你有<span style="color:red">尚未发表</span>的博文</span></a>',"</div>"].join("");scope.nicknamePanelTemplate=['<div id="#{panel}" class="tb_layer_Y tb_layer_w2" style="z-index:512;">','<div class="tb_layer_arrow"></div>','<div class="tb_layer_Y_main">','<div class="tb_ps">','<div class="tb_ps_list">',"<ul>","<li>",'<span class="tb_ps_nm"><a id="#{linkBlog}" href="javascript:;"><img class="SG_icon SG_icon15" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="博客" align="absmiddle" /><strong>博客</strong></a></span>','<span class="tb_ps_set">[<a target="_blank" id="#{linkPostBlog}" href="http://control.blog.sina.com.cn/admin/article/article_add.php">发博文</a>]</span>',"</li>","<li>",'<span class="tb_ps_nm"><a id="#{linkPhoto}" href="javascript:;"><img class="SG_icon SG_icon18" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="相册" align="absmiddle" /><strong>相册</strong></a></span>','<span class="tb_ps_set">[<a target="_blank" id="#{linkPostPhoto}" href="http://photo.blog.sina.com.cn/upload/upload.php">发图片</a>]</span>',"</li>","<li>",'<span class="tb_ps_nm"><a target="_blank" id="#{linkVBlog}" href="javascript:;"><img class="SG_icon SG_icon16" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="播客" align="absmiddle" /><strong>播客</strong></a></span>','<span class="tb_ps_set">[<a target="_blank" id="#{linkUpload}" href="http://vupload.you.video.sina.com.cn/u.php?m=1">发视频</a>][<a id="#{linkRecord}" href="http://vupload.you.video.sina.com.cn/r.php" target="_blank">录视频</a>]</span>',"</li>","<li>",'<span class="tb_ps_nm"><a id="#{miniblog}" href="javascript:;" target="_blank"><img class="SG_icon SG_icon51" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="微博" align="absmiddle" /><strong>微博</strong></a></span>',"</li>","<li>",'<span class="tb_ps_nm"><a id="#{mySpace}" href="javascript:;"><img class="SG_icon SG_icon41" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="关于我" align="absmiddle" /><strong>关于我</strong></a></span>',"</li>","</ul>",'<div class="clearit"></div>',"</div>",'<div class="tb_ps_manage">','<p><a target="_blank" id="#{linkChangeFace}" href="javascript:;">修改头像昵称</a></p>','<p><a target="_blank" id="#{linkChangePassword}" href="javascript:;">修改登录密码</a></p>','<p><a target="_blank" id="#{linkAccountSetup}" href="javascript:;">账号安全设置</a></p>','<p><a target="_blank" id="#{bindEmail}" href="javascript:;">绑定邮箱</a></p>',"</div>","</div>","</div>","</div>"].join("");scope.NicknamePanel=Core.Class.define(function(){Lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(scope.nicknamePanelTemplate)},Lib.Panel,{initUserInfo:function(uid){var nodes=this.getNodes();scope.$bindEmail=function(data){var node=nodes["bindEmail"];if(data.ret!="y"&&data.errcode!="not_verify"){node.parentNode.removeChild(node)}else{node.href="https://login.sina.com.cn/bindmail/bindmail.php?entry=blog"}};try{var AuthorInfo=Utils.Cookie.getCookie("SUBP");if(AuthorInfo&&AuthorInfo!=""){var arrSubp=sinaSSOEncoder.getSUBPCookie.decode(AuthorInfo);var username=arrSubp.ln;Utils.Io.JsLoad.request("https://login.sina.com.cn/bindmail/checkmailuser.php?entry=blog&name="+encodeURIComponent(username)+"&utf82bgk=1&callback=scope.$bindEmail",{noreturn:true})}}catch(e){}nodes["linkBlog"].href="http://blog.sina.com.cn/u/"+uid;nodes["linkPhoto"].href="http://photo.blog.sina.com.cn/u/"+uid;nodes["linkVBlog"].href="http://you.video.sina.com.cn/m/"+uid;nodes["miniblog"].href="http://control.blog.sina.com.cn/t_sina_blog/tb.php?uname="+uid;nodes["mySpace"].href="http://blog.sina.com.cn/s/profile_"+uid+".html";nodes["linkChangeFace"].href="http://control.blog.sina.com.cn/blogprofile/nick.php";nodes["linkChangePassword"].href="https://security.sina.com.cn/account/security?option=chgpwd&entry=blog ";nodes["linkAccountSetup"].href="https://security.sina.com.cn/account/security";var node=["linkBlog","linkPhoto","linkVBlog","miniblog","mySpace","linkChangeFace","linkChangePassword","linkAccountSetup"];for(var i=0;i<node.length;i++){nodes[node[i]].onclick=function(){v7sendLog("40_01_02_"+$UID)}}}});var st=['<div id="#{panel}" style="z-index:512;" class="tb_layerBox">',"<ul>",'<li id="#{blog}"><a href="javascript:;" onclick="v7sendLog(\'40_01_19\')">博文</a></li>','<li id="#{bauthor}"><a href="javascript:;" onclick="v7sendLog(\'40_01_19\')">博主</a></li>','<li id="#{song}"><a href="javascript:;" onclick="v7sendLog(\'40_01_19\')">音乐</a></li>','<li id="#{video}"><a href="javascript:;" onclick="v7sendLog(\'40_01_19\')">视频</a></li>','<li id="#{vauthor}"><a href="javascript:;" onclick="v7sendLog(\'40_01_19\')">播主 </a></li>',"</ul>","</div>"];scope.searchPanelTemplate=st.join("");scope.SearchPanel=Core.Class.define(function(){Lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(scope.searchPanelTemplate)},Lib.Panel,{config:{blog:{text:"博文",url:"http://search.sina.com.cn/?c=blog",keyName:"q",range:"article",by:"all"},bauthor:{text:"博主",url:"http://search.sina.com.cn/?c=blog",keyName:"q",range:"author",by:"all"},song:{text:"音乐",url:"http://music.sina.com.cn/yueku/search/s.php",keyName:"k",t:"song",s:"",ts:"",type:"",stype:""},video:{text:"视频",url:"http://search.video.sina.com.cn/search.php",keyName:"k",t:"",s:"sup",ts:"",type:"boke",stype:"1"},vauthor:{text:"播主",url:"http://search.video.sina.com.cn/search.php",keyName:"k",t:"",s:"sup",ts:"",type:"boke",stype:"3"}}});var st=['<div id="#{panel}" style="z-index:512;" class="tb_layer_Y tb_layer_w6" style="left:400px; top:700px;">','<div class="tb_layer_arrow"></div>','<div class="tb_layer_Y_main">','<div class="tb_mas" id="#{newInboxList}" style="">','<div class="tb_mas_list">','<ul id="#{changebgli1}"  style="display:none" >','<li  style="display:none" >','<span id="#{ccsysgonggao}" class="tb_friend_nm">[<strong>公告</strong>] <a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">新浪邀你一起共度中秋活动</a></span>','<span class="tb_friend_set"><a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">&gt;&gt;</a></span>',"</li>",'<li style="display:none">','<span id="#{ccsystongzhi}" class="tb_friend_nm">[<strong>通知</strong>] <a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">新浪2010邀你一起共度中秋活动...</a></span>','<span class="tb_friend_set"><a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">&gt;&gt;</a></span>',"</li>","</ul>",'<ul class="bd" id="#{changebgli2}">','<li  id="#{newInboxLoding}" style="cursor:default" ><div style="margin: 0pt; padding: 10px;text-align:center;"><img src="http://simg.sinajs.cn/blog7style/images/common/loading.gif"><div></li>','<li  id="#{nomsgli}" style="cursor:default;" >还没有消息</li>','<li style="float:none;"><span class="mas_more"><a id="#{mas_moremsg}" href="http://i.blog.sina.com.cn/blogprofile/profilelatestnote.php">全部消息</a></span></li>',"</ul>",'<div class="clearit"></div>',"</div>",'<ul class="commentslist" id="commentdata">','<li><a class="conn" href="http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=1">评论</a><a class="num" href="http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=1" id="#{commentRelapseCount}" ></a></li>','<li><a class="conn" href="http://i.blog.sina.com.cn/blogprofile/wall.php">留言</a><a class="num" href="http://i.blog.sina.com.cn/blogprofile/wall.php" id="#{guestBookCount}">1</a></li>','<li class="lst"><a class="conn" href="http://control.blog.sina.com.cn/blogprofile/profileinvitelist.php">好友邀请</a><a class="num" href="http://control.blog.sina.com.cn/blogprofile/profileinvitelist.php" id="#{inviteCount}" ></a></li>','<li><a class="conn" href="http://control.blog.sina.com.cn/blogprofile/profilepaperlist.php?type=1">纸条</a><a class="num" href="http://control.blog.sina.com.cn/blogprofile/profilepaperlist.php?type=1" id="#{messageCount}" ></a></li>','<li><a class="conn" target="_blank" href="http://mail.sina.com.cn" reject="1">邮箱</a><a class="num" href="http://mail.sina.com.cn" id="#{mailCount}" target="_blank" reject="1"></a></li>','<li><a class="conn" href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">系统消息</a><a class="num" href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote" id="#{sysnoticeCount}" ></a></li>',"</ul>","</div>","</div>","</div>"];scope.newInboxPanelTemplate=st.join("");Lib.LocalDB={_this:null,isFlashReady:false,FlaDom:null,updataFun:null,loadedFun:null,regiFun:[],regiFunArgs:[],scacheReady:function(){var me=Lib.LocalDB;me.isFlashReady=true;if(me.loadedFun){me.loadedFun(me._this)}var f=me.regiFun;var a=me.regiFunArgs;for(var i=0;i<f.length;i++){f[i].apply(null,a[i])}},registerFun:function(fun,args){this.regiFun.push(fun);var a=args||[];this.regiFunArgs.push(a)},set:function(key,data){if(this.isFlashReady){try{this.FlaDom.setLazyInterface(key,data);return true}catch(e){trace("set函数出错")}}return false},get:function(key,escapeMsecond,ignore){if(this.isFlashReady){try{return this.FlaDom.getLazyInterface(key,escapeMsecond,ignore)}catch(e){trace("get函数出错")}}return false},clearCache:function(escapeMsecond,key){if(this.isFlashReady){try{$E("scache").clearCache(escapeMsecond,key)}catch(e){trace("gclearCache函数出错")}}return false},loadFlash:function(containerDiv){var random="";if(window.$Maxthon||window.$360||window.$TT){random="?t="+Core.Math.getUniqueId()}if(!this.FlaDom){var FlashPlayer=new Utils.Flash.swfObject($_GLOBAL.flashBasicURL+"scache.swf"+random,"scache","1","1","9","#00ff00");FlashPlayer.addParam("quality","high");FlashPlayer.addParam("wmode","transparent");FlashPlayer.addParam("allowScriptAccess","always");
FlashPlayer.write(containerDiv);this.FlaDom=$E("scache")}},getServer:function(){try{return this.FlaDom.isServer()}catch(e){trace("判断是否是通信主机发生错误");return false}},login:function(uid){try{this.FlaDom.login(uid)}catch(e){trace("login函数出错");trace(uid)}},sendToClient:function(data){try{if(this.getServer()){this.FlaDom.sendToClient(data)}else{}}catch(e){trace("sendToClient函数出错")}},setClientJsFun:function(jsFun){try{if(this.getServer()){this.FlaDom.setClientJsFun(jsFun)}else{trace("非主机不可以设置接收函数")}}catch(e){trace("setClientJsFun函数出错")}},receive:function(data){this.updataFun(data)}};scope.msnTipsTemplate=['<div id="#{panel}" style="position: absolute; width: 369px; padding-top: 7px; font-size: 12px; z-index:511">',"<div  style=\"top: 0pt; left: 65px; position: absolute; width: 16px; height: 8px; background: url('http://simg.sinajs.cn/blog7style/images/special/move/bg_boxtop_01.png') no-repeat scroll 0pt 0pt transparent; z-index: 100;\"></div>","<div style=\"padding: 5px 6px 9px 14px; border: 1px solid rgb(181, 202, 214); background: url('http://simg.sinajs.cn/blog7style/images/special/move/bg_asiangames.jpg') no-repeat scroll left bottom rgb(255, 255, 255); z-index: 1;\">",'<p id="#{close}" class="close" style="float: right; margin: 0pt; cursor: pointer; width: 8px; height: 8px; font-size: 0pt;background:url(\'http://simg.sinajs.cn/blog7style/images/special/move/btn_close.gif\') no-repeat 0 0;"></p>','<div style="width: 342px; margin: 10px 0pt 0pt; padding: 0pt 0pt 3px;">','<a style="float: left; margin: 0pt 10px 0pt 0pt;" href="#"><img height="91" width="122" style="border: 0pt none;" alt="MSN" src="http://simg.sinajs.cn/blog7style/images/special/move/img_msnphoto.png"></a>','<h3 style="padding: 2px 0pt 5px; color: rgb(0, 0, 0); margin: 0pt; font-size: 12px;">各位拥有MSN帐号的同学注意啦!</h3>','<p style="width: 268px; display: inline; text-indent: 0pt; padding: 0pt; color: rgb(51, 51, 51); line-height: 19px;">新浪博客帐号与MSN帐号已经实现关联。您可以使用MSN帐号来登录博客，绑定后发博文、发图片可同步到Live，第一时间让您的MSN好友知晓。</p>',"</div>",'<p style="clear: both; height: 30px; margin: 12px 10px 4px 0pt; padding: 12px 0pt 0pt; border-top: 1px solid rgb(220, 213, 211); text-align: right;"><a style="float: right; color: rgb(176, 173, 172); margin-top: 10px; text-decoration: none;" href="javascript:void(0);" id="#{noMoreShow}">不再显示</a><a style="float: right; text-decoration: none; margin: 10px 14px 0pt 16px;color:#2d3186;" href="http://blog.sina.com.cn/s/blog_4b0f52990100lt3i.html">帮助</a><a id="#{setNow}"style="float: right;" href="http://control.blog.sina.com.cn/blogprofile/msnbind.php"><img height="32" width="105" style="border: medium none;" alt="立即设置" src="http://simg.sinajs.cn/blog7style/images/special/move/btn_receive01.jpg"></a></p>',"</div>","</div>"].join("");scope.msnTips=Core.Class.define(function(){Lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(scope.msnTipsTemplate)},Lib.Panel,{initUserInfo:function(nick,uid){var nodes=this.getNodes();this.setFixed($E("loginBarActivity"),-230,-2);var _this=this;nodes["close"].onclick=function(){_this.hidden()};nodes["noMoreShow"].onclick=function(){_this.hidden();Utils.Cookie.setCookie("noMoreMsnTips"+$UID,1,24*100,"/",".blog.sina.com.cn")};nodes["setNow"].onclick=function(){v7sendLog("95_02_01",scope.$pageid,"")}},setFixed:function(dom,offsetLeft,offsetTop){var _this=this;setTimeout(function(){_this.showWithDom(dom,offsetLeft,offsetTop);_this.fadeIn()},2e3);Core.Events.addEvent(window,function(){var x=Core.Dom.getLeft(dom)+dom.offsetWidth+offsetLeft;var y=Core.Dom.getTop(dom)+dom.offsetHeight+offsetTop;if($IE6&&_this.isFixed){x=x-document.documentElement.scrollLeft;y=y-document.documentElement.scrollTop}_this.setPosition(x,y)},"resize")},fadeIn:function(){var entity=this.entity;Core.Dom.opacity(entity,0);var i=0;!function fn(){Core.Dom.opacity(entity,i+=5);if(Core.Dom.getStyle(entity,"opacity")<1){setTimeout(fn,20)}}()}});scope.NewInboxPanel=Core.Class.define(function(){Lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(scope.newInboxPanelTemplate);this.nodes=this.getNodes();var me=this;var t=Lib.LocalDB;if(/Mobile/i.test(navigator.userAgent)){setTimeout(function(){me.requestDataInterface()},100)}else{if(!t.FlaDom){t._this=me;t.loadedFun=me.FlashLoaded;t.loadFlash("trayFlashConnetion")}else{me.FlashLoaded(me)}}Core.Events.addEvent($E("loginBarInbox"),function(event){v7sendLog("40_01_09_"+$UID);var target=event&&event.target||window.event&&window.event.srcElement;if(target&&target.tagName&&target.tagName.toLowerCase()=="a"){v7sendLog("45_01_10_"+$UID)}me._hasOverview=true;$E("ccnotepiaohong").style.display="none";me.requestMsgDate()},"click");this.interfaceMessages=new Interface("http://interface.blog.sina.com.cn/riaapi/profile/unread.php","jsload")},Lib.Panel,{nodes:null,_connectSWF:null,_SWFChannelName:"inboxConnection",interfaceMessges:null,isMessageLoaded:false,isUICServiceLoaded:true,isHaveNewMessage:false,_listData:null,_productIDs:{blog:1,vblog:2,group:4,photo:8,cube:16},_msgIsLoad:false,_newnote:0,_hasOverview:false,interfaceUICServiceURL:"http://uic.sinajs.cn/uic?type=service&uids=#{uids}&varname=service",FlashLoaded:function(me){var t=Lib.LocalDB;var _this=me;window.$updateData=function(dataObj){_this.updateData(dataObj)};Lib.checkAuthor(function(){t.login($UID);t.setClientJsFun("$updateData");setTimeout(function(){_this.requestDataInterface()},100)},"NewInboxPanel"+(new Date).getTime())},requestMsgDate:function(){this.updateView("loading");var me=this;var clearnum=0;if(this._hasOverview){clearnum=this._newnote;this._newnote=0;this._hasOverview=false}var inter=new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/profile/note/notetips.php?clearnum="+clearnum,"jsload");inter.request({GET:{uid:$UID},onSuccess:function(res){if(typeof res.announcement!="undefined"&&res.announcement){me.nodes["ccsysgonggao"].innerHTML='[<strong>公告</strong>]&nbsp;<a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">'+res.announcement+"</a>";me.nodes["ccsysgonggao"].parentNode.style.display=""}else{me.nodes["ccsysgonggao"].parentNode.style.display="none"}if(typeof res.sysNote!="undefined"&&res.sysNote){me.nodes["ccsystongzhi"].innerHTML='[<strong>通知</strong>]&nbsp;<a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">'+res.sysNote+"</a>";me.nodes["ccsystongzhi"].parentNode.style.display=""}else{me.nodes["ccsystongzhi"].parentNode.style.display="none"}if(typeof res.sysNote=="undefined"&&typeof res.announcement=="undefined"){me.nodes["ccsystongzhi"].parentNode.parentNode.style.display="none"}else{me.nodes["ccsystongzhi"].parentNode.parentNode.style.display=""}me.nodes["nomsgli"].style.display="";if(typeof res.notice!="undefined"&&res.notice){var aNotice=res.notice;while(me.nodes["changebgli2"].childNodes.length>2){me.nodes["changebgli2"].removeChild(me.nodes["changebgli2"].childNodes[me.nodes["changebgli2"].childNodes.length-3])}for(var i=aNotice.length-1;i>=0;i--){var li=$C("li");li.innerHTML=aNotice[i].data;li._href=aNotice[i].url;me.nodes["changebgli2"].insertBefore(li,me.nodes["changebgli2"].firstChild);li.onclick=function(){v7sendLog("45_01_11_"+$UID);window.location.href=this._href};me.nodes["nomsgli"].style.display="none"}}if(parseInt($E("ccnotepiaohong").innerHTML,10)>0){var num=parseInt($E("ccnotepiaohong").innerHTML,10);var cn=me.nodes["changebgli2"].childNodes;for(var j=0;j<cn.length-2&&j<num;j++){Core.Dom.removeClassName(cn[j],"cur");cn[j].className+=" cur"}}me.updateView("loaded");me._msgIsLoad=true;me.bindliEvent()},onError:function(data){},onFail:function(){}});var mailInter=new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/profile/note/unreadmail.php","jsload");mailInter.request({onSuccess:function(data){var tota=parseInt(data)||0;if(tota>99){tota="99+"}me.nodes.mailCount.innerHTML=tota||""},onError:function(){me.nodes.mailCount.innerHTML=""}})},requestDataInterface:function(){var _this=this;Lib.checkAuthor(function(){var t=Lib.LocalDB;var d=null;if(t.isFlashReady&&!_this.checkCache){_this.clearCache();d=t.get("uid_"+$UID+"unread",60*1e3*4);_this.checkCache=true}var unreadOk=function(data,isCache){if(!d&&!isCache){t.set("uid_"+$UID+"unread",data)}if(data["isBindToMsn"]==0&&Utils.Cookie.getCookie("noMoreMsnTips"+$UID)!=1){}_this.isMessageLoaded=true;_this.onMessageLoad(data["nickname"]);_this._listData=data;scope.unreadMsg=data;scope.nickname=data["full_nickname"];scope.loginUserWtype=data["login_wtype"];if(data.svr_time)scope.$svr_time=data.svr_time;if(data.nfn>=1){v7sendLog("40_01_03_"+$UID);_this.initNewStatusTip(data)}else{}_this.updateListData(data);if(_this.isMessageLoaded){_this.updateData({data:_this._listData});_this.onLoaded()}scope.hasOpenBlog=data.isbloguser==1?"open":"no";scope.bindTrayOpenTime=1;Lib.Listener.notify("tray-data-loaded",data);if(scope.hasOpenBlog=="no"&&scope.bindTrayOpenTime==1){if(!$E("openblogcss")){Utils.Io.loadCss({id:"openblogcss",url:$_GLOBAL.cssBasicURL+"module/layer/re_nowopen.css"})}$E("openedBlogTray").style.display="none";$E("noOpenedBlogTray").style.display="";$E("outOfOpenBlogTray").style.display="";scope.addBlogOpenerEvent($E("openBlogBtnTray"));$E("noOpenBlogName").href="http://blog.sina.com.cn/u/"+$UID;scope.bindTrayOpenTime=2}scope.unreadOkExecuted=true};if(d){unreadOk(d,true);trace("-------unread 使用缓存的数据!!!----")}else{trace("-----直接调用unread接口！！！");_this.interfaceMessages.request({GET:{uid:$UID,product:"blog"},onSuccess:unreadOk,onError:function(data){},onFail:function(){}})}},"NewInboxPanelrequestDataInterface"+(new Date).getTime())},clearCache:function(){var pageId={profile_notice:"notice",profile_paperlist:"message",profile_invitelist:"invite",profile_commlist:"blogcomment",profile_replylist:"blogrecomment",profile_guestBookM:"gbook",profile_commtrash:"trashcomment",profile_commphotolist:"photocomment",profile_index:"profile_index",profile_remind:"profile_remind"};var t=Lib.LocalDB;var d=t.get("uid_"+$UID+"unread",60*1e3*4);if(d&&pageId[scope.$pageid]&&typeof d[pageId[scope.$pageid]]!=undefined){trace("-----清除缓存");t.clearCache(10,"uid_"+$UID+"unread")}var ccn=$UID+"_clear_flash";var clearFlash=Utils.Cookie.getCookie(ccn);if(clearFlash==1){trace("【活动】根据cookie标记,清除Flash缓存");t.clearCache(10,"uid_"+$UID+"unread");Utils.Cookie.setCookie(ccn,"",0,"/",".sina.com.cn")}},initMsnTips:function(){Lib.checkAuthor(function(){(new scope.msnTips).initUserInfo($nick,$UID)},"NewInboxPanel"+(new Date).getTime())},initNewStatusTip:function(data){if(scope.$pageid=="profile_index"||scope.$pageid=="pageSetM"||scope.$pageid=="editor"){return}var tip=$E("newStatusTip");if(tip||!data){return}v7sendLog("45_01_07_"+$UID);tip=$C("div");tip.id="newStatusTip";tip.className="tb_layer_Y tb_layer_w3";tip.style.width="138px";tip.innerHTML=scope.newStatusTipTemplay;var a=$T($E("loginBarCenter"),"a")[0];var loc=Core.Dom.getXY(a);tip.style.left=loc[0]-(138/2-a.offsetWidth/2)+"px";tip.style.top=loc[1]+a.offsetHeight+"px";tip.style.zIndex="510";if(a.href.indexOf("?")==-1){a.href+="?type=2&from="+scope.$pageid}Core.Dom.opacity(tip,0);document.body.appendChild(tip);if(data.nfn>=1){$E("nstFeed").style.display="block";$E("nstFeed").onclick=function(){v7sendLog("45_01_09_"+$UID);v7sendLog("40_01_04_"+$UID)}}if(data.official_blog==1){$E("gbimg").style.display="";$E("gbmsg").style.display=""}for(var i=1;i<=500;i++){!function(val){setTimeout(function(){Core.Dom.opacity(tip,val*2/10)},val*2)}(i)}if(scope.$pageid=="editor"){a.target="_blank";$E("nstFeed").parentNode.target="_blank";$E("gbmsg").style.target="_blank";Core.Events.addEvent(a,this.closeTip(a),"click")}Core.Events.addEvent(window,function(){var a=$T($E("loginBarCenter"),"a")[0];var loc=Core.Dom.getXY(a);tip.style.left=loc[0]-(138/2-a.offsetWidth/2)+"px";tip.style.top=loc[1]+a.offsetHeight+"px"},"resize")},closeTip:function(ele){return function(){$E("newStatusTip").style.display="none";ele.href=ele.href.split("?")[0]}},updateData:function(dataObj){var t=Lib.LocalDB;var _this=this;Lib.checkAuthor(function(){try{if($UID&&$UID==dataObj.uid||t.getServer()==true){_this.isHaveNewMessage=false;_this.isMessageLoaded=false;_this.updateListData(dataObj.data);if(_this._newnote>0){v7sendLog("45_01_08_"+$UID);v7sendLog("40_01_08_"+$UID)}if(dataObj.data.nfn>=1){_this.initNewStatusTip()}}}catch(ex){}if(t.getServer()==true){Lib.checkAuthor(function(){t.sendToClient({data:dataObj.data,uid:$UID});setTimeout(function(){_this.requestUICService();_this.requestDataInterface()},6e4*4)},"NewInboxPanel"+(new Date).getTime())}else{setTimeout(function(){if(t.getServer()){t.setClientJsFun("$updateData");_this.requestUICService();_this.requestDataInterface()}},6e4*4)}},"NewInboxPanel"+(new Date).getTime())},initializeList:function(){this.requestUICService();this.checkCache=false},updateListData:function(dataCollection){try{var tota=0;tota+=parseInt(this._getFormatCountString(dataCollection["invite"])||0);if(tota>500){tota="500+"}this.nodes["inviteCount"].innerHTML=tota?tota:""}catch(e){}try{var tota=0;tota+=parseInt(this._getFormatCountString(dataCollection["message"])||0);if(tota>500){tota="500+"}this.nodes["messageCount"].innerHTML=tota?tota:""}catch(e){}try{var tota=0;tota+=parseInt(dataCollection["unreadnotices"]||0);tota+=parseInt(dataCollection["notice"]||0);if(tota>500){tota="500+"}this.nodes["sysnoticeCount"].innerHTML=tota?tota:""}catch(e){}Lib.checkAuthor();try{var tota=0;tota+=parseInt(this._getFormatCountString(dataCollection["gbook"])||0);tota+=parseInt(this._getFormatCountString(dataCollection["trashwall"])||0);if(tota>500){tota="500+"}this.nodes["guestBookCount"].innerHTML=tota?tota:""}catch(e){}try{var tota=0;tota+=parseInt(dataCollection["blogcomment"]||0);tota+=parseInt(dataCollection["blogrecomment"]||0);tota+=parseInt(dataCollection["photocomment"]||0);tota+=parseInt(dataCollection["trashcomment"]||0);if(tota>500){tota="500+"}this.nodes["commentRelapseCount"].innerHTML=tota?tota:""}catch(e){}this._newnote=parseInt(dataCollection["newnotes"],10);if(this._newnote>0){$E("ccnotepiaohong").innerHTML=this._newnote>500?"500+":this._newnote;$E("ccnotepiaohong").style.display=""}else{$E("ccnotepiaohong").style.display="none"}var i,msgCfg=["notice","invite","message","blogcomment","blogrecomment","photocomment","trashcomment","vblogcomment","gbook"],len=msgCfg.length;for(i=0;i<len;i++){if(parseInt(dataCollection[msgCfg[i]])>0){this.isHaveNewMessage=true}var k;for(k in dataCollection){if(k!="version"&&window.parseInt(dataCollection[k])>0){if($E("left_"+k)){$E("left_"+k).innerHTML="("+dataCollection[k]+")"}}}}},requestUICService:function(){var _this=this;Lib.checkAuthor(function(){if(_this.isMessageLoaded){_this.updateData({data:_this._listData});_this.onLoaded()}},"newInboxPanel_requestUICService"+(new Date).getTime())},_getFormatCountString:function(count){var result="";if(!isNaN(parseInt(count))&&parseInt(count)!=0){if(parseInt(count)>500){result="(<strong>500+</strong>)"}else{result=count}}return result},updateView:function(loadState){this.nodes["newInboxLoding"].style.display=loadState=="loaded"?"none":"";if(loadState=="loading"){this.nodes["nomsgli"].style.display="none"}},onLoaded:function(){},onMessageLoad:function(nickname){$E("loginBarAppMenuLabel").innerHTML=Core.System.htmlFilter(nickname);$E("noOpenBlogName").innerHTML=Core.System.htmlFilter(nickname)},bindliEvent:function(){var lis=this.nodes["changebgli1"].getElementsByTagName("li");var lis2=this.nodes["changebgli2"].getElementsByTagName("li");for(var i=0;i<lis.length;i++){lis[i].style.cursor="pointer";lis[i].onmouseover=function(){this._className=this.className;this.className="on"};lis[i].onmouseout=function(){this.className=this._className}}for(var i=0;i<lis2.length-1;i++){if(lis2[i]==this.nodes["nomsgli"]){continue}lis2[i].style.cursor="pointer";lis2[i].onmouseover=function(){this._className=this.className;this.className="on"};lis2[i].onmouseout=function(){this.className=this._className}}var commentdata=$E("commentdata");if(commentdata){Core.Events.addEvent(commentdata,function(event){logFunc(event)})}Core.Events.addEvent(this.nodes["changebgli1"],function(event){logFunc(event)});Core.Events.addEvent(this.nodes["changebgli2"],function(event){logFunc(event)});function logFunc(event){var target=event&&event.target||window.event&&window.event.srcElement;if(target&&target.tagName&&(target.tagName.toLowerCase()=="a"||target.tagName.toLowerCase()=="li")&&!target.getAttribute("reject")){v7sendLog("40_01_10_"+$UID);v7sendLog("45_01_11_"+$UID)}}}});scope.addArticleTemplate=['<div id="#{panel}" class="wrtBlog_sub" style="z-index:512;">','<div class="wrtBlog_sub2">','<p><img width="15" height="16" align="absmiddle" title="写365" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon138"><a onclick="v7sendLog(\'48_01_18\');v7sendLog(\'40_01_14\');" href="http://control.blog.sina.com.cn/admin/article/article_add.php?tag365" target="_blank">写365</a></p>','<div class="SG_j_linedot"></div>','<p><img class="SG_icon SG_icon88" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="长微博" align="absmiddle" /><a target="_blank" onclick="v7sendLog(\'40_01_14\')" href="http://control.blog.sina.com.cn/admin/article/changWeiBo.php">长微博</a></p>','<div class="SG_j_linedot"></div>','<p><img class="SG_icon SG_icon18" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="发照片" align="absmiddle" /><a target="_blank" onclick="v7sendLog(\'40_01_14\')" href="http://photo.blog.sina.com.cn/upload/upload.php">发照片</a></p>','<div class="SG_j_linedot"></div>','<p><img class="SG_icon SG_icon16" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="发视频" align="absmiddle" /><a target="_blank" onclick="v7sendLog(\'40_01_14\')" href="http://vupload.you.video.sina.com.cn/u.php?m=1">发视频</a></p>','<div id="tray_tbh_ware_linedot" style="display:none;" class="SG_j_linedot"></div>','<p id="tray_tbh_ware_link" style="display:none;"><img class="SG_icon SG_icon150" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="发商品" align="absmiddle" /><a target="_blank" onclick="v7sendLog(\'40_01_14\')" href="http://control.blog.sina.com.cn/admin/article/article_add.php?tbh=1">发商品</a></p>',"</div>","</div>"].join("");scope.addArticlePanel=Core.Class.define(function(){Lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(scope.addArticleTemplate);this.hidden()},Lib.Panel,{});Lib.PlatformTrayPlus=Core.Class.create();Lib.PlatformTrayPlus.prototype={tray:null,subPanels:[],trayLogin:null,initialize:function(){},load:function(loginState){var bar_logo=$E("login_bar_logo_link_350");if(bar_logo&&$_GLOBAL&&$_GLOBAL.platformTrayLogo){if(!$IE6&&$_GLOBAL.platformTrayLogo.imgForOtherBrs){bar_logo.children[0].src=$_GLOBAL.platformTrayLogo.imgForOtherBrs}else if($_GLOBAL.platformTrayLogo.imgForIE6){bar_logo.children[0].src=$_GLOBAL.platformTrayLogo.imgForIE6}}switch(loginState){case"login":if($E("loginBarOptApp")==null||!$isAdmin){this.render(scope.trayPlusTemplayLogin);trace("++++js渲染 登陆后++++++")}this.initStatic();if(/ipad/i.test(navigator.userAgent)){v7sendLog("48_01_02")}this.setNodesMouseHoverStyle(["loginBarOptApp","loginBarMail","loginBarCenter","loginBarFriend","loginBarInbox"]);this.initNicknamePanel();this.initNewInboxPanel();this.initActivityPanel();var that=this;Utils.Io.JsLoad.request("http://service.mail.sina.com.cn/mailproxy/mail.php",{onComplete:function(){var email=sinamailinfo.email;if(email!=""){that.initMailRemind()}},onException:function(){}});this.initMsnLogout();if(scope&&scope.$private&&scope.$private.msnfeed){var _this=this;setTimeout(function(){_this.displayUserGuideTips()},1e3)}break;case"logout":this.trayLogin=new Lib.Login.Ui;if($E("phprender")===null){this.render(scope.trayPlusTemplayLogout);trace("-----------js渲染---------")}else{trace("-----------php渲染---------")}this.initLogin();this.initPopularize();break;case"oncelogedon":this.trayLogin=new Lib.Login.Ui;this.render(scope.trayPlusTemplayOnceLoged);this.setNodesMouseHoverStyle(["loginBarOptApp","loginBarMail","loginBarCenter","loginBarFriend","loginBarInbox"]);var info=Lib.Login.info();var uid=info&&info.uid;$E("loginBarAppMenuLabel").innerHTML=info&&info.nick;this.initPopularize();this.initOnceLogedEvent(["loginBarOptApp","loginBarMail","loginBarCenter","loginBarFriend","loginBarInbox"],uid);this.initOnceLogedTips(uid);this.initStatic();break}this.initAddArticlePanel();this.initSearchPanel();this.initFilmSearch()},displayUserGuideTips:function(){if(!window.scope||scope.$pageid==="profile_index"){Utils.Cookie.setCookie($UID+"alreadyVisitProfileIndex","true","86400","/",".sina.com.cn");return}var _this=this;function updateTipPos(){var loginBarCenter=$E("loginBarCenter");if(loginBarCenter){var pos=Core.Dom.getXY(loginBarCenter),left=pos[0]+loginBarCenter.offsetWidth/2-_this.tipsUserGuide.offsetWidth/2+"px",top=pos[1]+loginBarCenter.offsetHeight+10+"px"}_this.tipsUserGuide.style.left=left;_this.tipsUserGuide.style.top=top}},initStatic:function(){if(!this._commetTimer){var send=function(){var uid=scope.$uid;var blogid=scope.$articleid||"";var url="http://comet.blog.sina.com.cn/api?maintype=notice";Utils.Io.JsLoad.request(url,{GET:{uid:uid||"",blogid:blogid},onComplete:function(r){}})};this._commetTimer=setInterval(send,30*1e3);setTimeout(function(){send()},15)}},initFilmSearch:function(){var ele=$E("loginBarSearchInput");ele&&(ele.value="");var tag=$E("loginBarSearchSType");tag&&(tag.value="title")},render:function(html){$E("trayContainer").innerHTML=html},initLogin:function(){var me=this;var homeNode=Core.Dom.getElementsByClass($E("trayContainer"),"span","link")[0];homeNode.onclick=function(){v7sendLog("40_01_15")};Core.Events.addEvent($E("linkTrayLogin"),function(){v7sendLog("40_01_16");if(typeof sinaSSOController!="undefined")sinaSSOController.loginExtraQuery={};me.trayLogin.login(function(){Lib.checkAuthor(function(){var str=$UID==scope.$uid?"02":"01";v7sendLog("87_01_"+str+"_"+$UID,scope.$pageid)},"PlatformTrayPlus"+(new Date).getTime());setTimeout(function(){window.location=window.location.toString().replace(/#.*/,"")},100)},false,"referer:"+location.hostname+location.pathname+",func:0007")},"click");$E("linkReg").href="https://login.sina.com.cn/signup/signupmail.php?entry=blog&srcuid="+scope.$uid+"&src=blogicp";$E("linkReg").onclick=function(){v7sendLog("40_01_17")};if(scope.$channel){if(scope.$channel==2){$E("linkReg").href="https://login.sina.com.cn/signup/signupmail.php?entry=blog&srcuid="+scope.$uid+"&src=baby"}}},initPopularize:function(){var popEl=$E("divPopularize");if(popEl){this.hideActiLink(popEl);this._loadPopularizeData(popEl)}},_loadPopularizeData:function(parentEl){Utils.Io.JsLoad.request("http://blog.sina.com.cn/lm/iframe/283/2012/0705/1.js",{charset:"utf-8",onComplete:function(data){var cfg=$_GLOBAL.popularizeConfig;if(!cfg||parentEl.innerHTML){return}var len=cfg.length;var cookieUtil=Utils.Cookie;var index=parseInt(cookieUtil.getCookie("blogPopularizeIndex")||0);if(len<=index){index=0}cookieUtil.setCookie("blogPopularizeIndex",1+index,24,"/",".blog.sina.com.cn");parentEl.innerHTML=cfg[index];if($E("err_i8t9c")){var txt=parentEl.innerText||parentEl.textContent||"";if(txt.length>10){parentEl.children[0].innerHTML=txt.substr(0,9)+"..."}}}})},setNodesMouseHoverStyle:function(nodeNames){var i,len=nodeNames.length;for(i=0;i<len;i++){Core.Events.addEvent($E(nodeNames[i]),function(idx){return function(){Core.Dom.removeClassName($E(nodeNames[idx]),"current");$E(nodeNames[idx]).className+=" current"}}(i),"mouseover");Core.Events.addEvent($E(nodeNames[i]),function(idx){return function(){Core.Dom.removeClassName($E(nodeNames[idx]),"current")}}(i),"mouseout")}$E("loginBarCenter").onclick=function(){v7sendLog("40_01_05_"+$UID)};$E("loginBarFriend").onclick=function(){v7sendLog("40_01_06_"+$UID)};$E("logOut").onclick=function(){v7sendLog("40_01_11_"+$UID)}},initNicknamePanel:function(){var nicknamePanel=new scope.NicknamePanel;var _this=this;Lib.checkAuthor(function(){nicknamePanel.initUserInfo($UID);_this.addSubPanel(nicknamePanel,$E("loginBarOptApp"),-98,-9)},"PlatformTrayPlus1"+(new Date).getTime());var me=this;if(Utils.Cookie.getCookie("loginFromMsn")&&!$E("msnLoginIcon")){var holder=$C("img");holder.src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif";holder.style.cssFloat=holder.style.styleFloat="left";holder.width="18";holder.height="0";holder.style.padding="9px 0";holder.align="absmiddle";Core.Dom.insertAfter(holder,$E("loginBarAppMenuLabel"));trace("创建msn icon");createLinkMask(holder)}else{trace("不渲染msn icon")}function createLinkMask(holder){var mask=$C("a");var span=holder.parentNode;var container=span.parentNode;var node=$C("img");container.style.position="relative";span.style.position="relative";node.id="msnLoginIcon";node.className="SG_icon SG_icon136";node.src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif";node.style.width="18px";node.style.height="18px";node.align="absmiddle";mask.appendChild(node);mask.href="http://control.blog.sina.com.cn/blogprofile/msnbind.php?c="+ +new Date;mask.target="_blank";mask.style.cssText="display:block; width:18px; height:18px; position:absolute; z-index:1024;";mask.style.paddingTop="4px";mask.title="MSN账号登录";container.insertBefore(mask,container.childNodes[0]);Core.Events.addEvent(window,relocation,"resize");trace("创建msn icon mask");relocation();function relocation(){var timer=setInterval(function(){var adminName=$E("loginBarAppMenuLabel").innerHTML;if(adminName!=="读取中..."){var strLeft=holder.offsetLeft+"px";mask.style.left=strLeft;trace("刷新msn icon mask");clearInterval(timer)}},300)}scope.$msnRelocation=relocation}},initAddArticlePanel:function(){var addArticlePanel=new scope.addArticlePanel;this.addSubPanel(addArticlePanel,$E("arrowAddArticle"),-81,0);$E("arrowAddArticle").onclick=function(){v7sendLog("40_01_13_"+($UID?$UID:""))};$E("arrowAddArticle").parentNode.children[0].onclick=function(){v7sendLog("40_01_12_"+($UID?$UID:""))}},showPublishWare:function(data){if(data["tbh_status"]&&parseInt(data["tbh_status"],10)){$E("tray_tbh_ware_linedot").style.display="";var publishBtn=$E("tray_tbh_ware_link");publishBtn.style.display="";try{var link=$T(publishBtn,"a")[0];if(scope&&"editor"==scope.$pageid){link.href="javascript:;";link.target="";link.onclick=function(){var plugin=$E("shortcut_content");var imgs=$T(plugin,"img");for(var i=0;i<imgs.length;i++){if(-1!=imgs[i].src.indexOf("element_shop")){Core.Events.click(imgs[i])}}}}link=null;publishBtn=null}catch(e){}}Lib.Listener.off({name:"tray-data-loaded",callBack:this.showPublishWare,scope:this})},initSearchPanel:function(){var searchPanel=new scope.SearchPanel;this.addSubPanel(searchPanel,$E("searchSelect"),-54,-4);Utils.Form.limitMaxLen($E("loginBarSearchInput"),50);var spNodes=searchPanel.getNodes();var cfg;for(cfg in searchPanel.config){!function(c){Core.Events.addEvent(spNodes[c],function(){_setActiveOption(c)},"click")}(cfg)}_setActiveOption("blog");$E("searchSelect").onclick=function(){v7sendLog("40_01_18")};var searchNode=Core.Dom.getElementsByClass($E("loginBarSearchForm"),"input","topbar_searchBtn")[0];searchNode.onclick=function(){v7sendLog("40_01_20")};Core.Events.addEvent($E("loginBarSearchInput"),function(e){var c=e.keyCode||e.charCode;if(c==15){v7sendLog("40_01_20")}},"keyup");function _setActiveOption(opt){var formEl=$E("loginBarSearchForm");formEl.action=searchPanel.config[opt]["url"];$E("loginBarSearchMenuLabel").innerHTML=spNodes[opt].getElementsByTagName("a")[0].innerHTML;var searchCEl=$E("loginBarSearchC"),searchTEl=$E("loginBarSearchT"),searchTypeEl=$E("loginBarSearchType"),searchSEl=$E("loginBarSearchS"),searchTSEl=$E("loginBarSearchTS"),searchTextEl=$E("loginBarSearchInput");switch(opt){case"all":case"blog":case"bauthor":if(!searchCEl){searchCEl=$C("input");searchCEl.type="hidden";searchCEl.name="c";searchCEl.id="loginBarSearchC";formEl.appendChild(searchCEl)}searchCEl.value="blog";searchTEl.value=searchPanel.config[opt]["range"];searchTEl.name="range";searchTypeEl.value=searchPanel.config[opt]["by"];searchTypeEl.name="by";searchTextEl.name=searchPanel.config[opt]["keyName"];break;case"song":case"video":case"vauthor":searchCEl&&(searchCEl.value="");searchTEl.value=searchPanel.config[opt]["t"];searchTEl.name="t";searchSEl.value=searchPanel.config[opt]["s"];searchTSEl.value=searchPanel.config[opt]["ts"];searchTypeEl.value=searchPanel.config[opt]["type"];searchTypeEl.name="type";$E("loginBarSearchSType").value=searchPanel.config[opt]["stype"];searchTextEl.name=searchPanel.config[opt]["keyName"];break}}},hideActiLink:function(el){var pageId=scope.$pageid;if("pageSetM"!==pageId&&"editor"!==pageId){el.style.display="none";el.setAttribute("shouldShow","1")}setTimeout(function(){if(typeof BLOG_AD_TIPS=="undefined"||!BLOG_AD_TIPS){el.style.display="";return}},3e3)},initActivityPanel:function(){if($_GLOBAL){var loginActLink=$E("loginBarActivity");if(loginActLink){this.hideActiLink(loginActLink);this._loadPopularizeData(loginActLink)}}if($_GLOBAL.activityBlackList&&$_GLOBAL.activityBlackList[scope.$pageid]){trace("【活动】当前页面在黑名单");return}},initMsnLogout:function(){var _tray=$E("openedBlogTray");var _a_list=_tray.getElementsByTagName("a");var _logout_a=_a_list[_a_list.length-1];_logout_a.href="#";_logout_a.onclick=function(){return false};var _tray_noIn=$E("noOpenedBlogTray");var _a_list_noIn=_tray_noIn.getElementsByTagName("a");var _logout_a_noIn=_a_list_noIn[_a_list_noIn.length-1];_logout_a_noIn.href="#";_logout_a_noIn.onclick=function(){return false};var _curHref=encodeURIComponent(window.location.href);if(_tray)Core.Events.addEvent(_logout_a,logoutMsnAndBlog);if(_tray_noIn)Core.Events.addEvent(_logout_a_noIn,logoutMsnAndBlog);function logoutMsnAndBlog(){new Interface("http://control.blog.sina.com.cn/blog_rebuild/msn/api/msnLoginOut.php","jsload").request({onSuccess:function(res){window.location.href="https://login.sina.com.cn/cgi/login/logout.php?r="+_curHref},onError:function(res){window.location.href="https://login.sina.com.cn/cgi/login/logout.php?r="+_curHref},onFail:function(res){window.location.href="https://login.sina.com.cn/cgi/login/logout.php?r="+_curHref}})}},addSubPanel:function(panel,dom,offsetLeft,offsetTop){var _this=this;this.subPanels.push(panel);function _showPanel(){Core.Events.stopEvent();var i,len=_this.subPanels.length;for(i=0;i<len;i++){_this.subPanels[i].hidden()}panel.showWithDom(dom,offsetLeft,offsetTop)}Core.Events.addEvent(dom,function(){if(dom===$E("loginBarOptApp")){v7sendLog("40_01_01_"+$UID)}_showPanel()},"click");Core.Events.addEvent(document.body,function(){panel.hidden()},"click");Core.Events.addEvent(panel.entity,function(){Core.Events.stopEvent()},"mousedown");Core.Events.addEvent(window,function(){var x=Core.Dom.getLeft(dom)+dom.offsetWidth+offsetLeft;var y=Core.Dom.getTop(dom)+dom.offsetHeight+offsetTop;if($IE6&&this.isFixed){x=x-document.documentElement.scrollLeft;y=y-document.documentElement.scrollTop}panel.setPosition(x,y)},"resize")},initNewInboxPanel:function(){var newInboxPanel=new scope.NewInboxPanel;this.addSubPanel(newInboxPanel,$E("loginBarInbox"),-137,-9);try{if(!$E("ccnotepiaohong")){var di=$C("div");di.className="imforbox";di.style.display="none";di.id="ccnotepiaohong";$E("loginBarInbox").appendChild(di)}$E("loginBarInbox").className="link imfor"}catch(e){}newInboxPanel.onMessageLoad=function(nickname){$E("loginBarAppMenuLabel").innerHTML=nickname;$E("noOpenBlogName").innerHTML=Core.System.htmlFilter(nickname)}},initMailRemind:function(){if($E("loginBarMail")&&$E("line")){$E("loginBarMail").style.display="";$E("line").style.display=""}function remindEmail(){var mailInter=new Interface("http://interface.blog.sina.com.cn/riaapi/profile/unreadmail.php","jsload");mailInter.request({onSuccess:function(data){var tota=parseInt(data,10);if(tota>99){tota="99+"}if(tota!==0&&$E("mailpiaohong")){var num=$E("mailpiaohong");num.style.display="";
num.innerHTML=tota}else{$E("mailpiaohong").style.display="none"}},onError:function(){$E("mailpiaohong").style.display="none"}})}remindEmail();var remind=setInterval(remindEmail,5*60*1e3);Core.Events.addEvent($E("loginBarMail"),function(){v7sendLog("40_01_07_"+$UID);var redEl=$E("mailpiaohong");var isRed=!redEl.style.display;if(isRed){redEl.style.display="none"}},"click");Core.Events.addEvent($E("mailpiaohong"),function(){var redEl=$E("mailpiaohong");redEl.style.display="none";window.open("http://mail.sina.com.cn/?s=2")},"click")},initOnceLogedEvent:function(nodeNames,uid){var i,len=nodeNames.length;var me=this;for(i=0;i<len;i++){$E(nodeNames[i]).onclick=function(){switch(this.id){case"loginBarOptApp":v7sendLog("44_01_07_"+uid);break;case"loginBarMail":v7sendLog("44_01_08_"+uid);break;case"loginBarCenter":v7sendLog("44_01_09_"+uid);break;case"loginBarFriend":v7sendLog("44_01_10_"+uid);break;case"loginBarInbox":v7sendLog("44_01_11_"+uid);break}if(typeof sinaSSOController!="undefined")sinaSSOController.loginExtraQuery={};me.trayLogin.login(function(){setTimeout(function(){window.location=window.location.toString().replace(/#.*/,"")},100)},false);return false}}},initOnceLogedTips:function(uid){var me=this;var messageUrl="http://interface.blog.sina.com.cn/riaapi/profile/unread.php";Utils.Io.JsLoad.request(messageUrl,{GET:{uid:uid,product:"blog"},onComplete:function(res){if(scope.$pageid=="profile_index"||scope.$pageid=="pageSetM"||scope.$pageid=="editor"){return}var tip=$E("newStatusTip");if(!tip){tip=$C("div");tip.id="newStatusTip";tip.className="tb_layer_Y tb_layer_w3";tip.style.width="138px";tip.innerHTML=scope.onceLogedStatusTipTemplay;var a=$T($E("loginBarCenter"),"a")[0];var loc=Core.Dom.getXY(a);tip.style.left=loc[0]-(138/2-a.offsetWidth/2)+"px";tip.style.top=loc[1]+a.offsetHeight+"px";tip.style.zIndex="510";tip.style.display="none";document.body.appendChild(tip)}if(res.data.unreadnotes>=1){v7sendLog("44_01_12_"+uid);tip.style.display="block";$E("nstUnread").style.display="block";$E("nstUnread").onclick=function(){v7sendLog("44_01_13_"+uid);if(typeof sinaSSOController!="undefined")sinaSSOController.loginExtraQuery={};me.trayLogin.login(function(){setTimeout(function(){window.location="http://i.blog.sina.com.cn/blogprofile/profilelatestnote.php"},100)},false);return false}}else if(res.data.nfn>=1){v7sendLog("44_01_14_"+uid);tip.style.display="block";$E("nstFeed").style.display="block";$E("nstFeed").onclick=function(){v7sendLog("44_01_15_"+uid);if(typeof sinaSSOController!="undefined")sinaSSOController.loginExtraQuery={};me.trayLogin.login(function(){setTimeout(function(){window.location="http://i.blog.sina.com.cn/blogprofile/index.php?type=3&from=newstatus&com=2"},100)},false);return false}}Core.Events.addEvent(window,function(){var a=$T($E("loginBarCenter"),"a")[0];var loc=Core.Dom.getXY(a);tip.style.left=loc[0]-(138/2-a.offsetWidth/2)+"px";tip.style.top=loc[1]+a.offsetHeight+"px"},"resize")},onException:function(data){}})}};$registJob("tray_new",function(){Lib.Listener.add("tray-data-loaded");var _addEvt=Core.Events.addEvent;var JSON=Lib.util.JSON;var tray;var $logo=$E("login_bar_logo_link_350");var isNewTray="ntopbar_main"===$logo.parentNode.className;var attr=function(el,attr,v){if(typeof v!=="string"){return el.getAttribute(attr)}else{return el.setAttribute(attr,v)}};function moveChilds(childs,target){for(var i=0;i<childs.length;i++){clone=childs[i].cloneNode(true);target.appendChild(clone)}}function getMaxWidth(lis){var maxW=0;for(var i=0;i<lis.length;i++){var li=lis[i];var clone=document.createElement("span");document.body.appendChild(clone);clone.style.cssText="font-size:14px;padding:0 20px 0;";moveChilds(li.childNodes,clone);maxW=Math.max(clone.offsetWidth,maxW)+5+10;document.body.removeChild(clone)}return maxW}Lib.tray.msgSummaryPanel.prototype._updateCont=function(fun){var _list=[];var _this=this;this._lock=0;if(this._requirestate){this._getDate({},function(_data){_list.push(_this._getComment(_data));_list.push(_this._getMessage(_data));_list.push(_this._getGbook(_data));_list.push(_this._getNotice(_data));$E("j-summary-list").innerHTML=_list.join("");_this._srcPot.setAttribute("old-msg-count",_this._srcPot.getAttribute("msg-count"));var lis=$E("j-summary-list").getElementsByTagName("li");var maxW=getMaxWidth(lis);$E("j-summary-list").style.width=maxW+"px";_this._showAction()},function(_data){});this._requirestate=0}};Lib.tray.TrayPanel.prototype._ie6fix=function(){};Lib.tray.msgSummaryPanel.prototype._setThePos=function(){if($IE6||$IE7||$IE8){this.entity.style.width="auto"}var pop=Core.Dom.getXY(this._srcPot);var sv=this._srcPot.className=="link"?-2:0;var width=$IE7||$IE6||$IE8?this.entity.offsetWidth:this.entity.clientWidth;var x=pop[0]+this._srcPot.clientWidth-width+sv;var y=pop[1]+this._srcPot.clientHeight;if($IE6||$IE7||$IE8){this.entity.style.width=this.entity.clientWidth+1+"px";this.entity.style.width=this.entity.clientWidth-1+"px";y=y-2}if($IE6)y=y-1;this.setPosition(x,y)};Lib.tray.unReadMsgPanel.prototype._setThePos=function(){var pop=Core.Dom.getXY(this._srcPot);var sv=this._srcPot.className=="link"?-2:0;var width=$IE7||$IE6?this.entity.offsetWidth:this.entity.clientWidth;if(pop[0]){var x=pop[0]+this._srcPot.clientWidth-width+sv;var _y=0;if(this._srcPot.getAttribute("adshow")==1&&this._scrolling===0){_y=pop[1]}var y=this._srcPot.clientHeight+_y+26;this.setPosition(x,y)}};Lib.tray.SearchFormPanel.prototype.showCateSearch=function($withEl,offset,v){var catePanel=this.catePanel;if(v&&catePanel.isHidden){catePanel.showWithDom($withEl,-offset,2)}else if(!v){this.hideCateSearch()}catePanel.updateSearch(v)};Lib.tray.TrayPanel.prototype.showNewMsgTips=function(data,sign){var sum=data.sum-data.feed;var $tips=this.getNode("newTips");var $trayMsg=this.getNode("trayMsg");var offsetLeft,offsetTop;if(sum){if($trayMsg.getAttribute("unread-show-state")=="0"&&$trayMsg.getAttribute("msg-panel-show-state")=="0"){$tips.style.display="block"}if(scope.$pageid=="editor"){$tips.style.display="block"}var msgNode=this.getNode("trayMsg");offsetLeft=Core.Dom.getXY(msgNode)[0];offsetTop=Core.Dom.getXY(msgNode)[1];$tips.style.left=offsetLeft+msgNode.offsetWidth-$tips.offsetWidth+5+"px";$tips.style.top=offsetTop-5+"px";if(sum<10){$tips.innerHTML=sum}else{$tips.innerHTML="•••"}if(!this.newTipsLog){v7sendLog("40_01_49_"+$UID);this.newTipsLog=1}$trayMsg.setAttribute("msg-count",JSON.stringify(data));this.startTitleTips(sum)}else{$trayMsg.setAttribute("msg-count",JSON.stringify(data));this.stopTitleTips()}var feed=data.feed;if(feed){var $feed=this.getNode("newFeed");$feed.style.display="block";var centerNode=Core.Dom.getElementsByClass(this.entity,"span","link")[1];offsetLeft=Core.Dom.getXY(centerNode)[0];offsetTop=Core.Dom.getXY(centerNode)[1];$feed.style.left=offsetLeft+centerNode.offsetWidth-$feed.offsetWidth-5+"px";$feed.style.top=offsetTop-5+"px";feed=feed<10?feed:"•••";$feed.innerHTML=feed;if(!$feed.addEvt){$feed.addEvt=1;_addEvt($feed,function(){location.href="http://i.blog.sina.com.cn/blogprofile/index.php?com=1";$feed.style.display="none";$feed.innerHTML=""})}}};var logoId="login_bar_logo_link_350";Lib.tray.TrayPanel.prototype.initBlogMenu=function(info){var $bindEl=this.getNode("addArticle");var isInit=attr($bindEl,"init");if(!isInit){attr($bindEl,"init","1");var $this=this;var $tabEl=$this.getNode("blogMenu");var flag=0;Lib.util.hoverJq({elm:$tabEl,mouseenter:function(e,el,i){var offsetLeft=$tabEl.offsetWidth;clearTimeout($this.hoverTimeout);if(!flag){flag=1;var blogMenu=$this._findSub("blogMenu");var panel;if(!blogMenu){panel=new Lib.tray.BlogMenuPanel;$this.addSubPanel("blogMenu",panel,$bindEl,$tabEl);if(info["tbh_status"]===1){panel.getNode("tbh_status").style.display=""}}var $blogMenuPanel=panel.getNode("panel");Lib.util.hoverJq({elm:$blogMenuPanel,mouseenter:function(e,el,i){clearTimeout($this.hoverTimeout);$this._showPanel("blogMenu",-offsetLeft,-1)},mouseleave:function(e,el,i){$this.hoverTimeout=setTimeout(function(){$this._hideActiveSub()},$this.hoverTime)}})}if($IE6){$this._showPanel("blogMenu",-offsetLeft,-2)}else{$this._showPanel("blogMenu",-offsetLeft,-1)}},mouseleave:function(e,el,i){$this.hoverTimeout=setTimeout(function(){$this._hideActiveSub()},$this.hoverTime)}})}};Lib.tray.TrayPanel.prototype.initUserMenu=function(){var $bindEl=this.getNode("userMenu");var isInit=attr($bindEl,"init");if(!isInit){attr($bindEl,"init","1");var $this=this;var hasEmail;var $tabEl=$this.getNode("userMenu");var userMenu=$this._findSub("userMenu");var flag=0;Lib.util.hoverJq({elm:$bindEl,mouseenter:function(e,el,i){clearTimeout($this.hoverTimeout);if(!flag){flag=1;var panel;if(!userMenu){panel=new Lib.tray.UserMenuPanel;$this.addSubPanel("userMenu",panel,$bindEl,$tabEl)}else{panel=userMenu.panel}var $userPanelNode=panel.getNode("panel");panel.initUserInfo($UID);Lib.util.hoverJq({elm:$userPanelNode,mouseenter:function(e,el,i){clearTimeout($this.hoverTimeout);$this._showPanel("userMenu",-183,-1)},mouseleave:function(e,el,i){$this.hoverTimeout=setTimeout(function(){$this._hideActiveSub()},$this.hoverTime)}});getEmail(function(hasEmail){if(hasEmail){panel.getNode("mail").style.display=""}})}if($IE6){$this._showPanel("userMenu",-183,-2)}else{$this._showPanel("userMenu",-183,-1)}},mouseleave:function(e,el,i){$this.hoverTimeout=setTimeout(function(){$this._hideActiveSub()},$this.hoverTime)}});var getEmail=function(cb){if(typeof hasEmail==="boolean"){cb(hasEmail)}else{Utils.Io.JsLoad.request("http://service.mail.sina.com.cn/mailproxy/mail.php",{onComplete:function(){var email=sinamailinfo.email;if(email!==""){hasEmail=!0}else{hasEmail=!1}cb(hasEmail)},onException:function(){}})}}}};if(isNewTray){tray=Lib.TrayPanel()}else{tray=new Lib.PlatformTrayPlus}var userInfo=Lib.Login.info();var uid=userInfo.uid;window.$onceLog=false;var onceloggedonblog=unescape(Utils.Cookie.getCookie("onceloggedonblog"));if(onceloggedonblog&&uid){time=onceloggedonblog;var now=(new Date).getTime();if(time&&now>time){$onceLog=true}}Lib.checkAuthor(function(){if($isLogin){tray.load("login")}else if(!isNewTray&&$onceLog){tray.load("oncelogedon")}else{tray.load("logout")}},"tray"+(new Date).getTime());window.$tray={};window.$tray.renderLogin=function(){Lib.checkAuthor(function(){if($isLogin){tray.load("login")}},"tray1_"+(new Date).getTime())};window.$tray.renderLogout=function(){tray.load("logout")}});$registJob("login",function(){var Login=new Lib.Login.Ui;Core.Events.addEvent("loginbtn",function(){Login.login(function(){alert("做一些，登陆之后，做的事情，呵呵！")})})});Lib.insertMoban=function(){if(scope.tpl&&scope.tpl!=""&&(scope.tpl.split("_")[0]=="13"||$_GLOBAL.flashtemplate[scope.tpl])){Lib.insertMobanFunc(scope.tpl)}};Lib.insertMobanFunc=function(id){var headflash=$E("headflash");if(headflash){headflash.innerHTML="";headflash.style.display="";var swf_url="http://simg.sinajs.cn/blog7newtpl/css/"+id.split("_")[0]+"/"+id+"/top.swf";var width=950,height=266;if($_GLOBAL.flashtemplate[id].width){width=$_GLOBAL.flashtemplate[id].width}if($_GLOBAL.flashtemplate[id].height){height=$_GLOBAL.flashtemplate[id].height}trace("flash height="+height);var x=Utils.Flash.swfView.Add(swf_url,"headflash","headflash_f",width,height,"9.0.0.0","#000",{},{allowScriptAccess:"false",wmode:"transparent",allowFullScreen:"false"})}};Lib.tplFuncArr={};Lib.tplFuncCount=0;Lib.getTplNum=function(func){Lib.tplFuncArr[Lib.tplFuncCount++]=func||function(){};if($isAdmin&&scope.tpl&&scope.tpl!=""){for(var k in Lib.tplFuncArr){Lib.tplFuncArr[k]();Lib.tplFuncArr[k]=null;delete Lib.tplFuncArr[k]}return}else{if($IE){var ss=document.styleSheets;var re=/\S*(blog7tpl([^t]*))\S*/gi;var re2=/\S*(blog7newtpl\/css([^t]*))\S*/gim;for(var i=0;i<ss.length;i++){if(ss[i].id=="uid_link_css"){var res=re.exec(ss[i].cssText);var res2=re2.exec(ss[i].cssText);if(res!=null||res2!=null){if(res!=null){scope.tpl=res[2].split("/")[2]}else if(res2!=null){scope.tpl=res2[2].split("/")[2]}}break}}for(var k in Lib.tplFuncArr){Lib.tplFuncArr[k]();Lib.tplFuncArr[k]=null;delete Lib.tplFuncArr[k]}}else if(!$IE&&scope.$PRODUCT_NAME=="blog7"){for(var k in Lib.tplFuncArr){Lib.tplFuncArr[k]();Lib.tplFuncArr[k]=null;delete Lib.tplFuncArr[k]}return;Utils.Io.Ajax.request("http://blog.sina.com.cn/s/"+scope.$uid+".css?",{onComplete:function(text){text=text.replace("\n","");var re=/\S*(blog7tpl([^t]*))\S*/gim;var re2=/\S*(blog7newtpl\/css([^t]*))\S*/gim;var res=re.exec(text);var res2=re2.exec(text);if(res!=null||res2!=null){if(res!=null){scope.tpl=res[2].split("/")[2]}else if(res2!=null){scope.tpl=res2[2].split("/")[2]}}for(var k in Lib.tplFuncArr){Lib.tplFuncArr[k]();Lib.tplFuncArr[k]=null;delete Lib.tplFuncArr[k]}}.bind2(this),returnType:"txt"})}else if(!$IE&&scope.$PRODUCT_NANM!="blog7"){Utils.Io.JsLoad.request("http://blog.sina.com.cn/s/"+scope.$uid+".js",{GET:{tm:(new Date).getTime()},onComplete:function(){for(var k in Lib.tplFuncArr){Lib.tplFuncArr[k]();Lib.tplFuncArr[k]=null;delete Lib.tplFuncArr[k]}}.bind2(this)})}}};$registJob("getTplNum",function(){});function main(){if(window!=parent){parent.location.href=window.location.href}v7sendLog("42_01_16");var job=new Jobs;job.add("suda");job.add("checkImgBlogger");job.add("editor_init");job.add("editor_focus");job.add("article_associate");job.add("article_cate");job.add("editor_mjtag");job.add("article_permission");job.add("send_article_page_init");job.add("newEditorGuideLayer");job.add("adNoticeChannel");job.add("blogNotice");job.add("tray_new");job.add("login");job.add("getTplNum");job.start()}